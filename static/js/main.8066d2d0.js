/*! For license information please see main.8066d2d0.js.LICENSE.txt */
(()=>{"use strict";var e={730(e,t,n){var r=n(43),s=n(853);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function g(e,t,n,r,s,i,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){m[e]=new g(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){m[e]=new g(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){m[e]=new g(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){m[e]=new g(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){m[e]=new g(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var s=m.hasOwnProperty(t)?m[t]:null;(null!==s?0!==s.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,s,r)&&(n=null),r||null===s?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=null===n?3!==s.type&&"":n:(t=s.attributeName,r=s.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(s=s.type)||4===s&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)}),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)});var E=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),L=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function N(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var M,F=Object.assign;function U(e){if(void 0===M)try{throw Error()}catch(sE){var t=sE.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var j=!1;function B(e,t){if(!e||j)return"";j=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var s=c.stack.split("\n"),i=r.stack.split("\n"),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(1!==a||1!==o)do{if(a--,0>--o||s[a]!==i[o]){var l="\n"+s[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{j=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function V(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function z(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case S:return"Portal";case x:return"Profiler";case k:return"StrictMode";case _:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case L:return(e.displayName||"Context")+".Consumer";case I:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:z(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return z(e(t))}catch(sE){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return z(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=K(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(nE){return e.body}}function Q(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Z(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(r&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ie(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,s){MSApp.execUnsafeLocalFunction(function(){return e(t,n)})}:e}(function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function pe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),s=pe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,s):e[n]=s}}Object.keys(he).forEach(function(e){fe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]})});var me=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(me[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function Ee(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Te=null;function ke(e){if(e=ys(e)){if("function"!==typeof we)throw Error(i(280));var t=e.stateNode;t&&(t=Es(t),we(e.stateNode,e.type,t))}}function xe(e){Se?Te?Te.push(e):Te=[e]:Se=e}function Ie(){if(Se){var e=Se,t=Te;if(Te=Se=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Le(e,t){return e(t)}function Ce(){}var _e=!1;function Ae(e,t,n){if(_e)return e(t,n);_e=!0;try{return Le(e,t,n)}finally{_e=!1,(null!==Se||null!==Te)&&(Ce(),Ie())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var r=Es(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Pe=!1;if(u)try{var De={};Object.defineProperty(De,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(Yb){Pe=!1}function Oe(e,t,n,r,s,i,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(_E){this.onError(_E)}}var Ne=!1,Me=null,Fe=!1,Ue=null,je={onError:function(e){Ne=!0,Me=e}};function Be(e,t,n,r,s,i,a,o,l){Ne=!1,Me=null,Oe.apply(je,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function ze(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ge(e){if(Ve(e)!==e)throw Error(i(188))}function He(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var s=n.return;if(null===s)break;var a=s.alternate;if(null===a){if(null!==(r=s.return)){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return Ge(s),e;if(a===r)return Ge(s),t;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=s,r=a;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=a;break}if(l===r){o=!0,r=s,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,r=s;break}if(l===r){o=!0,r=a,n=s;break}l=l.sibling}if(!o)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e),null!==e?Ke(e):null}function Ke(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ke(e);if(null!==t)return t;e=e.sibling}return null}var We=s.unstable_scheduleCallback,qe=s.unstable_cancelCallback,Ye=s.unstable_shouldYield,Qe=s.unstable_requestPaint,Xe=s.unstable_now,Ze=s.unstable_getCurrentPriorityLevel,Je=s.unstable_ImmediatePriority,$e=s.unstable_UserBlockingPriority,et=s.unstable_NormalPriority,tt=s.unstable_LowPriority,nt=s.unstable_IdlePriority,rt=null,st=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/ot|0)|0},at=Math.log,ot=Math.LN2;var lt=64,ct=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,s=e.suspendedLanes,i=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~s;0!==o?r=ut(o):0!==(i&=a)&&(r=ut(i))}else 0!==(a=n&~s)?r=ut(a):0!==i&&(r=ut(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&s)&&((s=r&-r)>=(i=t&-t)||16===s&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)s=1<<(n=31-it(t)),r|=e[n],t&=~s;return r}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function mt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),s=1<<r;s&t|e[r]&t&&(e[r]|=t),n&=~s}}var yt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Et,wt,St,Tt,kt,xt=!1,It=[],Lt=null,Ct=null,_t=null,At=new Map,Rt=new Map,Pt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Lt=null;break;case"dragenter":case"dragleave":Ct=null;break;case"mouseover":case"mouseout":_t=null;break;case"pointerover":case"pointerout":At.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Nt(e,t,n,r,s,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},null!==t&&(null!==(t=ys(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Mt(e){var t=vs(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=ze(n)))return e.blockedOn=t,void kt(e.priority,function(){St(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ys(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Ut(e,t,n){Ft(e)&&n.delete(t)}function jt(){xt=!1,null!==Lt&&Ft(Lt)&&(Lt=null),null!==Ct&&Ft(Ct)&&(Ct=null),null!==_t&&Ft(_t)&&(_t=null),At.forEach(Ut),Rt.forEach(Ut)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,xt||(xt=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,jt)))}function Vt(e){function t(t){return Bt(t,e)}if(0<It.length){Bt(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Lt&&Bt(Lt,e),null!==Ct&&Bt(Ct,e),null!==_t&&Bt(_t,e),At.forEach(t),Rt.forEach(t),n=0;n<Pt.length;n++)(r=Pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Pt.length&&null===(n=Pt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Pt.shift()}var zt=E.ReactCurrentBatchConfig,Gt=!0;function Ht(e,t,n,r){var s=yt,i=zt.transition;zt.transition=null;try{yt=1,Wt(e,t,n,r)}finally{yt=s,zt.transition=i}}function Kt(e,t,n,r){var s=yt,i=zt.transition;zt.transition=null;try{yt=4,Wt(e,t,n,r)}finally{yt=s,zt.transition=i}}function Wt(e,t,n,r){if(Gt){var s=Yt(e,t,n,r);if(null===s)Gr(e,t,r,qt,n),Ot(e,r);else if(function(e,t,n,r,s){switch(t){case"focusin":return Lt=Nt(Lt,e,t,n,r,s),!0;case"dragenter":return Ct=Nt(Ct,e,t,n,r,s),!0;case"mouseover":return _t=Nt(_t,e,t,n,r,s),!0;case"pointerover":var i=s.pointerId;return At.set(i,Nt(At.get(i)||null,e,t,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Rt.set(i,Nt(Rt.get(i)||null,e,t,n,r,s)),!0}return!1}(s,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Dt.indexOf(e)){for(;null!==s;){var i=ys(s);if(null!==i&&Et(i),null===(i=Yt(e,t,n,r))&&Gr(e,t,r,qt,n),i===s)break;s=i}null!==s&&r.stopPropagation()}else Gr(e,t,r,null,n)}}var qt=null;function Yt(e,t,n,r){if(qt=null,null!==(e=vs(e=Ee(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=ze(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Je:return 1;case $e:return 4;case et:case tt:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Xt=null,Zt=null,Jt=null;function $t(){if(Jt)return Jt;var e,t,n=Zt,r=n.length,s="value"in Xt?Xt.value:Xt.textContent,i=s.length;for(e=0;e<r&&n[e]===s[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===s[i-t];t++);return Jt=s.slice(e,1<t?1-t:void 0)}function en(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function tn(){return!0}function nn(){return!1}function rn(e){function t(t,n,r,s,i){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=s,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?tn:nn,this.isPropagationStopped=nn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=tn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=tn)},persist:function(){},isPersistent:tn}),t}var sn,an,on,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=rn(ln),un=F({},ln,{view:0,detail:0}),dn=rn(un),hn=F({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==on&&(on&&"mousemove"===e.type?(sn=e.screenX-on.screenX,an=e.screenY-on.screenY):an=sn=0,on=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=rn(hn),pn=rn(F({},hn,{dataTransfer:0})),gn=rn(F({},un,{relatedTarget:0})),mn=rn(F({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=F({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=rn(vn),bn=rn(F({},ln,{data:0})),En={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function kn(){return Tn}var xn=F({},un,{key:function(e){if(e.key){var t=En[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=en(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?en(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?en(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=rn(xn),Ln=rn(F({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Cn=rn(F({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),_n=rn(F({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),An=F({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=rn(An),Pn=[9,13,27,32],Dn=u&&"CompositionEvent"in window,On=null;u&&"documentMode"in document&&(On=document.documentMode);var Nn=u&&"TextEvent"in window&&!On,Mn=u&&(!Dn||On&&8<On&&11>=On),Fn=String.fromCharCode(32),Un=!1;function jn(e,t){switch(e){case"keyup":return-1!==Pn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var zn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!zn[e.type]:"textarea"===t}function Hn(e,t,n,r){xe(r),0<(t=Kr(t,"onChange")).length&&(n=new cn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Kn=null,Wn=null;function qn(e){Fr(e,0)}function Yn(e){if(q(bs(e)))return e}function Qn(e,t){if("change"===e)return t}var Xn=!1;if(u){var Zn;if(u){var Jn="oninput"in document;if(!Jn){var $n=document.createElement("div");$n.setAttribute("oninput","return;"),Jn="function"===typeof $n.oninput}Zn=Jn}else Zn=!1;Xn=Zn&&(!document.documentMode||9<document.documentMode)}function er(){Kn&&(Kn.detachEvent("onpropertychange",tr),Wn=Kn=null)}function tr(e){if("value"===e.propertyName&&Yn(Wn)){var t=[];Hn(t,Wn,e,Ee(e)),Ae(qn,t)}}function nr(e,t,n){"focusin"===e?(er(),Wn=n,(Kn=t).attachEvent("onpropertychange",tr)):"focusout"===e&&er()}function rr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Wn)}function sr(e,t){if("click"===e)return Yn(t)}function ir(e,t){if("input"===e||"change"===e)return Yn(t)}var ar="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function or(e,t){if(ar(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!d.call(t,s)||!ar(e[s],t[s]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cr(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function ur(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ur(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ur(n.ownerDocument.documentElement,n)){if(null!==r&&hr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=void 0===r.end?i:Math.min(r.end,s),!e.extend&&i>r&&(s=r,r=i,i=s),s=cr(n,i);var a=cr(n,r);s&&a&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var pr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,mr=null,vr=null,yr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yr||null==gr||gr!==Y(r)||("selectionStart"in(r=gr)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&or(vr,r)||(vr=r,0<(r=Kr(mr,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function Er(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:Er("Animation","AnimationEnd"),animationiteration:Er("Animation","AnimationIteration"),animationstart:Er("Animation","AnimationStart"),transitionend:Er("Transition","TransitionEnd")},Sr={},Tr={};function kr(e){if(Sr[e])return Sr[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Tr)return Sr[e]=n[t];return e}u&&(Tr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var xr=kr("animationend"),Ir=kr("animationiteration"),Lr=kr("animationstart"),Cr=kr("transitionend"),_r=new Map,Ar="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(e,t){_r.set(e,t),l(t,[e])}for(var Pr=0;Pr<Ar.length;Pr++){var Dr=Ar[Pr];Rr(Dr.toLowerCase(),"on"+(Dr[0].toUpperCase()+Dr.slice(1)))}Rr(xr,"onAnimationEnd"),Rr(Ir,"onAnimationIteration"),Rr(Lr,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(Cr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Nr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,s,a,o,l,c){if(Be.apply(this,arguments),Ne){if(!Ne)throw Error(i(198));var u=Me;Ne=!1,Me=null,Fe||(Fe=!0,Ue=u)}}(r,t,void 0,e),e.currentTarget=null}function Fr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],s=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;Mr(s,o,c),i=l}else for(a=0;a<r.length;a++){if(l=(o=r[a]).instance,c=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;Mr(s,o,c),i=l}}}if(Fe)throw e=Ue,Fe=!1,Ue=null,e}function Ur(e,t){var n=t[ps];void 0===n&&(n=t[ps]=new Set);var r=e+"__bubble";n.has(r)||(zr(t,e,2,!1),n.add(r))}function jr(e,t,n){var r=0;t&&(r|=4),zr(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[Br]){e[Br]=!0,a.forEach(function(t){"selectionchange"!==t&&(Nr.has(t)||jr(t,!1,e),jr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,jr("selectionchange",!1,t))}}function zr(e,t,n,r){switch(Qt(t)){case 1:var s=Ht;break;case 4:s=Kt;break;default:s=Wt}n=s.bind(null,t,n,e),s=void 0,!Pe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),r?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function Gr(e,t,n,r,s){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var o=r.stateNode.containerInfo;if(o===s||8===o.nodeType&&o.parentNode===s)break;if(4===a)for(a=r.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;a=a.return}for(;null!==o;){if(null===(a=vs(o)))return;if(5===(l=a.tag)||6===l){r=i=a;continue e}o=o.parentNode}}r=r.return}Ae(function(){var r=i,s=Ee(n),a=[];e:{var o=_r.get(e);if(void 0!==o){var l=cn,c=e;switch(e){case"keypress":if(0===en(n))break e;case"keydown":case"keyup":l=In;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=pn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Cn;break;case xr:case Ir:case Lr:l=mn;break;case Cr:l=_n;break;case"scroll":l=dn;break;case"wheel":l=Rn;break;case"copy":case"cut":case"paste":l=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Ln}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==o?o+"Capture":null:o;u=[];for(var f,p=r;null!==p;){var g=(f=p).stateNode;if(5===f.tag&&null!==g&&(f=g,null!==h&&(null!=(g=Re(p,h))&&u.push(Hr(p,g,f)))),d)break;p=p.return}0<u.length&&(o=new l(o,c,null,n,s),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!vs(c)&&!c[fs])&&(l||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?vs(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=fn,g="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Ln,g="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==l?o:bs(l),f=null==c?o:bs(c),(o=new u(g,p+"leave",l,n,s)).target=d,o.relatedTarget=f,g=null,vs(s)===r&&((u=new u(h,p+"enter",c,n,s)).target=f,u.relatedTarget=d,g=u),d=g,l&&c)e:{for(h=c,p=0,f=u=l;f;f=Wr(f))p++;for(f=0,g=h;g;g=Wr(g))f++;for(;0<p-f;)u=Wr(u),p--;for(;0<f-p;)h=Wr(h),f--;for(;p--;){if(u===h||null!==h&&u===h.alternate)break e;u=Wr(u),h=Wr(h)}u=null}else u=null;null!==l&&qr(a,o,l,u,!1),null!==c&&null!==d&&qr(a,d,c,u,!0)}if("select"===(l=(o=r?bs(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var m=Qn;else if(Gn(o))if(Xn)m=ir;else{m=rr;var v=nr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=sr);switch(m&&(m=m(e,r))?Hn(a,m,n,s):(v&&v(e,o,r),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=r?bs(r):window,e){case"focusin":(Gn(v)||"true"===v.contentEditable)&&(gr=v,mr=r,vr=null);break;case"focusout":vr=mr=gr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,br(a,n,s);break;case"selectionchange":if(pr)break;case"keydown":case"keyup":br(a,n,s)}var y;if(Dn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vn?jn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Mn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(y=$t()):(Zt="value"in(Xt=s)?Xt.value:Xt.textContent,Vn=!0)),0<(v=Kr(r,b)).length&&(b=new bn(b,e,null,n,s),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=Bn(n))&&(b.data=y))),(y=Nn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(Un=!0,Fn);case"textInput":return(e=t.data)===Fn&&Un?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Dn&&jn(e,t)?(e=$t(),Jt=Zt=Xt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Kr(r,"onBeforeInput")).length&&(s=new bn("onBeforeInput","beforeinput",null,n,s),a.push({event:s,listeners:r}),s.data=y))}Fr(a,t)})}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Kr(e,t){for(var n=t+"Capture",r=[];null!==e;){var s=e,i=s.stateNode;5===s.tag&&null!==i&&(s=i,null!=(i=Re(e,n))&&r.unshift(Hr(e,i,s)),null!=(i=Re(e,t))&&r.push(Hr(e,i,s))),e=e.return}return r}function Wr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qr(e,t,n,r,s){for(var i=t._reactName,a=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,s?null!=(l=Re(n,i))&&a.unshift(Hr(n,l,o)):s||null!=(l=Re(n,i))&&a.push(Hr(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Yr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Xr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Qr,"")}function Zr(e,t,n){if(t=Xr(t),Xr(e)!==t&&n)throw Error(i(425))}function Jr(){}var $r=null,es=null;function ts(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ns="function"===typeof setTimeout?setTimeout:void 0,rs="function"===typeof clearTimeout?clearTimeout:void 0,ss="function"===typeof Promise?Promise:void 0,is="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ss?function(e){return ss.resolve(null).then(e).catch(as)}:ns;function as(e){setTimeout(function(){throw e})}function os(e,t){var n=t,r=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0===r)return e.removeChild(s),void Vt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=s}while(n);Vt(t)}function ls(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function cs(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var us=Math.random().toString(36).slice(2),ds="__reactFiber$"+us,hs="__reactProps$"+us,fs="__reactContainer$"+us,ps="__reactEvents$"+us,gs="__reactListeners$"+us,ms="__reactHandles$"+us;function vs(e){var t=e[ds];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fs]||n[ds]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=cs(e);null!==e;){if(n=e[ds])return n;e=cs(e)}return t}n=(e=n).parentNode}return null}function ys(e){return!(e=e[ds]||e[fs])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bs(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function Es(e){return e[hs]||null}var ws=[],Ss=-1;function Ts(e){return{current:e}}function ks(e){0>Ss||(e.current=ws[Ss],ws[Ss]=null,Ss--)}function xs(e,t){Ss++,ws[Ss]=e.current,e.current=t}var Is={},Ls=Ts(Is),Cs=Ts(!1),_s=Is;function As(e,t){var n=e.type.contextTypes;if(!n)return Is;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var s,i={};for(s in n)i[s]=t[s];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Rs(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ps(){ks(Cs),ks(Ls)}function Ds(e,t,n){if(Ls.current!==Is)throw Error(i(168));xs(Ls,t),xs(Cs,n)}function Os(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var s in r=r.getChildContext())if(!(s in t))throw Error(i(108,G(e)||"Unknown",s));return F({},n,r)}function Ns(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Is,_s=Ls.current,xs(Ls,e),xs(Cs,Cs.current),!0}function Ms(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Os(e,t,_s),r.__reactInternalMemoizedMergedChildContext=e,ks(Cs),ks(Ls),xs(Ls,e)):ks(Cs),xs(Cs,n)}var Fs=null,Us=!1,js=!1;function Bs(e){null===Fs?Fs=[e]:Fs.push(e)}function Vs(){if(!js&&null!==Fs){js=!0;var e=0,t=yt;try{var n=Fs;for(yt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fs=null,Us=!1}catch(_w){throw null!==Fs&&(Fs=Fs.slice(e+1)),We(Je,Vs),_w}finally{yt=t,js=!1}}return null}var zs=[],Gs=0,Hs=null,Ks=0,Ws=[],qs=0,Ys=null,Qs=1,Xs="";function Zs(e,t){zs[Gs++]=Ks,zs[Gs++]=Hs,Hs=e,Ks=t}function Js(e,t,n){Ws[qs++]=Qs,Ws[qs++]=Xs,Ws[qs++]=Ys,Ys=e;var r=Qs;e=Xs;var s=32-it(r)-1;r&=~(1<<s),n+=1;var i=32-it(t)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,Qs=1<<32-it(t)+s|n<<s|r,Xs=i+e}else Qs=1<<i|n<<s|r,Xs=e}function $s(e){null!==e.return&&(Zs(e,1),Js(e,1,0))}function ei(e){for(;e===Hs;)Hs=zs[--Gs],zs[Gs]=null,Ks=zs[--Gs],zs[Gs]=null;for(;e===Ys;)Ys=Ws[--qs],Ws[qs]=null,Xs=Ws[--qs],Ws[qs]=null,Qs=Ws[--qs],Ws[qs]=null}var ti=null,ni=null,ri=!1,si=null;function ii(e,t){var n=Rc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ai(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ti=e,ni=ls(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ti=e,ni=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ys?{id:Qs,overflow:Xs}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Rc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ti=e,ni=null,!0);default:return!1}}function oi(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function li(e){if(ri){var t=ni;if(t){var n=t;if(!ai(e,t)){if(oi(e))throw Error(i(418));t=ls(n.nextSibling);var r=ti;t&&ai(e,t)?ii(r,n):(e.flags=-4097&e.flags|2,ri=!1,ti=e)}}else{if(oi(e))throw Error(i(418));e.flags=-4097&e.flags|2,ri=!1,ti=e}}}function ci(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ti=e}function ui(e){if(e!==ti)return!1;if(!ri)return ci(e),ri=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ts(e.type,e.memoizedProps)),t&&(t=ni)){if(oi(e))throw di(),Error(i(418));for(;t;)ii(e,t),t=ls(t.nextSibling)}if(ci(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ni=ls(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ni=null}}else ni=ti?ls(e.stateNode.nextSibling):null;return!0}function di(){for(var e=ni;e;)e=ls(e.nextSibling)}function hi(){ni=ti=null,ri=!1}function fi(e){null===si?si=[e]:si.push(e)}var pi=E.ReactCurrentBatchConfig;function gi(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var mi=Ts(null),vi=null,yi=null,bi=null;function Ei(){bi=yi=vi=null}function wi(e){var t=mi.current;ks(mi),e._currentValue=t}function Si(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ti(e,t){vi=e,bi=yi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function ki(e){var t=e._currentValue;if(bi!==e)if(e={context:e,memoizedValue:t,next:null},null===yi){if(null===vi)throw Error(i(308));yi=e,vi.dependencies={lanes:0,firstContext:e}}else yi=yi.next=e;return t}var xi=null;function Ii(e){null===xi?xi=[e]:xi.push(e)}function Li(e,t,n,r){var s=t.interleaved;return null===s?(n.next=n,Ii(t)):(n.next=s.next,s.next=n),t.interleaved=n,Ci(e,r)}function Ci(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var _i=!1;function Ai(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ri(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Pi(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Di(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Cl)){var s=r.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),r.pending=t,Ci(e,n)}return null===(s=r.interleaved)?(t.next=t,Ii(r)):(t.next=s.next,s.next=t),r.interleaved=t,Ci(e,n)}function Oi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Ni(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var s=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?s=i=a:i=i.next=a,n=n.next}while(null!==n);null===i?s=i=t:i=i.next=t}else s=i=t;return n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Mi(e,t,n,r){var s=e.updateQueue;_i=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?i=c:a.next=c,a=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==i){var d=s.baseState;for(a=0,u=c=l=null,o=i;;){var h=o.lane,f=o.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,g=o;switch(h=t,f=n,g.tag){case 1:if("function"===typeof(p=g.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=g.payload)?p.call(f,d,h):p)||void 0===h)break e;d=F({},d,h);break e;case 2:_i=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=s.effects)?s.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,a|=h;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(h=o).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}if(null===u&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,null!==(t=s.shared.interleaved)){s=t;do{a|=s.lane,s=s.next}while(s!==t)}else null===i&&(s.shared.lanes=0);Ml|=a,e.lanes=a,e.memoizedState=d}}function Fi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],s=r.callback;if(null!==s){if(r.callback=null,r=n,"function"!==typeof s)throw Error(i(191,s));s.call(r)}}}var Ui=(new r.Component).refs;function ji(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Bi={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),s=tc(e),i=Pi(r,s);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Di(e,i,s))&&(nc(t,e,s,r),Oi(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),s=tc(e),i=Pi(r,s);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Di(e,i,s))&&(nc(t,e,s,r),Oi(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),s=Pi(n,r);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Di(e,s,r))&&(nc(t,e,r,n),Oi(t,e,r))}};function Vi(e,t,n,r,s,i,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!or(n,r)||!or(s,i))}function zi(e,t,n){var r=!1,s=Is,i=t.contextType;return"object"===typeof i&&null!==i?i=ki(i):(s=Rs(t)?_s:Ls.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?As(e,s):Is),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Bi,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=i),t}function Gi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Bi.enqueueReplaceState(t,t.state,null)}function Hi(e,t,n,r){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs=Ui,Ai(e);var i=t.contextType;"object"===typeof i&&null!==i?s.context=ki(i):(i=Rs(t)?_s:Ls.current,s.context=As(e,i)),s.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(ji(e,t,i,n),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&Bi.enqueueReplaceState(s,s.state,null),Mi(e,n,s,r),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function Ki(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var s=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=s.refs;t===Ui&&(t=s.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function Wi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function qi(e){return(0,e._init)(e._payload)}function Yi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Dc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Fc(n,e.mode,r)).return=e,t):((t=s(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===T?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===P&&qi(i)===t.type)?((r=s(t,n.props)).ref=Ki(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=Ki(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,r)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function d(e,t,n,r,i){return null===t||7!==t.tag?((t=Nc(n,e.mode,r,i)).return=e,t):((t=s(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=Ki(e,null,t),n.return=e,n;case S:return(t=Uc(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=Nc(t,e.mode,n,null)).return=e,t;Wi(e,t)}return null}function f(e,t,n,r){var s=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==s?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===s?c(e,t,n,r):null;case S:return n.key===s?u(e,t,n,r):null;case P:return f(e,t,(s=n._init)(n._payload),r)}if(te(n)||N(n))return null!==s?null:d(e,t,n,r,null);Wi(e,n)}return null}function p(e,t,n,r,s){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,s);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,s);case S:return u(t,e=e.get(null===r.key?n:r.key)||null,r,s);case P:return p(e,t,n,(0,r._init)(r._payload),s)}if(te(r)||N(r))return d(t,e=e.get(n)||null,r,s,null);Wi(t,r)}return null}function g(s,i,o,l){for(var c=null,u=null,d=i,g=i=0,m=null;null!==d&&g<o.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var v=f(s,d,o[g],l);if(null===v){null===d&&(d=m);break}e&&d&&null===v.alternate&&t(s,d),i=a(v,i,g),null===u?c=v:u.sibling=v,u=v,d=m}if(g===o.length)return n(s,d),ri&&Zs(s,g),c;if(null===d){for(;g<o.length;g++)null!==(d=h(s,o[g],l))&&(i=a(d,i,g),null===u?c=d:u.sibling=d,u=d);return ri&&Zs(s,g),c}for(d=r(s,d);g<o.length;g++)null!==(m=p(d,s,g,o[g],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),i=a(m,i,g),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach(function(e){return t(s,e)}),ri&&Zs(s,g),c}function m(s,o,l,c){var u=N(l);if("function"!==typeof u)throw Error(i(150));if(null==(l=u.call(l)))throw Error(i(151));for(var d=u=null,g=o,m=o=0,v=null,y=l.next();null!==g&&!y.done;m++,y=l.next()){g.index>m?(v=g,g=null):v=g.sibling;var b=f(s,g,y.value,c);if(null===b){null===g&&(g=v);break}e&&g&&null===b.alternate&&t(s,g),o=a(b,o,m),null===d?u=b:d.sibling=b,d=b,g=v}if(y.done)return n(s,g),ri&&Zs(s,m),u;if(null===g){for(;!y.done;m++,y=l.next())null!==(y=h(s,y.value,c))&&(o=a(y,o,m),null===d?u=y:d.sibling=y,d=y);return ri&&Zs(s,m),u}for(g=r(s,g);!y.done;m++,y=l.next())null!==(y=p(g,s,m,y.value,c))&&(e&&null!==y.alternate&&g.delete(null===y.key?m:y.key),o=a(y,o,m),null===d?u=y:d.sibling=y,d=y);return e&&g.forEach(function(e){return t(s,e)}),ri&&Zs(s,m),u}return function e(r,i,a,l){if("object"===typeof a&&null!==a&&a.type===T&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case w:e:{for(var c=a.key,u=i;null!==u;){if(u.key===c){if((c=a.type)===T){if(7===u.tag){n(r,u.sibling),(i=s(u,a.props.children)).return=r,r=i;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&qi(c)===u.type){n(r,u.sibling),(i=s(u,a.props)).ref=Ki(r,u,a),i.return=r,r=i;break e}n(r,u);break}t(r,u),u=u.sibling}a.type===T?((i=Nc(a.props.children,r.mode,l,a.key)).return=r,r=i):((l=Oc(a.type,a.key,a.props,null,r.mode,l)).ref=Ki(r,i,a),l.return=r,r=l)}return o(r);case S:e:{for(u=a.key;null!==i;){if(i.key===u){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){n(r,i.sibling),(i=s(i,a.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Uc(a,r.mode,l)).return=r,r=i}return o(r);case P:return e(r,i,(u=a._init)(a._payload),l)}if(te(a))return g(r,i,a,l);if(N(a))return m(r,i,a,l);Wi(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==i&&6===i.tag?(n(r,i.sibling),(i=s(i,a)).return=r,r=i):(n(r,i),(i=Fc(a,r.mode,l)).return=r,r=i),o(r)):n(r,i)}}var Qi=Yi(!0),Xi=Yi(!1),Zi={},Ji=Ts(Zi),$i=Ts(Zi),ea=Ts(Zi);function ta(e){if(e===Zi)throw Error(i(174));return e}function na(e,t){switch(xs(ea,t),xs($i,e),xs(Ji,Zi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ks(Ji),xs(Ji,t)}function ra(){ks(Ji),ks($i),ks(ea)}function sa(e){ta(ea.current);var t=ta(Ji.current),n=le(t,e.type);t!==n&&(xs($i,e),xs(Ji,n))}function ia(e){$i.current===e&&(ks(Ji),ks($i))}var aa=Ts(0);function oa(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var la=[];function ca(){for(var e=0;e<la.length;e++)la[e]._workInProgressVersionPrimary=null;la.length=0}var ua=E.ReactCurrentDispatcher,da=E.ReactCurrentBatchConfig,ha=0,fa=null,pa=null,ga=null,ma=!1,va=!1,ya=0,ba=0;function Ea(){throw Error(i(321))}function wa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function Sa(e,t,n,r,s,a){if(ha=a,fa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ua.current=null===e||null===e.memoizedState?io:ao,e=n(r,s),va){a=0;do{if(va=!1,ya=0,25<=a)throw Error(i(301));a+=1,ga=pa=null,t.updateQueue=null,ua.current=oo,e=n(r,s)}while(va)}if(ua.current=so,t=null!==pa&&null!==pa.next,ha=0,ga=pa=fa=null,ma=!1,t)throw Error(i(300));return e}function Ta(){var e=0!==ya;return ya=0,e}function ka(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ga?fa.memoizedState=ga=e:ga=ga.next=e,ga}function xa(){if(null===pa){var e=fa.alternate;e=null!==e?e.memoizedState:null}else e=pa.next;var t=null===ga?fa.memoizedState:ga.next;if(null!==t)ga=t,pa=e;else{if(null===e)throw Error(i(310));e={memoizedState:(pa=e).memoizedState,baseState:pa.baseState,baseQueue:pa.baseQueue,queue:pa.queue,next:null},null===ga?fa.memoizedState=ga=e:ga=ga.next=e}return ga}function Ia(e,t){return"function"===typeof t?t(e):t}function La(e){var t=xa(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=pa,s=r.baseQueue,a=n.pending;if(null!==a){if(null!==s){var o=s.next;s.next=a.next,a.next=o}r.baseQueue=s=a,n.pending=null}if(null!==s){a=s.next,r=r.baseState;var l=o=null,c=null,u=a;do{var d=u.lane;if((ha&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,o=r):c=c.next=h,fa.lanes|=d,Ml|=d}u=u.next}while(null!==u&&u!==a);null===c?o=r:c.next=l,ar(r,t.memoizedState)||(bo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){s=e;do{a=s.lane,fa.lanes|=a,Ml|=a,s=s.next}while(s!==e)}else null===s&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ca(e){var t=xa(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,s=n.pending,a=t.memoizedState;if(null!==s){n.pending=null;var o=s=s.next;do{a=e(a,o.action),o=o.next}while(o!==s);ar(a,t.memoizedState)||(bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function _a(){}function Aa(e,t){var n=fa,r=xa(),s=t(),a=!ar(r.memoizedState,s);if(a&&(r.memoizedState=s,bo=!0),r=r.queue,za(Da.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==ga&&1&ga.memoizedState.tag){if(n.flags|=2048,Fa(9,Pa.bind(null,n,r,s,t),void 0,null),null===_l)throw Error(i(349));0!==(30&ha)||Ra(n,t,s)}return s}function Ra(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=fa.updateQueue)?(t={lastEffect:null,stores:null},fa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Pa(e,t,n,r){t.value=n,t.getSnapshot=r,Oa(t)&&Na(e)}function Da(e,t,n){return n(function(){Oa(t)&&Na(e)})}function Oa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(r){return!0}}function Na(e){var t=Ci(e,1);null!==t&&nc(t,e,1,-1)}function Ma(e){var t=ka();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:e},t.queue=e,e=e.dispatch=eo.bind(null,fa,e),[t.memoizedState,e]}function Fa(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=fa.updateQueue)?(t={lastEffect:null,stores:null},fa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ua(){return xa().memoizedState}function ja(e,t,n,r){var s=ka();fa.flags|=e,s.memoizedState=Fa(1|t,n,void 0,void 0===r?null:r)}function Ba(e,t,n,r){var s=xa();r=void 0===r?null:r;var i=void 0;if(null!==pa){var a=pa.memoizedState;if(i=a.destroy,null!==r&&wa(r,a.deps))return void(s.memoizedState=Fa(t,n,i,r))}fa.flags|=e,s.memoizedState=Fa(1|t,n,i,r)}function Va(e,t){return ja(8390656,8,e,t)}function za(e,t){return Ba(2048,8,e,t)}function Ga(e,t){return Ba(4,2,e,t)}function Ha(e,t){return Ba(4,4,e,t)}function Ka(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Wa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ba(4,4,Ka.bind(null,t,e),n)}function qa(){}function Ya(e,t){var n=xa();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&wa(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Qa(e,t){var n=xa();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&wa(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Xa(e,t,n){return 0===(21&ha)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=n):(ar(n,t)||(n=pt(),fa.lanes|=n,Ml|=n,e.baseState=!0),t)}function Za(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var r=da.transition;da.transition={};try{e(!1),t()}finally{yt=n,da.transition=r}}function Ja(){return xa().memoizedState}function $a(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},to(e))no(t,n);else if(null!==(n=Li(e,t,n,r))){nc(n,e,r,ec()),ro(n,t,r)}}function eo(e,t,n){var r=tc(e),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(to(e))no(t,s);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=i(a,n);if(s.hasEagerState=!0,s.eagerState=o,ar(o,a)){var l=t.interleaved;return null===l?(s.next=s,Ii(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(c){}null!==(n=Li(e,t,s,r))&&(nc(n,e,r,s=ec()),ro(n,t,r))}}function to(e){var t=e.alternate;return e===fa||null!==t&&t===fa}function no(e,t){va=ma=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ro(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var so={readContext:ki,useCallback:Ea,useContext:Ea,useEffect:Ea,useImperativeHandle:Ea,useInsertionEffect:Ea,useLayoutEffect:Ea,useMemo:Ea,useReducer:Ea,useRef:Ea,useState:Ea,useDebugValue:Ea,useDeferredValue:Ea,useTransition:Ea,useMutableSource:Ea,useSyncExternalStore:Ea,useId:Ea,unstable_isNewReconciler:!1},io={readContext:ki,useCallback:function(e,t){return ka().memoizedState=[e,void 0===t?null:t],e},useContext:ki,useEffect:Va,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ja(4194308,4,Ka.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ja(4194308,4,e,t)},useInsertionEffect:function(e,t){return ja(4,2,e,t)},useMemo:function(e,t){var n=ka();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ka();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=$a.bind(null,fa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ka().memoizedState=e},useState:Ma,useDebugValue:qa,useDeferredValue:function(e){return ka().memoizedState=e},useTransition:function(){var e=Ma(!1),t=e[0];return e=Za.bind(null,e[1]),ka().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=fa,s=ka();if(ri){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===_l)throw Error(i(349));0!==(30&ha)||Ra(r,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,Va(Da.bind(null,r,a,e),[e]),r.flags|=2048,Fa(9,Pa.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=ka(),t=_l.identifierPrefix;if(ri){var n=Xs;t=":"+t+"R"+(n=(Qs&~(1<<32-it(Qs)-1)).toString(32)+n),0<(n=ya++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ba++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ao={readContext:ki,useCallback:Ya,useContext:ki,useEffect:za,useImperativeHandle:Wa,useInsertionEffect:Ga,useLayoutEffect:Ha,useMemo:Qa,useReducer:La,useRef:Ua,useState:function(){return La(Ia)},useDebugValue:qa,useDeferredValue:function(e){return Xa(xa(),pa.memoizedState,e)},useTransition:function(){return[La(Ia)[0],xa().memoizedState]},useMutableSource:_a,useSyncExternalStore:Aa,useId:Ja,unstable_isNewReconciler:!1},oo={readContext:ki,useCallback:Ya,useContext:ki,useEffect:za,useImperativeHandle:Wa,useInsertionEffect:Ga,useLayoutEffect:Ha,useMemo:Qa,useReducer:Ca,useRef:Ua,useState:function(){return Ca(Ia)},useDebugValue:qa,useDeferredValue:function(e){var t=xa();return null===pa?t.memoizedState=e:Xa(t,pa.memoizedState,e)},useTransition:function(){return[Ca(Ia)[0],xa().memoizedState]},useMutableSource:_a,useSyncExternalStore:Aa,useId:Ja,unstable_isNewReconciler:!1};function lo(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var s=n}catch(lE){s="\nError generating stack: "+lE.message+"\n"+lE.stack}return{value:e,source:t,stack:s,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(sE){setTimeout(function(){throw sE})}}var ho="function"===typeof WeakMap?WeakMap:Map;function fo(e,t,n){(n=Pi(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hl||(Hl=!0,Kl=r),uo(0,t)},n}function po(e,t,n){(n=Pi(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var s=t.value;n.payload=function(){return r(s)},n.callback=function(){uo(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof r&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function go(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var s=new Set;r.set(t,s)}else void 0===(s=r.get(t))&&(s=new Set,r.set(t,s));s.has(n)||(s.add(n),e=xc.bind(null,e,t,n),t.then(e,e))}function mo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,r,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Pi(-1,1)).tag=2,Di(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var yo=E.ReactCurrentOwner,bo=!1;function Eo(e,t,n,r){t.child=null===e?Xi(t,null,n,r):Qi(t,e.child,n,r)}function wo(e,t,n,r,s){n=n.render;var i=t.ref;return Ti(t,s),r=Sa(e,t,n,r,i,s),n=Ta(),null===e||bo?(ri&&n&&$s(t),t.flags|=1,Eo(e,t,r,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Go(e,t,s))}function So(e,t,n,r,s){if(null===e){var i=n.type;return"function"!==typeof i||Pc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,To(e,t,i,r,s))}if(i=e.child,0===(e.lanes&s)){var a=i.memoizedProps;if((n=null!==(n=n.compare)?n:or)(a,r)&&e.ref===t.ref)return Go(e,t,s)}return t.flags|=1,(e=Dc(i,r)).ref=t.ref,e.return=t,t.child=e}function To(e,t,n,r,s){if(null!==e){var i=e.memoizedProps;if(or(i,r)&&e.ref===t.ref){if(bo=!1,t.pendingProps=r=i,0===(e.lanes&s))return t.lanes=e.lanes,Go(e,t,s);0!==(131072&e.flags)&&(bo=!0)}}return Io(e,t,n,r,s)}function ko(e,t,n){var r=t.pendingProps,s=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xs(Dl,Pl),Pl|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,xs(Dl,Pl),Pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,xs(Dl,Pl),Pl|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,xs(Dl,Pl),Pl|=r;return Eo(e,t,s,n),t.child}function xo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Io(e,t,n,r,s){var i=Rs(n)?_s:Ls.current;return i=As(t,i),Ti(t,s),n=Sa(e,t,n,r,i,s),r=Ta(),null===e||bo?(ri&&r&&$s(t),t.flags|=1,Eo(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Go(e,t,s))}function Lo(e,t,n,r,s){if(Rs(n)){var i=!0;Ns(t)}else i=!1;if(Ti(t,s),null===t.stateNode)zo(e,t),zi(t,n,r),Hi(t,n,r,s),r=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=ki(c):c=As(t,c=Rs(n)?_s:Ls.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==r||l!==c)&&Gi(t,a,r,c),_i=!1;var h=t.memoizedState;a.state=h,Mi(t,r,a,s),l=t.memoizedState,o!==r||h!==l||Cs.current||_i?("function"===typeof u&&(ji(t,n,u,r),l=t.memoizedState),(o=_i||Vi(t,n,o,r,h,l,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Ri(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:gi(t.type,o),a.props=c,d=t.pendingProps,h=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=ki(l):l=As(t,l=Rs(n)?_s:Ls.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==d||h!==l)&&Gi(t,a,r,l),_i=!1,h=t.memoizedState,a.state=h,Mi(t,r,a,s);var p=t.memoizedState;o!==d||h!==p||Cs.current||_i?("function"===typeof f&&(ji(t,n,f,r),p=t.memoizedState),(c=_i||Vi(t,n,c,r,h,p,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=l,r=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Co(e,t,n,r,i,s)}function Co(e,t,n,r,s,i){xo(e,t);var a=0!==(128&t.flags);if(!r&&!a)return s&&Ms(t,n,!1),Go(e,t,i);r=t.stateNode,yo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=Qi(t,e.child,null,i),t.child=Qi(t,null,o,i)):Eo(e,t,o,i),t.memoizedState=r.state,s&&Ms(t,n,!0),t.child}function _o(e){var t=e.stateNode;t.pendingContext?Ds(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ds(0,t.context,!1),na(e,t.containerInfo)}function Ao(e,t,n,r,s){return hi(),fi(s),t.flags|=256,Eo(e,t,n,r),t.child}var Ro,Po,Do,Oo={dehydrated:null,treeContext:null,retryLane:0};function No(e){return{baseLanes:e,cachePool:null,transitions:null}}function Mo(e,t,n){var r,s=t.pendingProps,a=aa.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),xs(aa,1&a),null===e)return li(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Mc(l,s,0,null),e=Nc(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=No(n),t.memoizedState=Oo,e):Fo(t,l));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,s,a,o){if(n)return 256&t.flags?(t.flags&=-257,Uo(e,t,o,r=co(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,s=t.mode,r=Mc({mode:"visible",children:r.children},s,0,null),(a=Nc(a,s,o,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&Qi(t,e.child,null,o),t.child.memoizedState=No(o),t.memoizedState=Oo,a);if(0===(1&t.mode))return Uo(e,t,o,null);if("$!"===s.data){if(r=s.nextSibling&&s.nextSibling.dataset)var l=r.dgst;return r=l,Uo(e,t,o,r=co(a=Error(i(419)),r,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(r=_l)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(r.suspendedLanes|o))?0:s)&&s!==a.retryLane&&(a.retryLane=s,Ci(e,s),nc(r,e,s,-1))}return gc(),Uo(e,t,o,r=co(Error(i(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Lc.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,ni=ls(s.nextSibling),ti=t,ri=!0,si=null,null!==e&&(Ws[qs++]=Qs,Ws[qs++]=Xs,Ws[qs++]=Ys,Qs=e.id,Xs=e.overflow,Ys=t),t=Fo(t,r.children),t.flags|=4096,t)}(e,t,l,s,r,a,n);if(o){o=s.fallback,l=t.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==a?((s=t.child).childLanes=0,s.pendingProps=c,t.deletions=null):(s=Dc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?o=Dc(r,o):(o=Nc(o,l,n,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=null===(l=e.child.memoizedState)?No(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Oo,s}return e=(o=e.child).sibling,s=Dc(o,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=n),s.return=t,s.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Fo(e,t){return(t=Mc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Uo(e,t,n,r){return null!==r&&fi(r),Qi(t,e.child,null,n),(e=Fo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function jo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Si(e.return,t,n)}function Bo(e,t,n,r,s){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function Vo(e,t,n){var r=t.pendingProps,s=r.revealOrder,i=r.tail;if(Eo(e,t,r.children,n),0!==(2&(r=aa.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&jo(e,n,t);else if(19===e.tag)jo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(xs(aa,r),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===oa(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),Bo(t,!1,s,n,i);break;case"backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===oa(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}Bo(t,!0,n,null,i);break;case"together":Bo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Go(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ml|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Dc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ho(e,t){if(!ri)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ko(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,r|=14680064&s.subtreeFlags,r|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Wo(e,t,n){var r=t.pendingProps;switch(ei(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ko(t),null;case 1:case 17:return Rs(t.type)&&Ps(),Ko(t),null;case 3:return r=t.stateNode,ra(),ks(Cs),ks(Ls),ca(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ui(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==si&&(ac(si),si=null))),Ko(t),null;case 5:ia(t);var s=ta(ea.current);if(n=t.type,null!==e&&null!=t.stateNode)Po(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Ko(t),null}if(e=ta(Ji.current),ui(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[ds]=t,r[hs]=a,e=0!==(1&t.mode),n){case"dialog":Ur("cancel",r),Ur("close",r);break;case"iframe":case"object":case"embed":Ur("load",r);break;case"video":case"audio":for(s=0;s<Or.length;s++)Ur(Or[s],r);break;case"source":Ur("error",r);break;case"img":case"image":case"link":Ur("error",r),Ur("load",r);break;case"details":Ur("toggle",r);break;case"input":X(r,a),Ur("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Ur("invalid",r);break;case"textarea":se(r,a),Ur("invalid",r)}for(var l in ve(n,a),s=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,c,e),s=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,c,e),s=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Ur("scroll",r)}switch(n){case"input":W(r),$(r,a,!0);break;case"textarea":W(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=Jr)}r=s,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[ds]=t,e[hs]=r,Ro(e,t),t.stateNode=e;e:{switch(l=ye(n,r),n){case"dialog":Ur("cancel",e),Ur("close",e),s=r;break;case"iframe":case"object":case"embed":Ur("load",e),s=r;break;case"video":case"audio":for(s=0;s<Or.length;s++)Ur(Or[s],e);s=r;break;case"source":Ur("error",e),s=r;break;case"img":case"image":case"link":Ur("error",e),Ur("load",e),s=r;break;case"details":Ur("toggle",e),s=r;break;case"input":X(e,r),s=Q(e,r),Ur("invalid",e);break;case"option":default:s=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},s=F({},r,{value:void 0}),Ur("invalid",e);break;case"textarea":se(e,r),s=re(e,r),Ur("invalid",e)}for(a in ve(n,s),c=s)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?ge(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&ue(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Ur("scroll",e):null!=u&&b(e,a,u,l))}switch(n){case"input":W(e),$(e,r,!1);break;case"textarea":W(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=Jr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ko(t),null;case 6:if(e&&null!=t.stateNode)Do(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=ta(ea.current),ta(Ji.current),ui(t)){if(r=t.stateNode,n=t.memoizedProps,r[ds]=t,(a=r.nodeValue!==n)&&null!==(e=ti))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ds]=t,t.stateNode=r}return Ko(t),null;case 13:if(ks(aa),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ri&&null!==ni&&0!==(1&t.mode)&&0===(128&t.flags))di(),hi(),t.flags|=98560,a=!1;else if(a=ui(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(i(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(i(317));a[ds]=t}else hi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ko(t),a=!1}else null!==si&&(ac(si),si=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&aa.current)?0===Ol&&(Ol=3):gc())),null!==t.updateQueue&&(t.flags|=4),Ko(t),null);case 4:return ra(),null===e&&Vr(t.stateNode.containerInfo),Ko(t),null;case 10:return wi(t.type._context),Ko(t),null;case 19:if(ks(aa),null===(a=t.memoizedState))return Ko(t),null;if(r=0!==(128&t.flags),null===(l=a.rendering))if(r)Ho(a,!1);else{if(0!==Ol||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=oa(e))){for(t.flags|=128,Ho(a,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return xs(aa,1&aa.current|2),t.child}e=e.sibling}null!==a.tail&&Xe()>zl&&(t.flags|=128,r=!0,Ho(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=oa(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ho(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!ri)return Ko(t),null}else 2*Xe()-a.renderingStartTime>zl&&1073741824!==n&&(t.flags|=128,r=!0,Ho(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Xe(),t.sibling=null,n=aa.current,xs(aa,r?1&n|2:1&n),t):(Ko(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Pl)&&(Ko(t),6&t.subtreeFlags&&(t.flags|=8192)):Ko(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function qo(e,t){switch(ei(t),t.tag){case 1:return Rs(t.type)&&Ps(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ra(),ks(Cs),ks(Ls),ca(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return ia(t),null;case 13:if(ks(aa),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));hi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ks(aa),null;case 4:return ra(),null;case 10:return wi(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Ro=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(e,t,n,r){var s=e.memoizedProps;if(s!==r){e=t.stateNode,ta(Ji.current);var i,a=null;switch(n){case"input":s=Q(e,s),r=Q(e,r),a=[];break;case"select":s=F({},s,{value:void 0}),r=F({},r,{value:void 0}),a=[];break;case"textarea":s=re(e,s),r=re(e,r),a=[];break;default:"function"!==typeof s.onClick&&"function"===typeof r.onClick&&(e.onclick=Jr)}for(u in ve(n,r),n=null,s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&null!=s[u])if("style"===u){var l=s[u];for(i in l)l.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=s?s[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Ur("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Do=function(e,t,n,r){n!==r&&(t.flags|=4)};var Yo=!1,Qo=!1,Xo="function"===typeof WeakSet?WeakSet:Set,Zo=null;function Jo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){kc(e,t,r)}else n.current=null}function $o(e,t,n){try{n()}catch(r){kc(e,t,r)}}var el=!1;function tl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var s=r=r.next;do{if((s.tag&e)===e){var i=s.destroy;s.destroy=void 0,void 0!==i&&$o(t,n,i)}s=s.next}while(s!==r)}}function nl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function rl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ds],delete t[hs],delete t[ps],delete t[gs],delete t[ms])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function il(e){return 5===e.tag||3===e.tag||4===e.tag}function al(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||il(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ol(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Jr));else if(4!==r&&null!==(e=e.child))for(ol(e,t,n),e=e.sibling;null!==e;)ol(e,t,n),e=e.sibling}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}var cl=null,ul=!1;function dl(e,t,n){for(n=n.child;null!==n;)hl(e,t,n),n=n.sibling}function hl(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(rt,n)}catch(eE){}switch(n.tag){case 5:Qo||Jo(n,t);case 6:var r=cl,s=ul;cl=null,dl(e,t,n),ul=s,null!==(cl=r)&&(ul?(e=cl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):cl.removeChild(n.stateNode));break;case 18:null!==cl&&(ul?(e=cl,n=n.stateNode,8===e.nodeType?os(e.parentNode,n):1===e.nodeType&&os(e,n),Vt(e)):os(cl,n.stateNode));break;case 4:r=cl,s=ul,cl=n.stateNode.containerInfo,ul=!0,dl(e,t,n),cl=r,ul=s;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,void 0!==a&&(0!==(2&i)||0!==(4&i))&&$o(n,t,a),s=s.next}while(s!==r)}dl(e,t,n);break;case 1:if(!Qo&&(Jo(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(eE){kc(n,t,eE)}dl(e,t,n);break;case 21:dl(e,t,n);break;case 22:1&n.mode?(Qo=(r=Qo)||null!==n.memoizedState,dl(e,t,n),Qo=r):dl(e,t,n);break;default:dl(e,t,n)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Xo),t.forEach(function(t){var r=Cc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function pl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var s=n[r];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,ul=!1;break e;case 3:case 4:cl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===cl)throw Error(i(160));hl(a,o,s),cl=null,ul=!1;var c=s.alternate;null!==c&&(c.return=null),s.return=null}catch(u){kc(s,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pl(t,e),vl(e),4&r){try{tl(3,e,e.return),nl(3,e)}catch(WE){kc(e,e.return,WE)}try{tl(5,e,e.return)}catch(WE){kc(e,e.return,WE)}}break;case 1:pl(t,e),vl(e),512&r&&null!==n&&Jo(n,n.return);break;case 5:if(pl(t,e),vl(e),512&r&&null!==n&&Jo(n,n.return),32&e.flags){var s=e.stateNode;try{de(s,"")}catch(WE){kc(e,e.return,WE)}}if(4&r&&null!=(s=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&Z(s,a),ye(l,o);var u=ye(l,a);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];"style"===d?ge(s,h):"dangerouslySetInnerHTML"===d?ue(s,h):"children"===d?de(s,h):b(s,d,h,u)}switch(l){case"input":J(s,a);break;case"textarea":ie(s,a);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?ne(s,!!a.multiple,p,!1):f!==!!a.multiple&&(null!=a.defaultValue?ne(s,!!a.multiple,a.defaultValue,!0):ne(s,!!a.multiple,a.multiple?[]:"",!1))}s[hs]=a}catch(WE){kc(e,e.return,WE)}}break;case 6:if(pl(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(i(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(WE){kc(e,e.return,WE)}}break;case 3:if(pl(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(WE){kc(e,e.return,WE)}break;case 4:default:pl(t,e),vl(e);break;case 13:pl(t,e),vl(e),8192&(s=e.child).flags&&(a=null!==s.memoizedState,s.stateNode.isHidden=a,!a||null!==s.alternate&&null!==s.alternate.memoizedState||(Vl=Xe())),4&r&&fl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Qo=(u=Qo)||d,pl(t,e),Qo=u):pl(t,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Zo=e,d=e.child;null!==d;){for(h=Zo=d;null!==Zo;){switch(p=(f=Zo).child,f.tag){case 0:case 11:case 14:case 15:tl(4,f,f.return);break;case 1:Jo(f,f.return);var g=f.stateNode;if("function"===typeof g.componentWillUnmount){r=f,n=f.return;try{t=r,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(WE){kc(r,n,WE)}}break;case 5:Jo(f,f.return);break;case 22:if(null!==f.memoizedState){wl(h);continue}}null!==p?(p.return=f,Zo=p):wl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{s=h.stateNode,u?"function"===typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=pe("display",o))}catch(WE){kc(e,e.return,WE)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(WE){kc(e,e.return,WE)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:pl(t,e),vl(e),4&r&&fl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(il(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var s=r.stateNode;32&r.flags&&(de(s,""),r.flags&=-33),ll(e,al(e),s);break;case 3:case 4:var a=r.stateNode.containerInfo;ol(e,al(e),a);break;default:throw Error(i(161))}}catch(o){kc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Zo=e,bl(e,t,n)}function bl(e,t,n){for(var r=0!==(1&e.mode);null!==Zo;){var s=Zo,i=s.child;if(22===s.tag&&r){var a=null!==s.memoizedState||Yo;if(!a){var o=s.alternate,l=null!==o&&null!==o.memoizedState||Qo;o=Yo;var c=Qo;if(Yo=a,(Qo=l)&&!c)for(Zo=s;null!==Zo;)l=(a=Zo).child,22===a.tag&&null!==a.memoizedState?Sl(s):null!==l?(l.return=a,Zo=l):Sl(s);for(;null!==i;)Zo=i,bl(i,t,n),i=i.sibling;Zo=s,Yo=o,Qo=c}El(e)}else 0!==(8772&s.subtreeFlags)&&null!==i?(i.return=s,Zo=i):El(e)}}function El(e){for(;null!==Zo;){var t=Zo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qo||nl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qo)if(null===n)r.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:gi(t.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Fi(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Fi(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(i(163))}Qo||512&t.flags&&rl(t)}catch(Gb){kc(t,t.return,Gb)}}if(t===e){Zo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zo=n;break}Zo=t.return}}function wl(e){for(;null!==Zo;){var t=Zo;if(t===e){Zo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zo=n;break}Zo=t.return}}function Sl(e){for(;null!==Zo;){var t=Zo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{nl(4,t)}catch(l){kc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var s=t.return;try{r.componentDidMount()}catch(l){kc(t,s,l)}}var i=t.return;try{rl(t)}catch(l){kc(t,i,l)}break;case 5:var a=t.return;try{rl(t)}catch(l){kc(t,a,l)}}}catch(l){kc(t,t.return,l)}if(t===e){Zo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Zo=o;break}Zo=t.return}}var Tl,kl=Math.ceil,xl=E.ReactCurrentDispatcher,Il=E.ReactCurrentOwner,Ll=E.ReactCurrentBatchConfig,Cl=0,_l=null,Al=null,Rl=0,Pl=0,Dl=Ts(0),Ol=0,Nl=null,Ml=0,Fl=0,Ul=0,jl=null,Bl=null,Vl=0,zl=1/0,Gl=null,Hl=!1,Kl=null,Wl=null,ql=!1,Yl=null,Ql=0,Xl=0,Zl=null,Jl=-1,$l=0;function ec(){return 0!==(6&Cl)?Xe():-1!==Jl?Jl:Jl=Xe()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Cl)&&0!==Rl?Rl&-Rl:null!==pi.transition?(0===$l&&($l=pt()),$l):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function nc(e,t,n,r){if(50<Xl)throw Xl=0,Zl=null,Error(i(185));mt(e,n,r),0!==(2&Cl)&&e===_l||(e===_l&&(0===(2&Cl)&&(Fl|=n),4===Ol&&oc(e,Rl)),rc(e,r),1===n&&0===Cl&&0===(1&t.mode)&&(zl=Xe()+500,Us&&Vs()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,s=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-it(i),o=1<<a,l=s[a];-1===l?0!==(o&n)&&0===(o&r)||(s[a]=ht(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}}(e,t);var r=dt(e,e===_l?Rl:0);if(0===r)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){Us=!0,Bs(e)}(lc.bind(null,e)):Bs(lc.bind(null,e)),is(function(){0===(6&Cl)&&Vs()}),n=null;else{switch(bt(r)){case 1:n=Je;break;case 4:n=$e;break;case 16:default:n=et;break;case 536870912:n=nt}n=_c(n,sc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sc(e,t){if(Jl=-1,$l=0,0!==(6&Cl))throw Error(i(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var r=dt(e,e===_l?Rl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mc(e,r);else{t=r;var s=Cl;Cl|=2;var a=pc();for(_l===e&&Rl===t||(Gl=null,zl=Xe()+500,hc(e,t));;)try{yc();break}catch(eE){fc(e,eE)}Ei(),xl.current=a,Cl=s,null!==Al?t=0:(_l=null,Rl=0,t=Ol)}if(0!==t){if(2===t&&(0!==(s=ft(e))&&(r=s,t=ic(e,s))),1===t)throw n=Nl,hc(e,0),oc(e,r),rc(e,Xe()),n;if(6===t)oc(e,r);else{if(s=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!ar(i(),s))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=mc(e,r))&&(0!==(a=ft(e))&&(r=a,t=ic(e,a))),1===t))throw n=Nl,hc(e,0),oc(e,r),rc(e,Xe()),n;switch(e.finishedWork=s,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:wc(e,Bl,Gl);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(t=Vl+500-Xe())){if(0!==dt(e,0))break;if(((s=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=ns(wc.bind(null,e,Bl,Gl),t);break}wc(e,Bl,Gl);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,s=-1;0<r;){var o=31-it(r);a=1<<o,(o=t[o])>s&&(s=o),r&=~a}if(r=s,10<(r=(120>(r=Xe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*kl(r/1960))-r)){e.timeoutHandle=ns(wc.bind(null,e,Bl,Gl),r);break}wc(e,Bl,Gl);break;default:throw Error(i(329))}}}return rc(e,Xe()),e.callbackNode===n?sc.bind(null,e):null}function ic(e,t){var n=jl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=Bl,Bl=n,null!==t&&ac(t)),e}function ac(e){null===Bl?Bl=e:Bl.push.apply(Bl,e)}function oc(e,t){for(t&=~Ul,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&Cl))throw Error(i(327));Sc();var t=dt(e,0);if(0===(1&t))return rc(e,Xe()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Nl,hc(e,0),oc(e,t),rc(e,Xe()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Bl,Gl),rc(e,Xe()),null}function cc(e,t){var n=Cl;Cl|=1;try{return e(t)}finally{0===(Cl=n)&&(zl=Xe()+500,Us&&Vs())}}function uc(e){null!==Yl&&0===Yl.tag&&0===(6&Cl)&&Sc();var t=Cl;Cl|=1;var n=Ll.transition,r=yt;try{if(Ll.transition=null,yt=1,e)return e()}finally{yt=r,Ll.transition=n,0===(6&(Cl=t))&&Vs()}}function dc(){Pl=Dl.current,ks(Dl)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rs(n)),null!==Al)for(n=Al.return;null!==n;){var r=n;switch(ei(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Ps();break;case 3:ra(),ks(Cs),ks(Ls),ca();break;case 5:ia(r);break;case 4:ra();break;case 13:case 19:ks(aa);break;case 10:wi(r.type._context);break;case 22:case 23:dc()}n=n.return}if(_l=e,Al=e=Dc(e.current,null),Rl=Pl=t,Ol=0,Nl=null,Ul=Fl=Ml=0,Bl=jl=null,null!==xi){for(t=0;t<xi.length;t++)if(null!==(r=(n=xi[t]).interleaved)){n.interleaved=null;var s=r.next,i=n.pending;if(null!==i){var a=i.next;i.next=s,r.next=a}n.pending=r}xi=null}return e}function fc(e,t){for(;;){var n=Al;try{if(Ei(),ua.current=so,ma){for(var r=fa.memoizedState;null!==r;){var s=r.queue;null!==s&&(s.pending=null),r=r.next}ma=!1}if(ha=0,ga=pa=fa=null,va=!1,ya=0,Il.current=null,null===n||null===n.return){Ol=1,Nl=t,Al=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Rl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=mo(o);if(null!==p){p.flags&=-257,vo(p,o,l,0,t),1&p.mode&&go(a,u,t),c=u;var g=(t=p).updateQueue;if(null===g){var m=new Set;m.add(c),t.updateQueue=m}else g.add(c);break e}if(0===(1&t)){go(a,u,t),gc();break e}c=Error(i(426))}else if(ri&&1&l.mode){var v=mo(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),fi(lo(c,l));break e}}a=c=lo(c,l),4!==Ol&&(Ol=2),null===jl?jl=[a]:jl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Ni(a,fo(0,c,t));break e;case 1:l=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Wl||!Wl.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,Ni(a,po(a,l,t));break e}}a=a.return}while(null!==a)}Ec(n)}catch(E){t=E,Al===n&&null!==n&&(Al=n=n.return);continue}break}}function pc(){var e=xl.current;return xl.current=so,null===e?so:e}function gc(){0!==Ol&&3!==Ol&&2!==Ol||(Ol=4),null===_l||0===(268435455&Ml)&&0===(268435455&Fl)||oc(_l,Rl)}function mc(e,t){var n=Cl;Cl|=2;var r=pc();for(_l===e&&Rl===t||(Gl=null,hc(e,t));;)try{vc();break}catch(_w){fc(e,_w)}if(Ei(),Cl=n,xl.current=r,null!==Al)throw Error(i(261));return _l=null,Rl=0,Ol}function vc(){for(;null!==Al;)bc(Al)}function yc(){for(;null!==Al&&!Ye();)bc(Al)}function bc(e){var t=Tl(e.alternate,e,Pl);e.memoizedProps=e.pendingProps,null===t?Ec(e):Al=t,Il.current=null}function Ec(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Wo(n,t,Pl)))return void(Al=n)}else{if(null!==(n=qo(n,t)))return n.flags&=32767,void(Al=n);if(null===e)return Ol=6,void(Al=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Al=t);Al=t=e}while(null!==t);0===Ol&&(Ol=5)}function wc(e,t,n){var r=yt,s=Ll.transition;try{Ll.transition=null,yt=1,function(e,t,n,r){do{Sc()}while(null!==Yl);if(0!==(6&Cl))throw Error(i(327));n=e.finishedWork;var s=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-it(n),i=1<<s;t[s]=0,r[s]=-1,e[s]=-1,n&=~i}}(e,a),e===_l&&(Al=_l=null,Rl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||ql||(ql=!0,_c(et,function(){return Sc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Ll.transition,Ll.transition=null;var o=yt;yt=1;var l=Cl;Cl|=4,Il.current=null,function(e,t){if($r=Gt,hr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(ml){n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==s&&3!==h.nodeType||(l=o+s),h!==a||0!==r&&3!==h.nodeType||(c=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===s&&(l=o),f===a&&++d===r&&(c=o),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(es={focusedElem:e,selectionRange:n},Gt=!1,Zo=t;null!==Zo;)if(e=(t=Zo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zo=e;else for(;null!==Zo;){t=Zo;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,v=g.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:gi(t.type,m),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(i(163))}}catch(ml){kc(t,t.return,ml)}if(null!==(e=t.sibling)){e.return=t.return,Zo=e;break}Zo=t.return}g=el,el=!1}(e,n),gl(n,e),fr(es),Gt=!!$r,es=$r=null,e.current=n,yl(n,e,s),Qe(),Cl=l,yt=o,Ll.transition=a}else e.current=n;if(ql&&(ql=!1,Yl=e,Ql=s),a=e.pendingLanes,0===a&&(Wl=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Xe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Hl)throw Hl=!1,e=Kl,Kl=null,e;0!==(1&Ql)&&0!==e.tag&&Sc(),a=e.pendingLanes,0!==(1&a)?e===Zl?Xl++:(Xl=0,Zl=e):Xl=0,Vs()}(e,t,n,r)}finally{Ll.transition=s,yt=r}return null}function Sc(){if(null!==Yl){var e=bt(Ql),t=Ll.transition,n=yt;try{if(Ll.transition=null,yt=16>e?16:e,null===Yl)var r=!1;else{if(e=Yl,Yl=null,Ql=0,0!==(6&Cl))throw Error(i(331));var s=Cl;for(Cl|=4,Zo=e.current;null!==Zo;){var a=Zo,o=a.child;if(0!==(16&Zo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Zo=u;null!==Zo;){var d=Zo;switch(d.tag){case 0:case 11:case 15:tl(8,d,a)}var h=d.child;if(null!==h)h.return=d,Zo=h;else for(;null!==Zo;){var f=(d=Zo).sibling,p=d.return;if(sl(d),d===u){Zo=null;break}if(null!==f){f.return=p,Zo=f;break}Zo=p}}}var g=a.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}Zo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Zo=o;else e:for(;null!==Zo;){if(0!==(2048&(a=Zo).flags))switch(a.tag){case 0:case 11:case 15:tl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Zo=y;break e}Zo=a.return}}var b=e.current;for(Zo=b;null!==Zo;){var E=(o=Zo).child;if(0!==(2064&o.subtreeFlags)&&null!==E)E.return=o,Zo=E;else e:for(o=b;null!==Zo;){if(0!==(2048&(l=Zo).flags))try{switch(l.tag){case 0:case 11:case 15:nl(9,l)}}catch(S){kc(l,l.return,S)}if(l===o){Zo=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Zo=w;break e}Zo=l.return}}if(Cl=s,Vs(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(rt,e)}catch(S){}r=!0}return r}finally{yt=n,Ll.transition=t}}return!1}function Tc(e,t,n){e=Di(e,t=fo(0,t=lo(n,t),1),1),t=ec(),null!==e&&(mt(e,1,t),rc(e,t))}function kc(e,t,n){if(3===e.tag)Tc(e,e,n);else for(;null!==t;){if(3===t.tag){Tc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Wl||!Wl.has(r))){t=Di(t,e=po(t,e=lo(n,e),1),1),e=ec(),null!==t&&(mt(t,1,e),rc(t,e));break}}t=t.return}}function xc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,_l===e&&(Rl&n)===n&&(4===Ol||3===Ol&&(130023424&Rl)===Rl&&500>Xe()-Vl?hc(e,0):Ul|=n),rc(e,t)}function Ic(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=ec();null!==(e=Ci(e,t))&&(mt(e,t,n),rc(e,n))}function Lc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ic(e,n)}function Cc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Ic(e,n)}function _c(e,t){return We(e,t)}function Ac(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,n,r){return new Ac(e,t,n,r)}function Pc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dc(e,t){var n=e.alternate;return null===n?((n=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,s,a){var o=2;if(r=e,"function"===typeof e)Pc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case T:return Nc(n.children,s,a,t);case k:o=8,s|=8;break;case x:return(e=Rc(12,n,t,2|s)).elementType=x,e.lanes=a,e;case _:return(e=Rc(13,n,t,s)).elementType=_,e.lanes=a,e;case A:return(e=Rc(19,n,t,s)).elementType=A,e.lanes=a,e;case D:return Mc(n,s,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case I:o=10;break e;case L:o=9;break e;case C:o=11;break e;case R:o=14;break e;case P:o=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Rc(o,n,t,s)).elementType=e,t.type=r,t.lanes=a,t}function Nc(e,t,n,r){return(e=Rc(7,e,r,t)).lanes=n,e}function Mc(e,t,n,r){return(e=Rc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=Rc(6,e,null,t)).lanes=n,e}function Uc(e,t,n){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function jc(e,t,n,r,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Bc(e,t,n,r,s,i,a,o,l){return e=new jc(e,t,n,o,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Rc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ai(i),e}function Vc(e){if(!e)return Is;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Rs(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Rs(n))return Os(e,n,t)}return t}function zc(e,t,n,r,s,i,a,o,l){return(e=Bc(n,r,!0,e,0,i,0,o,l)).context=Vc(null),n=e.current,(i=Pi(r=ec(),s=tc(n))).callback=void 0!==t&&null!==t?t:null,Di(n,i,s),e.current.lanes=s,mt(e,s,r),rc(e,r),e}function Gc(e,t,n,r){var s=t.current,i=ec(),a=tc(s);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Pi(i,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Di(s,t,a))&&(nc(e,s,a,i),Oi(e,s,a)),a}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Kc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){Kc(e,t),(e=e.alternate)&&Kc(e,t)}Tl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Cs.current)bo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bo=!1,function(e,t,n){switch(t.tag){case 3:_o(t),hi();break;case 5:sa(t);break;case 1:Rs(t.type)&&Ns(t);break;case 4:na(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,s=t.memoizedProps.value;xs(mi,r._currentValue),r._currentValue=s;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(xs(aa,1&aa.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Mo(e,t,n):(xs(aa,1&aa.current),null!==(e=Go(e,t,n))?e.sibling:null);xs(aa,1&aa.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Vo(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),xs(aa,aa.current),r)break;return null;case 22:case 23:return t.lanes=0,ko(e,t,n)}return Go(e,t,n)}(e,t,n);bo=0!==(131072&e.flags)}else bo=!1,ri&&0!==(1048576&t.flags)&&Js(t,Ks,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;zo(e,t),e=t.pendingProps;var s=As(t,Ls.current);Ti(t,n),s=Sa(null,t,r,e,s,n);var a=Ta();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Rs(r)?(a=!0,Ns(t)):a=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Ai(t),s.updater=Bi,t.stateNode=s,s._reactInternals=t,Hi(t,r,e,n),t=Co(null,t,r,!0,a,n)):(t.tag=0,ri&&a&&$s(t),Eo(null,t,s,n),t=t.child),t;case 16:r=t.elementType;e:{switch(zo(e,t),e=t.pendingProps,r=(s=r._init)(r._payload),t.type=r,s=t.tag=function(e){if("function"===typeof e)return Pc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===R)return 14}return 2}(r),e=gi(r,e),s){case 0:t=Io(null,t,r,e,n);break e;case 1:t=Lo(null,t,r,e,n);break e;case 11:t=wo(null,t,r,e,n);break e;case 14:t=So(null,t,r,gi(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,s=t.pendingProps,Io(e,t,r,s=t.elementType===r?s:gi(r,s),n);case 1:return r=t.type,s=t.pendingProps,Lo(e,t,r,s=t.elementType===r?s:gi(r,s),n);case 3:e:{if(_o(t),null===e)throw Error(i(387));r=t.pendingProps,s=(a=t.memoizedState).element,Ri(e,t),Mi(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ao(e,t,r,n,s=lo(Error(i(423)),t));break e}if(r!==s){t=Ao(e,t,r,n,s=lo(Error(i(424)),t));break e}for(ni=ls(t.stateNode.containerInfo.firstChild),ti=t,ri=!0,si=null,n=Xi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(hi(),r===s){t=Go(e,t,n);break e}Eo(e,t,r,n)}t=t.child}return t;case 5:return sa(t),null===e&&li(t),r=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,o=s.children,ts(r,s)?o=null:null!==a&&ts(r,a)&&(t.flags|=32),xo(e,t),Eo(e,t,o,n),t.child;case 6:return null===e&&li(t),null;case 13:return Mo(e,t,n);case 4:return na(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Qi(t,null,r,n):Eo(e,t,r,n),t.child;case 11:return r=t.type,s=t.pendingProps,wo(e,t,r,s=t.elementType===r?s:gi(r,s),n);case 7:return Eo(e,t,t.pendingProps,n),t.child;case 8:case 12:return Eo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,s=t.pendingProps,a=t.memoizedProps,o=s.value,xs(mi,r._currentValue),r._currentValue=o,null!==a)if(ar(a.value,o)){if(a.children===s.children&&!Cs.current){t=Go(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=Pi(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Si(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(i(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Si(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}Eo(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,r=t.pendingProps.children,Ti(t,n),r=r(s=ki(s)),t.flags|=1,Eo(e,t,r,n),t.child;case 14:return s=gi(r=t.type,t.pendingProps),So(e,t,r,s=gi(r.type,s),n);case 15:return To(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:gi(r,s),zo(e,t),t.tag=1,Rs(r)?(e=!0,Ns(t)):e=!1,Ti(t,n),zi(t,r,s),Hi(t,r,s,n),Co(null,t,r,!0,e,n);case 19:return Vo(e,t,n);case 22:return ko(e,t,n)}throw Error(i(156,t.tag))};var qc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function $c(e,t,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if("function"===typeof s){var o=s;s=function(){var e=Hc(a);o.call(e)}}Gc(t,a,e,s)}else a=function(e,t,n,r,s){if(s){if("function"===typeof r){var i=r;r=function(){var e=Hc(a);i.call(e)}}var a=zc(t,r,e,0,null,!1,0,"",Jc);return e._reactRootContainer=a,e[fs]=a.current,Vr(8===e.nodeType?e.parentNode:e),uc(),a}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof r){var o=r;r=function(){var e=Hc(l);o.call(e)}}var l=Bc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[fs]=l.current,Vr(8===e.nodeType?e.parentNode:e),uc(function(){Gc(t,l,n,r)}),l}(n,t,e,s,r);return Hc(a)}Qc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Gc(e,t,null,null)},Qc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){Gc(null,e,null,null)}),t[fs]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Pt.length&&0!==t&&t<Pt[n].priority;n++);Pt.splice(n,0,e),0===n&&Mt(e)}},Et=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(vt(t,1|n),rc(t,Xe()),0===(6&Cl)&&(zl=Xe()+500,Vs()))}break;case 13:uc(function(){var t=Ci(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Wc(e,1)}},wt=function(e){if(13===e.tag){var t=Ci(e,134217728);if(null!==t)nc(t,e,134217728,ec());Wc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),n=Ci(e,t);if(null!==n)nc(n,e,t,ec());Wc(e,t)}},Tt=function(){return yt},kt=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var s=Es(r);if(!s)throw Error(i(90));q(r),J(r,s)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Le=cc,Ce=uc;var eu={usingClientEntryPoint:!1,Events:[ys,bs,Es,xe,Ie,cc]},tu={findFiberByHostInstance:vs,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{rt=ru.inject(nu),st=ru}catch(Yb){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xc(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xc(e))throw Error(i(299));var n=!1,r="",s=qc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Bc(e,1,!1,null,0,n,0,r,s),e[fs]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Zc(t))throw Error(i(200));return $c(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,s=!1,a="",o=qc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=zc(t,null,e,1,null!=n?n:null,s,0,a,o),e[fs]=t.current,Vr(e),r)for(e=0;e<r.length;e++)s=(s=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Qc(t)},t.render=function(e,t,n){if(!Zc(t))throw Error(i(200));return $c(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(i(40));return!!e._reactRootContainer&&(uc(function(){$c(null,null,e,!1,function(){e._reactRootContainer=null,e[fs]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return $c(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},391(e,t,n){var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},950(e,t,n){!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},153(e,t,n){var r=n(43),s=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:s,type:e,key:c,ref:u,props:i,_owner:o.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},202(e,t){var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var E=b.prototype=new y;E.constructor=b,g(E,v.prototype),E.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,T={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function x(e,t,r){var s,i={},a=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)S.call(t,s)&&!k.hasOwnProperty(s)&&(i[s]=t[s]);var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===i[s]&&(i[s]=l[s]);return{$$typeof:n,type:e,key:a,ref:o,props:i,_owner:T.current}}function I(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var L=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function _(e,t,s,i,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return a=a(l=e),e=""===i?"."+C(l,0):i,w(a)?(s="",null!=e&&(s=e.replace(L,"$&/")+"/"),_(a,t,s,"",function(e){return e})):null!=a&&(I(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(L,"$&/")+"/")+e)),t.push(a)),1;if(l=0,i=""===i?".":i+":",w(e))for(var c=0;c<e.length;c++){var u=i+C(o=e[c],c);l+=_(o,t,s,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=_(o=o.value,t,s,u=i+C(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function A(e,t,n){if(null==e)return e;var r=[],s=0;return _(e,r,"","",function(e){return t.call(n,e,s++)}),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},D={transition:null},O={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:D,ReactCurrentOwner:T};t.Children={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!I(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=s,t.Profiler=a,t.PureComponent=b,t.StrictMode=i,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=g({},e.props),i=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=T.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!k.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:n,type:e.type,key:i,ref:a,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=x,t.createFactory=function(e){var t=x.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.2.0"},43(e,t,n){e.exports=n(202)},579(e,t,n){e.exports=n(153)},234(e,t){function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,s=e[r];if(!(0<i(s,t)))break e;e[r]=t,e[n]=s,n=r}}function r(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>i(l,n))c<s&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<s&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,f=3,p=!1,g=!1,m=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function E(e){for(var t=r(u);null!==t;){if(null===t.callback)s(u);else{if(!(t.startTime<=e))break;s(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function w(e){if(m=!1,E(e),!g)if(null!==r(c))g=!0,D(S);else{var t=r(u);null!==t&&O(w,t.startTime-e)}}function S(e,n){g=!1,m&&(m=!1,y(I),I=-1),p=!0;var i=f;try{for(E(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!_());){var a=h.callback;if("function"===typeof a){h.callback=null,f=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===r(c)&&s(c),E(n)}else s(c);h=r(c)}if(null!==h)var l=!0;else{var d=r(u);null!==d&&O(w,d.startTime-n),l=!1}return l}finally{h=null,f=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,k=!1,x=null,I=-1,L=5,C=-1;function _(){return!(t.unstable_now()-C<L)}function A(){if(null!==x){var e=t.unstable_now();C=e;var n=!0;try{n=x(!0,e)}finally{n?T():(k=!1,x=null)}}else k=!1}if("function"===typeof b)T=function(){b(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,P=R.port2;R.port1.onmessage=A,T=function(){P.postMessage(null)}}else T=function(){v(A,0)};function D(e){x=e,k||(k=!0,T())}function O(e,n){I=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||p||(g=!0,D(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,s,i){var a=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?a+i:a:i=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:s,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>a?(e.sortIndex=i,n(u,e),null===r(c)&&e===r(u)&&(m?(y(I),I=-1):m=!0,O(w,i-a))):(e.sortIndex=o,n(c,e),g||p||(g=!0,D(S))),e},t.unstable_shouldYield=_,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},853(e,t,n){e.exports=n(234)},365(e,t,n){var r=n(43);var s="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},i=r.useSyncExternalStore,a=r.useRef,o=r.useEffect,l=r.useMemo,c=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,u){var d=a(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;d=l(function(){function e(e){if(!o){if(o=!0,i=e,e=r(e),void 0!==u&&h.hasValue){var t=h.value;if(u(t,e))return a=t}return a=e}if(t=a,s(i,e))return t;var n=r(e);return void 0!==u&&u(t,n)?(i=e,t):(i=e,a=n)}var i,a,o=!1,l=void 0===n?null:n;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,n,r,u]);var f=i(e,d[0],d[1]);return o(function(){h.hasValue=!0,h.value=f},[f]),c(f),f}},237(e,t,n){e.exports=n(365)}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"===typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&s&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>r[e]);return a.default=()=>r,n.d(i,a),i}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(_w){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r=n(43),s=n.t(r,2),i=n(391);function a(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function l(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}function c(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const h=["sri"],f=["page"],p=["page","matches"],g=["onClick","discover","prefetch","relative","reloadDocument","replace","unstable_mask","state","target","to","preventScrollReset","viewTransition","unstable_defaultShouldRevalidate"],m=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],v=["discover","fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","viewTransition","unstable_defaultShouldRevalidate"];var y="popstate";function b(e){return"object"===typeof e&&null!=e&&"pathname"in e&&"search"in e&&"hash"in e&&"state"in e&&"key"in e}function E(){return L(function(e,t){var n;let r=null===(n=t.state)||void 0===n?void 0:n.masked,{pathname:s,search:i,hash:a}=r||e.location;return k("",{pathname:s,search:i,hash:a},t.state&&t.state.usr||null,t.state&&t.state.key||"default",r?{pathname:e.location.pathname,search:e.location.search,hash:e.location.hash}:void 0)},function(e,t){return"string"===typeof t?t:x(t)},null,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function w(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function S(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(_w){}}}function T(e,t){return{usr:e.state,key:e.key,idx:t,masked:e.unstable_mask?{pathname:e.pathname,search:e.search,hash:e.hash}:void 0}}function k(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return d(d({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?I(t):t),{},{state:n,key:t&&t.key||r||Math.random().toString(36).substring(2,10),unstable_mask:s})}function x(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function I(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function L(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,o="POP",l=null,c=u();function u(){return(a.state||{idx:null}).idx}function h(){o="POP";let e=u(),t=null==e?null:e-c;c=e,l&&l({action:o,location:p.location,delta:t})}function f(e){return C(e)}null==c&&(c=0,a.replaceState(d(d({},a.state),{},{idx:c}),""));let p={get action(){return o},get location(){return e(s,a)},listen(e){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(y,h),l=e,()=>{s.removeEventListener(y,h),l=null}},createHref:e=>t(s,e),createURL:f,encodeLocation(e){let t=f(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){o="PUSH";let r=b(e)?e:k(p.location,e,t);n&&n(r,e),c=u()+1;let d=T(r,c),h=p.createHref(r.unstable_mask||r);try{a.pushState(d,"",h)}catch(f){if(f instanceof DOMException&&"DataCloneError"===f.name)throw f;s.location.assign(h)}i&&l&&l({action:o,location:p.location,delta:1})},replace:function(e,t){o="REPLACE";let r=b(e)?e:k(p.location,e,t);n&&n(r,e),c=u();let s=T(r,c),d=p.createHref(r.unstable_mask||r);a.replaceState(s,"",d),i&&l&&l({action:o,location:p.location,delta:0})},go:e=>a.go(e)};return p}function C(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="http://localhost";"undefined"!==typeof window&&(n="null"!==window.location.origin?window.location.origin:window.location.href),w(n,"No window.location.(origin|href) available to create URL");let r="string"===typeof e?e:x(e);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=n+r),new URL(r,n)}new WeakMap;function _(e,t){return A(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",!1)}function A(e,t,n,r){let s=K(("string"===typeof t?I(t):t).pathname||"/",n);if(null==s)return null;let i=R(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(i);let a=null;for(let o=0;null==a&&o<i.length;++o){let e=H(s);a=V(i[o],e,r)}return a}function R(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=function(e,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s,o=arguments.length>3?arguments[3]:void 0,l={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};if(l.relativePath.startsWith("/")){if(!l.relativePath.startsWith(r)&&a)return;w(l.relativePath.startsWith(r),'Absolute route path "'.concat(l.relativePath,'" nested under path "').concat(r,'" is not valid. An absolute child route path must start with the combined path of all its parent routes.')),l.relativePath=l.relativePath.slice(r.length)}let c=J([r,l.relativePath]),u=n.concat(l);e.children&&e.children.length>0&&(w(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'.concat(c,'".')),R(e.children,t,u,c,a)),(null!=e.path||e.index)&&t.push({path:c,score:B(c,e.index),routesMeta:u})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!==(n=e.path)&&void 0!==n&&n.includes("?"))for(let r of P(e.path))i(e,t,!0,r);else i(e,t)}),t}function P(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===r.length)return s?[i,""]:[i];let a=P(r.join("/")),o=[];return o.push(...a.map(e=>""===e?i:[i,e].join("/"))),s&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}var D=/^:[\w-]+$/,O=3,N=2,M=1,F=10,U=-2,j=e=>"*"===e;function B(e,t){let n=e.split("/"),r=n.length;return n.some(j)&&(r+=U),t&&(r+=N),n.filter(e=>!j(e)).reduce((e,t)=>e+(D.test(t)?O:""===t?M:F),r)}function V(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{routesMeta:r}=e,s={},i="/",a=[];for(let o=0;o<r.length;++o){let e=r[o],l=o===r.length-1,c="/"===i?t:t.slice(i.length)||"/",u=z({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),d=e.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=z({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(s,u.params),a.push({params:s,pathname:J([i,u.pathname]),pathnameBase:$(J([i,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(i=J([i,u.pathnameBase]))}return a}function z(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=G(e.path,e.caseSensitive,e.end),s=t.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:s}=t;if("*"===r){let e=o[n]||"";a=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[r]=s&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:i,pathnameBase:a,pattern:e}}function G(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];S("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'.concat(e,'" will be treated as if it were "').concat(e.replace(/\*$/,"/*"),'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "').concat(e.replace(/\*$/,"/*"),'".'));let r=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n,s,i)=>{if(r.push({paramName:t,isOptional:null!=n}),n){let t=i.charAt(s+e.length);return t&&"/"!==t?"/([^\\/]*)":"(?:/([^\\/]*))?"}return"/([^\\/]+)"}).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(r.push({paramName:"*"}),s+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":""!==e&&"/"!==e&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),r]}function H(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return S(!1,'The URL path "'.concat(e,'" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (').concat(t,").")),e}}function K(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}var W=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function q(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function Y(e,t,n,r){return"Cannot include a '".concat(e,"' character in a manually specified `to.").concat(t,"` field [").concat(JSON.stringify(r),"].  Please separate it out to the `to.").concat(n,'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.')}function Q(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function X(e){let t=Q(e);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function Z(e,t,n){let r,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"string"===typeof e?r=I(e):(r=d({},e),w(!r.pathname||!r.pathname.includes("?"),Y("?","pathname","search",r)),w(!r.pathname||!r.pathname.includes("#"),Y("#","pathname","hash",r)),w(!r.search||!r.search.includes("#"),Y("#","search","hash",r)));let i,a=""===e||""===r.pathname,o=a?"/":r.pathname;if(null==o)i=n;else{let e=t.length-1;if(!s&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}i=e>=0?t[e]:"/"}let l=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",{pathname:r,search:s="",hash:i=""}="string"===typeof e?I(e):e;return r?(r=r.replace(/\/\/+/g,"/"),t=r.startsWith("/")?q(r.substring(1),"/"):q(r,n)):t=n,{pathname:t,search:ee(s),hash:te(i)}}(r,i),c=o&&"/"!==o&&o.endsWith("/"),u=(a||"."===o)&&n.endsWith("/");return l.pathname.endsWith("/")||!c&&!u||(l.pathname+="/"),l}var J=e=>e.join("/").replace(/\/\/+/g,"/"),$=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),ee=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",te=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";var ne=class{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.status=e,this.statusText=t||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function re(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}function se(e){return e.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var ie="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;function ae(e,t){let n=e;if("string"!==typeof n||!W.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(ie)try{let e=new URL(window.location.href),r=n.startsWith("//")?new URL(e.protocol+n):new URL(n),i=K(r.pathname,t);r.origin===e.origin&&null!=i?n=i+r.search+r.hash:s=!0}catch(_w){S(!1,'<Link to="'.concat(n,'"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.'))}return{absoluteURL:r,isExternal:s,to:n}}Symbol("Uninstrumented");Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var oe=["POST","PUT","PATCH","DELETE"],le=(new Set(oe),["GET",...oe]);new Set(le),Symbol("ResetLoaderData");var ce=r.createContext(null);ce.displayName="DataRouter";var ue=r.createContext(null);ue.displayName="DataRouterState";var de=r.createContext(!1);function he(){return r.useContext(de)}var fe=r.createContext({isTransitioning:!1});fe.displayName="ViewTransition";var pe=r.createContext(new Map);pe.displayName="Fetchers";var ge=r.createContext(null);ge.displayName="Await";var me=r.createContext(null);me.displayName="Navigation";var ve=r.createContext(null);ve.displayName="Location";var ye=r.createContext({outlet:null,matches:[],isDataRoute:!1});ye.displayName="Route";var be=r.createContext(null);be.displayName="RouteError";var Ee="REACT_ROUTER_ERROR";function we(){return null!=r.useContext(ve)}function Se(){return w(we(),"useLocation() may be used only in the context of a <Router> component."),r.useContext(ve).location}var Te="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function ke(e){r.useContext(me).static||r.useLayoutEffect(e)}function xe(){let{isDataRoute:e}=r.useContext(ye);return e?function(){let{router:e}=Fe("useNavigate"),t=je("useNavigate"),n=r.useRef(!1);ke(()=>{n.current=!0});let s=r.useCallback(async function(r){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};S(n.current,Te),n.current&&("number"===typeof r?await e.navigate(r):await e.navigate(r,d({fromRouteId:t},s)))},[e,t]);return s}():function(){w(we(),"useNavigate() may be used only in the context of a <Router> component.");let e=r.useContext(ce),{basename:t,navigator:n}=r.useContext(me),{matches:s}=r.useContext(ye),{pathname:i}=Se(),a=JSON.stringify(X(s)),o=r.useRef(!1);ke(()=>{o.current=!0});let l=r.useCallback(function(r){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(S(o.current,Te),!o.current)return;if("number"===typeof r)return void n.go(r);let l=Z(r,JSON.parse(a),i,"path"===s.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:J([t,l.pathname])),(s.replace?n.replace:n.push)(l,s.state,s)},[t,n,a,i,e]);return l}()}r.createContext(null);function Ie(){let{matches:e}=r.useContext(ye),t=e[e.length-1];return t?t.params:{}}function Le(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{matches:n}=r.useContext(ye),{pathname:s}=Se(),i=JSON.stringify(X(n));return r.useMemo(()=>Z(e,JSON.parse(i),s,"path"===t),[e,i,s,t])}function Ce(e,t,n){w(we(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=r.useContext(me),{matches:i}=r.useContext(ye),a=i[i.length-1],o=a?a.params:{},l=a?a.pathname:"/",c=a?a.pathnameBase:"/",u=a&&a.route;{let e=u&&u.path||"";ze(l,!u||e.endsWith("*")||e.endsWith("*?"),'You rendered descendant <Routes> (or called `useRoutes()`) at "'.concat(l,'" (under <Route path="').concat(e,'">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won\'t match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="').concat(e,'"> to <Route path="').concat("/"===e?"*":"".concat(e,"/*"),'">.'))}let h,f=Se();if(t){var p;let e="string"===typeof t?I(t):t;w("/"===c||(null===(p=e.pathname)||void 0===p?void 0:p.startsWith(c)),'When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "'.concat(c,'" but pathname "').concat(e.pathname,'" was given in the `location` prop.')),h=e}else h=f;let g=h.pathname||"/",m=g;if("/"!==c){let e=c.replace(/^\//,"").split("/");m="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=_(e,{pathname:m});S(u||null!=v,'No routes matched location "'.concat(h.pathname).concat(h.search).concat(h.hash,'" ')),S(null==v||void 0!==v[v.length-1].route.element||void 0!==v[v.length-1].route.Component||void 0!==v[v.length-1].route.lazy,'Matched leaf route at location "'.concat(h.pathname).concat(h.search).concat(h.hash,'" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.'));let y=Ne(v&&v.map(e=>Object.assign({},e,{params:Object.assign({},o,e.params),pathname:J([c,s.encodeLocation?s.encodeLocation(e.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:J([c,s.encodeLocation?s.encodeLocation(e.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathnameBase])})),i,n);return t&&y?r.createElement(ve.Provider,{value:{location:d({pathname:"/",search:"",hash:"",state:null,key:"default",unstable_mask:void 0},h),navigationType:"POP"}},y):y}function _e(){let e=Be(),t=re(e)?"".concat(e.status," ").concat(e.statusText):e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,s="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:s},a={padding:"2px 4px",backgroundColor:s},o=null;return console.error("Error handled by React Router default ErrorBoundary:",e),o=r.createElement(r.Fragment,null,r.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),r.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",r.createElement("code",{style:a},"ErrorBoundary")," or"," ",r.createElement("code",{style:a},"errorElement")," prop on your route.")),r.createElement(r.Fragment,null,r.createElement("h2",null,"Unexpected Application Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},t),n?r.createElement("pre",{style:i},n):null,o)}var Ae=r.createElement(_e,null),Re=class extends r.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.onError?this.props.onError(e,t):console.error("React Router caught the following error during render",e)}render(){let e=this.state.error;if(this.context&&"object"===typeof e&&e&&"digest"in e&&"string"===typeof e.digest){const t=function(e){if(e.startsWith("".concat(Ee,":").concat("ROUTE_ERROR_RESPONSE",":{")))try{let t=JSON.parse(e.slice(40));if("object"===typeof t&&t&&"number"===typeof t.status&&"string"===typeof t.statusText)return new ne(t.status,t.statusText,t.data)}catch(t){}}(e.digest);t&&(e=t)}let t=void 0!==e?r.createElement(ye.Provider,{value:this.props.routeContext},r.createElement(be.Provider,{value:e,children:this.props.component})):this.props.children;return this.context?r.createElement(De,{error:e},t):t}};Re.contextType=de;var Pe=new WeakMap;function De(e){let{children:t,error:n}=e,{basename:s}=r.useContext(me);if("object"===typeof n&&n&&"digest"in n&&"string"===typeof n.digest){let e=function(e){if(e.startsWith("".concat(Ee,":").concat("REDIRECT",":{")))try{let t=JSON.parse(e.slice(28));if("object"===typeof t&&t&&"number"===typeof t.status&&"string"===typeof t.statusText&&"string"===typeof t.location&&"boolean"===typeof t.reloadDocument&&"boolean"===typeof t.replace)return t}catch(t){}}(n.digest);if(e){let t=Pe.get(n);if(t)throw t;let i=ae(e.location,s);if(ie&&!Pe.get(n)){if(!i.isExternal&&!e.reloadDocument){const t=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:e.replace}));throw Pe.set(n,t),t}window.location.href=i.absoluteURL||i.to}return r.createElement("meta",{httpEquiv:"refresh",content:"0;url=".concat(i.absoluteURL||i.to)})}}return t}function Oe(e){let{routeContext:t,match:n,children:s}=e,i=r.useContext(ce);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),r.createElement(ye.Provider,{value:t},s)}function Ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=null===n||void 0===n?void 0:n.state;if(null==e){if(!s)return null;if(s.errors)e=s.matches;else{if(0!==t.length||s.initialized||!(s.matches.length>0))return null;e=s.matches}}let i=e,a=null===s||void 0===s?void 0:s.errors;if(null!=a){let e=i.findIndex(e=>e.route.id&&void 0!==(null===a||void 0===a?void 0:a[e.route.id]));w(e>=0,"Could not find a matching route for errors on route IDs: ".concat(Object.keys(a).join(","))),i=i.slice(0,Math.min(i.length,e+1))}let o=!1,l=-1;if(n&&s){o=s.renderFallback;for(let e=0;e<i.length;e++){let t=i[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(l=e),t.route.id){let{loaderData:e,errors:r}=s,a=t.route.loader&&!e.hasOwnProperty(t.route.id)&&(!r||void 0===r[t.route.id]);if(t.route.lazy||a){n.isStatic&&(o=!0),i=l>=0?i.slice(0,l+1):[i[0]];break}}}}let c=null===n||void 0===n?void 0:n.onError,u=s&&c?(e,t)=>{var n,r;c(e,{location:s.location,params:null!==(n=null===(r=s.matches)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.params)&&void 0!==n?n:{},unstable_pattern:se(s.matches),errorInfo:t})}:void 0;return i.reduceRight((e,n,c)=>{let d,h=!1,f=null,p=null;s&&(d=a&&n.route.id?a[n.route.id]:void 0,f=n.route.errorElement||Ae,o&&(l<0&&0===c?(ze("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,p=null):l===c&&(h=!0,p=n.route.hydrateFallbackElement||null)));let g=t.concat(i.slice(0,c+1)),m=()=>{let t;return t=d?f:h?p:n.route.Component?r.createElement(n.route.Component,null):n.route.element?n.route.element:e,r.createElement(Oe,{match:n,routeContext:{outlet:e,matches:g,isDataRoute:null!=s},children:t})};return s&&(n.route.ErrorBoundary||n.route.errorElement||0===c)?r.createElement(Re,{location:s.location,revalidation:s.revalidation,component:f,error:d,children:m(),routeContext:{outlet:null,matches:g,isDataRoute:!0},onError:u}):m()},null)}function Me(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function Fe(e){let t=r.useContext(ce);return w(t,Me(e)),t}function Ue(e){let t=r.useContext(ue);return w(t,Me(e)),t}function je(e){let t=function(e){let t=r.useContext(ye);return w(t,Me(e)),t}(e),n=t.matches[t.matches.length-1];return w(n.route.id,"".concat(e,' can only be used on routes that contain a unique "id"')),n.route.id}function Be(){var e;let t=r.useContext(be),n=Ue("useRouteError"),s=je("useRouteError");return void 0!==t?t:null===(e=n.errors)||void 0===e?void 0:e[s]}var Ve={};function ze(e,t,n){t||Ve[e]||(Ve[e]=!0,S(!1,n))}var Ge={};function He(e,t){e||Ge[t]||(Ge[t]=!0,console.warn(t))}s.useOptimistic;r.memo(Ke);function Ke(e){let{routes:t,future:n,state:r,isStatic:s,onError:i}=e;return Ce(t,void 0,{state:r,isStatic:s,onError:i,future:n})}function We(e){let{to:t,replace:n,state:s,relative:i}=e;w(we(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=r.useContext(me);S(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=r.useContext(ye),{pathname:l}=Se(),c=xe(),u=Z(t,X(o),l,"path"===i),d=JSON.stringify(u);return r.useEffect(()=>{c(JSON.parse(d),{replace:n,state:s,relative:i})},[c,d,i,n,s]),null}function qe(e){w(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Ye(e){let{basename:t="/",children:n=null,location:s,navigationType:i="POP",navigator:a,static:o=!1,unstable_useTransitions:l}=e;w(!we(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=t.replace(/^\/*/,"/"),u=r.useMemo(()=>({basename:c,navigator:a,static:o,unstable_useTransitions:l,future:{}}),[c,a,o,l]);"string"===typeof s&&(s=I(s));let{pathname:d="/",search:h="",hash:f="",state:p=null,key:g="default",unstable_mask:m}=s,v=r.useMemo(()=>{let e=K(d,c);return null==e?null:{location:{pathname:e,search:h,hash:f,state:p,key:g,unstable_mask:m},navigationType:i}},[c,d,h,f,p,g,i,m]);return S(null!=v,'<Router basename="'.concat(c,'"> is not able to match the URL "').concat(d).concat(h).concat(f,"\" because it does not start with the basename, so the <Router> won't render anything.")),null==v?null:r.createElement(me.Provider,{value:u},r.createElement(ve.Provider,{children:n,value:v}))}function Qe(e){let{children:t,location:n}=e;return Ce(Xe(t),n)}r.Component;function Xe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return r.Children.forEach(e,(e,s)=>{if(!r.isValidElement(e))return;let i=[...t,s];if(e.type===r.Fragment)return void n.push.apply(n,Xe(e.props.children,i));w(e.type===qe,"[".concat("string"===typeof e.type?e.type:e.type.name,"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>")),w(!e.props.index||!e.props.children,"An index route cannot have child routes.");let a={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,middleware:e.props.middleware,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=Xe(e.props.children,i)),n.push(a)}),n}var Ze="get",Je="application/x-www-form-urlencoded";function $e(e){return"undefined"!==typeof HTMLElement&&e instanceof HTMLElement}function et(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(e=>[n,e]):[[n,r]])},[]))}var tt=null;var nt=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function rt(e){return null==e||nt.has(e)?e:(S(!1,'"'.concat(e,'" is not a valid `encType` for `<Form>`/`<fetcher.Form>` and will default to "').concat(Je,'"')),null)}function st(e,t){let n,r,s,i,a;if($e(o=e)&&"form"===o.tagName.toLowerCase()){let a=e.getAttribute("action");r=a?K(a,t):null,n=e.getAttribute("method")||Ze,s=rt(e.getAttribute("enctype"))||Je,i=new FormData(e)}else if(function(e){return $e(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return $e(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let a=e.form;if(null==a)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let o=e.getAttribute("formaction")||a.getAttribute("action");if(r=o?K(o,t):null,n=e.getAttribute("formmethod")||a.getAttribute("method")||Ze,s=rt(e.getAttribute("formenctype"))||rt(a.getAttribute("enctype"))||Je,i=new FormData(a,e),!function(){if(null===tt)try{new FormData(document.createElement("form"),0),tt=!1}catch(_w){tt=!0}return tt}()){let{name:t,type:n,value:r}=e;if("image"===n){let e=t?"".concat(t,"."):"";i.append("".concat(e,"x"),"0"),i.append("".concat(e,"y"),"0")}else t&&i.append(t,r)}}else{if($e(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Ze,r=null,s=Je,a=e}var o;return i&&"text/plain"===s&&(a=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");"undefined"!==typeof window?window:"undefined"!==typeof globalThis&&globalThis;function it(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}Symbol("SingleFetchRedirect");function at(e,t,n,r){let s="string"===typeof e?new URL(e,"undefined"===typeof window?"server://singlefetch/":window.location.origin):e;return n?s.pathname.endsWith("/")?s.pathname="".concat(s.pathname,"_.").concat(r):s.pathname="".concat(s.pathname,".").concat(r):"/"===s.pathname?s.pathname="_root.".concat(r):t&&"/"===K(s.pathname,t)?s.pathname="".concat(t.replace(/\/$/,""),"/_root.").concat(r):s.pathname="".concat(s.pathname.replace(/\/$/,""),".").concat(r),s}async function ot(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error("Error loading route module `".concat(e.module,"`, reloading page...")),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function lt(e){return null!=e&&"string"===typeof e.page}function ct(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"===typeof e.imageSrcSet&&"string"===typeof e.imageSizes:"string"===typeof e.rel&&"string"===typeof e.href)}function ut(e,t,n,r,s,i){let a=(e,t)=>!n[t]||e.route.id!==n[t].route.id,o=(e,t)=>{var r;return n[t].pathname!==e.pathname||(null===(r=n[t].route.path)||void 0===r?void 0:r.endsWith("*"))&&n[t].params["*"]!==e.params["*"]};return"assets"===i?t.filter((e,t)=>a(e,t)||o(e,t)):"data"===i?t.filter((t,i)=>{let l=r.routes[t.route.id];if(!l||!l.hasLoader)return!1;if(a(t,i)||o(t,i))return!0;if(t.route.shouldRevalidate){var c;let r=t.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:(null===(c=n[0])||void 0===c?void 0:c.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"===typeof r)return r}return!0}):[]}function dt(e,t){let{includeHydrateFallback:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=e.map(e=>{let r=t.routes[e.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1),[...new Set(r)];var r}function ht(e,t){let n=new Set,r=new Set(t);return e.reduce((e,s)=>{if(t&&!lt(s)&&"script"===s.as&&s.href&&r.has(s.href))return e;let i=JSON.stringify(function(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}(s));return n.has(i)||(n.add(i),e.push({key:i,link:s})),e},[])}function ft(e,t){return"lazy"===e.mode&&!0===t}function pt(){let e=r.useContext(ce);return it(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function gt(){let e=r.useContext(ue);return it(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var mt=r.createContext(void 0);function vt(){let e=r.useContext(mt);return it(e,"You must render this element inside a <HydratedRouter> element"),e}function yt(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function bt(e,t,n){if(n&&!Tt)return[e[0]];if(t){let n=e.findIndex(e=>void 0!==t[e.route.id]);return e.slice(0,n+1)}return e}mt.displayName="FrameworkContext";function Et(e){let{page:t}=e,n=a(e,f),{router:s}=pt(),i=r.useMemo(()=>_(s.routes,t,s.basename),[s.routes,t,s.basename]);return i?r.createElement(St,d({page:t,matches:i},n)):null}function wt(e){let{manifest:t,routeModules:n}=vt(),[s,i]=r.useState([]);return r.useEffect(()=>{let r=!1;return async function(e,t,n){let r=await Promise.all(e.map(async e=>{let r=t.routes[e.route.id];if(r){let e=await ot(r,n);return e.links?e.links():[]}return[]}));return ht(r.flat(1).filter(ct).filter(e=>"stylesheet"===e.rel||"preload"===e.rel).map(e=>"stylesheet"===e.rel?d(d({},e),{},{rel:"prefetch",as:"style"}):d(d({},e),{},{rel:"prefetch"})))}(e,t,n).then(e=>{r||i(e)}),()=>{r=!0}},[e,t,n]),s}function St(e){let{page:t,matches:n}=e,s=a(e,p),i=Se(),{future:o,manifest:l,routeModules:c}=vt(),{basename:u}=pt(),{loaderData:h,matches:f}=gt(),g=r.useMemo(()=>ut(t,n,f,l,i,"data"),[t,n,f,l,i]),m=r.useMemo(()=>ut(t,n,f,l,i,"assets"),[t,n,f,l,i]),v=r.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let e=new Set,r=!1;if(n.forEach(t=>{var n;let s=l.routes[t.route.id];s&&s.hasLoader&&(!g.some(e=>e.route.id===t.route.id)&&t.route.id in h&&null!==(n=c[t.route.id])&&void 0!==n&&n.shouldRevalidate||s.hasClientLoader?r=!0:e.add(t.route.id))}),0===e.size)return[];let s=at(t,u,o.unstable_trailingSlashAwareDataRequests,"data");return r&&e.size>0&&s.searchParams.set("_routes",n.filter(t=>e.has(t.route.id)).map(e=>e.route.id).join(",")),[s.pathname+s.search]},[u,o.unstable_trailingSlashAwareDataRequests,h,i,l,g,n,t,c]),y=r.useMemo(()=>dt(m,l),[m,l]),b=wt(m);return r.createElement(r.Fragment,null,v.map(e=>r.createElement("link",d({key:e,rel:"prefetch",as:"fetch",href:e},s))),y.map(e=>r.createElement("link",d({key:e,rel:"modulepreload",href:e},s))),b.map(e=>{var t;let{key:n,link:i}=e;return r.createElement("link",d(d({key:n,nonce:s.nonce},i),{},{crossOrigin:null!==(t=i.crossOrigin)&&void 0!==t?t:s.crossOrigin}))}))}var Tt=!1;function kt(e){let{manifest:t,serverHandoffString:n,isSpaMode:s,renderMeta:i,routeDiscovery:o,ssr:l}=vt(),{router:c,static:u,staticContext:f}=pt(),{matches:p}=gt(),g=he(),m=ft(o,l);i&&(i.didRenderScripts=!0);let v=bt(p,null,s);r.useEffect(()=>{Tt=!0},[]);let y=r.useMemo(()=>{var s;if(g)return null;let i=f?"window.__reactRouterContext = ".concat(n,";").concat("window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());"):" ",o=u?"".concat(null!==(s=t.hmr)&&void 0!==s&&s.runtime?"import ".concat(JSON.stringify(t.hmr.runtime),";"):"").concat(m?"":"import ".concat(JSON.stringify(t.url)),";\n").concat(v.map((e,n)=>{let r="route".concat(n),s=t.routes[e.route.id];it(s,"Route ".concat(e.route.id," not found in manifest"));let{clientActionModule:i,clientLoaderModule:a,clientMiddlewareModule:o,hydrateFallbackModule:l,module:c}=s,u=[...i?[{module:i,varName:"".concat(r,"_clientAction")}]:[],...a?[{module:a,varName:"".concat(r,"_clientLoader")}]:[],...o?[{module:o,varName:"".concat(r,"_clientMiddleware")}]:[],...l?[{module:l,varName:"".concat(r,"_HydrateFallback")}]:[],{module:c,varName:"".concat(r,"_main")}];return 1===u.length?"import * as ".concat(r," from ").concat(JSON.stringify(c),";"):[u.map(e=>"import * as ".concat(e.varName,' from "').concat(e.module,'";')).join("\n"),"const ".concat(r," = {").concat(u.map(e=>"...".concat(e.varName)).join(","),"};")].join("\n")}).join("\n"),"\n  ").concat(m?"window.__reactRouterManifest = ".concat(JSON.stringify(function(e,t){let{sri:n}=e,r=a(e,h),s=new Set(t.state.matches.map(e=>e.route.id)),i=t.state.location.pathname.split("/").filter(Boolean),o=["/"];for(i.pop();i.length>0;)o.push("/".concat(i.join("/"))),i.pop();o.forEach(e=>{let n=_(t.routes,e,t.basename);n&&n.forEach(e=>s.add(e.route.id))});let l=[...s].reduce((e,t)=>Object.assign(e,{[t]:r.routes[t]}),{});return d(d({},r),{},{routes:l,sri:!!n||void 0})}(t,c),null,2),";"):"","\n  window.__reactRouterRouteModules = {").concat(v.map((e,t)=>"".concat(JSON.stringify(e.route.id),":route").concat(t)).join(","),"};\n\nimport(").concat(JSON.stringify(t.entry.module),");"):" ";return r.createElement(r.Fragment,null,r.createElement("script",d(d({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:i},type:void 0})),r.createElement("script",d(d({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:o},type:"module",async:!0})))},[]),b=Tt||g?[]:(E=t.entry.imports.concat(dt(v,t,{includeHydrateFallback:!0})),[...new Set(E)]);var E;let w="object"===typeof t.sri?t.sri:{};return He(!g,"The <Scripts /> element is a no-op when using RSC and can be safely removed."),Tt||g?null:r.createElement(r.Fragment,null,"object"===typeof t.sri?r.createElement("script",d(d({},e),{},{"rr-importmap":"",type:"importmap",suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:JSON.stringify({integrity:w})}})):null,m?null:r.createElement("link",{rel:"modulepreload",href:t.url,crossOrigin:e.crossOrigin,integrity:w[t.url],suppressHydrationWarning:!0}),r.createElement("link",{rel:"modulepreload",href:t.entry.module,crossOrigin:e.crossOrigin,integrity:w[t.entry.module],suppressHydrationWarning:!0}),b.map(t=>r.createElement("link",{key:t,rel:"modulepreload",href:t,crossOrigin:e.crossOrigin,integrity:w[t],suppressHydrationWarning:!0})),y)}function xt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{t.forEach(t=>{"function"===typeof t?t(e):null!=t&&(t.current=e)})}}r.Component;function It(e){let{error:t,isOutsideRemixApp:n}=e;console.error(t);let s,i=r.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://reactrouter.com/how-to/error-boundary for more information."\n        );\n      '}});if(re(t))return r.createElement(Lt,{title:"Unhandled Thrown Response!"},r.createElement("h1",{style:{fontSize:"24px"}},t.status," ",t.statusText),i);if(t instanceof Error)s=t;else{let e=null==t?"Unknown Error":"object"===typeof t&&"toString"in t?t.toString():JSON.stringify(t);s=new Error(e)}return r.createElement(Lt,{title:"Application Error!",isOutsideRemixApp:n},r.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),r.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},s.stack),i)}function Lt(e){var t;let{title:n,renderScripts:s,isOutsideRemixApp:i,children:a}=e,{routeModules:o}=vt();return null!==(t=o.root)&&void 0!==t&&t.Layout&&!i?a:r.createElement("html",{lang:"en"},r.createElement("head",null,r.createElement("meta",{charSet:"utf-8"}),r.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),r.createElement("title",null,n)),r.createElement("body",null,r.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},a,s?r.createElement(kt,null):null)))}var Ct="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{Ct&&(window.__reactRouterVersion="7.13.1")}catch(_w){}function _t(e){let{basename:t,children:n,unstable_useTransitions:s,window:i}=e,a=r.useRef();null==a.current&&(a.current=E({window:i,v5Compat:!0}));let o=a.current,[l,c]=r.useState({action:o.action,location:o.location}),u=r.useCallback(e=>{!1===s?c(e):r.startTransition(()=>c(e))},[s]);return r.useLayoutEffect(()=>o.listen(u),[o,u]),r.createElement(Ye,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:s})}var At=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Rt=r.forwardRef(function(e,t){let{onClick:n,discover:s="render",prefetch:i="none",relative:o,reloadDocument:l,replace:c,unstable_mask:u,state:h,target:f,to:p,preventScrollReset:m,viewTransition:v,unstable_defaultShouldRevalidate:y}=e,b=a(e,g),{basename:E,navigator:S,unstable_useTransitions:T}=r.useContext(me),k="string"===typeof p&&At.test(p),I=ae(p,E);p=I.to;let L=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(we(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:s}=r.useContext(me),{hash:i,pathname:a,search:o}=Le(e,{relative:t}),l=a;return"/"!==n&&(l="/"===a?n:J([n,a])),s.createHref({pathname:l,search:o,hash:i})}(p,{relative:o}),C=Se(),_=null;if(u){let e=Z(u,[],C.unstable_mask?C.unstable_mask.pathname:"/",!0);"/"!==E&&(e.pathname="/"===e.pathname?E:J([E,e.pathname])),_=S.createHref(e)}let[A,R,P]=function(e,t){let n=r.useContext(mt),[s,i]=r.useState(!1),[a,o]=r.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:u,onMouseLeave:d,onTouchStart:h}=t,f=r.useRef(null);r.useEffect(()=>{if("render"===e&&o(!0),"viewport"===e){let e=new IntersectionObserver(e=>{e.forEach(e=>{o(e.isIntersecting)})},{threshold:.5});return f.current&&e.observe(f.current),()=>{e.disconnect()}}},[e]),r.useEffect(()=>{if(s){let e=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(e)}}},[s]);let p=()=>{i(!0)},g=()=>{i(!1),o(!1)};return n?"intent"!==e?[a,f,{}]:[a,f,{onFocus:yt(l,p),onBlur:yt(c,g),onMouseEnter:yt(u,p),onMouseLeave:yt(d,g),onTouchStart:yt(h,p)}]:[!1,f,{}]}(i,b),D=function(e){let{target:t,replace:n,unstable_mask:s,state:i,preventScrollReset:a,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:c,unstable_useTransitions:u}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=xe(),h=Se(),f=Le(e,{relative:o});return r.useCallback(p=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(p,t)){p.preventDefault();let t=void 0!==n?n:x(h)===x(f),g=()=>d(e,{replace:t,unstable_mask:s,state:i,preventScrollReset:a,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:c});u?r.startTransition(()=>g()):g()}},[h,d,f,n,s,i,t,e,a,o,l,c,u])}(p,{replace:c,unstable_mask:u,state:h,target:f,preventScrollReset:m,relative:o,viewTransition:v,unstable_defaultShouldRevalidate:y,unstable_useTransitions:T});let O=!(I.isExternal||l),N=r.createElement("a",d(d(d({},b),P),{},{href:(O?_:void 0)||I.absoluteURL||L,onClick:O?function(e){n&&n(e),e.defaultPrevented||D(e)}:n,ref:xt(t,R),target:f,"data-discover":k||"render"!==s?void 0:"true"}));return A&&!k?r.createElement(r.Fragment,null,N,r.createElement(Et,{page:L})):N});Rt.displayName="Link";var Pt=r.forwardRef(function(e,t){let{"aria-current":n="page",caseSensitive:s=!1,className:i="",end:o=!1,style:l,to:c,viewTransition:u,children:h}=e,f=a(e,m),p=Le(c,{relative:f.relative}),g=Se(),v=r.useContext(ue),{navigator:y,basename:b}=r.useContext(me),E=null!=v&&function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.useContext(fe);w(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=Nt("useViewTransitionState"),i=Le(e,{relative:t});if(!n.isTransitioning)return!1;let a=K(n.currentLocation.pathname,s)||n.currentLocation.pathname,o=K(n.nextLocation.pathname,s)||n.nextLocation.pathname;return null!=z(i.pathname,o)||null!=z(i.pathname,a)}(p)&&!0===u,S=y.encodeLocation?y.encodeLocation(p).pathname:p.pathname,T=g.pathname,k=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;s||(T=T.toLowerCase(),k=k?k.toLowerCase():null,S=S.toLowerCase()),k&&b&&(k=K(k,b)||k);const x="/"!==S&&S.endsWith("/")?S.length-1:S.length;let I,L=T===S||!o&&T.startsWith(S)&&"/"===T.charAt(x),C=null!=k&&(k===S||!o&&k.startsWith(S)&&"/"===k.charAt(S.length)),_={isActive:L,isPending:C,isTransitioning:E},A=L?n:void 0;I="function"===typeof i?i(_):[i,L?"active":null,C?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let R="function"===typeof l?l(_):l;return r.createElement(Rt,d(d({},f),{},{"aria-current":A,className:I,ref:t,style:R,to:c,viewTransition:u}),"function"===typeof h?h(_):h)});Pt.displayName="NavLink";var Dt=r.forwardRef((e,t)=>{let{discover:n="render",fetcherKey:s,navigate:i,reloadDocument:o,replace:l,state:c,method:u=Ze,action:h,onSubmit:f,relative:p,preventScrollReset:g,viewTransition:m,unstable_defaultShouldRevalidate:y}=e,b=a(e,v),{unstable_useTransitions:E}=r.useContext(me),S=jt(),T=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{basename:n}=r.useContext(me),s=r.useContext(ye);w(s,"useFormAction must be used inside a RouteContext");let[i]=s.matches.slice(-1),a=d({},Le(e||".",{relative:t})),o=Se();if(null==e){a.search=o.search;let e=new URLSearchParams(a.search),t=e.getAll("index"),n=t.some(e=>""===e);if(n){e.delete("index"),t.filter(e=>e).forEach(t=>e.append("index",t));let n=e.toString();a.search=n?"?".concat(n):""}}e&&"."!==e||!i.route.index||(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index");"/"!==n&&(a.pathname="/"===a.pathname?n:J([n,a.pathname]));return x(a)}(h,{relative:p}),k="get"===u.toLowerCase()?"get":"post",I="string"===typeof h&&At.test(h);return r.createElement("form",d(d({ref:t,method:k,action:T,onSubmit:o?f:e=>{if(f&&f(e),e.defaultPrevented)return;e.preventDefault();let t=e.nativeEvent.submitter,n=(null===t||void 0===t?void 0:t.getAttribute("formmethod"))||u,a=()=>S(t||e.currentTarget,{fetcherKey:s,method:n,navigate:i,replace:l,state:c,relative:p,preventScrollReset:g,viewTransition:m,unstable_defaultShouldRevalidate:y});E&&!1!==i?r.startTransition(()=>a()):a()}},b),{},{"data-discover":I||"render"!==n?void 0:"true"}))});function Ot(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function Nt(e){let t=r.useContext(ce);return w(t,Ot(e)),t}function Mt(e){S("undefined"!==typeof URLSearchParams,"You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=r.useRef(et(e)),n=r.useRef(!1),s=Se(),i=r.useMemo(()=>function(e,t){let n=et(e);return t&&t.forEach((e,r)=>{n.has(r)||t.getAll(r).forEach(e=>{n.append(r,e)})}),n}(s.search,n.current?null:t.current),[s.search]),a=xe(),o=r.useCallback((e,t)=>{const r=et("function"===typeof e?e(new URLSearchParams(i)):e);n.current=!0,a("?"+r,t)},[a,i]);return[i,o]}Dt.displayName="Form";var Ft=0,Ut=()=>"__".concat(String(++Ft),"__");function jt(){let{router:e}=Nt("useSubmit"),{basename:t}=r.useContext(me),n=je("useRouteId"),s=e.fetch,i=e.navigate;return r.useCallback(async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{action:a,method:o,encType:l,formData:c,body:u}=st(e,t);if(!1===r.navigate){let e=r.fetcherKey||Ut();await s(e,n,r.action||a,{unstable_defaultShouldRevalidate:r.unstable_defaultShouldRevalidate,preventScrollReset:r.preventScrollReset,formData:c,body:u,formMethod:r.method||o,formEncType:r.encType||l,flushSync:r.flushSync})}else await i(r.action||a,{unstable_defaultShouldRevalidate:r.unstable_defaultShouldRevalidate,preventScrollReset:r.preventScrollReset,formData:c,body:u,formMethod:r.method||o,formEncType:r.encType||l,replace:r.replace,state:r.state,fromRouteId:n,flushSync:r.flushSync,viewTransition:r.viewTransition})},[s,i,t,n])}const Bt=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296===(64512&s)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},Vt={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<e.length;s+=3){const t=e[s],i=s+1<e.length,a=i?e[s+1]:0,o=s+2<e.length,l=o?e[s+2]:0,c=t>>2,u=(3&t)<<4|a>>4;let d=(15&a)<<2|l>>6,h=63&l;o||(h=64,i||(d=64)),r.push(n[c],n[u],n[d],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Bt(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<e.length;){const t=n[e.charAt(s++)],i=s<e.length?n[e.charAt(s)]:0;++s;const a=s<e.length?n[e.charAt(s)]:64;++s;const o=s<e.length?n[e.charAt(s)]:64;if(++s,null==t||null==i||null==a||null==o)throw new zt;const l=t<<2|i>>4;if(r.push(l),64!==a){const e=i<<4&240|a>>2;if(r.push(e),64!==o){const e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class zt extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Gt=function(e){return function(e){const t=Bt(e);return Vt.encodeByteArray(t,!0)}(e).replace(/\./g,"")},Ht=function(e){try{return Vt.decodeString(e,!0)}catch(_w){console.error("base64Decode failed: ",_w)}return null};function Kt(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}const Wt=()=>{try{return Kt().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/auto-cast-capture",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BASE_URL:"http://192.168.1.183:3000",REACT_APP_DEFAULT_STRIPE_PRICE_ID:"price_1SeoLmFiGpyZE87M9ZOX2uoC",REACT_APP_FIREBASE_API_KEY:"AIzaSyCwoCcI0qoMI72UKbVbAMSHp8UxHLuM960",REACT_APP_FIREBASE_APP_ID:"1:822639495360:web:8483e0da5c9ceb387d0525",REACT_APP_FIREBASE_AUTH_DOMAIN:"towncapture-25aa5.firebaseapp.com",REACT_APP_FIREBASE_PROJECT_ID:"towncapture-25aa5",REACT_APP_FIREBASE_STORAGE_BUCKET:"towncapture-25aa5.firebasestorage.app",REACT_APP_GOOGLE_MAPS_KEY:"AIzaSyCGRWnLsX5MMzlvfMiby5vvH-CsXyD607s",REACT_APP_PUBLIC_CAPTURE_BASE_URL:"http://localhost:3000",REACT_APP_SERVER_URL:"http://192.168.1.183:4450"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(_w){return}const t=e&&Ht(e[1]);return t&&JSON.parse(t)})()}catch(_w){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(_w))}},qt=e=>{var t;return null===(t=Wt())||void 0===t||null===(t=t.emulatorHosts)||void 0===t?void 0:t[e]},Yt=e=>{const t=qt(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},Qt=()=>{var e;return null===(e=Wt())||void 0===e?void 0:e.config},Xt=e=>{var t;return null===(t=Wt())||void 0===t?void 0:t["_".concat(e)]};class Zt{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function Jt(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}async function $t(e){return(await fetch(e,{credentials:"include"})).ok}function en(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=d({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Gt(JSON.stringify({alg:"none",type:"JWT"})),Gt(JSON.stringify(i)),""].join(".")}const tn={};let nn=!1;function rn(e,t){if("undefined"===typeof window||"undefined"===typeof document||!Jt(window.location.host)||tn[e]===t||tn[e]||nn)return;function n(e){return"__firebase__banner__".concat(e)}tn[e]=t;const r="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(tn))tn[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{nn=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}function a(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),a=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),l=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,o);const n=i();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,a,l,n),document.body.appendChild(t)}s?(a.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}function sn(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function an(){var e;const t=null===(e=Wt())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(_w){return!1}}function on(){return!an()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ln(){try{return"object"===typeof indexedDB}catch(_w){return!1}}class cn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,cn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,un.prototype.create)}}class un{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],s=r?function(e,t){return e.replace(dn,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",i="".concat(this.serviceName,": ").concat(s," (").concat(n,").");return new cn(n,i,t)}}const dn=/\{\$([^}]+)}/g;function hn(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(fn(n)&&fn(i)){if(!hn(n,i))return!1}else if(n!==i)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function fn(e){return null!==e&&"object"===typeof e}function pn(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function gn(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function mn(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class vn{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=yn),void 0===r.error&&(r.error=yn),void 0===r.complete&&(r.complete=yn);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(_w){}}),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(_w){"undefined"!==typeof console&&console.error&&console.error(_w)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function yn(){}function bn(e){return e&&e._delegate?e._delegate:e}class En{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const wn="[DEFAULT]";class Sn{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Zt;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(_w){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(_w){if(r)return null;throw _w}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:wn})}catch(_w){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(_w){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wn;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wn;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wn;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&i.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===wn?void 0:s),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(i){}var s;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wn;return this.component?this.component.multipleInstances?e:wn:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Tn{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Sn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const kn=[];var xn;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(xn||(xn={}));const In={debug:xn.DEBUG,verbose:xn.VERBOSE,info:xn.INFO,warn:xn.WARN,error:xn.ERROR,silent:xn.SILENT},Ln=xn.INFO,Cn={[xn.DEBUG]:"log",[xn.VERBOSE]:"log",[xn.INFO]:"info",[xn.WARN]:"warn",[xn.ERROR]:"error"},_n=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=Cn[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var s=arguments.length,i=new Array(s>2?s-2:0),a=2;a<s;a++)i[a-2]=arguments[a];console[r]("[".concat(n,"]  ").concat(e.name,":"),...i)};class An{constructor(e){this.name=e,this._logLevel=Ln,this._logHandler=_n,this._userLogHandler=null,kn.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in xn))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?In[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,xn.DEBUG,...t),this._logHandler(this,xn.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,xn.VERBOSE,...t),this._logHandler(this,xn.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,xn.INFO,...t),this._logHandler(this,xn.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,xn.WARN,...t),this._logHandler(this,xn.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,xn.ERROR,...t),this._logHandler(this,xn.ERROR,...t)}}let Rn,Pn;const Dn=new WeakMap,On=new WeakMap,Nn=new WeakMap,Mn=new WeakMap,Fn=new WeakMap;let Un={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return On.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Nn.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Vn(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function jn(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Pn||(Pn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(zn(this),n),Vn(Dn.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Vn(e.apply(zn(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];const i=e.call(zn(this),t,...r);return Nn.set(i,t.sort?t.sort():[t]),Vn(i)}}function Bn(e){return"function"===typeof e?jn(e):(e instanceof IDBTransaction&&function(e){if(On.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});On.set(e,t)}(e),t=e,(Rn||(Rn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Un):e);var t}function Vn(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(Vn(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&Dn.set(t,e)}).catch(()=>{}),Fn.set(t,e),t}(e);if(Mn.has(e))return Mn.get(e);const t=Bn(e);return t!==e&&(Mn.set(e,t),Fn.set(t,e)),t}const zn=e=>Fn.get(e);const Gn=["get","getKey","getAll","getAllKeys","count"],Hn=["put","add","delete","clear"],Kn=new Map;function Wn(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Kn.get(t))return Kn.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=Hn.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!Gn.includes(n))return;const i=async function(e){const t=this.transaction(e,s?"readwrite":"readonly");let i=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];return r&&(i=i.index(o.shift())),(await Promise.all([i[n](...o),s&&t.done]))[0]};return Kn.set(t,i),i}Un=(e=>d(d({},e),{},{get:(t,n,r)=>Wn(t,n)||e.get(t,n,r),has:(t,n)=>!!Wn(t,n)||e.has(t,n)}))(Un);class qn{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const Yn="@firebase/app",Qn="0.14.8",Xn=new An("@firebase/app"),Zn="@firebase/app-compat",Jn="@firebase/analytics-compat",$n="@firebase/analytics",er="@firebase/app-check-compat",tr="@firebase/app-check",nr="@firebase/auth",rr="@firebase/auth-compat",sr="@firebase/database",ir="@firebase/data-connect",ar="@firebase/database-compat",or="@firebase/functions",lr="@firebase/functions-compat",cr="@firebase/installations",ur="@firebase/installations-compat",dr="@firebase/messaging",hr="@firebase/messaging-compat",fr="@firebase/performance",pr="@firebase/performance-compat",gr="@firebase/remote-config",mr="@firebase/remote-config-compat",vr="@firebase/storage",yr="@firebase/storage-compat",br="@firebase/firestore",Er="@firebase/ai",wr="@firebase/firestore-compat",Sr="firebase",Tr="[DEFAULT]",kr={[Yn]:"fire-core",[Zn]:"fire-core-compat",[$n]:"fire-analytics",[Jn]:"fire-analytics-compat",[tr]:"fire-app-check",[er]:"fire-app-check-compat",[nr]:"fire-auth",[rr]:"fire-auth-compat",[sr]:"fire-rtdb",[ir]:"fire-data-connect",[ar]:"fire-rtdb-compat",[or]:"fire-fn",[lr]:"fire-fn-compat",[cr]:"fire-iid",[ur]:"fire-iid-compat",[dr]:"fire-fcm",[hr]:"fire-fcm-compat",[fr]:"fire-perf",[pr]:"fire-perf-compat",[gr]:"fire-rc",[mr]:"fire-rc-compat",[vr]:"fire-gcs",[yr]:"fire-gcs-compat",[br]:"fire-fst",[wr]:"fire-fst-compat",[Er]:"fire-vertex","fire-js":"fire-js",[Sr]:"fire-js-all"},xr=new Map,Ir=new Map,Lr=new Map;function Cr(e,t){try{e.container.addComponent(t)}catch(_w){Xn.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),_w)}}function _r(e){const t=e.name;if(Lr.has(t))return Xn.debug("There were multiple attempts to register component ".concat(t,".")),!1;Lr.set(t,e);for(const n of xr.values())Cr(n,e);for(const n of Ir.values())Cr(n,e);return!0}function Ar(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Rr(e){return null!==e&&void 0!==e&&void 0!==e.settings}const Pr=new un("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Dr{constructor(e,t,n){this._isDeleted=!1,this._options=d({},e),this._config=d({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new En("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Pr.create("app-deleted",{appName:this._name})}}const Or="12.9.0";function Nr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=d({name:Tr,automaticDataCollectionEnabled:!0},t),s=r.name;if("string"!==typeof s||!s)throw Pr.create("bad-app-name",{appName:String(s)});if(n||(n=Qt()),!n)throw Pr.create("no-options");const i=xr.get(s);if(i){if(hn(n,i.options)&&hn(r,i.config))return i;throw Pr.create("duplicate-app",{appName:s})}const a=new Tn(s);for(const l of Lr.values())a.addComponent(l);const o=new Dr(n,r,a);return xr.set(s,o),o}function Mr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tr;const t=xr.get(e);if(!t&&e===Tr&&Qt())return Nr();if(!t)throw Pr.create("no-app",{appName:e});return t}function Fr(e,t,n){var r;let s=null!==(r=kr[e])&&void 0!==r?r:e;n&&(s+="-".concat(n));const i=s.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const e=['Unable to register library "'.concat(s,'" with version "').concat(t,'":')];return i&&e.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),i&&a&&e.push("and"),a&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void Xn.warn(e.join(" "))}_r(new En("".concat(s,"-version"),()=>({library:s,version:t}),"VERSION"))}const Ur="firebase-heartbeat-store";let jr=null;function Br(){return jr||(jr=function(e,t){let{blocked:n,upgrade:r,blocking:s,terminated:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=Vn(a);return r&&a.addEventListener("upgradeneeded",e=>{r(Vn(a.result),e.oldVersion,e.newVersion,Vn(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Ur)}catch(_w){console.warn(_w)}}}).catch(e=>{throw Pr.create("idb-open",{originalErrorMessage:e.message})})),jr}async function Vr(e,t){try{const n=(await Br()).transaction(Ur,"readwrite"),r=n.objectStore(Ur);await r.put(t,zr(e)),await n.done}catch(_w){if(_w instanceof cn)Xn.warn(_w.message);else{const t=Pr.create("idb-set",{originalErrorMessage:null===_w||void 0===_w?void 0:_w.message});Xn.warn(t.message)}}}function zr(e){return"".concat(e.name,"!").concat(e.options.appId)}class Gr{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Kr(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{var e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Hr();var t;if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(_w){Xn.warn(_w)}}async getHeartbeatsHeader(){try{var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Hr(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const s of e){const e=n.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),Wr(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Wr(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=Gt(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(_w){return Xn.warn(_w),""}}}function Hr(){return(new Date).toISOString().substring(0,10)}class Kr{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ln()&&new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Br()).transaction(Ur),n=await t.objectStore(Ur).get(zr(e));return await t.done,n}catch(_w){if(_w instanceof cn)Xn.warn(_w.message);else{const t=Pr.create("idb-get",{originalErrorMessage:null===_w||void 0===_w?void 0:_w.message});Xn.warn(t.message)}}}(this.app);return null!==e&&void 0!==e&&e.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return Vr(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return Vr(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Wr(e){return Gt(JSON.stringify({version:2,heartbeats:e})).length}var qr;qr="",_r(new En("platform-logger",e=>new qn(e),"PRIVATE")),_r(new En("heartbeat",e=>new Gr(e),"PRIVATE")),Fr(Yn,Qn,qr),Fr(Yn,Qn,"esm2020"),Fr("fire-js","");const Yr=["providerId"],Qr=["uid","auth","stsTokenManager"],Xr=["providerId","signInMethod"];function Zr(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Jr=Zr,$r=new un("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),es=new An("@firebase/auth");function ts(e){if(es.logLevel<=xn.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];es.error("Auth (".concat(Or,"): ").concat(e),...n)}}function ns(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw as(e,...n)}function rs(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return as(e,...n)}function ss(e,t,n){const r=d(d({},Jr()),{},{[t]:n});return new un("auth","Firebase",r).create(t,{appName:e.name})}function is(e){return ss(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function as(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return $r.create(e,...n)}function os(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];throw as(t,...r)}}function ls(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ts(t),new Error(t)}function cs(e,t){e||ls(t)}function us(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function ds(){return"http:"===hs()||"https:"===hs()}function hs(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function fs(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(ds()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class ps{constructor(e,t){this.shortDelay=e,this.longDelay=t,cs(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(sn())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return fs()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function gs(e,t){cs(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class ms{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void ls("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void ls("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void ls("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const vs={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ys=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],bs=new ps(3e4,6e4);function Es(e,t){return e.tenantId&&!t.tenantId?d(d({},t),{},{tenantId:e.tenantId}):t}async function ws(e,t,n,r){return Ss(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let s={},i={};r&&("GET"===t?i=r:s={body:JSON.stringify(r)});const a=pn(d({key:e.config.apiKey},i)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=d({method:t,headers:o},s);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&Jt(e.emulatorConfig.host)&&(l.credentials="include"),ms.fetch()(await ks(e,e.config.apiHost,n,a),l)})}async function Ss(e,t,n){e._canInitEmulator=!1;const r=d(d({},vs),t);try{const t=new Is(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw Ls(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ls(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw Ls(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw Ls(e,"user-disabled",i);const o=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw ss(e,o,a);ns(e,o)}}catch(_w){if(_w instanceof cn)throw _w;ns(e,"network-request-failed",{message:String(_w)})}}async function Ts(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const i=await ws(e,t,n,r,s);return"mfaPendingCredential"in i&&ns(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function ks(e,t,n,r){const s="".concat(t).concat(n,"?").concat(r),i=e,a=i.config.emulator?gs(e.config,s):"".concat(e.config.apiScheme,"://").concat(s);if(ys.includes(n)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())){return i._getPersistence()._getFinalTarget(a).toString()}return a}function xs(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Is{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(rs(this.auth,"network-request-failed")),bs.get())})}}function Ls(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=rs(e,t,r);return s.customData._tokenResponse=n,s}function Cs(e){return void 0!==e&&void 0!==e.enterprise}class _s{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return xs(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function As(e,t){return ws(e,"GET","/v2/recaptchaConfig",Es(e,t))}async function Rs(e,t){return ws(e,"POST","/v1/accounts:lookup",t)}function Ps(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(_w){}}function Ds(e){return 1e3*Number(e)}function Os(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return ts("JWT malformed, contained fewer than 3 sections"),null;try{const e=Ht(n);return e?JSON.parse(e):(ts("Failed to decode base64 JWT payload"),null)}catch(_w){return ts("Caught error parsing JWT payload as JSON",null===_w||void 0===_w?void 0:_w.toString()),null}}function Ns(e){const t=Os(e);return os(t,"internal-error"),os("undefined"!==typeof t.exp,"internal-error"),os("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Ms(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(_w){throw _w instanceof cn&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(_w)&&e.auth.currentUser===e&&await e.auth.signOut(),_w}}class Fs{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{var t;this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(_w){return void((null===_w||void 0===_w?void 0:_w.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class Us{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ps(this.lastLoginAt),this.creationTime=Ps(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function js(e){var t;const n=e.auth,r=await e.getIdToken(),s=await Ms(e,Rs(n,{idToken:r}));os(null===s||void 0===s?void 0:s.users.length,n,"internal-error");const i=s.users[0];e._notifyReloadListener(i);const a=null!==(t=i.providerUserInfo)&&void 0!==t&&t.length?Bs(i.providerUserInfo):[],o=function(e,t){const n=e.filter(e=>!t.some(t=>t.providerId===e.providerId));return[...n,...t]}(e.providerData,a),l=e.isAnonymous,c=!(e.email&&i.passwordHash)&&!(null!==o&&void 0!==o&&o.length),u=!!l&&c,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Us(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(e,d)}function Bs(e){return e.map(e=>{let{providerId:t}=e,n=a(e,Yr);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class Vs{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){os(e.idToken,"internal-error"),os("undefined"!==typeof e.idToken,"internal-error"),os("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):Ns(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){os(0!==e.length,"internal-error");const t=Ns(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(os(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await Ss(e,{},async()=>{const n=pn({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,i=await ks(e,r,"/v1/token","key=".concat(s)),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const o={method:"POST",headers:a,body:n};return e.emulatorConfig&&Jt(e.emulatorConfig.host)&&(o.credentials="include"),ms.fetch()(i,o)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,i=new Vs;return n&&(os("string"===typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(os("string"===typeof r,"internal-error",{appName:e}),i.accessToken=r),s&&(os("number"===typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Vs,this.toJSON())}_performRefresh(){return ls("not implemented")}}function zs(e,t){os("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Gs{constructor(e){let{uid:t,auth:n,stsTokenManager:r}=e,s=a(e,Qr);this.providerId="firebase",this.proactiveRefresh=new Fs(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Us(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ms(this,this.stsTokenManager.getToken(this.auth,e));return os(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=bn(e),r=await n.getIdToken(t),s=Os(r);os(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i="object"===typeof s.firebase?s.firebase:void 0,a=null===i||void 0===i?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ps(Ds(s.auth_time)),issuedAtTime:Ps(Ds(s.iat)),expirationTime:Ps(Ds(s.exp)),signInProvider:a||null,signInSecondFactor:(null===i||void 0===i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=bn(e);await js(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(os(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>d({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Gs(d(d({},this),{},{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){os(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await js(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Rr(this.auth.app))return Promise.reject(is(this.auth));const e=await this.getIdToken();return await Ms(this,async function(e,t){return ws(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return d(d({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>d({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{},{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,s,i,a,o,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,f=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,p=null!==(i=t.photoURL)&&void 0!==i?i:void 0,g=null!==(a=t.tenantId)&&void 0!==a?a:void 0,m=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,v=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:b,emailVerified:E,isAnonymous:w,providerData:S,stsTokenManager:T}=t;os(b&&T,e,"internal-error");const k=Vs.fromJSON(this.name,T);os("string"===typeof b,e,"internal-error"),zs(u,e.name),zs(h,e.name),os("boolean"===typeof E,e,"internal-error"),os("boolean"===typeof w,e,"internal-error"),zs(f,e.name),zs(p,e.name),zs(g,e.name),zs(m,e.name),zs(v,e.name),zs(y,e.name);const x=new Gs({uid:b,auth:e,email:h,emailVerified:E,displayName:u,isAnonymous:w,photoURL:p,phoneNumber:f,tenantId:g,stsTokenManager:k,createdAt:v,lastLoginAt:y});return S&&Array.isArray(S)&&(x.providerData=S.map(e=>d({},e))),m&&(x._redirectEventId=m),x}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new Vs;r.updateFromServerResponse(t);const s=new Gs({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await js(s),s}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];os(void 0!==r.localId,"internal-error");const s=void 0!==r.providerUserInfo?Bs(r.providerUserInfo):[],i=!(r.email&&r.passwordHash)&&!(null!==s&&void 0!==s&&s.length),a=new Vs;a.updateFromIdToken(n);const o=new Gs({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:i}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Us(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null!==s&&void 0!==s&&s.length)};return Object.assign(o,l),o}}const Hs=new Map;function Ks(e){cs(e instanceof Function,"Expected a class definition");let t=Hs.get(e);return t?(cs(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Hs.set(e,t),t)}class Ws{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ws.type="NONE";const qs=Ws;function Ys(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class Qs{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=Ys(this.userKey,r.apiKey,s),this.fullPersistenceKey=Ys("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await Rs(this.auth,{idToken:e}).catch(()=>{});return t?Gs._fromGetAccountInfoResponse(this.auth,t,e):null}return Gs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new Qs(Ks(qs),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=r[0]||Ks(qs);const i=Ys(n,e.config.apiKey,e.name);let a=null;for(const c of t)try{const t=await c._get(i);if(t){let n;if("string"===typeof t){const r=await Rs(e,{idToken:t}).catch(()=>{});if(!r)break;n=await Gs._fromGetAccountInfoResponse(e,r,t)}else n=Gs._fromJSON(e,t);c!==s&&(a=n),s=c;break}}catch(l){}const o=r.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&o.length?(s=o[0],a&&await s._set(i,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(i)}catch(t){}})),new Qs(s,e,n)):new Qs(s,e,n)}}function Xs(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ei(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Zs(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ni(t))return"Blackberry";if(ri(t))return"Webos";if(Js(t))return"Safari";if((t.includes("chrome/")||$s(t))&&!t.includes("edge/"))return"Chrome";if(ti(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function Zs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn();return/firefox\//i.test(e)}function Js(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function $s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn();return/crios\//i.test(e)}function ei(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn();return/iemobile/i.test(e)}function ti(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn();return/android/i.test(e)}function ni(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn();return/blackberry/i.test(e)}function ri(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn();return/webos/i.test(e)}function si(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ii(){return function(){const e=sn();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function ai(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn();return si(e)||ti(e)||ri(e)||ni(e)||/windows phone/i.test(e)||ei(e)}function oi(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=Xs(sn());break;case"Worker":t="".concat(Xs(sn()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(Or,"/").concat(r)}class li{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(_w){r(_w)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(_w){t.reverse();for(const n of t)try{n()}catch(HE){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===_w||void 0===_w?void 0:_w.message})}}}class ci{constructor(e){var t,n,r,s;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,s,i,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsLowercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(s=o.containsUppercaseLetter)||void 0===s||s),o.isValid&&(o.isValid=null===(i=o.containsNumericCharacter)||void 0===i||i),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class ui{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hi(this),this.idTokenSubscription=new hi(this),this.beforeStateQueue=new li(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=$r,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ks(t)),this._initializationPromise=this.queue(async()=>{var n,r,s;if(!this._deleted&&(this.persistenceManager=await Qs.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null!==(r=this._popupRedirectResolver)&&void 0!==r&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(_w){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(s=this.currentUser)||void 0===s?void 0:s.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Rs(this,{idToken:e}),n=await Gs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Rr(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){var s,i;await this.getOrInitRedirectPersistenceManager();const t=null===(s=this.redirectUser)||void 0===s?void 0:s._redirectEventId,a=null===(i=n)||void 0===i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);t&&t!==a||null===o||void 0===o||!o.user||(n=o.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(_w){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(_w))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return os(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(_w){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await js(e)}catch(_w){if((null===_w||void 0===_w?void 0:_w.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Rr(this.app))return Promise.reject(is(this));const t=e?bn(e):null;return t&&os(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&os(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Rr(this.app)?Promise.reject(is(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Rr(this.app)?Promise.reject(is(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ks(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return ws(e,"GET","/v2/passwordPolicy",Es(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new ci(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new un("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return ws(e,"POST","/v2/accounts:revokeToken",Es(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ks(e)||this._popupRedirectResolver;os(t,this,"argument-error"),this.redirectPersistenceManager=await Qs.create(this,[Ks(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s="function"===typeof t?t:t.next.bind(t);let i=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(os(a,this,"internal-error"),a.then(()=>{i||s(this.currentUser)}),"function"===typeof t){const s=e.addObserver(t,n,r);return()=>{i=!0,s()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return os(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=oi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if(Rr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return null!==t&&void 0!==t&&t.error&&function(e){if(es.logLevel<=xn.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];es.warn("Auth (".concat(Or,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function di(e){return bn(e)}class hi{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new vn(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return os(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let fi={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function pi(e){return fi.loadJS(e)}function gi(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class mi{constructor(){this.enterprise=new vi}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class vi{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const yi="NO_RECAPTCHA";class bi{constructor(e){this.type="recaptcha-enterprise",this.auth=di(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const s=window.grecaptcha;Cs(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(yi)})}):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new mi).execute("siteKey",{action:"verify"})}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{As(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new _s(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(s=>{if(!t&&Cs(window.grecaptcha))n(s,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=fi.recaptchaEnterpriseScript;0!==t.length&&(t+=s),pi(t).then(()=>{n(s,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function Ei(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i=new bi(e);let a;if(s)a=yi;else try{a=await i.verify(n)}catch(l){a=await i.verify(n,!0)}const o=d({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in o){const e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function wi(e,t,n,r,s){if("EMAIL_PASSWORD_PROVIDER"===s){var i;if(null!==(i=e._getRecaptchaConfig())&&void 0!==i&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Ei(e,t,n,"getOobCode"===n);return r(e,s)}return r(e,t).catch(async s=>{if(s.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const s=await Ei(e,t,n,"getOobCode"===n);return r(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){var a;if(null!==(a=e._getRecaptchaConfig())&&void 0!==a&&a.isProviderEnabled("PHONE_PROVIDER")){const s=await Ei(e,t,n);return r(e,s).catch(async s=>{var i;if("AUDIT"===(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.getProviderEnforcementState("PHONE_PROVIDER"))&&(s.code==="auth/".concat("missing-recaptcha-token")||s.code==="auth/".concat("invalid-app-credential"))){console.log("Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ".concat(n," flow."));const s=await Ei(e,t,n,!1,!0);return r(e,s)}return Promise.reject(s)})}{const s=await Ei(e,t,n,!1,!0);return r(e,s)}}return Promise.reject(s+" provider is not supported.")}async function Si(e){const t=di(e),n=await As(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new _s(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new bi(t).verify()}}function Ti(e,t,n){const r=di(e);os(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const s=!(null===n||void 0===n||!n.disableWarnings),i=ki(t),{host:a,port:o}=function(e){const t=ki(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const e=s[1];return{host:e,port:xi(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:xi(t)}}}(t),l=null===o?"":":".concat(o),c={url:"".concat(i,"//").concat(a).concat(l,"/")},u=Object.freeze({host:a,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator)return os(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void os(hn(c,r.config.emulator)&&hn(u,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=c,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,Jt(a)?($t("".concat(i,"//").concat(a).concat(l)),rn("Auth",!0)):s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function ki(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function xi(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ii{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ls("not implemented")}_getIdTokenResponse(e){return ls("not implemented")}_linkToIdToken(e,t){return ls("not implemented")}_getReauthenticationResolver(e){return ls("not implemented")}}async function Li(e,t){return ws(e,"POST","/v1/accounts:resetPassword",Es(e,t))}async function Ci(e,t){return ws(e,"POST","/v1/accounts:signUp",t)}async function _i(e,t){return Ts(e,"POST","/v1/accounts:signInWithPassword",Es(e,t))}async function Ai(e,t){return ws(e,"POST","/v1/accounts:sendOobCode",Es(e,t))}async function Ri(e,t){return Ai(e,t)}class Pi extends Ii{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Pi(e,t,"password")}static _fromEmailAndCode(e,t){return new Pi(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if(null!==t&&void 0!==t&&t.email&&null!==t&&void 0!==t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return wi(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",_i,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Ts(e,"POST","/v1/accounts:signInWithEmailLink",Es(e,t))}(e,{email:this._email,oobCode:this._password});default:ns(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return wi(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ci,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Ts(e,"POST","/v1/accounts:signInWithEmailLink",Es(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:ns(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Di(e,t){return Ts(e,"POST","/v1/accounts:signInWithIdp",Es(e,t))}class Oi extends Ii{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Oi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ns("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,s=a(t,Xr);if(!n||!r)return null;const i=new Oi(n,r);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(e){return Di(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Di(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Di(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=pn(t)}return e}}async function Ni(e,t){return ws(e,"POST","/v1/accounts:sendVerificationCode",Es(e,t))}const Mi={USER_NOT_FOUND:"user-not-found"};class Fi extends Ii{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Fi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Fi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Ts(e,"POST","/v1/accounts:signInWithPhoneNumber",Es(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Ts(e,"POST","/v1/accounts:signInWithPhoneNumber",Es(e,t));if(n.temporaryProof)throw Ls(e,"account-exists-with-different-credential",n);return n}(e,d({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Ts(e,"POST","/v1/accounts:signInWithPhoneNumber",Es(e,d(d({},t),{},{operation:"REAUTH"})),Mi)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}=e;return n||t||r||s?new Fi({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}):null}}class Ui{constructor(e){var t,n,r,s,i,a;const o=gn(mn(e)),l=null!==(t=o.apiKey)&&void 0!==t?t:null,c=null!==(n=o.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=o.mode)&&void 0!==r?r:null);os(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(s=o.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(i=o.lang)&&void 0!==i?i:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=gn(mn(e)).link,n=t?gn(mn(t)).deep_link_id:null,r=gn(mn(e)).deep_link_id;return(r?gn(mn(r)).link:null)||r||n||t||e}(e);try{return new Ui(t)}catch(n){return null}}}class ji{constructor(){this.providerId=ji.PROVIDER_ID}static credential(e,t){return Pi._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ui.parseLink(t);return os(n,"argument-error"),Pi._fromEmailAndCode(e,n.code,n.tenantId)}}ji.PROVIDER_ID="password",ji.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ji.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Bi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Vi extends Bi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class zi extends Vi{constructor(){super("facebook.com")}static credential(e){return Oi._fromParams({providerId:zi.PROVIDER_ID,signInMethod:zi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zi.credentialFromTaggedObject(e)}static credentialFromError(e){return zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return zi.credential(t.oauthAccessToken)}catch(n){return null}}}zi.FACEBOOK_SIGN_IN_METHOD="facebook.com",zi.PROVIDER_ID="facebook.com";class Gi extends Vi{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Oi._fromParams({providerId:Gi.PROVIDER_ID,signInMethod:Gi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Gi.credentialFromTaggedObject(e)}static credentialFromError(e){return Gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return Gi.credential(n,r)}catch(s){return null}}}Gi.GOOGLE_SIGN_IN_METHOD="google.com",Gi.PROVIDER_ID="google.com";class Hi extends Vi{constructor(){super("github.com")}static credential(e){return Oi._fromParams({providerId:Hi.PROVIDER_ID,signInMethod:Hi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Hi.credentialFromTaggedObject(e)}static credentialFromError(e){return Hi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Hi.credential(t.oauthAccessToken)}catch(n){return null}}}Hi.GITHUB_SIGN_IN_METHOD="github.com",Hi.PROVIDER_ID="github.com";class Ki extends Vi{constructor(){super("twitter.com")}static credential(e,t){return Oi._fromParams({providerId:Ki.PROVIDER_ID,signInMethod:Ki.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ki.credentialFromTaggedObject(e)}static credentialFromError(e){return Ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return Ki.credential(n,r)}catch(s){return null}}}Ki.TWITTER_SIGN_IN_METHOD="twitter.com",Ki.PROVIDER_ID="twitter.com";class Wi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=await Gs._fromIdTokenResponse(e,n,r),i=qi(n);return new Wi({user:s,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=qi(n);return new Wi({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function qi(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Yi extends cn{constructor(e,t,n,r){var s;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Yi.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Yi(e,t,n,r)}}function Qi(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw Yi._fromErrorAndOperation(e,n,t,r);throw n})}async function Xi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await Ms(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Wi._forOperation(e,"link",r)}async function Zi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(Rr(r.app))return Promise.reject(is(r));const s="reauthenticate";try{const i=await Ms(e,Qi(r,s,t,e),n);os(i.idToken,r,"internal-error");const a=Os(i.idToken);os(a,r,"internal-error");const{sub:o}=a;return os(e.uid===o,r,"user-mismatch"),Wi._forOperation(e,s,i)}catch(_w){throw(null===_w||void 0===_w?void 0:_w.code)==="auth/".concat("user-not-found")&&ns(r,"user-mismatch"),_w}}async function Ji(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Rr(e.app))return Promise.reject(is(e));const r="signIn",s=await Qi(e,r,t),i=await Wi._fromIdTokenResponse(e,r,s);return n||await e._updateCurrentUser(i.user),i}async function $i(e,t){return Ji(di(e),t)}class ea{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?ta._fromServerResponse(e,t):"totpInfo"in t?na._fromServerResponse(e,t):ns(e,"internal-error")}}class ta extends ea{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new ta(t)}}class na extends ea{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new na(t)}}function ra(e,t,n){var r;os((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),os("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),os("undefined"===typeof n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(os(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(os(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function sa(e){const t=di(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function ia(e,t){const{data:n}=await async function(e,t){const n=bn(e),r=await Li(n,{oobCode:t}),s=r.requestType;switch(os(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":os(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":os(r.mfaInfo,n,"internal-error");default:os(r.email,n,"internal-error")}let i=null;return r.mfaInfo&&(i=ea._fromServerResponse(di(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}(bn(e),t);return n.email}function aa(e,t){return ws(e,"POST","/v2/accounts/mfaEnrollment:start",Es(e,t))}new WeakMap;const oa="__sak";class la{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(oa,"1"),this.storage.removeItem(oa),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ca extends la{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ai(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);ii()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ca.type="LOCAL";const ua=ca;function da(e){var t,n;const r=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),s=RegExp("".concat(r,"=([^;]+)"));return null!==(t=null===(n=document.cookie.match(s))||void 0===n?void 0:n[1])&&void 0!==t?t:null}function ha(e){const t="http:"===window.location.protocol;return"".concat(t?"__dev_":"__HOST-","FIREBASE_").concat(e.split(":")[3])}class fa{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL("".concat(window.location.origin,"/__cookies__"));return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(null===(e=navigator.cookieEnabled)||void 0===e||e))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=ha(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return null===e||void 0===e?void 0:e.value}return da(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=ha(e);document.cookie="".concat(t,"=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High"),await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const n=ha(e);if(window.cookieStore){const e=e=>{const r=e.changed.find(e=>e.name===n);r&&t(r.value);e.deleted.find(e=>e.name===n)&&t(null)},r=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,r),window.cookieStore.addEventListener("change",e)}let r=da(n);const s=setInterval(()=>{const e=da(n);e!==r&&(t(e),r=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(s))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}fa.type="COOKIE";class pa extends la{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}pa.type="SESSION";const ga=pa;class ma{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new ma(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,i=this.handlersMap[r];if(null===i||void 0===i||!i.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const a=Array.from(i).map(async e=>e(t.origin,s)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function va(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}ma.receivers=[];class ya{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,i;return new Promise((a,o)=>{const l=va("",20);r.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},n);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(c),clearTimeout(s),o(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function ba(){return window}function Ea(){return"undefined"!==typeof ba().WorkerGlobalScope&&"function"===typeof ba().importScripts}const wa="firebaseLocalStorageDb",Sa="firebaseLocalStorage",Ta="fbase_key";class ka{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function xa(e,t){return e.transaction([Sa],t?"readwrite":"readonly").objectStore(Sa)}function Ia(){const e=indexedDB.open(wa,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Sa,{keyPath:Ta})}catch(_w){n(_w)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(Sa)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(wa);return new ka(e).toPromise()}(),t(await Ia()))})})}async function La(e,t,n){const r=xa(e,!0).put({[Ta]:t,value:n});return new ka(r).toPromise()}function Ca(e,t){const n=xa(e,!0).delete(t);return new ka(n).toPromise()}class _a{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Ia()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(_w){if(t++>3)throw _w;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ea()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ma._getInstance(Ea()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){var e;if(null===(e=navigator)||void 0===e||!e.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new ya(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=navigator)||void 0===e||null===(e=e.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ia();return await La(e,oa,"1"),await Ca(e,oa),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>La(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=xa(e,!1).get(t),r=await new ka(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Ca(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=xa(e,!1).getAll();return new ka(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}_a.type="LOCAL";const Aa=_a;function Ra(e,t){return ws(e,"POST","/v2/accounts/mfaSignIn:start",Es(e,t))}gi("rcb"),new ps(3e4,6e4);const Pa="recaptcha";async function Da(e,t,n){if(!e._getRecaptchaConfig())try{await Si(e)}catch(s){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(s="string"===typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){os("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},i=wi(e,r,"mfaSmsEnrollment",async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===yi){os((null===n||void 0===n?void 0:n.type)===Pa,e,"argument-error");return aa(e,await Oa(e,t,n))}return aa(e,t)},"PHONE_PROVIDER");return(await i.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{var r;os("signin"===t.type,e,"internal-error");const i=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;os(i,e,"missing-multi-factor-info");const a={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=wi(e,a,"mfaSmsSignIn",async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===yi){os((null===n||void 0===n?void 0:n.type)===Pa,e,"argument-error");return Ra(e,await Oa(e,t,n))}return Ra(e,t)},"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=wi(e,t,"sendVerificationCode",async(e,t)=>{if(t.captchaResponse===yi){os((null===n||void 0===n?void 0:n.type)===Pa,e,"argument-error");return Ni(e,await Oa(e,t,n))}return Ni(e,t)},"PHONE_PROVIDER");return(await r.catch(e=>Promise.reject(e))).sessionInfo}}finally{null===n||void 0===n||n._reset()}}async function Oa(e,t,n){os(n.type===Pa,e,"argument-error");const r=await n.verify();os("string"===typeof r,e,"argument-error");const s=d({},t);if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:i}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:r}),s}class Na{constructor(e){this.providerId=Na.PROVIDER_ID,this.auth=di(e)}verifyPhoneNumber(e,t){return Da(this.auth,e,bn(t))}static credential(e,t){return Fi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Na.credentialFromTaggedObject(t)}static credentialFromError(e){return Na.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?Fi._fromTokenResponse(n,r):null}}function Ma(e,t){return t?Ks(t):(os(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Na.PROVIDER_ID="phone",Na.PHONE_SIGN_IN_METHOD="phone";class Fa extends Ii{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Di(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Di(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Di(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ua(e){return Ji(e.auth,new Fa(e),e.bypassAuthState)}function ja(e){const{auth:t,user:n}=e;return os(n,t,"internal-error"),Zi(n,new Fa(e),e.bypassAuthState)}async function Ba(e){const{auth:t,user:n}=e;return os(n,t,"internal-error"),Xi(n,new Fa(e),e.bypassAuthState)}class Va{constructor(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(_w){this.reject(_w)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:i,type:a}=e;if(i)return void this.reject(i);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(_w){this.reject(_w)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ua;case"linkViaPopup":case"linkViaRedirect":return Ba;case"reauthViaPopup":case"reauthViaRedirect":return ja;default:ns(this.auth,"internal-error")}}resolve(e){cs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){cs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const za=new ps(2e3,1e4);class Ga extends Va{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,Ga.currentPopupAction&&Ga.currentPopupAction.cancel(),Ga.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return os(e,this.auth,"internal-error"),e}async onExecution(){cs(1===this.filter.length,"Popup operations only handle one event");const e=va();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(rs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(rs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ga.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t;null!==(t=this.authWindow)&&void 0!==t&&null!==(t=t.window)&&void 0!==t&&t.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(rs(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,za.get())};e()}}Ga.currentPopupAction=null;const Ha=new Map;class Ka extends Va{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Ha.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Ya(t),r=qa(e);if(!await r._isAvailable())return!1;const s="true"===await r._get(n);return await r._remove(n),s}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(_w){e=()=>Promise.reject(_w)}Ha.set(this.auth._key(),e)}return this.bypassAuthState||Ha.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Wa(e,t){Ha.set(e._key(),t)}function qa(e){return Ks(e._redirectPersistence)}function Ya(e){return Ys("pendingRedirect",e.config.apiKey,e.name)}async function Qa(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Rr(e.app))return Promise.reject(is(e));const r=di(e),s=Ma(r,t),i=new Ka(r,s,n),a=await i.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}class Xa{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ja(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Ja(e)){var n;const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(rs(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Za(e))}saveEventToCache(e){this.cachedEventUids.add(Za(e)),this.lastProcessedEventTime=Date.now()}}function Za(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Ja(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const $a=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,eo=/^https?/;async function to(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return ws(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(no(r))return}catch(n){}ns(e,"unauthorized-domain")}function no(e){const t=us(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===r}if(!eo.test(n))return!1;if($a.test(e))return r===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const ro=new ps(3e4,6e4);function so(){const e=ba().___jsl;if(null!==e&&void 0!==e&&e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function io(e){return new Promise((t,n)=>{var r,s;function i(){so(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{so(),n(rs(e,"network-request-failed"))},timeout:ro.get()})}if(null!==(r=ba().gapi)&&void 0!==r&&null!==(r=r.iframes)&&void 0!==r&&r.Iframe)t(gapi.iframes.getContext());else{if(null===(s=ba().gapi)||void 0===s||!s.load){const t=gi("iframefcb");return ba()[t]=()=>{gapi.load?i():n(rs(e,"network-request-failed"))},pi("".concat(fi.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}i()}}).catch(e=>{throw ao=null,e})}let ao=null;const oo=new ps(5e3,15e3),lo={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},co=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function uo(e){const t=e.config;os(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?gs(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:Or},s=co.get(e.config.apiHost);s&&(r.eid=s);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),"".concat(n,"?").concat(pn(r).slice(1))}async function ho(e){const t=await function(e){return ao=ao||io(e),ao}(e),n=ba().gapi;return os(n,e,"internal-error"),t.open({where:document.body,url:uo(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:lo,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const s=rs(e,"network-request-failed"),i=ba().setTimeout(()=>{r(s)},oo.get());function a(){ba().clearTimeout(i),n(t)}t.ping(a).then(a,()=>{r(s)})}))}const fo={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class po{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(_w){}}}function go(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=d(d({},fo),{},{width:r.toString(),height:s.toString(),top:i,left:a}),c=sn().toLowerCase();n&&(o=$s(c)?"_blank":n),Zs(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return si(arguments.length>0&&void 0!==arguments[0]?arguments[0]:sn())&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(c)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new po(null);const h=window.open(t||"",o,u);os(h,e,"popup-blocked");try{h.focus()}catch(_w){}return new po(h)}const mo="__/auth/handler",vo="emulator/auth/handler",yo=encodeURIComponent("fac");async function bo(e,t,n,r,s,i){os(e.config.authDomain,e,"auth-domain-config-required"),os(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Or,eventId:s};if(t instanceof Bi){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))a[e]=t}if(t instanceof Vi){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const u of Object.keys(o))void 0===o[u]&&delete o[u];const l=await e._getAppCheckToken(),c=l?"#".concat(yo,"=").concat(encodeURIComponent(l)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(mo);return gs(t,vo)}(e),"?").concat(pn(o).slice(1)).concat(c)}const Eo="webStorageSupport";const wo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ga,this._completeRedirectFn=Qa,this._overrideRedirectResult=Wa}async _openPopup(e,t,n,r){var s;cs(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");return go(e,await bo(e,t,n,us(),r),va())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){ba().location.href=e}(await bo(e,t,n,us(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(cs(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await ho(e),n=new Xa(e);return t.register("authEvent",t=>{os(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Eo,{type:Eo},n=>{var r;const s=null===n||void 0===n||null===(r=n[0])||void 0===r?void 0:r[Eo];void 0!==s&&t(!!s),ns(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=to(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ai()||Js()||si()}};var So="@firebase/auth",To="1.12.0";class ko{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){os(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const xo=Xt("authIdTokenMaxAge")||300;let Io=null;var Lo;!function(e){fi=e}({loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=rs("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),Lo="Browser",_r(new En("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;os(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:o,clientPlatform:Lo,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:oi(Lo)},c=new ui(r,s,i,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Ks);null!==t&&void 0!==t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),_r(new En("auth-internal",e=>(e=>new ko(e))(di(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),Fr(So,To,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Lo)),Fr(So,To,"esm2020");var Co,_o,Ao="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},Ro={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const r=Array(16);if("string"===typeof t)for(var s=0;s<16;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;s<16;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];let i,a=e.g[3];i=t+(a^n&(s^a))+r[0]+3614090360&4294967295,i=a+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[1]+3905402710&4294967295,a=t+(i<<12&4294967295|i>>>20),i=s+(n^a&(t^n))+r[2]+606105819&4294967295,i=n+(t^(s=a+(i<<17&4294967295|i>>>15))&(a^t))+r[3]+3250441966&4294967295,i=t+(a^(n=s+(i<<22&4294967295|i>>>10))&(s^a))+r[4]+4118548399&4294967295,i=a+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[5]+1200080426&4294967295,a=t+(i<<12&4294967295|i>>>20),i=s+(n^a&(t^n))+r[6]+2821735955&4294967295,i=n+(t^(s=a+(i<<17&4294967295|i>>>15))&(a^t))+r[7]+4249261313&4294967295,i=t+(a^(n=s+(i<<22&4294967295|i>>>10))&(s^a))+r[8]+1770035416&4294967295,i=a+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[9]+2336552879&4294967295,a=t+(i<<12&4294967295|i>>>20),i=s+(n^a&(t^n))+r[10]+4294925233&4294967295,i=n+(t^(s=a+(i<<17&4294967295|i>>>15))&(a^t))+r[11]+2304563134&4294967295,i=t+(a^(n=s+(i<<22&4294967295|i>>>10))&(s^a))+r[12]+1804603682&4294967295,i=a+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[13]+4254626195&4294967295,a=t+(i<<12&4294967295|i>>>20),i=s+(n^a&(t^n))+r[14]+2792965006&4294967295,i=n+(t^(s=a+(i<<17&4294967295|i>>>15))&(a^t))+r[15]+1236535329&4294967295,i=t+(s^a&((n=s+(i<<22&4294967295|i>>>10))^s))+r[1]+4129170786&4294967295,i=a+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[6]+3225465664&4294967295,a=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(a^t))+r[11]+643717713&4294967295,i=n+(a^t&((s=a+(i<<14&4294967295|i>>>18))^a))+r[0]+3921069994&4294967295,i=t+(s^a&((n=s+(i<<20&4294967295|i>>>12))^s))+r[5]+3593408605&4294967295,i=a+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[10]+38016083&4294967295,a=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(a^t))+r[15]+3634488961&4294967295,i=n+(a^t&((s=a+(i<<14&4294967295|i>>>18))^a))+r[4]+3889429448&4294967295,i=t+(s^a&((n=s+(i<<20&4294967295|i>>>12))^s))+r[9]+568446438&4294967295,i=a+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[14]+3275163606&4294967295,a=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(a^t))+r[3]+4107603335&4294967295,i=n+(a^t&((s=a+(i<<14&4294967295|i>>>18))^a))+r[8]+1163531501&4294967295,i=t+(s^a&((n=s+(i<<20&4294967295|i>>>12))^s))+r[13]+2850285829&4294967295,i=a+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[2]+4243563512&4294967295,a=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(a^t))+r[7]+1735328473&4294967295,i=n+(a^t&((s=a+(i<<14&4294967295|i>>>18))^a))+r[12]+2368359562&4294967295,i=t+((n=s+(i<<20&4294967295|i>>>12))^s^a)+r[5]+4294588738&4294967295,i=a+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[8]+2272392833&4294967295,a=t+(i<<11&4294967295|i>>>21),i=s+(a^t^n)+r[11]+1839030562&4294967295,i=n+((s=a+(i<<16&4294967295|i>>>16))^a^t)+r[14]+4259657740&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^a)+r[1]+2763975236&4294967295,i=a+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[4]+1272893353&4294967295,a=t+(i<<11&4294967295|i>>>21),i=s+(a^t^n)+r[7]+4139469664&4294967295,i=n+((s=a+(i<<16&4294967295|i>>>16))^a^t)+r[10]+3200236656&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^a)+r[13]+681279174&4294967295,i=a+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[0]+3936430074&4294967295,a=t+(i<<11&4294967295|i>>>21),i=s+(a^t^n)+r[3]+3572445317&4294967295,i=n+((s=a+(i<<16&4294967295|i>>>16))^a^t)+r[6]+76029189&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^a)+r[9]+3654602809&4294967295,i=a+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[12]+3873151461&4294967295,a=t+(i<<11&4294967295|i>>>21),i=s+(a^t^n)+r[15]+530742520&4294967295,i=n+((s=a+(i<<16&4294967295|i>>>16))^a^t)+r[2]+3299628645&4294967295,i=t+(s^((n=s+(i<<23&4294967295|i>>>9))|~a))+r[0]+4096336452&4294967295,i=a+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[7]+1126891415&4294967295,a=t+(i<<10&4294967295|i>>>22),i=s+(t^(a|~n))+r[14]+2878612391&4294967295,i=n+(a^((s=a+(i<<15&4294967295|i>>>17))|~t))+r[5]+4237533241&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~a))+r[12]+1700485571&4294967295,i=a+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[3]+2399980690&4294967295,a=t+(i<<10&4294967295|i>>>22),i=s+(t^(a|~n))+r[10]+4293915773&4294967295,i=n+(a^((s=a+(i<<15&4294967295|i>>>17))|~t))+r[1]+2240044497&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~a))+r[8]+1873313359&4294967295,i=a+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[15]+4264355552&4294967295,a=t+(i<<10&4294967295|i>>>22),i=s+(t^(a|~n))+r[6]+2734768916&4294967295,i=n+(a^((s=a+(i<<15&4294967295|i>>>17))|~t))+r[13]+1309151649&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~a))+r[4]+4149444226&4294967295,i=a+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[11]+3174756917&4294967295,a=t+(i<<10&4294967295|i>>>22),i=s+(t^(a|~n))+r[2]+718787259&4294967295,i=n+(a^((s=a+(i<<15&4294967295|i>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+a&4294967295}function r(e,t){this.h=t;const n=[];let r=!0;for(let s=e.length-1;s>=0;s--){const i=0|e[s];r&&i==t||(n[s]=i,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const r=t-this.blockSize,s=this.C;let i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(s[i++]=e.charCodeAt(a++),i==this.blockSize){n(this,s),i=0;break}}else for(;a<t;)if(s[i++]=e[a++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var s={};function i(e){return-128<=e&&e<128?function(e,t){var n=s;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new r([0|e],e<0?-1:0)}):new r([0|e],e<0?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(e<0)return h(a(-e));const t=[];let n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new r(t,0)}var o=i(0),l=i(1),c=i(16777216);function u(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function h(e){const t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new r(n,~e.h).add(l)}function f(e,t){return e.add(h(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(u(t))throw Error("division by zero");if(u(e))return new g(o,o);if(d(e))return t=m(h(e),t),new g(h(t.g),h(t.h));if(d(t))return t=m(e,h(t)),new g(h(t.g),t.h);if(e.g.length>30){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=t;r.l(e)<=0;)n=v(n),r=v(r);var s=y(n,1),i=y(r,1);for(r=y(r,2),n=y(n,2);!u(r);){var c=i.add(r);c.l(e)<=0&&(s=s.add(n),i=c),r=y(r,1),n=y(n,1)}return t=f(e,s.j(t)),new g(s,t)}for(s=o;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),c=(i=a(n)).j(t);d(c)||c.l(e)>0;)c=(i=a(n-=r)).j(t);u(i)&&(i=l),s=s.add(i),e=f(e,c)}return new g(s,e)}function v(e){const t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new r(n,e.h)}function y(e,t){const n=t>>5;t%=32;const s=e.g.length-n,i=[];for(let r=0;r<s;r++)i[r]=t>0?e.i(r+n)>>>t|e.i(r+n+1)<<32-t:e.i(r+n);return new r(i,e.h)}(e=r.prototype).m=function(){if(d(this))return-h(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(d(this))return"-"+h(this).toString(e);const t=a(Math.pow(e,6));var n=this;let r="";for(;;){const s=m(n,t).g;let i=(((n=f(n,s.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(u(n=s))return i+r;for(;i.length<6;)i="0"+i;r=i+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return d(e=f(this,e))?-1:u(e)?0:1},e.abs=function(){return d(this)?h(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let s=0;for(let r=0;r<=t;r++){let t=s+(65535&this.i(r))+(65535&e.i(r)),i=(t>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);s=i>>>16,t&=65535,i&=65535,n[r]=i<<16|t}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return o;if(d(this))return d(e)?h(this).j(h(e)):h(h(this).j(e));if(d(e))return h(this.j(h(e)));if(this.l(c)<0&&e.l(c)<0)return a(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var s=0;s<2*t;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(let t=0;t<e.g.length;t++){const r=this.i(s)>>>16,i=65535&this.i(s),a=e.i(t)>>>16,o=65535&e.i(t);n[2*s+2*t]+=i*o,p(n,2*s+2*t),n[2*s+2*t+1]+=r*o,p(n,2*s+2*t+1),n[2*s+2*t+1]+=i*a,p(n,2*s+2*t+1),n[2*s+2*t+2]+=r*a,p(n,2*s+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new r(n,0)},e.B=function(e){return m(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new r(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new r(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,_o=Ro.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=a,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=a(Math.pow(n,8));let s=o;for(let o=0;o<t.length;o+=8){var i=Math.min(8,t.length-o);const e=parseInt(t.substring(o,o+i),n);i<8?(i=a(Math.pow(n,i)),s=s.j(i).add(a(e))):(s=s.j(r),s=s.add(a(e)))}return s},Co=Ro.Integer=r}).apply("undefined"!==typeof Ao?Ao:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var Po,Do,Oo,No,Mo,Fo,Uo,jo,Bo="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},Vo={};(function(){var e,t=Object.defineProperty;var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Bo&&Bo];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(e,r){if(r)e:{var s=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in s))break e;s=s[a]}(r=r(i=s[e=e[e.length-1]]))!=i&&null!=r&&t(s,e,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},i=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){return(l=o).apply(null,arguments)}function c(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}var d="undefined"!==typeof AsyncContext&&"function"===typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function h(e){const t=e.length;if(t>0){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let r=1;r<arguments.length;r++){const t=arguments[r];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const r=t.length||0;e.length=n+r;for(let s=0;s<r;s++)e[n+s]=t[s]}else e.push(t)}}function p(e){i.setTimeout(()=>{throw e},0)}function g(){var e=E;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var m=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new v,e=>e.reset());class v{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,b=!1,E=new class{constructor(){this.h=this.g=null}add(e,t){const n=m.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},w=()=>{const e=Promise.resolve(void 0);y=()=>{e.then(S)}};function S(){for(var e;e=g();){try{e.h.call(e.g)}catch(sE){p(sE)}var t=m;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}b=!1}function T(){this.u=this.u,this.C=this.C}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},k.prototype.h=function(){this.defaultPrevented=!0};var x=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(sE){}return e}();function I(e){return/^[\s\xa0]*$/.test(e)}function L(e,t){k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}u(L,k),L.prototype.init=function(e,t){const n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&L.Z.h.call(this)},L.prototype.h=function(){L.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var C="closure_listenable_"+(1e6*Math.random()|0),_=0;function A(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=s,this.key=++_,this.da=this.fa=!1}function R(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function P(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function D(e){const t={};for(const n in e)t[n]=e[n];return t}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(e,t){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s],r)e[n]=r[n];for(let t=0;t<O.length;t++)n=O[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function M(e){this.src=e,this.g={},this.h=0}function F(e,t){const n=t.type;if(n in e.g){var r,s=e.g[n],i=Array.prototype.indexOf.call(s,t,void 0);(r=i>=0)&&Array.prototype.splice.call(s,i,1),r&&(R(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function U(e,t,n,r){for(let s=0;s<e.length;++s){const i=e[s];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==r)return s}return-1}M.prototype.add=function(e,t,n,r,s){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const a=U(e,t,r,s);return a>-1?(t=e[a],n||(t.fa=!1)):((t=new A(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var j="closure_lm_"+(1e6*Math.random()|0),B={};function V(e,t,n,r,s){if(r&&r.once)return G(e,t,n,r,s);if(Array.isArray(t)){for(let i=0;i<t.length;i++)V(e,t[i],n,r,s);return null}return n=X(n),e&&e[C]?e.J(t,n,a(r)?!!r.capture:!!r,s):z(e,t,n,!1,r,s)}function z(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");const o=a(s)?!!s.capture:!!s;let l=Y(e);if(l||(e[j]=l=new M(e)),(n=l.add(t,n,r,o,i)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=q;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)x||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(W(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function G(e,t,n,r,s){if(Array.isArray(t)){for(let i=0;i<t.length;i++)G(e,t[i],n,r,s);return null}return n=X(n),e&&e[C]?e.K(t,n,a(r)?!!r.capture:!!r,s):z(e,t,n,!0,r,s)}function H(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)H(e,t[i],n,r,s);else r=a(r)?!!r.capture:!!r,n=X(n),e&&e[C]?(e=e.i,(i=String(t).toString())in e.g&&((n=U(t=e.g[i],n,r,s))>-1&&(R(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[i],e.h--)))):e&&(e=Y(e))&&(t=e.g[t.toString()],e=-1,t&&(e=U(t,n,r,s)),(n=e>-1?t[e]:null)&&K(n))}function K(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[C])F(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(W(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Y(t))?(F(n,e),0==n.h&&(n.src=null,t[j]=null)):R(e)}}}function W(e){return e in B?B[e]:B[e]="on"+e}function q(e,t){if(e.da)e=!0;else{t=new L(t,this);const n=e.listener,r=e.ha||e.src;e.fa&&K(e),e=n.call(r,t)}return e}function Y(e){return(e=e[j])instanceof M?e:null}var Q="__closure_events_fn_"+(1e9*Math.random()>>>0);function X(e){return"function"===typeof e?e:(e[Q]||(e[Q]=function(t){return e.handleEvent(t)}),e[Q])}function Z(){T.call(this),this.i=new M(this),this.M=this,this.G=null}function J(e,t){var n,r=e.G;if(r)for(n=[];r;r=r.G)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var s=t;N(t=new k(r,e),s)}let i,a;if(s=!0,n)for(a=n.length-1;a>=0;a--)i=t.g=n[a],s=$(i,r,!0,t)&&s;if(i=t.g=e,s=$(i,r,!0,t)&&s,s=$(i,r,!1,t)&&s,n)for(a=0;a<n.length;a++)i=t.g=n[a],s=$(i,r,!1,t)&&s}function $(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let s=!0;for(let i=0;i<t.length;++i){const a=t[i];if(a&&!a.da&&a.capture==n){const t=a.listener,n=a.ha||a.src;a.fa&&F(e.i,a),s=!1!==t.call(n,r)&&s}}return s&&!r.defaultPrevented}function ee(e){e.g=function(e,t){if("function"!==typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return Number(t)>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,ee(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(Z,T),Z.prototype[C]=!0,Z.prototype.removeEventListener=function(e,t,n,r){H(this,e,t,n,r)},Z.prototype.N=function(){if(Z.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)R(n[e]);delete e.g[t],e.h--}}this.G=null},Z.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Z.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class te extends T{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ee(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ne(e){T.call(this),this.h=e,this.g={}}u(ne,T);var re=[];function se(e){P(e.g,function(e,t){this.g.hasOwnProperty(t)&&K(e)},e),e.g={}}ne.prototype.N=function(){ne.Z.N.call(this),se(this)},ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ie=i.JSON.stringify,ae=i.JSON.parse,oe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function le(){}function ce(){}var ue={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function de(){k.call(this,"d")}function he(){k.call(this,"c")}u(de,k),u(he,k);var fe={},pe=null;function ge(){return pe=pe||new Z}function me(e){k.call(this,fe.Ia,e)}function ve(e){const t=ge();J(t,new me(t))}function ye(e,t){k.call(this,fe.STAT_EVENT,e),this.stat=t}function be(e){const t=ge();J(t,new ye(t,e))}function Ee(e,t){k.call(this,fe.Ja,e),this.size=t}function we(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Se(){this.g=!0}function Te(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var n=i[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let e=1;e<r.length;e++)r[e]=""}}}return ie(i)}catch(lE){return t}}(e,n)+(r?" "+r:"")})}fe.Ia="serverreachability",u(me,k),fe.STAT_EVENT="statevent",u(ye,k),fe.Ja="timingevent",u(Ee,k),Se.prototype.ua=function(){this.g=!1},Se.prototype.info=function(){};var ke,xe={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ie={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Le(){}function Ce(e){return encodeURIComponent(String(e))}function _e(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Ae(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new ne(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Re}function Re(){this.i=null,this.g="",this.h=!1}u(Le,le),Le.prototype.g=function(){return new XMLHttpRequest},ke=new Le;var Pe={},De={};function Oe(e,t,n){e.M=1,e.A=it(et(t)),e.u=n,e.R=!0,Ne(e,null)}function Ne(e,t){e.F=Date.now(),Ue(e),e.B=et(e.A);var n=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),bt(n.i,"t",r),e.C=0,n=e.j.L,e.h=new Re,e.g=an(e.j,n?t:null,!e.u),e.P>0&&(e.O=new te(l(e.Y,e,e.g),e.P)),t=e.V,n=e.g,r=e.ba;var s="readystatechange";Array.isArray(s)||(s&&(re[0]=s.toString()),s=re);for(let i=0;i<s.length;i++){const e=V(n,s[i],r||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?D(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ve(),function(e,t,n,r,s,i){e.info(function(){if(e.g)if(i){var a="",o=i.split("&");for(let e=0;e<o.length;e++){var l=o[e].split("=");if(l.length>1){const e=l[0];l=l[1];const t=e.split("_");a=t.length>=2&&"type"==t[1]?a+(e+"=")+l+"&":a+(e+"=redacted&")}}}else a=null;else a=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Me(e){return!!e.g&&("GET"==e.v&&2!=e.M&&e.j.Aa)}function Fe(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?De:(n=Number(t.substring(n,r)),isNaN(n)?Pe:(r+=1)+n>t.length?De:(t=t.slice(r,r+n),e.C=r+n,t))}function Ue(e){e.T=Date.now()+e.H,je(e,e.H)}function je(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=we(l(e.aa,e),t)}function Be(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Ve(e){0==e.j.I||e.K||en(e.j,e)}function ze(e){Be(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,se(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Ge(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||Ye(n.h,e)))if(!e.L&&Ye(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(_E){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;$t(n),Gt(n)}Xt(n),be(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=we(l(n.Va,n),6e3));qe(n.h)<=1&&n.ta&&(n.ta=void 0)}else nn(n,11)}else if((e.L||n.g==e)&&$t(n),!I(t))for(s=n.Ba.g.parse(t),t=0;t<s.length;t++){let l=s[t];const u=l[0];if(!(u<=n.K))if(n.K=u,l=l[1],2==n.I)if("c"==l[0]){n.M=l[1],n.ba=l[2];const t=l[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const s=l[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const u=l[5];null!=u&&"number"===typeof u&&u>0&&(r=1.5*u,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Qe(i,i.h),i.h=null))}if(r.G){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,st(r.J,r.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var a=e;if((r=n).na=sn(r,r.L?r.ba:null,r.W),a.L){Xe(r.h,a);var o=a,c=r.O;c&&(o.H=c),o.D&&(Be(o),Ue(o)),r.g=a}else Qt(r);n.i.length>0&&Kt(n)}else"stop"!=l[0]&&"close"!=l[0]||nn(n,7);else 3==n.I&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?nn(n,7):zt(n):"noop"!=l[0]&&n.l&&n.l.qa(l),n.A=0)}ve()}catch(_E){}}Ae.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Ut(e)?t.j():this.Y(e)},Ae.prototype.Y=function(e){try{if(e==this.g)e:{const l=Ut(this.g),c=this.g.ya();this.g.ca();if(!(l<3)&&(3!=l||this.g&&(this.h.h||this.g.la()||jt(this.g)))){this.K||4!=l||7==c||ve(),Be(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Me(e))return e.g.la();const t=jt(e.g);if(""===t)return"";let n="";const r=t.length,s=4==Ut(e.g);if(!e.h.i){if("undefined"===typeof TextDecoder)return ze(e),Ve(e),"";e.h.i=new i.TextDecoder}for(let i=0;i<r;i++)e.h.h=!0,n+=e.h.i.decode(t[i],{stream:!(s&&i==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,r,s,i,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+i+" "+a})}(this.i,this.v,this.B,this.l,this.S,l,t),this.o){if(this.U&&!this.L){t:{if(this.g){var r,s=this.g;if((r=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(r)){var a=r;break t}}a=null}if(!(e=a)){this.o=!1,this.m=3,be(12),ze(this),Ve(this);break e}Te(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ge(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Fe(this,n),t==De){4==l&&(this.m=4,be(14),e=!1),Te(this.i,this.l,null,"[Incomplete Response]");break}if(t==Pe){this.m=4,be(15),Te(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}Te(this.i,this.l,t,null),Ge(this,t)}if(Me(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=l||0!=n.length||this.h.h||(this.m=1,be(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var o=this.j;o.g==this&&o.aa&&!o.P&&(o.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Zt(o),o.P=!0,be(11))}}else Te(this.i,this.l,n,"[Invalid Chunked Response]"),ze(this),Ve(this)}else Te(this.i,this.l,n,null),Ge(this,n);4==l&&ze(this),this.o&&!this.K&&(4==l?en(this.j,this):(this.o=!1,Ue(this)))}else(function(e){const t={};e=(e.g&&Ut(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(I(e[r]))continue;var n=_e(e[r]);const s=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const i=t[s]||[];t[s]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,be(12)):(this.m=0,be(13)),ze(this),Ve(this)}}}catch(l){}},Ae.prototype.cancel=function(){this.K=!0,ze(this)},Ae.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ve(),be(17)),ze(this),this.m=2,Ve(this)):je(this,this.T-e)};var He=class{constructor(e,t){this.g=e,this.map=t}};function Ke(e){this.l=e||10,i.PerformanceNavigationTiming?e=(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function We(e){return!!e.h||!!e.g&&e.g.size>=e.j}function qe(e){return e.h?1:e.g?e.g.size:0}function Ye(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Qe(e,t){e.g?e.g.add(t):e.h=t}function Xe(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Ze(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return h(e.i)}Ke.prototype.cancel=function(){if(this.i=Ze(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Je=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $e(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof $e?(this.l=e.l,tt(this,e.j),this.o=e.o,this.g=e.g,nt(this,e.u),this.h=e.h,rt(this,Et(e.i)),this.m=e.m):e&&(t=String(e).match(Je))?(this.l=!1,tt(this,t[1]||"",!0),this.o=at(t[2]||""),this.g=at(t[3]||"",!0),nt(this,t[4]),this.h=at(t[5]||"",!0),rt(this,t[6]||"",!0),this.m=at(t[7]||"")):(this.l=!1,this.i=new pt(null,this.l))}function et(e){return new $e(e)}function tt(e,t,n){e.j=n?at(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function nt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function rt(e,t,n){t instanceof pt?(e.i=t,function(e,t){t&&!e.j&&(gt(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(mt(this,t),bt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=ot(t,ht)),e.i=new pt(t,e.l))}function st(e,t,n){e.i.set(t,n)}function it(e){return st(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function at(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ot(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,lt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function lt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}$e.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(ot(t,ct,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ot(t,ct,!0),"@"),e.push(Ce(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ot(n,"/"==n.charAt(0)?dt:ut,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ot(n,ft)),e.join("")},$e.prototype.resolve=function(e){const t=et(this);let n=!!e.j;n?tt(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)nt(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var s=t.h.lastIndexOf("/");-1!=s&&(r=t.h.slice(0,s+1)+r)}if(".."==(s=r)||"."==s)r="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){r=0==s.lastIndexOf("/",0),s=s.split("/");const e=[];for(let t=0;t<s.length;){const n=s[t++];"."==n?r&&t==s.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==s.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=s}return n?t.h=r:n=""!==e.i.toString(),n?rt(t,Et(e.i)):n=!!e.m,n&&(t.m=e.m),t};var ct=/[#\/\?@]/g,ut=/[#\?:]/g,dt=/[#\?]/g,ht=/[#\?@]/g,ft=/#/g;function pt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function gt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const r=e[n].indexOf("=");let s,i=null;r>=0?(s=e[n].substring(0,r),i=e[n].substring(r+1)):s=e[n],t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function mt(e,t){gt(e),t=wt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function vt(e,t){return gt(e),t=wt(e,t),e.g.has(t)}function yt(e,t){gt(e);let n=[];if("string"===typeof t)vt(e,t)&&(n=n.concat(e.g.get(wt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function bt(e,t,n){mt(e,t),n.length>0&&(e.i=null,e.g.set(wt(e,t),h(n)),e.h+=n.length)}function Et(e){const t=new pt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function wt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function St(e,t,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(lE){}}function Tt(){this.g=new oe}function kt(e){this.i=e.Sb||null,this.h=e.ab||!1}function xt(e,t){Z.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function It(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function Lt(e){e.readyState=4,e.l=null,e.j=null,e.B=null,Ct(e)}function Ct(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function _t(e){let t="";return P(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function At(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=_t(n),"string"===typeof e?null!=n&&Ce(n):st(e,t,n))}function Rt(e){Z.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=pt.prototype).add=function(e,t){gt(this),this.i=null,e=wt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){gt(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.set=function(e,t){return gt(this),this.i=null,vt(this,e=wt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=yt(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];const s=Ce(n);n=yt(this,n);for(let t=0;t<n.length;t++){let r=s;""!==n[t]&&(r+="="+Ce(n[t])),e.push(r)}}return this.i=e.join("&")},u(kt,le),kt.prototype.g=function(){return new xt(this.i,this.h)},u(xt,Z),(e=xt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,Ct(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Lt(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ct(this)),this.g&&(this.readyState=3,Ct(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;It(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Lt(this):Ct(this),3==this.readyState&&It(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,Lt(this))},e.Na=function(e){this.g&&(this.response=e,Lt(this))},e.ga=function(){this.g&&Lt(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(xt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Rt,Z);var Pt=/^https?$/i,Dt=["POST","PUT"];function Ot(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Nt(e),Ft(e)}function Nt(e){e.A||(e.A=!0,J(e,"complete"),J(e,"error"))}function Mt(e){if(e.h&&"undefined"!=typeof s)if(e.v&&4==Ut(e))setTimeout(e.Ca.bind(e),0);else if(J(e,"readystatechange"),4==Ut(e)){e.h=!1;try{const s=e.ca();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===s){let t=String(e.D).match(Je)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),r=!Pt.test(t?t.toLowerCase():"")}n=r}if(n)J(e,"complete"),J(e,"success");else{e.o=6;try{var a=Ut(e)>2?e.g.statusText:""}catch(zE){a=""}e.l=a+" ["+e.ca()+"]",Nt(e)}}finally{Ft(e)}}}function Ft(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const r=e.g;e.g=null,t||J(e,"ready");try{r.onreadystatechange=null}catch(n){}}}function Ut(e){return e.g?e.g.readyState:0}function jt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(nE){return null}}function Bt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Vt(e){this.za=0,this.i=[],this.j=new Se,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Bt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Bt("baseRetryDelayMs",5e3,e),this.Za=Bt("retryDelaySeedMs",1e4,e),this.Ta=Bt("forwardChannelMaxRetries",2,e),this.va=Bt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new Ke(e&&e.concurrentRequestLimit),this.Ba=new Tt,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function zt(e){if(Ht(e),3==e.I){var t=e.V++,n=et(e.J);if(st(n,"SID",e.M),st(n,"RID",t),st(n,"TYPE","terminate"),qt(e,n),(t=new Ae(e,e.j,t)).M=2,t.A=it(et(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.A.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.A,n=!0),n||(t.g=an(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Ue(t)}rn(e)}function Gt(e){e.g&&(Zt(e),e.g.cancel(),e.g=null)}function Ht(e){Gt(e),e.v&&(i.clearTimeout(e.v),e.v=null),$t(e),e.h.cancel(),e.m&&("number"===typeof e.m&&i.clearTimeout(e.m),e.m=null)}function Kt(e){if(!We(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||w(),b||(y(),b=!0),E.add(t,e),e.D=0}}function Wt(e,t){var n;n=t?t.l:e.V++;const r=et(e.J);st(r,"SID",e.M),st(r,"RID",n),st(r,"AID",e.K),qt(e,r),e.u&&e.o&&At(r,e.u,e.o),n=new Ae(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Yt(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Qe(e.h,n),Oe(n,r,t)}function qt(e,t){e.H&&P(e.H,function(e,n){st(t,n,e)}),e.l&&P({},function(e,n){st(t,n,e)})}function Yt(e,t,n){n=Math.min(e.i.length,n);const r=e.l?l(e.l.Ka,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let c=0;c<n;c++){var i=s[c].g;const n=s[c].map;if((i-=t)<0)t=Math.max(0,s[c].g-100),l=!1;else try{i="req"+i+"_"||0;try{var o=n instanceof Map?n:Object.entries(n);for(const[t,n]of o){let r=n;a(n)&&(r=ie(n)),e.push(i+t+"="+encodeURIComponent(r))}}catch(bl){throw e.push(i+"type="+encodeURIComponent("_badmap")),bl}}catch(bl){r&&r(n)}}if(l){o=e.join("&");break e}}o=void 0}return e=e.i.splice(0,n),t.G=e,o}function Qt(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||w(),b||(y(),b=!0),E.add(t,e),e.A=0}}function Xt(e){return!(e.g||e.v||e.A>=3)&&(e.Y++,e.v=we(l(e.Da,e),tn(e,e.A)),e.A++,!0)}function Zt(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function Jt(e){e.g=new Ae(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=et(e.na);st(t,"RID","rpc"),st(t,"SID",e.M),st(t,"AID",e.K),st(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&st(t,"TO",e.ia),st(t,"TYPE","xmlhttp"),qt(e,t),e.u&&e.o&&At(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=it(et(t)),n.u=null,n.R=!0,Ne(n,e)}function $t(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function en(e,t){var n=null;if(e.g==t){$t(e),Zt(e),e.g=null;var r=2}else{if(!Ye(e.h,t))return;n=t.G,Xe(e.h,t),r=1}if(0!=e.I)if(t.o)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;J(r=ge(),new Ee(r,n)),Kt(e)}else Qt(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==r&&function(e,t){return!(qe(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.G.concat(e.i),!0):!(1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta))&&(e.m=we(l(e.Ea,e,t),tn(e,e.D)),e.D++,!0))}(e,t)||2==r&&Xt(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),s){case 1:nn(e,5);break;case 4:nn(e,10);break;case 3:nn(e,6);break;default:nn(e,2)}}function tn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function nn(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.bb,e),r=e.Ua;const t=!r;r=new $e(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||tt(r,"https"),it(r),t?function(e,t){const n=new Se;if(i.Image){const r=new Image;r.onload=c(St,n,"TestLoadImage: loaded",!0,t,r),r.onerror=c(St,n,"TestLoadImage: error",!1,t,r),r.onabort=c(St,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=c(St,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Se;const n=new AbortController,r=setTimeout(()=>{n.abort(),St(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?St(0,0,!0,t):St(0,0,!1,t)}).catch(()=>{clearTimeout(r),St(0,0,!1,t)})}(r.toString(),n)}else be(2);e.I=0,e.l&&e.l.pa(t),rn(e),Ht(e)}function rn(e){if(e.I=0,e.ja=[],e.l){const t=Ze(e.h);0==t.length&&0==e.i.length||(f(e.ja,t),f(e.ja,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.oa()}}function sn(e,t,n){var r=n instanceof $e?et(n):new $e(n);if(""!=r.g)t&&(r.g=t+"."+r.g),nt(r,r.u);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;const e=new $e(null);r&&tt(e,r),t&&(e.g=t),s&&nt(e,s),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&st(r,n,t),st(r,"VER",e.ka),qt(e,r),r}function an(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Rt(new kt({ab:n})):new Rt(e.ma)).Fa(e.L),t}function on(){}function ln(){}function cn(e,t){Z.call(this),this.g=new Vt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!I(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!I(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new hn(this)}function un(e){de.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function dn(){he.call(this),this.status=1}function hn(e){this.g=e}(e=Rt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ke.g(),this.g.onreadystatechange=d(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(lE){return void Ot(this,lE)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=i.FormData&&e instanceof i.FormData,!(Array.prototype.indexOf.call(Dt,t,void 0)>=0)||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(lE){Ot(this,lE)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,J(this,"complete"),J(this,"abort"),Ft(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ft(this,!0)),Rt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Mt(this):this.Xa())},e.Xa=function(){Mt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Ut(this)>2?this.g.status:-1}catch(Yb){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(Yb){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ae(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Vt.prototype).ka=8,e.I=1,e.connect=function(e,t,n,r){be(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=sn(this,null,this.W),Kt(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const s=new Ae(this,this.j,e);let i=this.o;if(this.U&&(i?(i=D(i),N(i,this.U)):i=this.U),null!==this.u||this.R||(s.J=i,i=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Yt(this,s,t),st(n=et(this.J),"RID",e),st(n,"CVER",22),this.G&&st(n,"X-HTTP-Session-Id",this.G),qt(this,n),i&&(this.R?t="headers="+Ce(_t(i))+"&"+t:this.u&&At(n,this.u,i)),Qe(this.h,s),this.Ra&&st(n,"TYPE","init"),this.S?(st(n,"$req",t),st(n,"SID","null"),s.U=!0,Oe(s,n,null)):Oe(s,n,t),this.I=2}}else 3==this.I&&(e?Wt(this,e):0==this.i.length||We(this.h)||Wt(this))},e.Da=function(){if(this.v=null,Jt(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=we(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,be(10),Gt(this),Jt(this))},e.Va=function(){null!=this.C&&(this.C=null,Gt(this),Xt(this),be(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),be(2)):(this.j.info("Failed to ping google.com"),be(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=on.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},ln.prototype.g=function(e,t){return new cn(e,t)},u(cn,Z),cn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},cn.prototype.close=function(){zt(this.g)},cn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ie(e),e=n);t.i.push(new He(t.Ya++,e)),3==t.I&&Kt(t)},cn.prototype.N=function(){this.g.l=null,delete this.j,zt(this.g),delete this.g,cn.Z.N.call(this)},u(un,de),u(dn,he),u(hn,on),hn.prototype.ra=function(){J(this.g,"a")},hn.prototype.qa=function(e){J(this.g,new un(e))},hn.prototype.pa=function(e){J(this.g,new dn)},hn.prototype.oa=function(){J(this.g,"b")},ln.prototype.createWebChannel=ln.prototype.g,cn.prototype.send=cn.prototype.o,cn.prototype.open=cn.prototype.m,cn.prototype.close=cn.prototype.close,jo=Vo.createWebChannelTransport=function(){return new ln},Uo=Vo.getStatEventTarget=function(){return ge()},Fo=Vo.Event=fe,Mo=Vo.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},xe.NO_ERROR=0,xe.TIMEOUT=8,xe.HTTP_ERROR=6,No=Vo.ErrorCode=xe,Ie.COMPLETE="complete",Oo=Vo.EventType=Ie,ce.EventType=ue,ue.OPEN="a",ue.CLOSE="b",ue.ERROR="c",ue.MESSAGE="d",Z.prototype.listen=Z.prototype.J,Do=Vo.WebChannel=ce,Vo.FetchXmlHttpFactory=kt,Rt.prototype.listenOnce=Rt.prototype.K,Rt.prototype.getLastError=Rt.prototype.Ha,Rt.prototype.getLastErrorCode=Rt.prototype.ya,Rt.prototype.getStatus=Rt.prototype.ca,Rt.prototype.getResponseJson=Rt.prototype.La,Rt.prototype.getResponseText=Rt.prototype.la,Rt.prototype.send=Rt.prototype.ea,Rt.prototype.setWithCredentials=Rt.prototype.Fa,Po=Vo.XhrIo=Rt}).apply("undefined"!==typeof Bo?Bo:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});class zo{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}zo.UNAUTHENTICATED=new zo(null),zo.GOOGLE_CREDENTIALS=new zo("google-credentials-uid"),zo.FIRST_PARTY=new zo("first-party-uid"),zo.MOCK_USER=new zo("mock-user");let Go="12.9.0";const Ho=new An("@firebase/firestore");function Ko(){return Ho.logLevel}function Wo(e){if(Ho.logLevel<=xn.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=n.map(Qo);Ho.debug("Firestore (".concat(Go,"): ").concat(e),...s)}}function qo(e){if(Ho.logLevel<=xn.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=n.map(Qo);Ho.error("Firestore (".concat(Go,"): ").concat(e),...s)}}function Yo(e){if(Ho.logLevel<=xn.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=n.map(Qo);Ho.warn("Firestore (".concat(Go,"): ").concat(e),...s)}}function Qo(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(WE){return e}}function Xo(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,Zo(e,r,n)}function Zo(e,t,n){let r="FIRESTORE (".concat(Go,") INTERNAL ASSERTION FAILED: ").concat(t," (ID: ").concat(e.toString(16),")");if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw qo(r),new Error(r)}function Jo(e,t,n,r){let s="Unexpected state";"string"==typeof n?s=n:r=n,e||Zo(t,s,r)}function $o(e,t){return e}const el={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tl extends cn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class nl{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rl{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class sl{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(zo.UNAUTHENTICATED))}shutdown(){}}class il{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class al{constructor(e){this.t=e,this.currentUser=zo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Jo(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new nl;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new nl,e.enqueueRetryable(()=>r(this.currentUser))};const i=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{Wo("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(Wo("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new nl)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Wo("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Jo("string"==typeof t.accessToken,31837,{l:t}),new rl(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Jo(null===e||"string"==typeof e,2055,{h:e}),new zo(e)}}class ol{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=zo.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class ll{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new ol(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(zo.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class cl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ul{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Rr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Jo(void 0===this.o,3512);const n=e=>{null!=e.error&&Wo("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.m;return this.m=e.token,Wo("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{Wo("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):Wo("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new cl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Jo("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new cl(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function dl(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class hl{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=dl(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function fl(e,t){return e<t?-1:e>t?1:0}function pl(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.charAt(r),s=t.charAt(r);if(n!==s)return vl(n)===vl(s)?fl(n,s):vl(n)?1:-1}return fl(e.length,t.length)}const gl=55296,ml=57343;function vl(e){const t=e.charCodeAt(0);return t>=gl&&t<=ml}function yl(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}const bl="__name__";class El{constructor(e,t,n){void 0===t?t=0:t>e.length&&Xo(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&Xo(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===El.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof El?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=El.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return fl(e.length,t.length)}static compareSegments(e,t){const n=El.isNumericId(e),r=El.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?El.extractNumericId(e).compare(El.extractNumericId(t)):pl(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Co.fromString(e.substring(4,e.length-2))}}class wl extends El{construct(e,t,n){return new wl(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const s of n){if(s.indexOf("//")>=0)throw new tl(el.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push(...s.split("/").filter(e=>e.length>0))}return new wl(e)}static emptyPath(){return new wl([])}}const Sl=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Tl extends El{construct(e,t,n){return new Tl(e,t,n)}static isValidIdentifier(e){return Sl.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Tl.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===bl}static keyField(){return new Tl([bl])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(0===n.length)throw new tl(el.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new tl(el.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tl(el.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(s(),r++)}if(s(),i)throw new tl(el.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Tl(t)}static emptyPath(){return new Tl([])}}class kl{constructor(e){this.path=e}static fromPath(e){return new kl(wl.fromString(e))}static fromName(e){return new kl(wl.fromString(e).popFirst(5))}static empty(){return new kl(wl.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===wl.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return wl.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new kl(new wl(e.slice()))}}function xl(e,t,n){if(!n)throw new tl(el.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Il(e){if(!kl.isDocumentKey(e))throw new tl(el.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Ll(e){if(kl.isDocumentKey(e))throw new tl(el.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Cl(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function _l(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":Xo(12329,{type:typeof e})}function Al(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tl(el.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=_l(e);throw new tl(el.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function Rl(e,t){const n={typeString:e};return t&&(n.value=t),n}function Pl(e,t){if(!Cl(e))throw new tl(el.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const s=t[r].typeString,i="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n="JSON missing required field: '".concat(r,"'");break}const a=e[r];if(s&&typeof a!==s){n="JSON field '".concat(r,"' must be a ").concat(s,".");break}if(void 0!==i&&a!==i.value){n="Expected '".concat(r,"' field to equal '").concat(i.value,"'");break}}if(n)throw new tl(el.INVALID_ARGUMENT,n);return!0}const Dl=-62135596800,Ol=1e6;class Nl{static now(){return Nl.fromMillis(Date.now())}static fromDate(e){return Nl.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Ol);return new Nl(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new tl(el.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new tl(el.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Dl)throw new tl(el.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new tl(el.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ol}_compareTo(e){return this.seconds===e.seconds?fl(this.nanoseconds,e.nanoseconds):fl(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Nl._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Pl(e,Nl._jsonSchema))return new Nl(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Dl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Nl._jsonSchemaVersion="firestore/timestamp/1.0",Nl._jsonSchema={type:Rl("string",Nl._jsonSchemaVersion),seconds:Rl("number"),nanoseconds:Rl("number")};class Ml{static fromTimestamp(e){return new Ml(e)}static min(){return new Ml(new Nl(0,0))}static max(){return new Ml(new Nl(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Fl=-1;class Ul{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}Ul.UNKNOWN_ID=-1;function jl(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,s=Ml.fromTimestamp(1e9===r?new Nl(n+1,0):new Nl(n,r));return new Vl(s,kl.empty(),t)}function Bl(e){return new Vl(e.readTime,e.key,Fl)}class Vl{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Vl(Ml.min(),kl.empty(),Fl)}static max(){return new Vl(Ml.max(),kl.empty(),Fl)}}function zl(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=kl.comparator(e.documentKey,t.documentKey),0!==n?n:fl(e.largestBatchId,t.largestBatchId))}const Gl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Hl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Kl(e){if(e.code!==el.FAILED_PRECONDITION||e.message!==Gl)throw e;Wo("LocalStore","Unexpectedly lost primary lease")}class Wl{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Xo(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Wl((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Wl?t:Wl.resolve(t)}catch(e){return Wl.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Wl.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Wl.reject(t)}static resolve(e){return new Wl((t,n)=>{t(e)})}static reject(e){return new Wl((t,n)=>{n(e)})}static waitFor(e){return new Wl((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=Wl.resolve(!1);for(const n of e)t=t.next(e=>e?Wl.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new Wl((n,r)=>{const s=e.length,i=new Array(s);let a=0;for(let o=0;o<s;o++){const l=o;t(e[l]).next(e=>{i[l]=e,++a,a===s&&n(i)},e=>r(e))}})}static doWhile(e,t){return new Wl((n,r)=>{const s=()=>{!0===e()?t().next(()=>{s()},r):n()};s()})}}function ql(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Yl(e){return"IndexedDbTransactionError"===e.name}class Ql{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ql.ce=-1;const Xl=-1;function Zl(e){return null==e}function Jl(e){return 0===e&&1/e==-1/0}function $l(e){return"number"==typeof e&&Number.isInteger(e)&&!Jl(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const ec="\x01";function tc(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=rc(t)),t=nc(e.get(n),t);return rc(t)}function nc(e,t){let n=t;const r=e.length;for(let s=0;s<r;s++){const t=e.charAt(s);switch(t){case"\0":n+="\x01\x10";break;case ec:n+="\x01\x11";break;default:n+=t}}return n}function rc(e){return e+ec+"\x01"}const sc="remoteDocuments",ic="owner",ac="mutationQueues",oc="mutations";const lc="documentMutations",cc="remoteDocumentsV14",uc="remoteDocumentGlobal",dc="targets",hc="targetDocuments",fc="targetGlobal",pc="collectionParents",gc="clientMetadata",mc="bundles",vc="namedQueries",yc="indexConfiguration",bc="indexState",Ec="indexEntries",wc="documentOverlays",Sc="globals",Tc=[ac,oc,lc,sc,dc,ic,fc,hc,gc,uc,pc,mc,vc],kc=[ac,oc,lc,cc,dc,ic,fc,hc,gc,uc,pc,mc,vc,wc],xc=kc,Ic=[...xc,yc,bc,Ec];function Lc(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Cc(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function _c(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ac{constructor(e,t){this.comparator=e,this.root=t||Pc.EMPTY}insert(e,t){return new Ac(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pc.BLACK,null,null))}remove(e){return new Ac(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Rc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Rc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Rc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Rc(this.root,e,this.comparator,!0)}}class Rc{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pc{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:Pc.RED,this.left=null!=r?r:Pc.EMPTY,this.right=null!=s?s:Pc.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Pc(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Pc.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Pc.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Xo(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Xo(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Xo(27949);return e+(this.isRed()?0:1)}}Pc.EMPTY=null,Pc.RED=!0,Pc.BLACK=!1,Pc.EMPTY=new class{constructor(){this.size=0}get key(){throw Xo(57766)}get value(){throw Xo(16141)}get color(){throw Xo(16727)}get left(){throw Xo(29726)}get right(){throw Xo(36894)}copy(e,t,n,r,s){return this}insert(e,t,n){return new Pc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Dc{constructor(e){this.comparator=e,this.data=new Ac(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Oc(this.data.getIterator())}getIteratorFrom(e){return new Oc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Dc))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Dc(this.comparator);return t.data=e,t}}class Oc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Nc{constructor(e){this.fields=e,e.sort(Tl.comparator)}static empty(){return new Nc([])}unionWith(e){let t=new Dc(Tl.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Nc(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return yl(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Mc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Fc{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Mc("Invalid base64 string: "+e):e}}(e);return new Fc(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Fc(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return fl(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Fc.EMPTY_BYTE_STRING=new Fc("");const Uc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jc(e){if(Jo(!!e,39018),"string"==typeof e){let t=0;const n=Uc.exec(e);if(Jo(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Bc(e.seconds),nanos:Bc(e.nanos)}}function Bc(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Vc(e){return"string"==typeof e?Fc.fromBase64String(e):Fc.fromUint8Array(e)}const zc="server_timestamp",Gc="__type__",Hc="__previous_value__",Kc="__local_write_time__";function Wc(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[Gc])||void 0===t?void 0:t.stringValue)===zc}function qc(e){const t=e.mapValue.fields[Hc];return Wc(t)?qc(t):t}function Yc(e){const t=jc(e.mapValue.fields[Kc].timestampValue);return new Nl(t.seconds,t.nanos)}class Qc{constructor(e,t,n,r,s,i,a,o,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c,this.apiKey=u}}const Xc="(default)";class Zc{constructor(e,t){this.projectId=e,this.database=t||Xc}static empty(){return new Zc("","")}get isDefaultDatabase(){return this.database===Xc}isEqual(e){return e instanceof Zc&&e.projectId===this.projectId&&e.database===this.database}}const Jc="__type__",$c="__max__",eu={mapValue:{fields:{__type__:{stringValue:$c}}}},tu="__vector__",nu="value";function ru(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Wc(e)?4:Eu(e)?9007199254740991:yu(e)?10:11:Xo(28295,{value:e})}function su(e,t){if(e===t)return!0;const n=ru(e);if(n!==ru(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Yc(e).isEqual(Yc(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=jc(e.timestampValue),r=jc(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Vc(e.bytesValue).isEqual(Vc(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Bc(e.geoPointValue.latitude)===Bc(t.geoPointValue.latitude)&&Bc(e.geoPointValue.longitude)===Bc(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Bc(e.integerValue)===Bc(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Bc(e.doubleValue),r=Bc(t.doubleValue);return n===r?Jl(n)===Jl(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return yl(e.arrayValue.values||[],t.arrayValue.values||[],su);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Lc(n)!==Lc(r))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===r[s]||!su(n[s],r[s])))return!1;return!0}(e,t);default:return Xo(52216,{left:e})}}function iu(e,t){return void 0!==(e.values||[]).find(e=>su(e,t))}function au(e,t){if(e===t)return 0;const n=ru(e),r=ru(t);if(n!==r)return fl(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return fl(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Bc(e.integerValue||e.doubleValue),r=Bc(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return ou(e.timestampValue,t.timestampValue);case 4:return ou(Yc(e),Yc(t));case 5:return pl(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Vc(e),r=Vc(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let s=0;s<n.length&&s<r.length;s++){const e=fl(n[s],r[s]);if(0!==e)return e}return fl(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=fl(Bc(e.latitude),Bc(t.latitude));return 0!==n?n:fl(Bc(e.longitude),Bc(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return lu(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,s,i;const a=e.fields||{},o=t.fields||{},l=null===(n=a[nu])||void 0===n?void 0:n.arrayValue,c=null===(r=o[nu])||void 0===r?void 0:r.arrayValue,u=fl((null===l||void 0===l||null===(s=l.values)||void 0===s?void 0:s.length)||0,(null===c||void 0===c||null===(i=c.values)||void 0===i?void 0:i.length)||0);return 0!==u?u:lu(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===eu.mapValue&&t===eu.mapValue)return 0;if(e===eu.mapValue)return 1;if(t===eu.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let a=0;a<r.length&&a<i.length;++a){const e=pl(r[a],i[a]);if(0!==e)return e;const t=au(n[r[a]],s[i[a]]);if(0!==t)return t}return fl(r.length,i.length)}(e.mapValue,t.mapValue);default:throw Xo(23264,{he:n})}}function ou(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return fl(e,t);const n=jc(e),r=jc(t),s=fl(n.seconds,r.seconds);return 0!==s?s:fl(n.nanos,r.nanos)}function lu(e,t){const n=e.values||[],r=t.values||[];for(let s=0;s<n.length&&s<r.length;++s){const e=au(n[s],r[s]);if(e)return e}return fl(n.length,r.length)}function cu(e){return uu(e)}function uu(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=jc(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Vc(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return kl.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=uu(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+="".concat(s,":").concat(uu(e.fields[s]));return n+"}"}(e.mapValue):Xo(61005,{value:e})}function du(e){switch(ru(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=qc(e);return t?16+du(t):16;case 5:return 2*e.stringValue.length;case 6:return Vc(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+du(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return Cc(e.fields,(e,n)=>{t+=e.length+du(n)}),t}(e.mapValue);default:throw Xo(13486,{value:e})}}function hu(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function fu(e){return!!e&&"integerValue"in e}function pu(e){return!!e&&"arrayValue"in e}function gu(e){return!!e&&"nullValue"in e}function mu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function vu(e){return!!e&&"mapValue"in e}function yu(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[Jc])||void 0===t?void 0:t.stringValue)===tu}function bu(e){if(e.geoPointValue)return{geoPointValue:d({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:d({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Cc(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=bu(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=bu(e.arrayValue.values[n]);return t}return d({},e)}function Eu(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===$c}class wu{constructor(e){this.value=e}static empty(){return new wu({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!vu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=bu(t)}setAll(e){let t=Tl.emptyPath(),n={},r=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=s.popLast()}e?n[s.lastSegment()]=bu(e):r.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());vu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return su(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];vu(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Cc(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new wu(bu(this.value))}}function Su(e){const t=[];return Cc(e.fields,(e,n)=>{const r=new Tl([e]);if(vu(n)){const e=Su(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new Nc(t)}class Tu{constructor(e,t,n,r,s,i,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=a}static newInvalidDocument(e){return new Tu(e,0,Ml.min(),Ml.min(),Ml.min(),wu.empty(),0)}static newFoundDocument(e,t,n,r){return new Tu(e,1,t,Ml.min(),n,r,0)}static newNoDocument(e,t){return new Tu(e,2,t,Ml.min(),Ml.min(),wu.empty(),0)}static newUnknownDocument(e,t){return new Tu(e,3,t,Ml.min(),Ml.min(),wu.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ml.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=wu.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=wu.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ml.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Tu&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Tu(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class ku{constructor(e,t){this.position=e,this.inclusive=t}}function xu(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],a=e.position[s];if(r=i.field.isKeyField()?kl.comparator(kl.fromName(a.referenceValue),n.key):au(a,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Iu(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!su(e.position[n],t.position[n]))return!1;return!0}class Lu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function Cu(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class _u{}class Au extends _u{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Uu(e,t,n):"array-contains"===t?new zu(e,n):"in"===t?new Gu(e,n):"not-in"===t?new Hu(e,n):"array-contains-any"===t?new Ku(e,n):new Au(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ju(e,n):new Bu(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(au(t,this.value)):null!==t&&ru(this.value)===ru(t)&&this.matchesComparison(au(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Xo(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ru extends _u{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ru(e,t)}matches(e){return Pu(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Pu(e){return"and"===e.op}function Du(e){return Ou(e)&&Pu(e)}function Ou(e){for(const t of e.filters)if(t instanceof Ru)return!1;return!0}function Nu(e){if(e instanceof Au)return e.field.canonicalString()+e.op.toString()+cu(e.value);if(Du(e))return e.filters.map(e=>Nu(e)).join(",");{const t=e.filters.map(e=>Nu(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function Mu(e,t){return e instanceof Au?function(e,t){return t instanceof Au&&e.op===t.op&&e.field.isEqual(t.field)&&su(e.value,t.value)}(e,t):e instanceof Ru?function(e,t){return t instanceof Ru&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&Mu(n,t.filters[r]),!0)}(e,t):void Xo(19439)}function Fu(e){return e instanceof Au?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(cu(e.value))}(e):e instanceof Ru?function(e){return e.op.toString()+" {"+e.getFilters().map(Fu).join(" ,")+"}"}(e):"Filter"}class Uu extends Au{constructor(e,t,n){super(e,t,n),this.key=kl.fromName(n.referenceValue)}matches(e){const t=kl.comparator(e.key,this.key);return this.matchesComparison(t)}}class ju extends Au{constructor(e,t){super(e,"in",t),this.keys=Vu("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Bu extends Au{constructor(e,t){super(e,"not-in",t),this.keys=Vu("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Vu(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>kl.fromName(e.referenceValue))}class zu extends Au{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return pu(t)&&iu(t.arrayValue,this.value)}}class Gu extends Au{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&iu(this.value.arrayValue,t)}}class Hu extends Au{constructor(e,t){super(e,"not-in",t)}matches(e){if(iu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!iu(this.value.arrayValue,t)}}class Ku extends Au{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!pu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>iu(this.value.arrayValue,e))}}class Wu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=a,this.Te=null}}function qu(e){return new Wu(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Yu(e){const t=$o(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Nu(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Zl(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>cu(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>cu(e)).join(",")),t.Te=e}return t.Te}function Qu(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Cu(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Mu(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Iu(e.startAt,t.startAt)&&Iu(e.endAt,t.endAt)}function Xu(e){return kl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Zu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Ju(e,t,n,r,s,i,a,o){return new Zu(e,t,n,r,s,i,a,o)}function $u(e){return new Zu(e)}function ed(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function td(e){return null!==e.collectionGroup}function nd(e){const t=$o(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const s of t.explicitOrderBy)t.Ie.push(s),e.add(s.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Dc(Tl.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new Lu(r,n))}),e.has(Tl.keyField().canonicalString())||t.Ie.push(new Lu(Tl.keyField(),n))}return t.Ie}function rd(e){const t=$o(e);return t.Ee||(t.Ee=sd(t,nd(e))),t.Ee}function sd(e,t){if("F"===e.limitType)return qu(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Lu(e.field,t)});const n=e.endAt?new ku(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new ku(e.startAt.position,e.startAt.inclusive):null;return qu(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function id(e,t){const n=e.filters.concat([t]);return new Zu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function ad(e,t,n){return new Zu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function od(e,t){return Qu(rd(e),rd(t))&&e.limitType===t.limitType}function ld(e){return"".concat(Yu(rd(e)),"|lt:").concat(e.limitType)}function cd(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>Fu(e)).join(", "),"]")),Zl(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>cu(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>cu(e)).join(",")),"Target(".concat(t,")")}(rd(e)),"; limitType=").concat(e.limitType,")")}function ud(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):kl.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of nd(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=xu(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,nd(e),t))&&!(e.endAt&&!function(e,t,n){const r=xu(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,nd(e),t))}(e,t)}function dd(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function hd(e){return(t,n)=>{let r=!1;for(const s of nd(e)){const e=fd(s,t,n);if(0!==e)return e;r=r||s.field.isKeyField()}return 0}}function fd(e,t,n){const r=e.field.isKeyField()?kl.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),s=n.data.field(e);return null!==r&&null!==s?au(r,s):Xo(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Xo(19790,{direction:e.dir})}}class pd{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,s]of n)if(this.equalsFn(r,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Cc(this.inner,(t,n)=>{for(const[r,s]of n)e(r,s)})}isEmpty(){return _c(this.inner)}size(){return this.innerSize}}const gd=new Ac(kl.comparator);function md(){return gd}const vd=new Ac(kl.comparator);function yd(){let e=vd;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const s of n)e=e.insert(s.key,s);return e}function bd(e){let t=vd;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Ed(){return Sd()}function wd(){return Sd()}function Sd(){return new pd(e=>e.toString(),(e,t)=>e.isEqual(t))}const Td=new Ac(kl.comparator),kd=new Dc(kl.comparator);function xd(){let e=kd;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const s of n)e=e.add(s);return e}const Id=new Dc(fl);function Ld(){return Id}function Cd(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Jl(t)?"-0":t}}function _d(e){return{integerValue:""+e}}function Ad(e,t){return $l(t)?_d(t):Cd(e,t)}class Rd{constructor(){this._=void 0}}function Pd(e,t,n){return e instanceof Nd?function(e,t){const n={fields:{[Gc]:{stringValue:zc},[Kc]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Wc(t)&&(t=qc(t)),t&&(n.fields[Hc]=t),{mapValue:n}}(n,t):e instanceof Md?Fd(e,t):e instanceof Ud?jd(e,t):function(e,t){const n=Od(e,t),r=Vd(n)+Vd(e.Ae);return fu(n)&&fu(e.Ae)?_d(r):Cd(e.serializer,r)}(e,t)}function Dd(e,t,n){return e instanceof Md?Fd(e,t):e instanceof Ud?jd(e,t):n}function Od(e,t){return e instanceof Bd?function(e){return fu(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Nd extends Rd{}class Md extends Rd{constructor(e){super(),this.elements=e}}function Fd(e,t){const n=zd(t);for(const r of e.elements)n.some(e=>su(e,r))||n.push(r);return{arrayValue:{values:n}}}class Ud extends Rd{constructor(e){super(),this.elements=e}}function jd(e,t){let n=zd(t);for(const r of e.elements)n=n.filter(e=>!su(e,r));return{arrayValue:{values:n}}}class Bd extends Rd{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Vd(e){return Bc(e.integerValue||e.doubleValue)}function zd(e){return pu(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Gd{constructor(e,t){this.field=e,this.transform=t}}class Hd{constructor(e,t){this.version=e,this.transformResults=t}}class Kd{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Kd}static exists(e){return new Kd(void 0,e)}static updateTime(e){return new Kd(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wd(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class qd{}function Yd(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new sh(e.key,Kd.none()):new $d(e.key,e.data,Kd.none());{const n=e.data,r=wu.empty();let s=new Dc(Tl.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),s=s.add(e)}return new eh(e.key,r,new Nc(s.toArray()),Kd.none())}}function Qd(e,t,n){e instanceof $d?function(e,t,n){const r=e.value.clone(),s=nh(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof eh?function(e,t,n){if(!Wd(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=nh(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(th(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Xd(e,t,n,r){return e instanceof $d?function(e,t,n,r){if(!Wd(e.precondition,t))return n;const s=e.value.clone(),i=rh(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof eh?function(e,t,n,r){if(!Wd(e.precondition,t))return n;const s=rh(e.fieldTransforms,r,t),i=t.data;return i.setAll(th(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return Wd(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Zd(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=Od(r.transform,e||null);null!=s&&(null===n&&(n=wu.empty()),n.set(r.field,s))}return n||null}function Jd(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&yl(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Md&&t instanceof Md||e instanceof Ud&&t instanceof Ud?yl(e.elements,t.elements,su):e instanceof Bd&&t instanceof Bd?su(e.Ae,t.Ae):e instanceof Nd&&t instanceof Nd}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class $d extends qd{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class eh extends qd{constructor(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function th(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function nh(e,t,n){const r=new Map;Jo(e.length===n.length,32656,{Ve:n.length,de:e.length});for(let s=0;s<n.length;s++){const i=e[s],a=i.transform,o=t.data.field(i.field);r.set(i.field,Dd(a,o,n[s]))}return r}function rh(e,t,n){const r=new Map;for(const s of e){const e=s.transform,i=n.data.field(s.field);r.set(s.field,Pd(e,i,t))}return r}class sh extends qd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ih extends qd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ah{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Qd(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Xd(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Xd(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=wd();return this.mutations.forEach(r=>{const s=e.get(r.key),i=s.overlayedDocument;let a=this.applyToLocalView(i,s.mutatedFields);a=t.has(r.key)?null:a;const o=Yd(i,a);null!==o&&n.set(r.key,o),i.isValidDocument()||i.convertToNoDocument(Ml.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),xd())}isEqual(e){return this.batchId===e.batchId&&yl(this.mutations,e.mutations,(e,t)=>Jd(e,t))&&yl(this.baseMutations,e.baseMutations,(e,t)=>Jd(e,t))}}class oh{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Jo(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=Td;const s=e.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new oh(e,t,n,r)}}class lh{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class ch{constructor(e,t){this.count=e,this.unchangedNames=t}}var uh,dh;function hh(e){switch(e){case el.OK:return Xo(64938);case el.CANCELLED:case el.UNKNOWN:case el.DEADLINE_EXCEEDED:case el.RESOURCE_EXHAUSTED:case el.INTERNAL:case el.UNAVAILABLE:case el.UNAUTHENTICATED:return!1;case el.INVALID_ARGUMENT:case el.NOT_FOUND:case el.ALREADY_EXISTS:case el.PERMISSION_DENIED:case el.FAILED_PRECONDITION:case el.ABORTED:case el.OUT_OF_RANGE:case el.UNIMPLEMENTED:case el.DATA_LOSS:return!0;default:return Xo(15467,{code:e})}}function fh(e){if(void 0===e)return qo("GRPC error has no .code"),el.UNKNOWN;switch(e){case uh.OK:return el.OK;case uh.CANCELLED:return el.CANCELLED;case uh.UNKNOWN:return el.UNKNOWN;case uh.DEADLINE_EXCEEDED:return el.DEADLINE_EXCEEDED;case uh.RESOURCE_EXHAUSTED:return el.RESOURCE_EXHAUSTED;case uh.INTERNAL:return el.INTERNAL;case uh.UNAVAILABLE:return el.UNAVAILABLE;case uh.UNAUTHENTICATED:return el.UNAUTHENTICATED;case uh.INVALID_ARGUMENT:return el.INVALID_ARGUMENT;case uh.NOT_FOUND:return el.NOT_FOUND;case uh.ALREADY_EXISTS:return el.ALREADY_EXISTS;case uh.PERMISSION_DENIED:return el.PERMISSION_DENIED;case uh.FAILED_PRECONDITION:return el.FAILED_PRECONDITION;case uh.ABORTED:return el.ABORTED;case uh.OUT_OF_RANGE:return el.OUT_OF_RANGE;case uh.UNIMPLEMENTED:return el.UNIMPLEMENTED;case uh.DATA_LOSS:return el.DATA_LOSS;default:return Xo(39323,{code:e})}}(dh=uh||(uh={}))[dh.OK=0]="OK",dh[dh.CANCELLED=1]="CANCELLED",dh[dh.UNKNOWN=2]="UNKNOWN",dh[dh.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",dh[dh.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",dh[dh.NOT_FOUND=5]="NOT_FOUND",dh[dh.ALREADY_EXISTS=6]="ALREADY_EXISTS",dh[dh.PERMISSION_DENIED=7]="PERMISSION_DENIED",dh[dh.UNAUTHENTICATED=16]="UNAUTHENTICATED",dh[dh.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",dh[dh.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",dh[dh.ABORTED=10]="ABORTED",dh[dh.OUT_OF_RANGE=11]="OUT_OF_RANGE",dh[dh.UNIMPLEMENTED=12]="UNIMPLEMENTED",dh[dh.INTERNAL=13]="INTERNAL",dh[dh.UNAVAILABLE=14]="UNAVAILABLE",dh[dh.DATA_LOSS=15]="DATA_LOSS";let ph=null;function gh(){return new TextEncoder}const mh=new Co([4294967295,4294967295],0);function vh(e){const t=gh().encode(e),n=new _o;return n.update(t),new Uint8Array(n.digest())}function yh(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Co([n,r],0),new Co([s,i],0)]}class bh{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Eh("Invalid padding: ".concat(t));if(n<0)throw new Eh("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new Eh("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new Eh("Invalid padding when bitmap length is 0: ".concat(t));this.ge=8*e.length-t,this.pe=Co.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(Co.fromNumber(n)));return 1===r.compare(mh)&&(r=new Co([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=vh(e),[n,r]=yh(t);for(let s=0;s<this.hashCount;s++){const e=this.ye(n,r,s);if(!this.we(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new bh(s,r,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;const t=vh(e),[n,r]=yh(t);for(let s=0;s<this.hashCount;s++){const e=this.ye(n,r,s);this.be(e)}}be(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Eh extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class wh{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Sh.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new wh(Ml.min(),r,new Ac(fl),md(),xd())}}class Sh{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Sh(n,t,xd(),xd(),xd())}}class Th{constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.De=r}}class kh{constructor(e,t){this.targetId=e,this.Ce=t}}class xh{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Fc.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Ih{constructor(){this.ve=0,this.Fe=_h(),this.Me=Fc.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=xd(),t=xd(),n=xd();return this.Fe.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Xo(38017,{changeType:s})}}),new Sh(this.Me,this.xe,e,t,n)}Ke(){this.Oe=!1,this.Fe=_h()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Jo(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Lh{constructor(e){this.Ge=e,this.ze=new Map,this.je=md(),this.He=Ch(),this.Je=Ch(),this.Ze=new Ac(fl)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(e.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.Qe(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:Xo(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(Xu(i))if(0===n){const e=new kl(i.path);this.et(t,e,Tu.newNoDocument(e,Ml.min()))}else Jo(1===n,20013,{expectedCount:n});else{const r=this._t(t);if(r!==n){var s;const n=this.ut(e),i=n?this.ct(n,e,r):1;if(0!==i){this.it(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,e)}null===(s=ph)||void 0===s||s.lt(function(e,t,n,r,s){var i,a,o,l,c;const u={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(u.bloomFilter={applied:0===s,hashCount:null!==(i=null===d||void 0===d?void 0:d.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(a=null===d||void 0===d||null===(o=d.bits)||void 0===o||null===(o=o.bitmap)||void 0===o?void 0:o.length)&&void 0!==a?a:0,padding:null!==(l=null===d||void 0===d||null===(c=d.bits)||void 0===c?void 0:c.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null===r||void 0===r?void 0:r.mightContain(e))&&void 0!==t&&t}}),u}(r,e.Ce,this.Ge.ht(),n,i))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t;let i,a;try{i=Vc(n).toUint8Array()}catch(e){if(e instanceof Mc)return Yo("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new bh(i,r,s)}catch(e){return Yo(e instanceof Eh?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.ge?null:a}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const s=this.Ge.ht(),i="projects/".concat(s.projectId,"/databases/").concat(s.database,"/documents/").concat(n.path.canonicalString());e.mightContain(i)||(this.et(t,n,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((n,r)=>{const s=this.ot(r);if(s){if(n.current&&Xu(s.target)){const t=new kl(s.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,Tu.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.Ke())}});let n=xd();this.Je.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const r=new wh(e,t,this.Ze,this.je,n);return this.je=md(),this.He=Ch(),this.Je=Ch(),this.Ze=new Ac(fl),r}Ye(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,n),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Ih,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new Dc(fl),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new Dc(fl),this.He=this.He.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||Wo("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ih),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ch(){return new Ac(kl.comparator)}function _h(){return new Ac(kl.comparator)}const Ah={asc:"ASCENDING",desc:"DESCENDING"},Rh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ph={and:"AND",or:"OR"};class Dh{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Oh(e,t){return e.useProto3Json||Zl(t)?t:{value:t}}function Nh(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Mh(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Fh(e,t){return Nh(e,t.toTimestamp())}function Uh(e){return Jo(!!e,49232),Ml.fromTimestamp(function(e){const t=jc(e);return new Nl(t.seconds,t.nanos)}(e))}function jh(e,t){return Bh(e,t).canonicalString()}function Bh(e,t){const n=function(e){return new wl(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Vh(e){const t=wl.fromString(e);return Jo(lf(t),10190,{key:t.toString()}),t}function zh(e,t){return jh(e.databaseId,t.path)}function Gh(e,t){const n=Vh(t);if(n.get(1)!==e.databaseId.projectId)throw new tl(el.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new tl(el.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new kl(qh(n))}function Hh(e,t){return jh(e.databaseId,t)}function Kh(e){const t=Vh(e);return 4===t.length?wl.emptyPath():qh(t)}function Wh(e){return new wl(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function qh(e){return Jo(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Yh(e,t,n){return{name:zh(e,t),fields:n.value.mapValue.fields}}function Qh(e,t){let n;if(t instanceof $d)n={update:Yh(e,t.key,t.value)};else if(t instanceof sh)n={delete:zh(e,t.key)};else if(t instanceof eh)n={update:Yh(e,t.key,t.data),updateMask:of(t.fieldMask)};else{if(!(t instanceof ih))return Xo(16599,{dt:t.type});n={verify:zh(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Nd)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Md)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ud)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Bd)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw Xo(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Fh(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Xo(27497)}(e,t.precondition)),n}function Xh(e,t){return{documents:[Hh(e,t.path)]}}function Zh(e,t){const n={structuredQuery:{}},r=t.path;let s;null!==t.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Hh(e,s);const i=function(e){if(0!==e.length)return af(Ru.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:rf(e.field),direction:ef(e.dir)}}(e))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=Oh(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:s}}function Jh(e){let t=Kh(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Jo(1===r,65062);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=$h(e);return t instanceof Ru&&Du(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>function(e){return new Lu(sf(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,Zl(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new ku(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new ku(n,t)}(n.endAt)),Ju(t,s,a,i,o,"F",l,c)}function $h(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=sf(e.unaryFilter.field);return Au.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=sf(e.unaryFilter.field);return Au.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=sf(e.unaryFilter.field);return Au.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=sf(e.unaryFilter.field);return Au.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Xo(61313);default:return Xo(60726)}}(e):void 0!==e.fieldFilter?function(e){return Au.create(sf(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Xo(58110);default:return Xo(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Ru.create(e.compositeFilter.filters.map(e=>$h(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Xo(1026)}}(e.compositeFilter.op))}(e):Xo(30097,{filter:e})}function ef(e){return Ah[e]}function tf(e){return Rh[e]}function nf(e){return Ph[e]}function rf(e){return{fieldPath:e.canonicalString()}}function sf(e){return Tl.fromServerFormat(e.fieldPath)}function af(e){return e instanceof Au?function(e){if("=="===e.op){if(mu(e.value))return{unaryFilter:{field:rf(e.field),op:"IS_NAN"}};if(gu(e.value))return{unaryFilter:{field:rf(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(mu(e.value))return{unaryFilter:{field:rf(e.field),op:"IS_NOT_NAN"}};if(gu(e.value))return{unaryFilter:{field:rf(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:rf(e.field),op:tf(e.op),value:e.value}}}(e):e instanceof Ru?function(e){const t=e.getFilters().map(e=>af(e));return 1===t.length?t[0]:{compositeFilter:{op:nf(e.op),filters:t}}}(e):Xo(54877,{filter:e})}function of(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function lf(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function cf(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class uf{constructor(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ml.min(),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Ml.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Fc.EMPTY_BYTE_STRING,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new uf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new uf(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new uf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new uf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class df{constructor(e){this.yt=e}}function hf(e){const t=Jh({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ad(t,t.limit,"L"):t}class ff{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Bc(e.integerValue));else if("doubleValue"in e){const n=Bc(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Jl(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=jc(n)),t.xt("".concat(n.seconds||"")),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Vc(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?Eu(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):yu(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):Xo(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){const n=e.fields||{};this.Ft(t,55);for(const r of Object.keys(n))this.Ot(r,t),this.Ct(n[r],t)}kt(e,t){var n;const r=e.fields||{};this.Ft(t,53);const s=nu,i=(null===(n=r[s].arrayValue)||void 0===n||null===(n=n.values)||void 0===n?void 0:n.length)||0;this.Ft(t,15),t.Mt(Bc(i)),this.Ot(s,t),this.Ct(r[s],t)}qt(e,t){const n=e.values||[];this.Ft(t,50);for(const r of n)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),kl.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}ff.Wt=new ff;class pf{constructor(){this.Sn=new gf}addToCollectionParentIndex(e,t){return this.Sn.add(t),Wl.resolve()}getCollectionParents(e,t){return Wl.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return Wl.resolve()}deleteFieldIndex(e,t){return Wl.resolve()}deleteAllFieldIndexes(e){return Wl.resolve()}createTargetIndexes(e,t){return Wl.resolve()}getDocumentsMatchingTarget(e,t){return Wl.resolve(null)}getIndexType(e,t){return Wl.resolve(0)}getFieldIndexes(e,t){return Wl.resolve([])}getNextCollectionGroupToUpdate(e){return Wl.resolve(null)}getMinOffset(e,t){return Wl.resolve(Vl.min())}getMinOffsetFromCollectionGroup(e,t){return Wl.resolve(Vl.min())}updateCollectionGroup(e,t,n){return Wl.resolve()}updateIndexEntries(e,t){return Wl.resolve()}}class gf{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Dc(wl.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Dc(wl.comparator)).toArray()}}new Uint8Array(0);const mf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},vf=41943040;class yf{static withCacheSize(e){return new yf(e,yf.DEFAULT_COLLECTION_PERCENTILE,yf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}yf.DEFAULT_COLLECTION_PERCENTILE=10,yf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yf.DEFAULT=new yf(vf,yf.DEFAULT_COLLECTION_PERCENTILE,yf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yf.DISABLED=new yf(-1,0,0);class bf{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new bf(0)}static ar(){return new bf(-1)}}const Ef="LruGarbageCollector",wf=1048576;function Sf(e,t){let[n,r]=e,[s,i]=t;const a=fl(n,s);return 0===a?fl(r,i):a}class Tf{constructor(e){this.Pr=e,this.buffer=new Dc(Sf),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Sf(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class kf{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){Wo(Ef,"Garbage collection scheduled in ".concat(e,"ms")),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Yl(e)?Wo(Ef,"Ignoring IndexedDB error during garbage collection: ",e):await Kl(e)}await this.Ar(3e5)})}}class xf{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Wl.resolve(Ql.ce);const n=new Tf(t);return this.Vr.forEachTarget(e,e=>n.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>n.Er(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Wo("LruGarbageCollector","Garbage collection skipped; disabled"),Wl.resolve(mf)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(Wo("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),mf):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let n,r,s,i,a,o,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(Wo("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=this.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(s=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),Ko()<=xn.DEBUG&&Wo("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(i-c,"ms\n\tDetermined least recently used ").concat(r," in ")+(a-i)+"ms\n"+"\tRemoved ".concat(s," targets in ")+(o-a)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(l-o)+"ms\n"+"Total Duration: ".concat(l-c,"ms")),Wl.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:e})))}}function If(e,t){return new xf(e,t)}class Lf{constructor(){this.changes=new pd(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Tu.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Wl.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Cf{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class _f{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Xd(n.mutation,e,Nc.empty(),Nl.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,xd()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xd();const r=Ed();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=yd();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Ed();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,xd()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let s=md();const i=Sd(),a=Sd();return t.forEach((e,t)=>{const a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof eh)?s=s.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),Xd(a.mutation,t,a.mutation.getFieldMask(),Nl.now())):i.set(t.key,Nc.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new Cf(t,null!==(n=i.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){const n=Sd();let r=new Ac((e,t)=>e-t),s=xd();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let a=n.get(e)||Nc.empty();a=s.applyToLocalView(i,a),n.set(e,a);const o=(r.get(s.batchId)||xd()).add(e);r=r.insert(s.batchId,o)})}).next(()=>{const i=[],a=r.getReverseIterator();for(;a.hasNext();){const r=a.getNext(),o=r.key,l=r.value,c=wd();l.forEach(e=>{if(!s.has(e)){const r=Yd(t.get(e),n.get(e));null!==r&&c.set(e,r),s=s.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,o,c))}return Wl.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return kl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):td(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):Wl.resolve(Ed());let a=Fl,o=s;return i.next(t=>Wl.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),s.get(t)?Wl.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,o,t,xd())).next(e=>({batchId:a,changes:bd(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new kl(t)).next(e=>{let t=yd();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const s=t.collectionGroup;let i=yd();return this.indexManager.getCollectionParents(e,s).next(a=>Wl.forEach(a,a=>{const o=function(e,t){return new Zu(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(s));return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r))).next(e=>{s.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Tu.newInvalidDocument(r)))});let n=yd();return e.forEach((e,r)=>{const i=s.get(e);void 0!==i&&Xd(i.mutation,r,Nc.empty(),Nl.now()),ud(t,r)&&(n=n.insert(e,r))}),n})}}class Af{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return Wl.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Uh(e.createTime)}}(t)),Wl.resolve()}getNamedQuery(e,t){return Wl.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(e){return{name:e.name,query:hf(e.bundledQuery),readTime:Uh(e.readTime)}}(t)),Wl.resolve()}}class Rf{constructor(){this.overlays=new Ac(kl.comparator),this.Lr=new Map}getOverlay(e,t){return Wl.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ed();return Wl.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.bt(e,t,r)}),Wl.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Lr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(n)),Wl.resolve()}getOverlaysForCollection(e,t,n){const r=Ed(),s=t.length+1,i=new kl(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Wl.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new Ac((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=Ed(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=Ed(),o=s.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return Wl.resolve(a)}bt(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Lr.get(r.largestBatchId).delete(n.key);this.Lr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new lh(t,n));let s=this.Lr.get(t);void 0===s&&(s=xd(),this.Lr.set(t,s)),this.Lr.set(t,s.add(n.key))}}class Pf{constructor(){this.sessionToken=Fc.EMPTY_BYTE_STRING}getSessionToken(e){return Wl.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Wl.resolve()}}class Df{constructor(){this.kr=new Dc(Of.Kr),this.qr=new Dc(Of.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const n=new Of(e,t);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new Of(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){const t=new kl(new wl([])),n=new Of(t,e),r=new Of(t,e+1),s=[];return this.qr.forEachInRange([n,r],e=>{this.Wr(e),s.push(e.key)}),s}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new kl(new wl([])),n=new Of(t,e),r=new Of(t,e+1);let s=xd();return this.qr.forEachInRange([n,r],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new Of(e,0),n=this.kr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Of{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return kl.comparator(e.key,t.key)||fl(e.Hr,t.Hr)}static Ur(e,t){return fl(e.Hr,t.Hr)||kl.comparator(e.key,t.key)}}class Nf{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new Dc(Of.Kr)}checkEmpty(e){return Wl.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new ah(s,t,n,r);this.mutationQueue.push(i);for(const a of r)this.Jr=this.Jr.add(new Of(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Wl.resolve(i)}lookupMutationBatch(e,t){return Wl.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Xr(n),s=r<0?0:r;return Wl.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Wl.resolve(0===this.mutationQueue.length?Xl:this.Yn-1)}getAllMutationBatches(e){return Wl.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Of(t,0),r=new Of(t,Number.POSITIVE_INFINITY),s=[];return this.Jr.forEachInRange([n,r],e=>{const t=this.Zr(e.Hr);s.push(t)}),Wl.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Dc(fl);return t.forEach(e=>{const t=new Of(e,0),r=new Of(e,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([t,r],e=>{n=n.add(e.Hr)})}),Wl.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;kl.isDocumentKey(s)||(s=s.child(""));const i=new Of(new kl(s),0);let a=new Dc(fl);return this.Jr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Hr)),!0)},i),Wl.resolve(this.Yr(a))}Yr(e){const t=[];return e.forEach(e=>{const n=this.Zr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){Jo(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Jr;return Wl.forEach(t.mutations,r=>{const s=new Of(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Jr=n})}nr(e){}containsKey(e,t){const n=new Of(t,0),r=this.Jr.firstAfterOrEqual(n);return Wl.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Wl.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Mf{constructor(e){this.ti=e,this.docs=new Ac(kl.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.ti(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Wl.resolve(n?n.document.mutableCopy():Tu.newInvalidDocument(t))}getEntries(e,t){let n=md();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Tu.newInvalidDocument(e))}),Wl.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=md();const i=t.path,a=new kl(i.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||zl(Bl(a),n)<=0||(r.has(a.key)||ud(t,a))&&(s=s.insert(a.key,a.mutableCopy()))}return Wl.resolve(s)}getAllFromCollectionGroup(e,t,n,r){Xo(9500)}ni(e,t){return Wl.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Ff(this)}getSize(e){return Wl.resolve(this.size)}}class Ff extends Lf{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(n)}),Wl.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class Uf{constructor(e){this.persistence=e,this.ri=new pd(e=>Yu(e),Qu),this.lastRemoteSnapshotVersion=Ml.min(),this.highestTargetId=0,this.ii=0,this.si=new Df,this.targetCount=0,this.oi=bf._r()}forEachTarget(e,t){return this.ri.forEach((e,n)=>t(n)),Wl.resolve()}getLastRemoteSnapshotVersion(e){return Wl.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Wl.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),Wl.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ii&&(this.ii=t),Wl.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new bf(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,Wl.resolve()}updateTargetData(e,t){return this.lr(t),Wl.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,Wl.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.ri.forEach((i,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.ri.delete(i),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),Wl.waitFor(s).next(()=>r)}getTargetCount(e){return Wl.resolve(this.targetCount)}getTargetData(e,t){const n=this.ri.get(t)||null;return Wl.resolve(n)}addMatchingKeys(e,t,n){return this.si.$r(t,n),Wl.resolve()}removeMatchingKeys(e,t,n){this.si.Qr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(t=>{s.push(r.markPotentiallyOrphaned(e,t))}),Wl.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),Wl.resolve()}getMatchingKeysForTargetId(e,t){const n=this.si.jr(t);return Wl.resolve(n)}containsKey(e,t){return Wl.resolve(this.si.containsKey(t))}}class jf{constructor(e,t){this._i={},this.overlays={},this.ai=new Ql(0),this.ui=!1,this.ui=!0,this.ci=new Pf,this.referenceDelegate=e(this),this.li=new Uf(this),this.indexManager=new pf,this.remoteDocumentCache=function(e){return new Mf(e)}(e=>this.referenceDelegate.hi(e)),this.serializer=new df(t),this.Pi=new Af(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Rf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this._i[e.toKey()];return n||(n=new Nf(t,this.referenceDelegate),this._i[e.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,n){Wo("MemoryPersistence","Starting transaction:",e);const r=new Bf(this.ai.next());return this.referenceDelegate.Ti(),n(r).next(e=>this.referenceDelegate.Ii(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ei(e,t){return Wl.or(Object.values(this._i).map(n=>()=>n.containsKey(e,t)))}}class Bf extends Hl{constructor(e){super(),this.currentSequenceNumber=e}}class Vf{constructor(e){this.persistence=e,this.Ri=new Df,this.Ai=null}static Vi(e){return new Vf(e)}get di(){if(this.Ai)return this.Ai;throw Xo(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.di.delete(n.toString()),Wl.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.di.add(n.toString()),Wl.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),Wl.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Wl.forEach(this.di,n=>{const r=kl.fromPath(n);return this.mi(e,r).next(e=>{e||t.removeEntry(r,Ml.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return Wl.or([()=>Wl.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class zf{constructor(e,t){this.persistence=e,this.fi=new pd(e=>tc(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=If(this,t)}static Vi(e,t){return new zf(e,t)}Ti(){}Ii(e){return Wl.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return Wl.forEach(this.fi,(n,r)=>this.wr(e,n,r).next(e=>e?Wl.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ni(e,r=>this.wr(e,r,t).next(e=>{e||(n++,s.removeEntry(r,Ml.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),Wl.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),Wl.resolve()}removeReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),Wl.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),Wl.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=du(e.data.value)),t}wr(e,t,n){return Wl.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.fi.get(t);return Wl.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Gf{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ts=n,this.Is=r}static Es(e,t){let n=xd(),r=xd();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Gf(e,t.fromCache,n,r)}}class Hf{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Kf{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=on()?8:ql(sn())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const s={result:null};return this.gs(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ps(e,t,r,n).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const n=new Hf;return this.ys(e,t,n).next(r=>{if(s.result=r,this.As)return this.ws(e,t,n,r.size)})}).next(()=>s.result)}ws(e,t,n,r){return n.documentReadCount<this.Vs?(Ko()<=xn.DEBUG&&Wo("QueryEngine","SDK will not create cache indexes for query:",cd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),Wl.resolve()):(Ko()<=xn.DEBUG&&Wo("QueryEngine","Query:",cd(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ds*r?(Ko()<=xn.DEBUG&&Wo("QueryEngine","The SDK decides to create cache indexes for query:",cd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rd(t))):Wl.resolve())}gs(e,t){if(ed(t))return Wl.resolve(null);let n=rd(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=ad(t,null,"F"),n=rd(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const s=xd(...r);return this.fs.getDocuments(e,s).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const i=this.bs(t,r);return this.Ss(t,i,s,n.readTime)?this.gs(e,ad(t,null,"F")):this.Ds(e,i,t,n)}))})))}ps(e,t,n,r){return ed(t)||r.isEqual(Ml.min())?Wl.resolve(null):this.fs.getDocuments(e,n).next(s=>{const i=this.bs(t,s);return this.Ss(t,i,n,r)?Wl.resolve(null):(Ko()<=xn.DEBUG&&Wo("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),cd(t)),this.Ds(e,i,t,jl(r,Fl)).next(e=>e))})}bs(e,t){let n=new Dc(hd(e));return t.forEach((t,r)=>{ud(e,r)&&(n=n.add(r))}),n}Ss(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}ys(e,t,n){return Ko()<=xn.DEBUG&&Wo("QueryEngine","Using full collection scan to execute query:",cd(t)),this.fs.getDocumentsMatchingQuery(e,t,Vl.min(),n)}Ds(e,t,n,r){return this.fs.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const Wf="LocalStore";class qf{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new Ac(fl),this.Fs=new pd(e=>Yu(e),Qu),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(n)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _f(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function Yf(e,t,n,r){return new qf(e,t,n,r)}async function Qf(e,t){const n=$o(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(s=>(r=s,n.Os(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],i=[];let a=xd();for(const e of r){s.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({Ns:e,removedBatchIds:s,addedBatchIds:i}))})})}function Xf(e){const t=$o(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.li.getLastRemoteSnapshotVersion(e))}function Zf(e,t,n){let r=xd(),s=xd();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=md();return n.forEach((n,i)=>{const a=e.get(n);i.isFoundDocument()!==a.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Ml.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):Wo(Wf,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",i.version)}),{Bs:r,Ls:s}})}function Jf(e,t){const n=$o(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=Xl),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function $f(e,t){const n=$o(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.li.getTargetData(e,t).next(s=>s?(r=s,Wl.resolve(r)):n.li.allocateTargetId(e).next(s=>(r=new uf(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.li.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.vs.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.vs=n.vs.insert(e.targetId,e),n.Fs.set(t,e.targetId)),e})}async function ep(e,t,n){const r=$o(e),s=r.vs.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!Yl(e))throw e;Wo(Wf,"Failed to update sequence numbers for target ".concat(t,": ").concat(e))}r.vs=r.vs.remove(t),r.Fs.delete(s.target)}function tp(e,t,n){const r=$o(e);let s=Ml.min(),i=xd();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=$o(e),s=r.Fs.get(n);return void 0!==s?Wl.resolve(r.vs.get(s)):r.li.getTargetData(t,n)}(r,e,rd(t)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>r.Cs.getDocumentsMatchingQuery(e,t,n?s:Ml.min(),n?i:xd())).next(e=>(np(r,dd(t),e),{documents:e,ks:i})))}function np(e,t,n){let r=e.Ms.get(t)||Ml.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Ms.set(t,r)}class rp{constructor(){this.activeTargetIds=Ld()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sp{constructor(){this.vo=new rp,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,n){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new rp,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ip{Mo(e){}shutdown(){}}const ap="ConnectivityMonitor";class op{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){Wo(ap,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){Wo(ap,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lp=null;function cp(){return null===lp?lp=268435456+Math.round(2147483648*Math.random()):lp++,"0x"+lp.toString(16)}const up="RestConnection",dp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class hp{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo="projects/".concat(n,"/databases/").concat(r),this.$o=this.databaseId.database===Xc?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}Wo(e,t,n,r,s){const i=cp(),a=this.Qo(e,t.toUriEncodedString());Wo(up,"Sending RPC '".concat(e,"' ").concat(i,":"),a,n);const o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,r,s);const{host:l}=new URL(a),c=Jt(l);return this.zo(e,a,o,n,c).then(t=>(Wo(up,"Received RPC '".concat(e,"' ").concat(i,": "),t),t),t=>{throw Yo(up,"RPC '".concat(e,"' ").concat(i," failed with error: "),t,"url: ",a,"request:",n),t})}jo(e,t,n,r,s,i){return this.Wo(e,t,n,r,s)}Go(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Go,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Qo(e,t){const n=dp[e];let r="".concat(this.qo,"/v1/").concat(t,":").concat(n);return this.databaseInfo.apiKey&&(r="".concat(r,"?key=").concat(encodeURIComponent(this.databaseInfo.apiKey))),r}terminate(){}}class fp{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const pp="WebChannelConnection",gp=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};class mp extends hp{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!mp.c_){const e=Uo();gp(e,Fo.STAT_EVENT,e=>{e.stat===Mo.PROXY?Wo(pp,"STAT_EVENT: detected buffering proxy"):e.stat===Mo.NOPROXY&&Wo(pp,"STAT_EVENT: detected no buffering proxy")}),mp.c_=!0}}zo(e,t,n,r,s){const i=cp();return new Promise((s,a)=>{const o=new Po;o.setWithCredentials(!0),o.listenOnce(Oo.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case No.NO_ERROR:const n=o.getResponseJson();Wo(pp,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(n)),s(n);break;case No.TIMEOUT:Wo(pp,"RPC '".concat(e,"' ").concat(i," timed out")),a(new tl(el.DEADLINE_EXCEEDED,"Request time out"));break;case No.HTTP_ERROR:const r=o.getStatus();if(Wo(pp,"RPC '".concat(e,"' ").concat(i," failed with status:"),r,"response text:",o.getResponseText()),r>0){var t;let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const n=null===(t=e)||void 0===t?void 0:t.error;if(n&&n.status&&n.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(el).indexOf(t)>=0?t:el.UNKNOWN}(n.status);a(new tl(e,n.message))}else a(new tl(el.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new tl(el.UNAVAILABLE,"Connection failed."));break;default:Xo(9055,{l_:e,streamId:i,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{Wo(pp,"RPC '".concat(e,"' ").concat(i," completed."))}});const l=JSON.stringify(r);Wo(pp,"RPC '".concat(e,"' ").concat(i," sending request:"),r),o.send(t,"POST",l,n,15)})}T_(e,t,n){const r=cp(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(a.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=s.join("");Wo(pp,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(l),a);const c=i.createWebChannel(l,a);this.I_(c);let u=!1,d=!1;const h=new fp({Ho:t=>{d?Wo(pp,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(u||(Wo(pp,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),c.open(),u=!0),Wo(pp,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),c.send(t))},Jo:()=>c.close()});return gp(c,Do.EventType.OPEN,()=>{d||(Wo(pp,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),h.i_())}),gp(c,Do.EventType.CLOSE,()=>{d||(d=!0,Wo(pp,"RPC '".concat(e,"' stream ").concat(r," transport closed")),h.o_(),this.E_(c))}),gp(c,Do.EventType.ERROR,t=>{d||(d=!0,Yo(pp,"RPC '".concat(e,"' stream ").concat(r," transport errored. Name:"),t.name,"Message:",t.message),h.o_(new tl(el.UNAVAILABLE,"The operation could not be completed")))}),gp(c,Do.EventType.MESSAGE,t=>{if(!d){var n;const s=t.data[0];Jo(!!s,16349);const i=s,a=(null===i||void 0===i?void 0:i.error)||(null===(n=i[0])||void 0===n?void 0:n.error);if(a){Wo(pp,"RPC '".concat(e,"' stream ").concat(r," received error:"),a);const t=a.status;let n=function(e){const t=uh[e];if(void 0!==t)return fh(t)}(t),s=a.message;"NOT_FOUND"===t&&s.includes("database")&&s.includes("does not exist")&&s.includes(this.databaseId.database)&&Yo("Database '".concat(this.databaseId.database,"' not found. Please check your project configuration.")),void 0===n&&(n=el.INTERNAL,s="Unknown error status: "+t+" with message "+a.message),d=!0,h.o_(new tl(n,s)),c.close()}else Wo(pp,"RPC '".concat(e,"' stream ").concat(r," received:"),s),h.__(s)}}),mp.u_(),setTimeout(()=>{h.s_()},0),h}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,n){super.Go(e,t,n),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return jo()}}function vp(e){return new mp(e)}function yp(){return"undefined"!=typeof document?document:null}function bp(e){return new Dh(e,!0)}mp.c_=!1;class Ep{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Ci=e,this.timerId=t,this.R_=n,this.A_=r,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&Wo("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.d_," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const wp="PersistentStream";class Sp{constructor(e,t,n,r,s,i,a,o){this.Ci=e,this.b_=n,this.S_=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ep(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===el.RESOURCE_EXHAUSTED?(qo(t.toString()),qo("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===el.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,r]=e;this.D_===t&&this.G_(n,r)},t=>{e(()=>{const e=new tl(el.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.Yo(()=>{n(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Wo(wp,"close with error: ".concat(e)),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(Wo(wp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Tp extends Sp{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Xo(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(Jo(void 0===t||"string"==typeof t,58123),Fc.fromBase64String(t||"")):(Jo(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Fc.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?el.UNKNOWN:fh(e.code);return new tl(t,e.message||"")}(a);n=new xh(r,s,i,o||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Gh(e,r.document.name),i=Uh(r.document.updateTime),a=r.document.createTime?Uh(r.document.createTime):Ml.min(),o=new wu({mapValue:{fields:r.document.fields}}),l=Tu.newFoundDocument(s,i,a,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Th(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Gh(e,r.document),i=r.readTime?Uh(r.readTime):Ml.min(),a=Tu.newNoDocument(s,i),o=r.removedTargetIds||[];n=new Th([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Gh(e,r.document),i=r.removedTargetIds||[];n=new Th([],i,s,null)}else{if(!("filter"in t))return Xo(11601,{Vt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:s}=e,i=new ch(r,s),a=e.targetId;n=new kh(a,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Ml.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Ml.min():t.readTime?Uh(t.readTime):Ml.min()}(e);return this.listener.J_(t,n)}Z_(e){const t={};t.database=Wh(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Xu(r)?{documents:Xh(e,r)}:{query:Zh(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Mh(e,t.resumeToken);const r=Oh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Ml.min())>0){n.readTime=Nh(e,t.snapshotVersion.toTimestamp());const r=Oh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xo(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.K_(t)}X_(e){const t={};t.database=Wh(this.serializer),t.removeTarget=e,this.K_(t)}}class kp extends Sp{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Jo(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Jo(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){Jo(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(Jo(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?Uh(e.updateTime):Uh(t);return n.isEqual(Ml.min())&&(n=Uh(t)),new Hd(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Uh(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Wh(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>Qh(this.serializer,e))};this.K_(t)}}class xp{}class Ip extends xp{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new tl(el.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[i,a]=s;return this.connection.Wo(e,Bh(t,n),r,i,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===el.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tl(el.UNKNOWN,e.toString())})}jo(e,t,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[a,o]=i;return this.connection.jo(e,Bh(t,n),r,a,o,s)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===el.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tl(el.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function Lp(e,t,n,r){return new Ip(e,t,n,r)}class Cp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(qo(t),this.aa=!1):Wo("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const _p="RemoteStore";class Ap{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo(e=>{n.enqueueAndForget(async()=>{jp(this)&&(Wo(_p,"Restarting streams for network reachability change."),await async function(e){const t=$o(e);t.Ea.add(4),await Pp(t),t.Va.set("Unknown"),t.Ea.delete(4),await Rp(t)}(this))})}),this.Va=new Cp(n,r)}}async function Rp(e){if(jp(e))for(const t of e.Ra)await t(!0)}async function Pp(e){for(const t of e.Ra)await t(!1)}function Dp(e,t){const n=$o(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),Up(n)?Fp(n):sg(n).O_()&&Np(n,t))}function Op(e,t){const n=$o(e),r=sg(n);n.Ia.delete(t),r.O_()&&Mp(n,t),0===n.Ia.size&&(r.O_()?r.L_():jp(n)&&n.Va.set("Unknown"))}function Np(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Ml.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}sg(e).Z_(t)}function Mp(e,t){e.da.$e(t),sg(e).X_(t)}function Fp(e){e.da=new Lh({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),sg(e).start(),e.Va.ua()}function Up(e){return jp(e)&&!sg(e).x_()&&e.Ia.size>0}function jp(e){return 0===$o(e).Ea.size}function Bp(e){e.da=void 0}async function Vp(e){e.Va.set("Online")}async function zp(e){e.Ia.forEach((t,n)=>{Np(e,t)})}async function Gp(e,t){Bp(e),Up(e)?(e.Va.ha(t),Fp(e)):e.Va.set("Unknown")}async function Hp(e,t,n){if(e.Va.set("Online"),t instanceof xh&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.da.removeTarget(r))}(e,t)}catch(n){Wo(_p,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Kp(e,n)}else if(t instanceof Th?e.da.Xe(t):t instanceof kh?e.da.st(t):e.da.tt(t),!n.isEqual(Ml.min()))try{const t=await Xf(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.da.Tt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.Ia.get(r);s&&e.Ia.set(r,s.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(Fc.EMPTY_BYTE_STRING,r.snapshotVersion)),Mp(e,t);const s=new uf(r.target,t,n,r.sequenceNumber);Np(e,s)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Wo(_p,"Failed to raise snapshot:",t),await Kp(e,t)}}async function Kp(e,t,n){if(!Yl(t))throw t;e.Ea.add(1),await Pp(e),e.Va.set("Offline"),n||(n=()=>Xf(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Wo(_p,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await Rp(e)})}function Wp(e,t){return t().catch(n=>Kp(e,n,t))}async function qp(e){const t=$o(e),n=ig(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Xl;for(;Yp(t);)try{const e=await Jf(t.localStore,r);if(null===e){0===t.Ta.length&&n.L_();break}r=e.batchId,Qp(t,e)}catch(e){await Kp(t,e)}Xp(t)&&Zp(t)}function Yp(e){return jp(e)&&e.Ta.length<10}function Qp(e,t){e.Ta.push(t);const n=ig(e);n.O_()&&n.Y_&&n.ea(t.mutations)}function Xp(e){return jp(e)&&!ig(e).x_()&&e.Ta.length>0}function Zp(e){ig(e).start()}async function Jp(e){ig(e).ra()}async function $p(e){const t=ig(e);for(const n of e.Ta)t.ea(n.mutations)}async function eg(e,t,n){const r=e.Ta.shift(),s=oh.from(r,t,n);await Wp(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await qp(e)}async function tg(e,t){t&&ig(e).Y_&&await async function(e,t){if(function(e){return hh(e)&&e!==el.ABORTED}(t.code)){const n=e.Ta.shift();ig(e).B_(),await Wp(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await qp(e)}}(e,t),Xp(e)&&Zp(e)}async function ng(e,t){const n=$o(e);n.asyncQueue.verifyOperationInProgress(),Wo(_p,"RemoteStore received new credentials");const r=jp(n);n.Ea.add(3),await Pp(n),r&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await Rp(n)}async function rg(e,t){const n=$o(e);t?(n.Ea.delete(2),await Rp(n)):t||(n.Ea.add(2),await Pp(n),n.Va.set("Unknown"))}function sg(e){return e.ma||(e.ma=function(e,t,n){const r=$o(e);return r.sa(),new Tp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:Vp.bind(null,e),Yo:zp.bind(null,e),t_:Gp.bind(null,e),J_:Hp.bind(null,e)}),e.Ra.push(async t=>{t?(e.ma.B_(),Up(e)?Fp(e):e.Va.set("Unknown")):(await e.ma.stop(),Bp(e))})),e.ma}function ig(e){return e.fa||(e.fa=function(e,t,n){const r=$o(e);return r.sa(),new kp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:()=>Promise.resolve(),Yo:Jp.bind(null,e),t_:tg.bind(null,e),ta:$p.bind(null,e),na:eg.bind(null,e)}),e.Ra.push(async t=>{t?(e.fa.B_(),await qp(e)):(await e.fa.stop(),e.Ta.length>0&&(Wo(_p,"Stopping write stream with ".concat(e.Ta.length," pending writes")),e.Ta=[]))})),e.fa}class ag{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new nl,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,a=new ag(e,t,i,r,s);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tl(el.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function og(e,t){if(qo("AsyncQueue","".concat(t,": ").concat(e)),Yl(e))return new tl(el.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class lg{static emptySet(e){return new lg(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||kl.comparator(t.key,n.key):(e,t)=>kl.comparator(e.key,t.key),this.keyedMap=yd(),this.sortedSet=new Ac(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof lg))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new lg;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class cg{constructor(){this.ga=new Ac(kl.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Xo(63341,{Vt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class ug{constructor(e,t,n,r,s,i,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new ug(e,t,lg.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&od(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class dg{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class hg{constructor(){this.queries=fg(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=$o(e),r=n.queries;n.queries=fg(),r.forEach((e,n)=>{for(const r of n.ba)r.onError(t)})}(this,new tl(el.ABORTED,"Firestore shutting down"))}}function fg(){return new pd(e=>ld(e),od)}async function pg(e,t){const n=$o(e);let r=3;const s=t.query;let i=n.queries.get(s);i?!i.Sa()&&t.Da()&&(r=2):(i=new dg,r=t.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(e){const n=og(e,"Initialization of query '".concat(cd(t.query),"' failed"));return void t.onError(n)}n.queries.set(s,i),i.ba.push(t),t.va(n.onlineState),i.wa&&t.Fa(i.wa)&&yg(n)}async function gg(e,t){const n=$o(e),r=t.query;let s=3;const i=n.queries.get(r);if(i){const e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?s=t.Da()?0:1:!i.Sa()&&t.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function mg(e,t){const n=$o(e);let r=!1;for(const s of t){const e=s.query,t=n.queries.get(e);if(t){for(const e of t.ba)e.Fa(s)&&(r=!0);t.wa=s}}r&&yg(n)}function vg(e,t,n){const r=$o(e),s=r.queries.get(t);if(s)for(const i of s.ba)i.onError(n);r.queries.delete(t)}function yg(e){e.Ca.forEach(e=>{e.next()})}var bg,Eg;(Eg=bg||(bg={})).Ma="default",Eg.Cache="cache";class wg{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ug(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.Ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=ug.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==bg.Cache}}class Sg{constructor(e){this.key=e}}class Tg{constructor(e){this.key=e}}class kg{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=xd(),this.mutatedKeys=xd(),this.eu=hd(e),this.tu=new lg(this.eu)}get nu(){return this.Za}ru(e,t){const n=t?t.iu:new cg,r=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,i=r,a=!1;const o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),u=ud(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),f=!0):this.su(c,u)||(n.track({type:2,doc:u}),f=!0,(o&&this.eu(u,o)>0||l&&this.eu(u,l)<0)&&(a=!0)):!c&&u?(n.track({type:0,doc:u}),f=!0):c&&!u&&(n.track({type:1,doc:c}),f=!0,(o||l)&&(a=!0)),f&&(u?(i=i.add(u),s=h?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{tu:i,iu:n,Ss:a,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xo(20277,{Vt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),r=null!==r&&void 0!==r&&r;const a=t&&!r?this._u():[],o=0===this.Ya.size&&this.current&&!r?1:0,l=o!==this.Xa;return this.Xa=o,0!==i.length||l?{snapshot:new ug(this.query,e.tu,s,i,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new cg,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=xd(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});const t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new Tg(e))}),this.Ya.forEach(n=>{e.has(n)||t.push(new Sg(n))}),t}cu(e){this.Za=e.ks,this.Ya=xd();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ug.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}const xg="SyncEngine";class Ig{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Lg{constructor(e){this.key=e,this.hu=!1}}class Cg{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new pd(e=>ld(e),od),this.Iu=new Map,this.Eu=new Set,this.Ru=new Ac(kl.comparator),this.Au=new Map,this.Vu=new Df,this.du={},this.mu=new Map,this.fu=bf.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function _g(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=Xg(e);let s;const i=r.Tu.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await Rg(r,t,n,!0),s}async function Ag(e,t){const n=Xg(e);await Rg(n,t,!0,!1)}async function Rg(e,t,n,r){const s=await $f(e.localStore,rd(t)),i=s.targetId,a=e.sharedClientState.addLocalQueryTarget(i,n);let o;return r&&(o=await Pg(e,t,i,"current"===a,s.resumeToken)),e.isPrimaryClient&&n&&Dp(e.remoteStore,s),o}async function Pg(e,t,n,r,s){e.pu=(t,n,r)=>async function(e,t,n,r){let s=t.view.ru(n);s.Ss&&(s=await tp(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ru(n,s)}));const i=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(s,e.isPrimaryClient,i,a);return Hg(e,t.targetId,o.au),o.snapshot}(e,t,n,r);const i=await tp(e.localStore,t,!0),a=new kg(t,i.ks),o=a.ru(i.documents),l=Sh.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,s),c=a.applyChanges(o,e.isPrimaryClient,l);Hg(e,n,c.au);const u=new Ig(t,n,a);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),c.snapshot}async function Dg(e,t,n){const r=$o(e),s=r.Tu.get(t),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(e=>!od(e,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ep(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Op(r.remoteStore,s.targetId),zg(r,s.targetId)}).catch(Kl)):(zg(r,s.targetId),await ep(r.localStore,s.targetId,!0))}async function Og(e,t){const n=$o(e),r=n.Tu.get(t),s=n.Iu.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Op(n.remoteStore,r.targetId))}async function Ng(e,t){const n=$o(e);try{const e=await function(e,t){const n=$o(e),r=t.snapshotVersion;let s=n.vs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=n.xs.newChangeBuffer({trackRemovals:!0});s=n.vs;const a=[];t.targetChanges.forEach((i,o)=>{const l=s.get(o);if(!l)return;a.push(n.li.removeMatchingKeys(e,i.removedDocuments,o).next(()=>n.li.addMatchingKeys(e,i.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(Fc.EMPTY_BYTE_STRING,Ml.min()).withLastLimboFreeSnapshotVersion(Ml.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,r)),s=s.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(l,c,i)&&a.push(n.li.updateTargetData(e,c))});let o=md(),l=xd();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(Zf(e,i,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!r.isEqual(Ml.min())){const t=n.li.getLastRemoteSnapshotVersion(e).next(t=>n.li.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return Wl.waitFor(a).next(()=>i.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.vs=s,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Au.get(t);r&&(Jo(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?Jo(r.hu,14607):e.removedDocuments.size>0&&(Jo(r.hu,42227),r.hu=!1))}),await qg(n,e,t)}catch(e){await Kl(e)}}function Mg(e,t,n){const r=$o(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Tu.forEach((n,r)=>{const s=r.view.va(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const n=$o(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const s of n.ba)s.va(t)&&(r=!0)}),r&&yg(n)}(r.eventManager,t),e.length&&r.Pu.J_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Fg(e,t,n){const r=$o(e);r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Au.get(t),i=s&&s.key;if(i){let e=new Ac(kl.comparator);e=e.insert(i,Tu.newNoDocument(i,Ml.min()));const n=xd().add(i),s=new wh(Ml.min(),new Map,new Ac(fl),e,n);await Ng(r,s),r.Ru=r.Ru.remove(i),r.Au.delete(t),Wg(r)}else await ep(r.localStore,t,!1).then(()=>zg(r,t,n)).catch(Kl)}async function Ug(e,t){const n=$o(e),r=t.batch.batchId;try{const e=await function(e,t){const n=$o(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),s=n.xs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const s=n.batch,i=s.keys();let a=Wl.resolve();return i.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{const i=n.docVersions.get(e);Jo(null!==i,48541),t.version.compareTo(i)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(n,e,t,s).next(()=>s.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=xd();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);Vg(n,r,null),Bg(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await qg(n,e)}catch(e){await Kl(e)}}async function jg(e,t,n){const r=$o(e);try{const e=await function(e,t){const n=$o(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(Jo(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);Vg(r,t,n),Bg(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await qg(r,e)}catch(n){await Kl(n)}}function Bg(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function Vg(e,t,n){const r=$o(e);let s=r.du[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.du[r.currentUser.toKey()]=s}}function zg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||Gg(e,t)})}function Gg(e,t){e.Eu.delete(t.path.canonicalString());const n=e.Ru.get(t);null!==n&&(Op(e.remoteStore,n),e.Ru=e.Ru.remove(t),e.Au.delete(n),Wg(e))}function Hg(e,t,n){for(const r of n)r instanceof Sg?(e.Vu.addReference(r.key,t),Kg(e,r)):r instanceof Tg?(Wo(xg,"Document no longer in limbo: "+r.key),e.Vu.removeReference(r.key,t),e.Vu.containsKey(r.key)||Gg(e,r.key)):Xo(19791,{wu:r})}function Kg(e,t){const n=t.key,r=n.path.canonicalString();e.Ru.get(n)||e.Eu.has(r)||(Wo(xg,"New document in limbo: "+n),e.Eu.add(r),Wg(e))}function Wg(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new kl(wl.fromString(t)),r=e.fu.next();e.Au.set(r,new Lg(n)),e.Ru=e.Ru.insert(n,r),Dp(e.remoteStore,new uf(rd($u(n.path)),r,"TargetPurposeLimboResolution",Ql.ce))}}async function qg(e,t,n){const r=$o(e),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((e,o)=>{a.push(r.pu(o,t,n).then(e=>{if((e||n)&&r.isPrimaryClient){var t;const s=e?!e.fromCache:null===n||void 0===n||null===(t=n.targetChanges.get(o.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,s?"current":"not-current")}if(e){s.push(e);const t=Gf.Es(o.targetId,e);i.push(t)}}))}),await Promise.all(a),r.Pu.J_(s),await async function(e,t){const n=$o(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Wl.forEach(t,t=>Wl.forEach(t.Ts,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Wl.forEach(t.Is,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!Yl(e))throw e;Wo(Wf,"Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.vs.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.vs=n.vs.insert(e,s)}}}(r.localStore,i))}async function Yg(e,t){const n=$o(e);if(!n.currentUser.isEqual(t)){Wo(xg,"User change. New user:",t.toKey());const e=await Qf(n.localStore,t);n.currentUser=t,function(e,t){e.mu.forEach(e=>{e.forEach(e=>{e.reject(new tl(el.CANCELLED,t))})}),e.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await qg(n,e.Ns)}}function Qg(e,t){const n=$o(e),r=n.Au.get(t);if(r&&r.hu)return xd().add(r.key);{let e=xd();const r=n.Iu.get(t);if(!r)return e;for(const t of r){const r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function Xg(e){const t=$o(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ng.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Qg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Fg.bind(null,t),t.Pu.J_=mg.bind(null,t.eventManager),t.Pu.yu=vg.bind(null,t.eventManager),t}function Zg(e){const t=$o(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ug.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=jg.bind(null,t),t}class Jg{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=bp(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Yf(this.persistence,new Kf,e.initialUser,this.serializer)}Cu(e){return new jf(Vf.Vi,this.serializer)}Du(e){return new sp}async terminate(){var e,t;null!==(e=this.gcScheduler)&&void 0!==e&&e.stop(),null!==(t=this.indexBackfillerScheduler)&&void 0!==t&&t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Jg.provider={build:()=>new Jg};class $g extends Jg{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Jo(this.persistence.referenceDelegate instanceof zf,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new kf(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?yf.withCacheSize(this.cacheSizeBytes):yf.DEFAULT;return new jf(e=>zf.Vi(e,t),this.serializer)}}class em{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Mg(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Yg.bind(null,this.syncEngine),await rg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new hg}createDatastore(e){const t=bp(e.databaseInfo.databaseId),n=vp(e.databaseInfo);return Lp(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,s){return new Ap(e,t,n,r,s)}(this.localStore,this.datastore,e.asyncQueue,e=>Mg(this.syncEngine,e,0),op.v()?new op:new ip)}createSyncEngine(e,t){return function(e,t,n,r,s,i,a){const o=new Cg(e,t,n,r,s,i);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=$o(e);Wo(_p,"RemoteStore shutting down."),t.Ea.add(5),await Pp(t),t.Aa.shutdown(),t.Va.set("Unknown")}(this.remoteStore),null!==(e=this.datastore)&&void 0!==e&&e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}em.provider={build:()=>new em};class tm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):qo("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const nm="FirestoreClient";class rm{constructor(e,t,n,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this._databaseInfo=r,this.user=zo.UNAUTHENTICATED,this.clientId=hl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,async e=>{Wo(nm,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(Wo(nm,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new nl;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(WE){const n=og(WE,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function sm(e,t){e.asyncQueue.verifyOperationInProgress(),Wo(nm,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Qf(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function im(e,t){e.asyncQueue.verifyOperationInProgress();const n=await am(e);Wo(nm,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>ng(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>ng(t.remoteStore,n)),e._onlineComponents=t}async function am(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Wo(nm,"Using user provided OfflineComponentProvider");try{await sm(e,e._uninitializedComponentsProvider._offline)}catch(WE){const n=WE;if(!function(e){return"FirebaseError"===e.name?e.code===el.FAILED_PRECONDITION||e.code===el.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;Yo("Error using user provided cache. Falling back to memory cache: "+n),await sm(e,new Jg)}}else Wo(nm,"Using default OfflineComponentProvider"),await sm(e,new $g(void 0));return e._offlineComponents}async function om(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Wo(nm,"Using user provided OnlineComponentProvider"),await im(e,e._uninitializedComponentsProvider._online)):(Wo(nm,"Using default OnlineComponentProvider"),await im(e,new em))),e._onlineComponents}function lm(e){return om(e).then(e=>e.syncEngine)}async function cm(e){const t=await om(e),n=t.eventManager;return n.onListen=_g.bind(null,t.syncEngine),n.onUnlisten=Dg.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Ag.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Og.bind(null,t.syncEngine),n}function um(e,t){const n=new nl;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=Zg(e);try{const e=await function(e,t){const n=$o(e),r=Nl.now(),s=t.reduce((e,t)=>e.add(t.key),xd());let i,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=md(),l=xd();return n.xs.getEntries(e,s).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,o)).next(s=>{i=s;const a=[];for(const e of t){const t=Zd(e,i.get(e.key).overlayedDocument);null!=t&&a.push(new eh(e.key,t,Su(t.value.mapValue),Kd.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,a,t)}).next(t=>{a=t;const r=t.applyToLocalDocumentSet(i,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:bd(i)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.du[e.currentUser.toKey()];r||(r=new Ac(fl)),r=r.insert(t,n),e.du[e.currentUser.toKey()]=r}(r,e.batchId,n),await qg(r,e.changes),await qp(r.remoteStore)}catch(e){const t=og(e,"Failed to persist write");n.reject(t)}}(await lm(e),t,n)),n.promise}function dm(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const hm="ComponentProvider",fm=new Map;function pm(e,t,n,r,s){return new Qc(e,t,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,dm(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}const gm="firestore.googleapis.com",mm=!0;class vm{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new tl(el.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=gm,this.ssl=mm}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:mm;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=vf;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<wf)throw new tl(el.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new tl(el.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dm(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new tl(el.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new tl(el.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new tl(el.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ym{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vm({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new tl(el.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tl(el.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vm(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new sl;switch(e.type){case"firstParty":return new ll(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new tl(el.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=fm.get(e);t&&(Wo(hm,"Removing Datastore"),fm.delete(e),t.terminate())}(this),Promise.resolve()}}class bm{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new bm(this.firestore,e,this._query)}}class Em{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Em(this.firestore,e,this._key)}toJSON(){return{type:Em._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Pl(t,Em._jsonSchema))return new Em(e,n||null,new kl(wl.fromString(t.referencePath)))}}Em._jsonSchemaVersion="firestore/documentReference/1.0",Em._jsonSchema={type:Rl("string",Em._jsonSchemaVersion),referencePath:Rl("string")};class wm extends bm{constructor(e,t,n){super(e,t,$u(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Em(this.firestore,null,new kl(e))}withConverter(e){return new wm(this.firestore,e,this._path)}}function Sm(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];if(e=bn(e),xl("collection","path",t),e instanceof ym){const n=wl.fromString(t,...r);return Ll(n),new wm(e,null,n)}{if(!(e instanceof Em||e instanceof wm))throw new tl(el.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(wl.fromString(t,...r));return Ll(n),new wm(e.firestore,null,n)}}function Tm(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];if(e=bn(e),1===arguments.length&&(t=hl.newId()),xl("doc","path",t),e instanceof ym){const n=wl.fromString(t,...r);return Il(n),new Em(e,null,new kl(n))}{if(!(e instanceof Em||e instanceof wm))throw new tl(el.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(wl.fromString(t,...r));return Il(n),new Em(e.firestore,e instanceof wm?e.converter:null,new kl(n))}}const km="AsyncQueue";class xm{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ep(this,"async_queue_retry"),this._c=()=>{const e=yp();e&&Wo(km,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=yp();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=yp();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new nl;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(_w){if(!Yl(_w))throw _w;Wo(km,"Operation failed with retryable error: "+_w)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,qo("INTERNAL UNHANDLED ERROR: ",Im(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=ag.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&Xo(47125,{Pc:Im(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Im(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class Lm extends ym{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new xm,this._persistenceKey=(null===r||void 0===r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new xm(e),this._firestoreClient=void 0,await e}}}function Cm(e){if(e._terminated)throw new tl(el.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||_m(e),e._firestoreClient}function _m(e){var t,n,r,s;const i=e._freezeSettings(),a=pm(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,null===(n=e._app)||void 0===n?void 0:n.options.apiKey,i);e._componentsProvider||null!==(r=i.localCache)&&void 0!==r&&r._offlineComponentProvider&&null!==(s=i.localCache)&&void 0!==s&&s._onlineComponentProvider&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new rm(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&function(e){const t=null===e||void 0===e?void 0:e._online.build();return{_offline:null===e||void 0===e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class Am{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Am(Fc.fromBase64String(e))}catch(e){throw new tl(el.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Am(Fc.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Am._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Pl(e,Am._jsonSchema))return Am.fromBase64String(e.bytes)}}Am._jsonSchemaVersion="firestore/bytes/1.0",Am._jsonSchema={type:Rl("string",Am._jsonSchemaVersion),bytes:Rl("string")};class Rm{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new tl(el.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Tl(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Pm{constructor(e){this._methodName=e}}class Dm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tl(el.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tl(el.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return fl(this._lat,e._lat)||fl(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Dm._jsonSchemaVersion}}static fromJSON(e){if(Pl(e,Dm._jsonSchema))return new Dm(e.latitude,e.longitude)}}Dm._jsonSchemaVersion="firestore/geoPoint/1.0",Dm._jsonSchema={type:Rl("string",Dm._jsonSchemaVersion),latitude:Rl("number"),longitude:Rl("number")};class Om{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Om._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Pl(e,Om._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Om(e.vectorValues);throw new tl(el.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Om._jsonSchemaVersion="firestore/vectorValue/1.0",Om._jsonSchema={type:Rl("string",Om._jsonSchemaVersion),vectorValues:Rl("object")};const Nm=/^__.*__$/;class Mm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new eh(e,this.data,this.fieldMask,t,this.fieldTransforms):new $d(e,this.data,t,this.fieldTransforms)}}class Fm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new eh(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Um(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xo(40011,{dataSource:e})}}class jm{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new jm(d(d({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return tv(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(Um(this.dataSource)&&Nm.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Bm{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||bp(e)}createContext(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new jm({dataSource:e,methodName:t,targetDoc:n,path:Tl.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Vm(e){const t=e._freezeSettings(),n=bp(e._databaseId);return new Bm(e._databaseId,!!t.ignoreUndefinedProperties,n)}function zm(e,t,n,r,s){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.createContext(i.merge||i.mergeFields?2:0,t,n,s);Zm("Data must be an object, but it was:",a,r);const o=Qm(r,a);let l,c;if(i.merge)l=new Nc(a.fieldMask),c=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=Jm(t,r,n);if(!a.contains(s))throw new tl(el.INVALID_ARGUMENT,"Field '".concat(s,"' is specified in your field mask but missing from your input data."));nv(e,s)||e.push(s)}l=new Nc(e),c=a.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=a.fieldTransforms;return new Mm(new wu(o),l,c)}class Gm extends Pm{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError("".concat(this._methodName,"() can only appear at the top level of your update data")):e.createError("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Gm}}class Hm extends Pm{_toFieldTransform(e){return new Gd(e.path,new Nd)}isEqual(e){return e instanceof Hm}}function Km(e,t,n,r){const s=e.createContext(1,t,n);Zm("Data must be an object, but it was:",s,r);const i=[],a=wu.empty();Cc(r,(e,r)=>{const o=ev(t,e,n);r=bn(r);const l=s.childContextForFieldPath(o);if(r instanceof Gm)i.push(o);else{const e=Ym(r,l);null!=e&&(i.push(o),a.set(o,e))}});const o=new Nc(i);return new Fm(a,o,s.fieldTransforms)}function Wm(e,t,n,r,s,i){const a=e.createContext(1,t,n),o=[Jm(t,r,n)],l=[s];if(i.length%2!=0)throw new tl(el.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let h=0;h<i.length;h+=2)o.push(Jm(t,i[h])),l.push(i[h+1]);const c=[],u=wu.empty();for(let h=o.length-1;h>=0;--h)if(!nv(c,o[h])){const e=o[h];let t=l[h];t=bn(t);const n=a.childContextForFieldPath(e);if(t instanceof Gm)c.push(e);else{const r=Ym(t,n);null!=r&&(c.push(e),u.set(e,r))}}const d=new Nc(c);return new Fm(u,d,a.fieldTransforms)}function qm(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Ym(n,e.createContext(r?4:3,t))}function Ym(e,t){if(Xm(e=bn(e)))return Zm("Unsupported field value:",t,e),Qm(e,t);if(e instanceof Pm)return function(e,t){if(!Um(t.dataSource))throw t.createError("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.createError("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const s of e){let e=Ym(s,t.childContextForArray(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=bn(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Ad(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Nl.fromDate(e);return{timestampValue:Nh(t.serializer,n)}}if(e instanceof Nl){const n=new Nl(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Nh(t.serializer,n)}}if(e instanceof Dm)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Am)return{bytesValue:Mh(t.serializer,e._byteString)};if(e instanceof Em){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:jh(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Om)return function(e,t){const n=e instanceof Om?e.toArray():e,r={fields:{[Jc]:{stringValue:tu},[nu]:{arrayValue:{values:n.map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return Cd(t.serializer,e)})}}}};return{mapValue:r}}(e,t);if(cf(e))return e._toProto(t.serializer);throw t.createError("Unsupported field value: ".concat(_l(e)))}(e,t)}function Qm(e,t){const n={};return _c(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Cc(e,(e,r)=>{const s=Ym(r,t.childContextForField(e));null!=s&&(n[e]=s)}),{mapValue:{fields:n}}}function Xm(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Nl||e instanceof Dm||e instanceof Am||e instanceof Em||e instanceof Pm||e instanceof Om||cf(e))}function Zm(e,t,n){if(!Xm(n)||!Cl(n)){const r=_l(n);throw"an object"===r?t.createError(e+" a custom object"):t.createError(e+" "+r)}}function Jm(e,t,n){if((t=bn(t))instanceof Rm)return t._internalPath;if("string"==typeof t)return ev(e,t);throw tv("Field path arguments must be of type string or ",e,!1,void 0,n)}const $m=new RegExp("[~\\*/\\[\\]]");function ev(e,t,n){if(t.search($m)>=0)throw tv("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new Rm(...t.split("."))._internalPath}catch(Gb){throw tv("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function tv(e,t,n,r,s){const i=r&&!r.isEmpty(),a=void 0!==s;let o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=" in field ".concat(r)),a&&(l+=" in document ".concat(s)),l+=")"),new tl(el.INVALID_ARGUMENT,o+e+l)}function nv(e,t){return e.some(e=>e.isEqual(t))}class rv{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(ru(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Bc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Vc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Xo(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return Cc(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t;const n=null===(t=e.fields)||void 0===t||null===(t=t[nu].arrayValue)||void 0===t||null===(t=t.values)||void 0===t?void 0:t.map(e=>Bc(e.doubleValue));return new Om(n)}convertGeoPoint(e){return new Dm(Bc(e.latitude),Bc(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=qc(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Yc(e));default:return null}}convertTimestamp(e){const t=jc(e);return new Nl(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=wl.fromString(e);Jo(lf(n),9688,{name:e});const r=new Zc(n.get(1),n.get(3)),s=new kl(n.popFirst(5));return r.isEqual(t)||qo("Document ".concat(s," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),s}}class sv extends rv{constructor(e){super(),this.firestore=e}convertBytes(e){return new Am(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Em(this.firestore,null,t)}}function iv(){return new Hm("serverTimestamp")}const av="@firebase/firestore",ov="4.11.0";function lv(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class cv{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Em(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new uv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e,t;return null!==(e=null===(t=this._document)||void 0===t?void 0:t.data.clone().value.mapValue.fields)&&void 0!==e?e:void 0}get(e){if(this._document){const t=this._document.data.field(Jm("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class uv extends cv{data(){return super.data()}}function dv(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new tl(el.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class hv{}class fv extends hv{}function pv(e,t){let n=[];for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];t instanceof hv&&n.push(t),n=n.concat(s),function(e){const t=e.filter(e=>e instanceof vv).length,n=e.filter(e=>e instanceof gv).length;if(t>1||t>0&&n>0)throw new tl(el.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)e=a._apply(e);return e}class gv extends fv{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new gv(e,t,n)}_apply(e){const t=this._parse(e);return kv(e._query,t),new bm(e.firestore,e.converter,id(e._query,t))}_parse(e){const t=Vm(e.firestore),n=function(e,t,n,r,s,i,a){let o;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new tl(el.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(i,"' queries on documentId()."));if("in"===i||"not-in"===i){Tv(a,i);const t=[];for(const n of a)t.push(Sv(r,e,n));o={arrayValue:{values:t}}}else o=Sv(r,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Tv(a,i),o=qm(n,t,a,"in"===i||"not-in"===i);return Au.create(s,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function mv(e,t,n){const r=t,s=Jm("where",e);return gv._create(s,r,n)}class vv extends hv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new vv(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Ru.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const s of r)kv(n,s),n=id(n,s)}(e._query,t),new bm(e.firestore,e.converter,id(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class yv extends fv{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new yv(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new tl(el.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new tl(el.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Lu(t,n)}(e._query,this._field,this._direction);return new bm(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Zu(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function bv(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Jm("orderBy",e);return yv._create(n,t)}class Ev extends fv{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Ev(e,t,n)}_apply(e){return new bm(e.firestore,e.converter,ad(e._query,this._limit,this._limitType))}}function wv(e){return function(e,t){if(t<=0)throw new tl(el.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}("limit",e),Ev._create("limit",e,"F")}function Sv(e,t,n){if("string"==typeof(n=bn(n))){if(""===n)throw new tl(el.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!td(t)&&-1!==n.indexOf("/"))throw new tl(el.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=t.path.child(wl.fromString(n));if(!kl.isDocumentKey(r))throw new tl(el.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return hu(e,new kl(r))}if(n instanceof Em)return hu(e,n._key);throw new tl(el.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(_l(n),"."))}function Tv(e,t){if(!Array.isArray(e)||0===e.length)throw new tl(el.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function kv(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new tl(el.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new tl(el.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}function xv(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Iv{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Lv extends cv{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Cv(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Jm("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new tl(el.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Lv._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Lv._jsonSchemaVersion="firestore/documentSnapshot/1.0",Lv._jsonSchema={type:Rl("string",Lv._jsonSchemaVersion),bundleSource:Rl("string","DocumentSnapshot"),bundleName:Rl("string"),bundle:Rl("string")};class Cv extends Lv{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class _v{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Iv(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Cv(this._firestore,this._userDataWriter,n.key,n,new Iv(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new tl(el.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new Cv(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Iv(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new Cv(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Iv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:Av(t.type),doc:r,oldIndex:s,newIndex:i}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new tl(el.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=_v._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=hl.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Av(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xo(61501,{type:e})}}_v._jsonSchemaVersion="firestore/querySnapshot/1.0",_v._jsonSchema={type:Rl("string",_v._jsonSchemaVersion),bundleSource:Rl("string","QuerySnapshot"),bundleName:Rl("string"),bundle:Rl("string")};function Rv(e){e=Al(e,Em);const t=Al(e.firestore,Lm);return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new nl;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,s){const i=new tm({next:o=>{i.Nu(),t.enqueueAndForget(()=>gg(e,a));const l=o.docs.has(n);!l&&o.fromCache?s.reject(new tl(el.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?s.reject(new tl(el.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(o)},error:e=>s.reject(e)}),a=new wg($u(n.path),i,{includeMetadataChanges:!0,Ka:!0});return pg(e,a)}(await cm(e),e.asyncQueue,t,n,r)),r.promise}(Cm(t),e._key).then(n=>jv(t,e,n))}function Pv(e){e=Al(e,bm);const t=Al(e.firestore,Lm),n=Cm(t),r=new sv(t);return dv(e._query),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new nl;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,s){const i=new tm({next:n=>{i.Nu(),t.enqueueAndForget(()=>gg(e,a)),n.fromCache&&"server"===r.source?s.reject(new tl(el.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),a=new wg(n,i,{includeMetadataChanges:!0,Ka:!0});return pg(e,a)}(await cm(e),e.asyncQueue,t,n,r)),r.promise}(n,e._query).then(n=>new _v(t,r,e,n))}function Dv(e,t,n){e=Al(e,Em);const r=Al(e.firestore,Lm),s=xv(e.converter,t,n);return Uv(r,[zm(Vm(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,Kd.none())])}function Ov(e,t,n){e=Al(e,Em);const r=Al(e.firestore,Lm),s=Vm(r);let i;for(var a=arguments.length,o=new Array(a>3?a-3:0),l=3;l<a;l++)o[l-3]=arguments[l];return i="string"==typeof(t=bn(t))||t instanceof Rm?Wm(s,"updateDoc",e._key,t,n,o):Km(s,"updateDoc",e._key,t),Uv(r,[i.toMutation(e._key,Kd.exists(!0))])}function Nv(e){return Uv(Al(e.firestore,Lm),[new sh(e._key,Kd.none())])}function Mv(e,t){const n=Al(e.firestore,Lm),r=Tm(e),s=xv(e.converter,t);return Uv(n,[zm(Vm(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,Kd.exists(!1))]).then(()=>r)}function Fv(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=bn(e);let s={includeMetadataChanges:!1,source:"default"},i=0;"object"!=typeof n[i]||lv(n[i])||(s=n[i++]);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(lv(n[i])){var o,l,c;const e=n[i];n[i]=null===(o=e.next)||void 0===o?void 0:o.bind(e),n[i+1]=null===(l=e.error)||void 0===l?void 0:l.bind(e),n[i+2]=null===(c=e.complete)||void 0===c?void 0:c.bind(e)}let u,d,h;if(e instanceof Em)d=Al(e.firestore,Lm),h=$u(e._key.path),u={next:t=>{n[i]&&n[i](jv(d,e,t))},error:n[i+1],complete:n[i+2]};else{const t=Al(e,bm);d=Al(t.firestore,Lm),h=t._query;const r=new sv(d);u={next:e=>{n[i]&&n[i](new _v(d,r,t,e))},error:n[i+1],complete:n[i+2]},dv(e._query)}return function(e,t,n,r){const s=new tm(r),i=new wg(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>pg(await cm(e),i)),()=>{s.Nu(),e.asyncQueue.enqueueAndForget(async()=>gg(await cm(e),i))}}(Cm(d),h,a,u)}function Uv(e,t){return um(Cm(e),t)}function jv(e,t,n){const r=n.docs.get(t._key),s=new sv(e);return new Lv(e,s,t._key,r,new Iv(n.hasPendingWrites,n.fromCache),t.converter)}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(function(e){Go=e})(Or),_r(new En("firestore",(e,n)=>{let{instanceIdentifier:r,options:s}=n;const i=e.getProvider("app").getImmediate(),a=new Lm(new al(e.getProvider("auth-internal")),new ul(i,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tl(el.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zc(e.options.projectId,t)}(i,r),i);return s=d({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Fr(av,ov,e),Fr(av,ov,"esm2020")}();Fr("firebase","12.9.0","app");const Bv="firebasestorage.googleapis.com",Vv="storageBucket";class zv extends cn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(Kv(e),"Firebase Storage: ".concat(t," (").concat(Kv(e),")")),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,zv.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Kv(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}var Gv,Hv;function Kv(e){return"storage/"+e}function Wv(){return new zv(Gv.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function qv(){return new zv(Gv.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Yv(){return new zv(Gv.CANCELED,"User canceled the upload/download.")}function Qv(){return new zv(Gv.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Xv(e){return new zv(Gv.INVALID_ARGUMENT,e)}function Zv(){return new zv(Gv.APP_DELETED,"The Firebase app was deleted.")}function Jv(e,t){return new zv(Gv.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function $v(e){throw new zv(Gv.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Gv||(Gv={}));class ey{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=ey.makeFromUrl(e,t)}catch(_w){return new ey(e,"")}if(""===n.path)return n;throw r=e,new zv(Gv.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const s=new RegExp("^gs://"+r+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),o=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(a,"/").concat("v[A-Za-z0-9_]+","/b/").concat(r,"/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp("^https?://".concat(t===Bv?"(?:storage.googleapis.com|storage.cloud.google.com)":t,"/").concat(r,"/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:i}];for(let l=0;l<o.length;l++){const t=o[l],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let s=r[t.indices.path];s||(s=""),n=new ey(e,s),t.postModify(n);break}}if(null==n)throw function(e){return new zv(Gv.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class ty{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function ny(e){return"string"===typeof e||e instanceof String}function ry(e){return sy()&&e instanceof Blob}function sy(){return"undefined"!==typeof Blob}function iy(e,t,n,r){if(r<t)throw Xv("Invalid value for '".concat(e,"'. Expected ").concat(t," or greater."));if(r>n)throw Xv("Invalid value for '".concat(e,"'. Expected ").concat(n," or less."))}function ay(e,t,n){let r=t;return null==n&&(r="https://".concat(t)),"".concat(n,"://").concat(r,"/v0").concat(e)}function oy(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}function ly(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),s=-1!==t.indexOf(e);return n||r||s}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Hv||(Hv={}));class cy{constructor(e,t,n,r,s,i,a,o,l,c,u){let d=!(arguments.length>11&&void 0!==arguments[11])||arguments[11],h=arguments.length>12&&void 0!==arguments[12]&&arguments[12];this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=i,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=u,this.retry=d,this.isUsingEmulator=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new uy(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Hv.NO_ERROR,s=n.getStatus();if(!t||ly(s,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Hv.ABORT;return void e(!1,new uy(!1,null,t))}const i=-1!==this.successCodes_.indexOf(s);e(!0,new uy(i,n))})},t=(e,t)=>{const n=this.resolve_,r=this.reject_,s=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(s,s.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(_w){r(_w)}else if(null!==s){const e=Wv();e.serverResponse=s.getErrorText(),this.errorCallback_?r(this.errorCallback_(s,e)):r(e)}else if(t.canceled){r(this.appDelete_?Zv():Yv())}else{r(qv())}};this.canceled_?t(0,new uy(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,s=null,i=null,a=!1,o=0;function l(){return 2===o}let c=!1;function u(){if(!c){c=!0;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(null,n)}}function d(t){s=setTimeout(()=>{s=null,e(f,l())},t)}function h(){i&&clearTimeout(i)}function f(e){if(c)return void h();for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];if(e)return h(),void u.call(null,e,...n);if(l()||a)return h(),void u.call(null,e,...n);let i;r<64&&(r*=2),1===o?(o=2,i=0):i=1e3*(r+Math.random()),d(i)}let p=!1;function g(e){p||(p=!0,h(),c||(null!==s?(e||(o=2),clearTimeout(s),d(0)):e||(o=1)))}return d(0),i=setTimeout(()=>{a=!0,g(!0)},n),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class uy{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function dy(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function hy(){const e=dy();for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(void 0!==e){const t=new e;for(let e=0;e<n.length;e++)t.append(n[e]);return t.getBlob()}if(sy())return new Blob(n);throw new zv(Gv.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function fy(e){if("undefined"===typeof atob)throw t="base-64",new zv(Gv.UNSUPPORTED_ENVIRONMENT,"".concat(t," is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information."));var t;return atob(e)}const py="raw",gy="base64",my="base64url",vy="data_url";class yy{constructor(e,t){this.data=e,this.contentType=t||null}}function by(e,t){switch(e){case py:return new yy(Ey(t));case gy:case my:return new yy(wy(e,t));case vy:return new yy(function(e){const t=new Sy(e);return t.base64?wy(gy,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(_w){throw Jv(vy,"Malformed data URL.")}return Ey(t)}(t.rest)}(t),new Sy(t).contentType)}throw Wv()}function Ey(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296===(64512&r)){if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1))){r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189)}else 56320===(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function wy(e,t){switch(e){case gy:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw Jv(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case my:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw Jv(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=fy(t)}catch(_w){if(_w.message.includes("polyfill"))throw _w;throw Jv(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class Sy{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Jv(vy,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){const n=e.length>=t.length;if(!n)return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class Ty{constructor(e,t){let n=0,r="";ry(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(ry(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new Ty(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Ty(n,!0)}}static getBlob(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(sy()){const e=t.map(e=>e instanceof Ty?e.data_:e);return new Ty(hy.apply(null,e))}{const e=t.map(e=>ny(e)?by(py,e).data:e.data_);let n=0;e.forEach(e=>{n+=e.byteLength});const r=new Uint8Array(n);let s=0;return e.forEach(e=>{for(let t=0;t<e.length;t++)r[s++]=e[t]}),new Ty(r,!0)}}uploadData(){return this.data_}}function ky(e){let t;try{t=JSON.parse(e)}catch(_w){return null}return function(e){return"object"===typeof e&&!Array.isArray(e)}(t)?t:null}function xy(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Iy(e,t){return t}class Ly{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Iy}}let Cy=null;function _y(){if(Cy)return Cy;const e=[];e.push(new Ly("bucket")),e.push(new Ly("generation")),e.push(new Ly("metageneration")),e.push(new Ly("name","fullPath",!0));const t=new Ly("name");t.xform=function(e,t){return function(e){return!ny(e)||e.length<2?e:xy(e)}(t)},e.push(t);const n=new Ly("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Ly("timeCreated")),e.push(new Ly("updated")),e.push(new Ly("md5Hash",null,!0)),e.push(new Ly("cacheControl",null,!0)),e.push(new Ly("contentDisposition",null,!0)),e.push(new Ly("contentEncoding",null,!0)),e.push(new Ly("contentLanguage",null,!0)),e.push(new Ly("contentType",null,!0)),e.push(new Ly("metadata","customMetadata",!0)),Cy=e,Cy}function Ay(e,t,n){const r={type:"file"},s=n.length;for(let i=0;i<s;i++){const e=n[i];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,s=new ey(n,r);return t._makeStorageReference(s)}})}(r,e),r}function Ry(e,t,n){const r=ky(t);if(null===r)return null;return Ay(e,r,n)}function Py(e,t){const n={},r=t.length;for(let s=0;s<r;s++){const r=t[s];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}class Dy{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Oy(e){if(!e)throw Wv()}function Ny(e,t){return function(n,r){const s=Ry(e,r,t);return Oy(null!==s),s}}function My(e,t){return function(n,r){const s=Ry(e,r,t);return Oy(null!==s),function(e,t,n,r){const s=ky(t);if(null===s)return null;if(!ny(s.downloadTokens))return null;const i=s.downloadTokens;if(0===i.length)return null;const a=encodeURIComponent;return i.split(",").map(t=>{const s=e.bucket,i=e.fullPath;return ay("/b/"+a(s)+"/o/"+a(i),n,r)+oy({alt:"media",token:t})})[0]}(s,r,e.host,e._protocol)}}function Fy(e){return function(t,n){let r;var s,i;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new zv(Gv.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new zv(Gv.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,r=new zv(Gv.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(s=e.path,r=new zv(Gv.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function Uy(e){const t=Fy(e);return function(n,r){let s=t(n,r);var i;return 404===n.getStatus()&&(i=e.path,s=new zv(Gv.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),s.serverResponse=r.serverResponse,s}}function jy(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}function By(e,t,n,r,s){const i=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};const o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;const l=jy(t,r,s),c="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Py(l,n)+"\r\n--"+o+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",u="\r\n--"+o+"--",d=Ty.getBlob(c,r,u);if(null===d)throw Qv();const h={name:l.fullPath},f=ay(i,e.host,e._protocol),p=e.maxUploadRetryTime,g=new Dy(f,"POST",Ny(e,n),p);return g.urlParams=h,g.headers=a,g.body=d.uploadData(),g.errorHandler=Fy(t),g}class Vy{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Hv.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Hv.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Hv.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r,s){if(this.sent_)throw $v("cannot .send() more than once");if(Jt(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==s)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw $v("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw $v("cannot .getStatus() before sending");try{return this.xhr_.status}catch(_w){return-1}}getResponse(){if(!this.sent_)throw $v("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw $v("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class zy extends Vy{initXhr(){this.xhr_.responseType="text"}}function Gy(){return new zy}class Hy{constructor(e,t){this._service=e,this._location=t instanceof ey?t:ey.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Hy(e,t)}get root(){const e=new ey(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return xy(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new ey(this._location.bucket,e);return new Hy(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new zv(Gv.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Ky(e,t,n){e._throwIfRoot("uploadBytes");const r=By(e.storage,e._location,_y(),new Ty(t,!0),n);return e.storage.makeRequestWithTokens(r,Gy).then(t=>({metadata:t,ref:e}))}function Wy(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=ay(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,i=new Dy(r,"GET",My(e,n),s);return i.errorHandler=Uy(t),i}(e.storage,e._location,_y());return e.storage.makeRequestWithTokens(t,Gy).then(e=>{if(null===e)throw new zv(Gv.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function qy(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=ay(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,s=new Dy(n,"DELETE",function(e,t){},r);return s.successCodes=[200,204],s.errorHandler=Uy(t),s}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Gy)}function Yy(e,t){const n=function(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new ey(e._location.bucket,n);return new Hy(e.storage,r)}function Qy(e,t){if(e instanceof Jy){const n=e;if(null==n._bucket)throw new zv(Gv.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Vv+"' property when initializing the app?");const r=new Hy(n,n._bucket);return null!=t?Qy(r,t):r}return void 0!==t?Yy(e,t):e}function Xy(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Jy)return new Hy(e,t);throw Xv("To use ref(service, url), the first argument must be a Storage instance.")}return Qy(e,t)}function Zy(e,t){const n=null===t||void 0===t?void 0:t[Vv];return null==n?null:ey.makeFromBucketSpec(n,e)}class Jy{constructor(e,t,n,r,s){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=s,this._isUsingEmulator=i,this._bucket=null,this._host=Bv,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?ey.makeFromBucketSpec(r,this._host):Zy(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=ey.makeFromBucketSpec(this._url,e):this._bucket=Zy(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){iy("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){iy("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(Rr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Hy(this,e)}_makeRequest(e,t,n,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new ty(Zv());{const i=function(e,t,n,r,s,i){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=oy(e.urlParams),c=e.url+l,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(u,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,r),new cy(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,s,a,o)}(e,this._appId,n,r,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const $y="@firebase/storage",eb="0.14.0",tb="storage";function nb(e){return Wy(e=bn(e))}function rb(e){return qy(e=bn(e))}function sb(e,t){return Xy(e=bn(e),t)}function ib(e,t){let{instanceIdentifier:n}=t;const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new Jy(r,s,i,n,Or)}_r(new En(tb,ib,"PUBLIC").setMultipleInstances(!0)),Fr($y,eb,""),Fr($y,eb,"esm2020");const ab=Nr({apiKey:"AIzaSyCwoCcI0qoMI72UKbVbAMSHp8UxHLuM960",authDomain:"towncapture-25aa5.firebaseapp.com",projectId:"towncapture-25aa5",storageBucket:"towncapture-25aa5.firebasestorage.app",appId:"1:822639495360:web:8483e0da5c9ceb387d0525"}),ob=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Mr();const t=Ar(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Ar(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(hn(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;ns(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:wo,persistence:[Aa,ua,ga]}),r=Xt("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>xo)return;const r=null===t||void 0===t?void 0:t.token;Io!==r&&(Io=r,await fetch(s,{method:r?"POST":"DELETE",headers:r?{Authorization:"Bearer ".concat(r)}:{}}))});!function(e,t,n){bn(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,r){bn(e).onIdTokenChanged(t,n,r)}(n,e=>t(e))}}var s;const i=qt("auth");return i&&Ti(n,"http://".concat(i)),n}(ab),lb=function(e,t){const n="object"==typeof e?e:Mr(),r="string"==typeof e?e:t||Xc,s=Ar(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const e=Yt("firestore");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=Al(e,ym);const s=Jt(t),i=e._getSettings(),a=d(d({},i),{},{emulatorOptions:e._getEmulatorOptions()}),o="".concat(t,":").concat(n);s&&($t("https://".concat(o)),rn("Firestore",!0)),i.host!==gm&&i.host!==o&&Yo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=d(d({},i),{},{host:o,ssl:s,emulatorOptions:r});if(!hn(l,a)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=zo.MOCK_USER;else{var c;t=en(r.mockUserToken,null===(c=e._app)||void 0===c?void 0:c.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new tl(el.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new zo(s)}e._authCredentials=new il(new rl(t,n))}}(s,...e)}return s}(ab),cb=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Mr(),t=arguments.length>1?arguments[1]:void 0;e=bn(e);const n=Ar(e,tb).getImmediate({identifier:t}),r=Yt("storage");return r&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host="".concat(t,":").concat(n);const s=Jt(t);s&&($t("https://".concat(e.host,"/b")),rn("Storage",!0)),e._isUsingEmulator=!0,e._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"===typeof i?i:en(i,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}(ab);var ub=n(579);const db=(0,r.createContext)(null),hb=()=>(0,r.useContext)(db);function fb(e){let{children:t}=e;const[n,s]=(0,r.useState)(null),[i,a]=(0,r.useState)(null),[o,l]=(0,r.useState)(!0),[c,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=function(e,t,n,r){return bn(e).onAuthStateChanged(t,n,r)}(ob,async e=>{try{if(e){const t=await e.getIdToken(!0);localStorage.setItem("idToken",t);const n=await Rv(Tm(lb,"users",e.uid));if(n.exists()){const t=n.data();t.clientId?(u(null),s(e),a(t.clientId),localStorage.setItem("clientId",t.clientId)):(u("Document users/".concat(e.uid,' has no field "clientId".')),s(e),a(null))}else u("Your account is missing a clientId mapping (users/".concat(e.uid,").")),s(e),a(null)}else s(null),a(null),u(null),localStorage.removeItem("idToken"),localStorage.removeItem("clientId")}catch(t){console.error("AuthContext error:",t),u("Failed to load mapping: ".concat(t.message))}finally{l(!1)}});return e},[]);const d=()=>{localStorage.removeItem("idToken"),localStorage.removeItem("clientId"),function(e){bn(e).signOut()}(ob)},h={user:n,clientId:i,logout:d,mappingError:c};return o?(0,ub.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-100",children:(0,ub.jsx)("div",{className:"px-4 py-3 rounded-xl bg-white shadow",children:"Loading\u2026"})}):n&&c?(0,ub.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-100",children:(0,ub.jsxs)("div",{className:"max-w-md bg-white rounded-2xl shadow p-6 space-y-4",children:[(0,ub.jsx)("h1",{className:"text-lg font-semibold text-red-600",children:"Configuration error"}),(0,ub.jsx)("p",{className:"text-sm text-slate-700 whitespace-pre-line",children:c}),(0,ub.jsx)("button",{className:"mt-2 px-4 py-2 rounded-xl bg-blue-600 text-white text-sm",onClick:d,children:"Log out"})]})}):(0,ub.jsx)(db.Provider,{value:h,children:t})}function pb(e){let{children:t}=e;const{user:n,clientId:r}=hb(),{clientId:s}=Ie(),i=Se();return n?s!==r?(0,ub.jsx)(We,{to:"/".concat(r,"/dashboard"),replace:!0}):t:(0,ub.jsx)(We,{to:"/".concat(s,"/login"),replace:!0,state:{from:i}})}function gb(e){if(Array.isArray(e))return e}function mb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function vb(e,t){if(e){if("string"==typeof e)return mb(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mb(e,t):void 0}}function yb(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function bb(e,t){return gb(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,i,a,o=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){c=!0,s=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}(e,t)||vb(e,t)||yb()}function Eb(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function Sb(e,t,n){return t&&wb(e.prototype,t),n&&wb(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Tb=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,kb={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"\xa9","&#169;":"\xa9","&reg;":"\xae","&#174;":"\xae","&hellip;":"\u2026","&#8230;":"\u2026","&#x2F;":"/","&#47;":"/"},xb=function(e){return kb[e]};function Ib(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Lb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ib(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ib(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Cb,_b={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:function(e){return e.replace(Tb,xb)}},Ab=(0,r.createContext)();var Rb=function(){function e(){Eb(this,e),this.usedNamespaces={}}return Sb(e,[{key:"addUsedNamespaces",value:function(e){var t=this;e.forEach(function(e){t.usedNamespaces[e]||(t.usedNamespaces[e]=!0)})}},{key:"getUsedNamespaces",value:function(){return Object.keys(this.usedNamespaces)}}]),e}();function Pb(){return Cb}var Db={type:"3rdParty",init:function(e){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_b=Lb(Lb({},_b),e)}(e.options.react),function(e){Cb=e}(e)}};function Ob(){if(console&&console.warn){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];"string"===typeof n[0]&&(n[0]="react-i18next:: ".concat(n[0])),(e=console).warn.apply(e,n)}}var Nb={};function Mb(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];"string"===typeof t[0]&&Nb[t[0]]||("string"===typeof t[0]&&(Nb[t[0]]=new Date),Ob.apply(void 0,t))}function Fb(e,t,n){e.loadNamespaces(t,function(){if(e.isInitialized)n();else{e.on("initialized",function t(){setTimeout(function(){e.off("initialized",t)},0),n()})}})}function Ub(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function jb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ub(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ub(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Bb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.i18n,s=(0,r.useContext)(Ab)||{},i=s.i18n,a=s.defaultNS,o=n||i||Pb();if(o&&!o.reportNamespaces&&(o.reportNamespaces=new Rb),!o){Mb("You will need to pass in an i18next instance by using initReactI18next");var l=function(e){return Array.isArray(e)?e[e.length-1]:e},c=[l,{},!1];return c.t=l,c.i18n={},c.ready=!1,c}o.options.react&&void 0!==o.options.react.wait&&Mb("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");var u=jb(jb(jb({},_b),o.options.react),t),d=u.useSuspense,h=u.keyPrefix,f=e||a||o.options&&o.options.defaultNS;f="string"===typeof f?[f]:f||["translation"],o.reportNamespaces.addUsedNamespaces&&o.reportNamespaces.addUsedNamespaces(f);var p=(o.isInitialized||o.initializedStoreOnce)&&f.every(function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.languages&&t.languages.length?void 0!==t.options.ignoreJSONStructure?t.hasLoadedNamespace(e,{precheck:function(t,r){if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!r(t.isLanguageChangingTo,e))return!1}}):function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.languages[0],s=!!t.options&&t.options.fallbackLng,i=t.languages[t.languages.length-1];if("cimode"===r.toLowerCase())return!0;var a=function(e,n){var r=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===r||2===r};return!(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!a(t.isLanguageChangingTo,e))&&(!!t.hasResourceBundle(r,e)||!(t.services.backendConnector.backend&&(!t.options.resources||t.options.partialBundledLanguages))||!(!a(r,e)||s&&!a(i,e)))}(e,t,n):(Mb("i18n.languages were undefined or empty",t.languages),!0)}(e,o,u)});function g(){return o.getFixedT(null,"fallback"===u.nsMode?f:f[0],h)}var m=bb((0,r.useState)(g),2),v=m[0],y=m[1],b=f.join(),E=function(e,t){var n=(0,r.useRef)();return(0,r.useEffect)(function(){n.current=t?n.current:e},[e,t]),n.current}(b),w=(0,r.useRef)(!0);(0,r.useEffect)(function(){var e=u.bindI18n,t=u.bindI18nStore;function n(){w.current&&y(g)}return w.current=!0,p||d||Fb(o,f,function(){w.current&&y(g)}),p&&E&&E!==b&&w.current&&y(g),e&&o&&o.on(e,n),t&&o&&o.store.on(t,n),function(){w.current=!1,e&&o&&e.split(" ").forEach(function(e){return o.off(e,n)}),t&&o&&t.split(" ").forEach(function(e){return o.store.off(e,n)})}},[o,b]);var S=(0,r.useRef)(!0);(0,r.useEffect)(function(){w.current&&!S.current&&y(g),S.current=!1},[o,h]);var T=[v,o,p];if(T.t=v,T.i18n=o,T.ready=p,p)return T;if(!p&&!d)return T;throw new Promise(function(e){Fb(o,f,function(){e()})})}var Vb=(e=>(e.Space=" ",e.Enter="Enter",e.Escape="Escape",e.Backspace="Backspace",e.Delete="Delete",e.ArrowLeft="ArrowLeft",e.ArrowUp="ArrowUp",e.ArrowRight="ArrowRight",e.ArrowDown="ArrowDown",e.Home="Home",e.End="End",e.PageUp="PageUp",e.PageDown="PageDown",e.Tab="Tab",e))(Vb||{}),zb=Object.defineProperty,Gb=(e,t,n)=>(((e,t,n)=>{t in e?zb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);let Hb=new class{constructor(){Gb(this,"current",this.detect()),Gb(this,"handoffState","pending"),Gb(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return"server"===this.current}get isClient(){return"client"===this.current}detect(){return"undefined"==typeof window||"undefined"==typeof document?"server":"client"}handoff(){"pending"===this.handoffState&&(this.handoffState="complete")}get isHandoffComplete(){return"complete"===this.handoffState}},Kb=(e,t)=>{Hb.isServer?(0,r.useEffect)(e,t):(0,r.useLayoutEffect)(e,t)};function Wb(e){let t=(0,r.useRef)(e);return Kb(()=>{t.current=e},[e]),t}function qb(e,t,n,s){let i=Wb(n);(0,r.useEffect)(()=>{function n(e){i.current(e)}return(e=null!=e?e:window).addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)},[e,t,s])}class Yb extends Map{constructor(e){super(),this.factory=e}get(e){let t=super.get(e);return void 0===t&&(t=this.factory(e),this.set(e,t)),t}}function Qb(e){"function"==typeof queueMicrotask?queueMicrotask(e):Promise.resolve().then(e).catch(e=>setTimeout(()=>{throw e}))}function Xb(){let e=[],t={addEventListener:(e,n,r,s)=>(e.addEventListener(n,r,s),t.add(()=>e.removeEventListener(n,r,s))),requestAnimationFrame(){let e=requestAnimationFrame(...arguments);return t.add(()=>cancelAnimationFrame(e))},nextFrame(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.requestAnimationFrame(()=>t.requestAnimationFrame(...n))},setTimeout(){let e=setTimeout(...arguments);return t.add(()=>clearTimeout(e))},microTask(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];let s={current:!0};return Qb(()=>{s.current&&n[0]()}),t.add(()=>{s.current=!1})},style(e,t,n){let r=e.style.getPropertyValue(t);return Object.assign(e.style,{[t]:n}),this.add(()=>{Object.assign(e.style,{[t]:r})})},group(e){let t=Xb();return e(t),this.add(()=>t.dispose())},add:t=>(e.includes(t)||e.push(t),()=>{let n=e.indexOf(t);if(n>=0)for(let t of e.splice(n,1))t()}),dispose(){for(let t of e.splice(0))t()}};return t}var Zb,Jb,$b,eE=Object.defineProperty,tE=(e,t,n)=>(((e,t,n)=>{t in e?eE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),nE=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},rE=(e,t,n)=>(nE(e,t,"read from private field"),n?n.call(e):t.get(e)),sE=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},iE=(e,t,n,r)=>(nE(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);class aE{constructor(e){sE(this,Zb,{}),sE(this,Jb,new Yb(()=>new Set)),sE(this,$b,new Set),tE(this,"disposables",Xb()),iE(this,Zb,e),Hb.isServer&&this.disposables.microTask(()=>{this.dispose()})}dispose(){this.disposables.dispose()}get state(){return rE(this,Zb)}subscribe(e,t){if(Hb.isServer)return()=>{};let n={selector:e,callback:t,current:e(rE(this,Zb))};return rE(this,$b).add(n),this.disposables.add(()=>{rE(this,$b).delete(n)})}on(e,t){return Hb.isServer?()=>{}:(rE(this,Jb).get(e).add(t),this.disposables.add(()=>{rE(this,Jb).get(e).delete(t)}))}send(e){let t=this.reduce(rE(this,Zb),e);if(t!==rE(this,Zb)){iE(this,Zb,t);for(let e of rE(this,$b)){let t=e.selector(rE(this,Zb));oE(e.current,t)||(e.current=t,e.callback(t))}for(let t of rE(this,Jb).get(e.type))t(rE(this,Zb),e)}}}function oE(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&lE(e[Symbol.iterator](),t[Symbol.iterator]()):e instanceof Map&&t instanceof Map||e instanceof Set&&t instanceof Set?e.size===t.size&&lE(e.entries(),t.entries()):!(!cE(e)||!cE(t))&&lE(Object.entries(e)[Symbol.iterator](),Object.entries(t)[Symbol.iterator]()))}function lE(e,t){for(;;){let n=e.next(),r=t.next();if(n.done&&r.done)return!0;if(n.done||r.done||!Object.is(n.value,r.value))return!1}}function cE(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);return null===t||null===Object.getPrototypeOf(t)}function uE(e,t){if(e in t){let i=t[e];for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return"function"==typeof i?i(...r):i}let i=new Error('Tried to handle "'.concat(e,'" but there is no handler defined. Only defined handlers are: ').concat(Object.keys(t).map(e=>'"'.concat(e,'"')).join(", "),"."));throw Error.captureStackTrace&&Error.captureStackTrace(i,uE),i}Zb=new WeakMap,Jb=new WeakMap,$b=new WeakMap;var dE=Object.defineProperty,hE=(e,t,n)=>(((e,t,n)=>{t in e?dE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),fE=(e=>(e[e.Push=0]="Push",e[e.Pop=1]="Pop",e))(fE||{});let pE={0(e,t){let n=t.id,r=e.stack,s=e.stack.indexOf(n);if(-1!==s){let t=e.stack.slice();return t.splice(s,1),t.push(n),r=t,d(d({},e),{},{stack:r})}return d(d({},e),{},{stack:[...e.stack,n]})},1(e,t){let n=t.id,r=e.stack.indexOf(n);if(-1===r)return e;let s=e.stack.slice();return s.splice(r,1),d(d({},e),{},{stack:s})}};class gE extends aE{constructor(){super(...arguments),hE(this,"actions",{push:e=>this.send({type:0,id:e}),pop:e=>this.send({type:1,id:e})}),hE(this,"selectors",{isTop:(e,t)=>e.stack[e.stack.length-1]===t,inStack:(e,t)=>e.stack.includes(t)})}static new(){return new gE({stack:[]})}reduce(e,t){return uE(t.type,pE,e,t)}}const mE=new Yb(()=>gE.new());var vE=n(237);let yE=function(e){let t=Wb(e);return r.useCallback(function(){return t.current(...arguments)},[t])};function bE(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:oE;return(0,vE.useSyncExternalStoreWithSelector)(yE(t=>e.subscribe(EE,t)),yE(()=>e.state),yE(()=>e.state),yE(t),n)}function EE(e){return e}function wE(e,t){let n=(0,r.useId)(),s=mE.get(t),[i,a]=bE(s,(0,r.useCallback)(e=>[s.selectors.isTop(e,n),s.selectors.inStack(e,n)],[s,n]));return Kb(()=>{if(e)return s.actions.push(n),()=>s.actions.pop(n)},[s,e,n]),!!e&&(!a||i)}function SE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"undefined"!=typeof document?document.defaultView:null,n=arguments.length>2?arguments[2]:void 0,r=wE(e,"escape");qb(t,"keydown",e=>{r&&(e.defaultPrevented||e.key===Vb.Escape&&n(e))})}function TE(e){var t;return Hb.isServer?null:null==e?document:null!=(t=null==e?void 0:e.ownerDocument)?t:document}function kE(e){var t,n;return Hb.isServer?null:null==e?document:null!=(n=null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e))?n:document}function xE(e){var t,n;return null!=(n=null==(t=kE(e))?void 0:t.activeElement)?n:null}let IE=new Map,LE=new Map;function CE(e){var t;let n=null!=(t=LE.get(e))?t:0;return LE.set(e,n+1),0!==n||(IE.set(e,{"aria-hidden":e.getAttribute("aria-hidden"),inert:e.inert}),e.setAttribute("aria-hidden","true"),e.inert=!0),()=>_E(e)}function _E(e){var t;let n=null!=(t=LE.get(e))?t:1;if(1===n?LE.delete(e):LE.set(e,n-1),1!==n)return;let r=IE.get(e);r&&(null===r["aria-hidden"]?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",r["aria-hidden"]),e.inert=r.inert,IE.delete(e))}function AE(e){let{allowed:t,disallowed:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=wE(e,"inert-others");Kb(()=>{var e,s;if(!r)return;let i=Xb();for(let t of null!=(e=null==n?void 0:n())?e:[])t&&i.add(CE(t));let a=null!=(s=null==t?void 0:t())?s:[];for(let t of a){if(!t)continue;let e=TE(t);if(!e)continue;let n=t.parentElement;for(;n&&n!==e.body;){for(let e of n.children)a.some(t=>e.contains(t))||i.add(CE(e));n=n.parentElement}}return i.dispose},[r,t,n])}function RE(e){return function(e){return"object"==typeof e&&null!==e&&"nodeType"in e}(e)&&"tagName"in e}function PE(e){return RE(e)&&"accessKey"in e}function DE(e){return RE(e)&&"tabIndex"in e}let OE=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","details>summary","textarea:not([disabled])"].map(e=>"".concat(e,":not([tabindex='-1'])")).join(","),NE=["[data-autofocus]"].map(e=>"".concat(e,":not([tabindex='-1'])")).join(",");var ME=(e=>(e[e.First=1]="First",e[e.Previous=2]="Previous",e[e.Next=4]="Next",e[e.Last=8]="Last",e[e.WrapAround=16]="WrapAround",e[e.NoScroll=32]="NoScroll",e[e.AutoFocus=64]="AutoFocus",e))(ME||{}),FE=(e=>(e[e.Error=0]="Error",e[e.Overflow=1]="Overflow",e[e.Success=2]="Success",e[e.Underflow=3]="Underflow",e))(FE||{}),UE=(e=>(e[e.Previous=-1]="Previous",e[e.Next=1]="Next",e))(UE||{});function jE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return null==e?[]:Array.from(e.querySelectorAll(OE)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}var BE=(e=>(e[e.Strict=0]="Strict",e[e.Loose=1]="Loose",e))(BE||{});function VE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var n;return e!==(null==(n=TE(e))?void 0:n.body)&&uE(t,{0:()=>e.matches(OE),1(){let t=e;for(;null!==t;){if(t.matches(OE))return!0;t=t.parentElement}return!1}})}var zE=(e=>(e[e.Keyboard=0]="Keyboard",e[e.Mouse=1]="Mouse",e))(zE||{});function GE(e){null==e||e.focus({preventScroll:!0})}"undefined"!=typeof window&&"undefined"!=typeof document&&(document.addEventListener("keydown",e=>{e.metaKey||e.altKey||e.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",e=>{1===e.detail?delete document.documentElement.dataset.headlessuiFocusVisible:0===e.detail&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));let HE=["textarea","input"].join(",");function KE(e,t){let{sorted:n=!0,relativeTo:r=null,skipElements:s=[]}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Array.isArray(e)?e.length>0?kE(e[0]):document:kE(e),a=Array.isArray(e)?n?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;return e.slice().sort((e,n)=>{let r=t(e),s=t(n);if(null===r||null===s)return 0;let i=r.compareDocumentPosition(s);return i&Node.DOCUMENT_POSITION_FOLLOWING?-1:i&Node.DOCUMENT_POSITION_PRECEDING?1:0})}(e):e:64&t?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return null==e?[]:Array.from(e.querySelectorAll(NE)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}(e):jE(e);s.length>0&&a.length>1&&(a=a.filter(e=>!s.some(t=>null!=t&&"current"in t?(null==t?void 0:t.current)===e:t===e))),r=null!=r?r:null==i?void 0:i.activeElement;let o,l=(()=>{if(5&t)return 1;if(10&t)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),c=(()=>{if(1&t)return 0;if(2&t)return Math.max(0,a.indexOf(r))-1;if(4&t)return Math.max(0,a.indexOf(r))+1;if(8&t)return a.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),u=32&t?{preventScroll:!0}:{},d=0,h=a.length;do{if(d>=h||d+h<=0)return 0;let e=c+d;if(16&t)e=(e+h)%h;else{if(e<0)return 3;if(e>=h)return 1}o=a[e],null==o||o.focus(u),d+=l}while(o!==xE(o));return 6&t&&function(e){var t,n;return null!=(n=null==(t=null==e?void 0:e.matches)?void 0:t.call(e,HE))&&n}(o)&&o.select(),2}function WE(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function qE(){return WE()||/Android/gi.test(window.navigator.userAgent)}function YE(e,t,n,s){let i=Wb(n);(0,r.useEffect)(()=>{if(e)return document.addEventListener(t,n,s),()=>document.removeEventListener(t,n,s);function n(e){i.current(e)}},[e,t,s])}function QE(e,t,n,s){let i=Wb(n);(0,r.useEffect)(()=>{if(e)return window.addEventListener(t,n,s),()=>window.removeEventListener(t,n,s);function n(e){i.current(e)}},[e,t,s])}function XE(e,t,n){let s=Wb(n),i=(0,r.useCallback)(function(e,n){if(e.defaultPrevented)return;let r=n(e);if(null===r||!r.getRootNode().contains(r)||!r.isConnected)return;let i=function e(t){return"function"==typeof t?e(t()):Array.isArray(t)||t instanceof Set?t:[t]}(t);for(let t of i)if(null!==t&&(t.contains(r)||e.composed&&e.composedPath().includes(t)))return;return!VE(r,BE.Loose)&&-1!==r.tabIndex&&e.preventDefault(),s.current(e,r)},[s,t]),a=(0,r.useRef)(null);YE(e,"pointerdown",e=>{var t,n;qE()||(a.current=(null==(n=null==(t=e.composedPath)?void 0:t.call(e))?void 0:n[0])||e.target)},!0),YE(e,"pointerup",e=>{if(qE()||!a.current)return;let t=a.current;return a.current=null,i(e,()=>t)},!0);let o=(0,r.useRef)({x:0,y:0});YE(e,"touchstart",e=>{o.current.x=e.touches[0].clientX,o.current.y=e.touches[0].clientY},!0),YE(e,"touchend",e=>{let t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY;if(!(Math.abs(t-o.current.x)>=30||Math.abs(n-o.current.y)>=30))return i(e,()=>DE(e.target)?e.target:null)},!0),QE(e,"blur",e=>i(e,()=>function(e){return PE(e)&&"IFRAME"===e.nodeName}(window.document.activeElement)?window.document.activeElement:null),!0)}function ZE(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.useMemo)(()=>TE(...t),[...t])}function JE(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Array.from(new Set(t.flatMap(e=>"string"==typeof e?e.split(" "):[]))).filter(Boolean).join(" ")}const $E=["static"],ew=["unmount"],tw=["as","children","refName"];var nw=(e=>(e[e.None=0]="None",e[e.RenderStrategy=1]="RenderStrategy",e[e.Static=2]="Static",e))(nw||{}),rw=(e=>(e[e.Unmount=0]="Unmount",e[e.Hidden=1]="Hidden",e))(rw||{});function sw(){let e=function(){let e=(0,r.useRef)([]),t=(0,r.useCallback)(t=>{for(let n of e.current)null!=n&&("function"==typeof n?n(t):n.current=t)},[]);return function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];if(!r.every(e=>null==e))return e.current=r,t}}();return(0,r.useCallback)(t=>function(e){let{ourProps:t,theirProps:n,slot:r,defaultTag:s,features:i,visible:o=!0,name:l,mergeRefs:c}=e;c=null!=c?c:aw;let u=ow(n,t);if(o)return iw(u,r,s,l,c);let h=null!=i?i:0;if(2&h){let{static:e=!1}=u,t=a(u,$E);if(e)return iw(t,r,s,l,c)}if(1&h){let{unmount:e=!0}=u,t=a(u,ew);return uE(e?0:1,{0:()=>null,1:()=>iw(d(d({},t),{},{hidden:!0,style:{display:"none"}}),r,s,l,c)})}return iw(u,r,s,l,c)}(d({mergeRefs:e},t)),[e])}function iw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=uw(e,["unmount","static"]),{as:l=n,children:c,refName:u="ref"}=o,d=a(o,tw),h=void 0!==e.ref?{[u]:e.ref}:{},f="function"==typeof c?c(t):c;"className"in d&&d.className&&"function"==typeof d.className&&(d.className=d.className(t)),d["aria-labelledby"]&&d["aria-labelledby"]===d.id&&(d["aria-labelledby"]=void 0);let p={};if(t){let e=!1,n=[];for(let[r,s]of Object.entries(t))"boolean"==typeof s&&(e=!0),!0===s&&n.push(r.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase())));if(e){p["data-headlessui-state"]=n.join(" ");for(let e of n)p["data-".concat(e)]=""}}if(hw(l)&&(Object.keys(cw(d)).length>0||Object.keys(cw(p)).length>0)){if(!(!(0,r.isValidElement)(f)||Array.isArray(f)&&f.length>1||function(e){return hw(e.type)}(f))){let e=f.props,t=null==e?void 0:e.className,n="function"==typeof t?function(){return JE(t(...arguments),d.className)}:JE(t,d.className),s=n?{className:n}:{},a=ow(f.props,cw(uw(d,["ref"])));for(let r in p)r in a&&delete p[r];return(0,r.cloneElement)(f,Object.assign({},a,p,h,{ref:i(dw(f),h.ref)},s))}if(Object.keys(cw(d)).length>0)throw new Error(['Passing props on "Fragment"!',"","The current component <".concat(s,' /> is rendering a "Fragment".'),"However we need to passthrough the following props:",Object.keys(cw(d)).concat(Object.keys(cw(p))).map(e=>"  - ".concat(e)).join("\n"),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(e=>"  - ".concat(e)).join("\n")].join("\n"))}return(0,r.createElement)(l,Object.assign({},uw(d,["ref"]),!hw(l)&&h,!hw(l)&&p),f)}function aw(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(e=>null==e)?void 0:e=>{for(let n of t)null!=n&&("function"==typeof n?n(e):n.current=e)}}function ow(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)return{};if(1===t.length)return t[0];let r={},s={};for(let i of t)for(let e in i)e.startsWith("on")&&"function"==typeof i[e]?(null!=s[e]||(s[e]=[]),s[e].push(i[e])):r[e]=i[e];if(r.disabled||r["aria-disabled"])for(let i in s)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(i)&&(s[i]=[e=>{var t;return null==(t=null==e?void 0:e.preventDefault)?void 0:t.call(e)}]);for(let i in s)Object.assign(r,{[i](e){let t=s[i];for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(let s of t){if((e instanceof Event||(null==e?void 0:e.nativeEvent)instanceof Event)&&e.defaultPrevented)return;s(e,...r)}}});return r}function lw(e){var t;return Object.assign((0,r.forwardRef)(e),{displayName:null!=(t=e.displayName)?t:e.name})}function cw(e){let t=Object.assign({},e);for(let n in t)void 0===t[n]&&delete t[n];return t}function uw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Object.assign({},e);for(let r of t)r in n&&delete n[r];return n}function dw(e){return r.version.split(".")[0]>="19"?e.props.ref:e.ref}function hw(e){return e===r.Fragment||e===Symbol.for("react.fragment")}const fw=["features"];var pw=(e=>(e[e.None=1]="None",e[e.Focusable=2]="Focusable",e[e.Hidden=4]="Hidden",e))(pw||{});let gw=lw(function(e,t){var n;let{features:r=1}=e,s=a(e,fw),i={ref:t,"aria-hidden":2===(2&r)||(null!=(n=s["aria-hidden"])?n:void 0),hidden:4===(4&r)||void 0,style:d({position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"},4===(4&r)&&2!==(2&r)&&{display:"none"})};return sw()({ourProps:i,theirProps:s,slot:{},defaultTag:"span",name:"Hidden"})});let mw=(0,r.createContext)(null);function vw(e){let{children:t,node:n}=e,[s,i]=(0,r.useState)(null),a=yw(null!=n?n:s);return r.createElement(mw.Provider,{value:a},t,null===a&&r.createElement(gw,{features:pw.Hidden,ref:e=>{var t,n;if(e)for(let r of null!=(n=null==(t=TE(e))?void 0:t.querySelectorAll("html > *, body > *"))?n:[])if(r!==document.body&&r!==document.head&&RE(r)&&null!=r&&r.contains(e)){i(r);break}}}))}function yw(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var t;return null!=(t=(0,r.useContext)(mw))?t:e}function bw(){let e;return{before(t){let{doc:n}=t;var r;let s=n.documentElement,i=null!=(r=n.defaultView)?r:window;e=Math.max(0,i.innerWidth-s.clientWidth)},after(t){let{doc:n,d:r}=t,s=n.documentElement,i=Math.max(0,s.clientWidth-s.offsetWidth),a=Math.max(0,e-i);r.style(s,"paddingRight","".concat(a,"px"))}}}function Ew(){return WE()?{before(e){let{doc:t,d:n,meta:r}=e;function s(e){for(let t of r().containers)for(let n of t())if(n.contains(e))return!0;return!1}n.microTask(()=>{var e;if("auto"!==window.getComputedStyle(t.documentElement).scrollBehavior){let e=Xb();e.style(t.documentElement,"scrollBehavior","auto"),n.add(()=>n.microTask(()=>e.dispose()))}let r=null!=(e=window.scrollY)?e:window.pageYOffset,i=null;n.addEventListener(t,"click",e=>{if(DE(e.target))try{let n=e.target.closest("a");if(!n)return;let{hash:r}=new URL(n.href),a=t.querySelector(r);DE(a)&&!s(a)&&(i=a)}catch(n){}},!0),n.group(e=>{n.addEventListener(t,"touchstart",t=>{if(e.dispose(),DE(t.target)&&function(e){return RE(e)&&"style"in e}(t.target))if(s(t.target)){let n=t.target;for(;n.parentElement&&s(n.parentElement);)n=n.parentElement;e.style(n,"overscrollBehavior","contain")}else e.style(t.target,"touchAction","none")})}),n.addEventListener(t,"touchmove",e=>{if(DE(e.target)){if(function(e){return PE(e)&&"INPUT"===e.nodeName}(e.target))return;if(s(e.target)){let t=e.target;for(;t.parentElement&&""!==t.dataset.headlessuiPortal&&!(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth);)t=t.parentElement;""===t.dataset.headlessuiPortal&&e.preventDefault()}else e.preventDefault()}},{passive:!1}),n.add(()=>{var e;let t=null!=(e=window.scrollY)?e:window.pageYOffset;r!==t&&window.scrollTo(0,r),i&&i.isConnected&&(i.scrollIntoView({block:"nearest"}),i=null)})})}}:{}}function ww(e){let t={};for(let n of e)Object.assign(t,n(t));return t}let Sw=function(e,t){let n=e(),r=new Set;return{getSnapshot:()=>n,subscribe:e=>(r.add(e),()=>r.delete(e)),dispatch(e){for(var s=arguments.length,i=new Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];let o=t[e].call(n,...i);o&&(n=o,r.forEach(e=>e()))}}}(()=>new Map,{PUSH(e,t){var n;let r=null!=(n=this.get(e))?n:{doc:e,count:0,d:Xb(),meta:new Set,computedMeta:{}};return r.count++,r.meta.add(t),r.computedMeta=ww(r.meta),this.set(e,r),this},POP(e,t){let n=this.get(e);return n&&(n.count--,n.meta.delete(t),n.computedMeta=ww(n.meta)),this},SCROLL_PREVENT(e){let t={doc:e.doc,d:e.d,meta:()=>e.computedMeta},n=[Ew(),bw(),{before(e){let{doc:t,d:n}=e;n.style(t.documentElement,"overflow","hidden")}}];n.forEach(e=>{let{before:n}=e;return null==n?void 0:n(t)}),n.forEach(e=>{let{after:n}=e;return null==n?void 0:n(t)})},SCROLL_ALLOW(e){let{d:t}=e;t.dispose()},TEARDOWN(e){let{doc:t}=e;this.delete(t)}});function Tw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>({containers:[]}),s=function(e){return(0,r.useSyncExternalStore)(e.subscribe,e.getSnapshot,e.getSnapshot)}(Sw),i=t?s.get(t):void 0,a=!!i&&i.count>0;return Kb(()=>{if(t&&e)return Sw.dispatch("PUSH",t,n),()=>Sw.dispatch("POP",t,n)},[e,t]),a}function kw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>[document.body];Tw(wE(e,"scroll-lock"),t,e=>{var t;return{containers:[...null!=(t=e.containers)?t:[],n]}})}function xw(){let e=function(){let e="undefined"==typeof document;return"useSyncExternalStore"in s&&(e=>e.useSyncExternalStore)(s)(()=>()=>{},()=>!1,()=>!e)}(),[t,n]=r.useState(Hb.isHandoffComplete);return t&&!1===Hb.isHandoffComplete&&n(!1),r.useEffect(()=>{!0!==t&&n(!0)},[t]),r.useEffect(()=>Hb.handoff(),[]),!e&&t}function Iw(e){return(0,r.useMemo)(()=>e,Object.values(e))}Sw.subscribe(()=>{let e=Sw.getSnapshot(),t=new Map;for(let[n]of e)t.set(n,n.documentElement.style.overflow);for(let n of e.values()){let e="hidden"===t.get(n.doc),r=0!==n.count;(r&&!e||!r&&e)&&Sw.dispatch(n.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",n),0===n.count&&Sw.dispatch("TEARDOWN",n)}});let Lw=Symbol();function Cw(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let s=(0,r.useRef)(t);(0,r.useEffect)(()=>{s.current=t},[t]);let i=yE(e=>{for(let t of s.current)null!=t&&("function"==typeof t?t(e):t.current=e)});return t.every(e=>null==e||(null==e?void 0:e[Lw]))?void 0:i}let _w=(0,r.createContext)(()=>{});function Aw(e){let{value:t,children:n}=e;return r.createElement(_w.Provider,{value:t},n)}let Rw=(0,r.createContext)(null);Rw.displayName="OpenClosedContext";var Pw=(e=>(e[e.Open=1]="Open",e[e.Closed=2]="Closed",e[e.Closing=4]="Closing",e[e.Opening=8]="Opening",e))(Pw||{});function Dw(){return(0,r.useContext)(Rw)}function Ow(e){let{value:t,children:n}=e;return r.createElement(Rw.Provider,{value:t},n)}function Nw(e){let{children:t}=e;return r.createElement(Rw.Provider,{value:null},t)}let Mw=(0,r.createContext)(!1);function Fw(e){return r.createElement(Mw.Provider,{value:e.force},e.children)}let Uw=(0,r.createContext)(void 0);const jw=["id"];let Bw=(0,r.createContext)(null);function Vw(){let e=(0,r.useContext)(Bw);if(null===e){let e=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(e,Vw),e}return e}Bw.displayName="DescriptionContext";let zw=lw(function(e,t){let n=(0,r.useId)(),s=(0,r.useContext)(Uw),{id:i="headlessui-description-".concat(n)}=e,o=a(e,jw),l=Vw(),c=Cw(t);Kb(()=>l.register(i),[i,l.register]);let u=Iw(d(d({},l.slot),{},{disabled:s||!1})),h=d(d({ref:c},l.props),{},{id:i});return sw()({ourProps:h,theirProps:o,slot:u,defaultTag:"p",name:l.name||"Description"})}),Gw=Object.assign(zw,{});function Hw(){let[e]=(0,r.useState)(Xb);return(0,r.useEffect)(()=>()=>e.dispose(),[e]),e}function Kw(){let e=(0,r.useRef)(!1);return Kb(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function Ww(e){let t=yE(e),n=(0,r.useRef)(!1);(0,r.useEffect)(()=>(n.current=!1,()=>{n.current=!0,Qb(()=>{n.current&&t()})}),[t])}var qw=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(qw||{});function Yw(e,t){let n=(0,r.useRef)([]),s=yE(e);(0,r.useEffect)(()=>{let e=[...n.current];for(let[r,i]of t.entries())if(n.current[r]!==i){let r=s(t,e);return n.current=t,r}},[s,...t])}let Qw=[];!function(e){function t(){"loading"!==document.readyState&&(e(),document.removeEventListener("DOMContentLoaded",t))}"undefined"!=typeof window&&"undefined"!=typeof document&&(document.addEventListener("DOMContentLoaded",t),t())}(()=>{function e(e){if(!DE(e.target)||e.target===document.body||Qw[0]===e.target)return;let t=e.target;t=t.closest(OE),Qw.unshift(null!=t?t:e.target),Qw=Qw.filter(e=>null!=e&&e.isConnected),Qw.splice(10)}window.addEventListener("click",e,{capture:!0}),window.addEventListener("mousedown",e,{capture:!0}),window.addEventListener("focus",e,{capture:!0}),document.body.addEventListener("click",e,{capture:!0}),document.body.addEventListener("mousedown",e,{capture:!0}),document.body.addEventListener("focus",e,{capture:!0})});const Xw=["initialFocus","initialFocusFallback","containers","features"];function Zw(e){if(!e)return new Set;if("function"==typeof e)return new Set(e());let t=new Set;for(let n of e.current)RE(n.current)&&t.add(n.current);return t}var Jw=(e=>(e[e.None=0]="None",e[e.InitialFocus=1]="InitialFocus",e[e.TabLock=2]="TabLock",e[e.FocusLock=4]="FocusLock",e[e.RestoreFocus=8]="RestoreFocus",e[e.AutoFocus=16]="AutoFocus",e))(Jw||{});let $w=lw(function(e,t){let n=(0,r.useRef)(null),s=Cw(n,t),{initialFocus:i,initialFocusFallback:o,containers:l,features:c=15}=e,u=a(e,Xw);xw()||(c=0);let d=ZE(n.current);!function(e,t){let{ownerDocument:n}=t,s=!!(8&e),i=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=(0,r.useRef)(Qw.slice());return Yw((e,n)=>{let[r]=e,[s]=n;!0===s&&!1===r&&Qb(()=>{t.current.splice(0)}),!1===s&&!0===r&&(t.current=Qw.slice())},[e,Qw,t]),yE(()=>{var e;return null!=(e=t.current.find(e=>null!=e&&e.isConnected))?e:null})}(s);Yw(()=>{s||function(e){return xE(e)===e}(null==n?void 0:n.body)&&GE(i())},[s]),Ww(()=>{s&&GE(i())})}(c,{ownerDocument:d});let h=tS(c,{ownerDocument:d,container:n,initialFocus:i,initialFocusFallback:o});!function(e,t){let{ownerDocument:n,container:r,containers:s,previousActiveElement:i}=t,a=Kw(),o=!!(4&e);qb(null==n?void 0:n.defaultView,"focus",e=>{if(!o||!a.current)return;let t=Zw(s);PE(r.current)&&t.add(r.current);let n=i.current;if(!n)return;let l=e.target;PE(l)?nS(t,l)?(i.current=l,GE(l)):(e.preventDefault(),e.stopPropagation(),GE(n)):GE(i.current)},!0)}(c,{ownerDocument:d,container:n,containers:l,previousActiveElement:h});let f=function(){let e=(0,r.useRef)(0);return QE(!0,"keydown",t=>{"Tab"===t.key&&(e.current=t.shiftKey?1:0)},!0),e}(),p=yE(e=>{if(!PE(n.current))return;let t=n.current;uE(f.current,{[qw.Forwards]:()=>{KE(t,ME.First,{skipElements:[e.relatedTarget,o]})},[qw.Backwards]:()=>{KE(t,ME.Last,{skipElements:[e.relatedTarget,o]})}})}),g=wE(!!(2&c),"focus-trap#tab-lock"),m=Hw(),v=(0,r.useRef)(!1),y={ref:s,onKeyDown(e){"Tab"==e.key&&(v.current=!0,m.requestAnimationFrame(()=>{v.current=!1}))},onBlur(e){if(!(4&c))return;let t=Zw(l);PE(n.current)&&t.add(n.current);let r=e.relatedTarget;DE(r)&&"true"!==r.dataset.headlessuiFocusGuard&&(nS(t,r)||(v.current?KE(n.current,uE(f.current,{[qw.Forwards]:()=>ME.Next,[qw.Backwards]:()=>ME.Previous})|ME.WrapAround,{relativeTo:e.target}):DE(e.target)&&GE(e.target)))}},b=sw();return r.createElement(r.Fragment,null,g&&r.createElement(gw,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:pw.Focusable}),b({ourProps:y,theirProps:u,defaultTag:"div",name:"FocusTrap"}),g&&r.createElement(gw,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:pw.Focusable}))}),eS=Object.assign($w,{features:Jw});function tS(e,t){let{ownerDocument:n,container:s,initialFocus:i,initialFocusFallback:a}=t,o=(0,r.useRef)(null),l=wE(!!(1&e),"focus-trap#initial-focus"),c=Kw();return Yw(()=>{if(0===e)return;if(!l)return void(null!=a&&a.current&&GE(a.current));let t=s.current;t&&Qb(()=>{if(!c.current)return;let r=null==n?void 0:n.activeElement;if(null!=i&&i.current){if((null==i?void 0:i.current)===r)return void(o.current=r)}else if(t.contains(r))return void(o.current=r);if(null!=i&&i.current)GE(i.current);else{if(16&e){if(KE(t,ME.First|ME.AutoFocus)!==FE.Error)return}else if(KE(t,ME.First)!==FE.Error)return;if(null!=a&&a.current&&(GE(a.current),(null==n?void 0:n.activeElement)===a.current))return;console.warn("There are no focusable elements inside the <FocusTrap />")}o.current=null==n?void 0:n.activeElement})},[a,l,e]),o}function nS(e,t){for(let n of e)if(n.contains(t))return!0;return!1}var rS=n(950);const sS=["ownerDocument"],iS=["enabled","ownerDocument"],aS=["target"];function oS(e){let t=(0,r.useContext)(Mw),n=(0,r.useContext)(dS),[s,i]=(0,r.useState)(()=>{var r;if(!t&&null!==n)return null!=(r=n.current)?r:null;if(Hb.isServer)return null;let s=null==e?void 0:e.getElementById("headlessui-portal-root");if(s)return s;if(null===e)return null;let i=e.createElement("div");return i.setAttribute("id","headlessui-portal-root"),e.body.appendChild(i)});return(0,r.useEffect)(()=>{null!==s&&(null!=e&&e.body.contains(s)||null==e||e.body.appendChild(s))},[s,e]),(0,r.useEffect)(()=>{t||null!==n&&i(n.current)},[n,i,t]),s}let lS=r.Fragment,cS=lw(function(e,t){let{ownerDocument:n=null}=e,s=a(e,sS),i=(0,r.useRef)(null),o=Cw(function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object.assign(e,{[Lw]:t})}(e=>{i.current=e}),t),l=ZE(i.current),c=oS(null!=n?n:l),u=(0,r.useContext)(hS),d=Hw(),h=sw();return Ww(()=>{var e;c&&c.childNodes.length<=0&&(null==(e=c.parentElement)||e.removeChild(c))}),c?(0,rS.createPortal)(r.createElement("div",{"data-headlessui-portal":"",ref:e=>{d.dispose(),u&&e&&d.add(u.register(e))}},h({ourProps:{ref:o},theirProps:s,slot:{},defaultTag:lS,name:"Portal"})),c):null});let uS=r.Fragment,dS=(0,r.createContext)(null);let hS=(0,r.createContext)(null);let fS=lw(function(e,t){let n=Cw(t),{enabled:s=!0,ownerDocument:i}=e,o=a(e,iS),l=sw();return s?r.createElement(cS,d(d({},o),{},{ownerDocument:i,ref:n})):l({ourProps:{ref:n},theirProps:o,slot:{},defaultTag:lS,name:"Portal"})}),pS=lw(function(e,t){let{target:n}=e,s=a(e,aS),i={ref:Cw(t)},o=sw();return r.createElement(dS.Provider,{value:n},o({ourProps:i,theirProps:s,defaultTag:uS,name:"Popover.Group"}))}),gS=Object.assign(fS,{Group:pS});var mS,vS;"undefined"!=typeof process&&"undefined"!=typeof globalThis&&"undefined"!=typeof Element&&"test"===(null==(mS=null==process?void 0:{NODE_ENV:"production",PUBLIC_URL:"/auto-cast-capture",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BASE_URL:"http://192.168.1.183:3000",REACT_APP_DEFAULT_STRIPE_PRICE_ID:"price_1SeoLmFiGpyZE87M9ZOX2uoC",REACT_APP_FIREBASE_API_KEY:"AIzaSyCwoCcI0qoMI72UKbVbAMSHp8UxHLuM960",REACT_APP_FIREBASE_APP_ID:"1:822639495360:web:8483e0da5c9ceb387d0525",REACT_APP_FIREBASE_AUTH_DOMAIN:"towncapture-25aa5.firebaseapp.com",REACT_APP_FIREBASE_PROJECT_ID:"towncapture-25aa5",REACT_APP_FIREBASE_STORAGE_BUCKET:"towncapture-25aa5.firebasestorage.app",REACT_APP_GOOGLE_MAPS_KEY:"AIzaSyCGRWnLsX5MMzlvfMiby5vvH-CsXyD607s",REACT_APP_PUBLIC_CAPTURE_BASE_URL:"http://localhost:3000",REACT_APP_SERVER_URL:"http://192.168.1.183:4450"})?void 0:mS.NODE_ENV)&&"undefined"==typeof(null==(vS=null==Element?void 0:Element.prototype)?void 0:vS.getAnimations)&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join("\n")),[]});var yS=(e=>(e[e.None=0]="None",e[e.Closed=1]="Closed",e[e.Enter=2]="Enter",e[e.Leave=4]="Leave",e))(yS||{});function bS(e,t,n,s){let[i,a]=(0,r.useState)(n),{hasFlag:o,addFlag:l,removeFlag:c}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,[t,n]=(0,r.useState)(e),s=(0,r.useCallback)(e=>n(e),[]),i=(0,r.useCallback)(e=>n(t=>t|e),[]),a=(0,r.useCallback)(e=>(t&e)===e,[t]),o=(0,r.useCallback)(e=>n(t=>t&~e),[]),l=(0,r.useCallback)(e=>n(t=>t^e),[]);return{flags:t,setFlag:s,addFlag:i,hasFlag:a,removeFlag:o,toggleFlag:l}}(e&&i?3:0),u=(0,r.useRef)(!1),d=(0,r.useRef)(!1),h=Hw();return Kb(()=>{var r;if(e)return n&&a(!0),t?(null==(r=null==s?void 0:s.start)||r.call(s,n),function(e,t){let{prepare:n,run:r,done:s,inFlight:i}=t,a=Xb();return function(e,t){let{inFlight:n,prepare:r}=t;if(null!=n&&n.current)return void r();let s=e.style.transition;e.style.transition="none",r(),e.offsetHeight,e.style.transition=s}(e,{prepare:n,inFlight:i}),a.nextFrame(()=>{r(),a.requestAnimationFrame(()=>{a.add(function(e,t){var n,r;let s=Xb();if(!e)return s.dispose;let i=!1;s.add(()=>{i=!0});let a=null!=(r=null==(n=e.getAnimations)?void 0:n.call(e).filter(e=>e instanceof CSSTransition))?r:[];return 0===a.length?(t(),s.dispose):(Promise.allSettled(a.map(e=>e.finished)).then(()=>{i||t()}),s.dispose)}(e,s))})}),a.dispose}(t,{inFlight:u,prepare(){d.current?d.current=!1:d.current=u.current,u.current=!0,!d.current&&(n?(l(3),c(4)):(l(4),c(2)))},run(){d.current?n?(c(3),l(4)):(c(4),l(3)):n?c(1):l(1)},done(){var e;d.current&&function(e){var t,n;return(null!=(n=null==(t=e.getAnimations)?void 0:t.call(e))?n:[]).some(e=>e instanceof CSSTransition&&"finished"!==e.playState)}(t)||(u.current=!1,c(7),n||a(!1),null==(e=null==s?void 0:s.end)||e.call(s,n))}})):void(n&&l(3))},[e,n,t,h]),e?[i,{closed:o(1),enter:o(2),leave:o(4),transition:o(2)||o(4)}]:[n,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}const ES=["transition","beforeEnter","afterEnter","beforeLeave","afterLeave","enter","enterFrom","enterTo","entered","leave","leaveFrom","leaveTo"],wS=["show","appear","unmount"];function SS(e){var t;return!!(e.enter||e.enterFrom||e.enterTo||e.leave||e.leaveFrom||e.leaveTo)||!hw(null!=(t=e.as)?t:CS)||1===r.Children.count(e.children)}let TS=(0,r.createContext)(null);TS.displayName="TransitionContext";var kS=(e=>(e.Visible="visible",e.Hidden="hidden",e))(kS||{});let xS=(0,r.createContext)(null);function IS(e){return"children"in e?IS(e.children):e.current.filter(e=>{let{el:t}=e;return null!==t.current}).filter(e=>{let{state:t}=e;return"visible"===t}).length>0}function LS(e,t){let n=Wb(e),s=(0,r.useRef)([]),i=Kw(),a=Hw(),o=yE(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rw.Hidden,r=s.current.findIndex(t=>{let{el:n}=t;return n===e});-1!==r&&(uE(t,{[rw.Unmount](){s.current.splice(r,1)},[rw.Hidden](){s.current[r].state="hidden"}}),a.microTask(()=>{var e;!IS(s)&&i.current&&(null==(e=n.current)||e.call(n))}))}),l=yE(e=>{let t=s.current.find(t=>{let{el:n}=t;return n===e});return t?"visible"!==t.state&&(t.state="visible"):s.current.push({el:e,state:"visible"}),()=>o(e,rw.Unmount)}),c=(0,r.useRef)([]),u=(0,r.useRef)(Promise.resolve()),d=(0,r.useRef)({enter:[],leave:[]}),h=yE((e,n,r)=>{c.current.splice(0),t&&(t.chains.current[n]=t.chains.current[n].filter(t=>{let[n]=t;return n!==e})),null==t||t.chains.current[n].push([e,new Promise(e=>{c.current.push(e)})]),null==t||t.chains.current[n].push([e,new Promise(e=>{Promise.all(d.current[n].map(e=>{let[t,n]=e;return n})).then(()=>e())})]),"enter"===n?u.current=u.current.then(()=>null==t?void 0:t.wait.current).then(()=>r(n)):r(n)}),f=yE((e,t,n)=>{Promise.all(d.current[t].splice(0).map(e=>{let[t,n]=e;return n})).then(()=>{var e;null==(e=c.current.shift())||e()}).then(()=>n(t))});return(0,r.useMemo)(()=>({children:s,register:l,unregister:o,onStart:h,onStop:f,wait:u,chains:d}),[l,o,s,h,f,d,u])}xS.displayName="NestingContext";let CS=r.Fragment,_S=nw.RenderStrategy;let AS=lw(function(e,t){let{show:n,appear:s=!1,unmount:i=!0}=e,o=a(e,wS),l=(0,r.useRef)(null),c=Cw(...SS(e)?[l,t]:null===t?[]:[t]);xw();let u=Dw();if(void 0===n&&null!==u&&(n=(u&Pw.Open)===Pw.Open),void 0===n)throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[h,f]=(0,r.useState)(n?"visible":"hidden"),p=LS(()=>{n||f("hidden")}),[g,m]=(0,r.useState)(!0),v=(0,r.useRef)([n]);Kb(()=>{!1!==g&&v.current[v.current.length-1]!==n&&(v.current.push(n),m(!1))},[v,n]);let y=(0,r.useMemo)(()=>({show:n,appear:s,initial:g}),[n,s,g]);Kb(()=>{n?f("visible"):!IS(p)&&null!==l.current&&f("hidden")},[n,p]);let b={unmount:i},E=yE(()=>{var t;g&&m(!1),null==(t=e.beforeEnter)||t.call(e)}),w=yE(()=>{var t;g&&m(!1),null==(t=e.beforeLeave)||t.call(e)}),S=sw();return r.createElement(xS.Provider,{value:p},r.createElement(TS.Provider,{value:y},S({ourProps:d(d({},b),{},{as:r.Fragment,children:r.createElement(RS,d(d(d({ref:c},b),o),{},{beforeEnter:E,beforeLeave:w}))}),theirProps:{},defaultTag:r.Fragment,features:_S,visible:"visible"===h,name:"Transition"})))}),RS=lw(function(e,t){var n,s;let{transition:i=!0,beforeEnter:o,afterEnter:l,beforeLeave:c,afterLeave:u,enter:h,enterFrom:f,enterTo:p,entered:g,leave:m,leaveFrom:v,leaveTo:y}=e,b=a(e,ES),[E,w]=(0,r.useState)(null),S=(0,r.useRef)(null),T=SS(e),k=Cw(...T?[S,t,w]:null===t?[]:[t]),x=null==(n=b.unmount)||n?rw.Unmount:rw.Hidden,{show:I,appear:L,initial:C}=function(){let e=(0,r.useContext)(TS);if(null===e)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),[_,A]=(0,r.useState)(I?"visible":"hidden"),R=function(){let e=(0,r.useContext)(xS);if(null===e)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),{register:P,unregister:D}=R;Kb(()=>P(S),[P,S]),Kb(()=>{if(x===rw.Hidden&&S.current)return I&&"visible"!==_?void A("visible"):uE(_,{hidden:()=>D(S),visible:()=>P(S)})},[_,S,P,D,I,x]);let O=xw();Kb(()=>{if(T&&O&&"visible"===_&&null===S.current)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[S,_,O,T]);let N=C&&!L,M=L&&I&&C,F=(0,r.useRef)(!1),U=LS(()=>{F.current||(A("hidden"),D(S))},R),j=yE(e=>{F.current=!0;let t=e?"enter":"leave";U.onStart(S,t,e=>{"enter"===e?null==o||o():"leave"===e&&(null==c||c())})}),B=yE(e=>{let t=e?"enter":"leave";F.current=!1,U.onStop(S,t,e=>{"enter"===e?null==l||l():"leave"===e&&(null==u||u())}),"leave"===t&&!IS(U)&&(A("hidden"),D(S))});(0,r.useEffect)(()=>{T&&i||(j(I),B(I))},[I,T,i]);let V=!(!i||!T||!O||N),[,z]=bS(V,E,I,{start:j,end:B}),G=cw(d({ref:k,className:(null==(s=JE(b.className,M&&h,M&&f,z.enter&&h,z.enter&&z.closed&&f,z.enter&&!z.closed&&p,z.leave&&m,z.leave&&!z.closed&&v,z.leave&&z.closed&&y,!z.transition&&I&&g))?void 0:s.trim())||void 0},function(e){let t={};for(let n in e)!0===e[n]&&(t["data-".concat(n)]="");return t}(z))),H=0;"visible"===_&&(H|=Pw.Open),"hidden"===_&&(H|=Pw.Closed),I&&"hidden"===_&&(H|=Pw.Opening),!I&&"visible"===_&&(H|=Pw.Closing);let K=sw();return r.createElement(xS.Provider,{value:U},r.createElement(Ow,{value:H},K({ourProps:G,theirProps:b,defaultTag:CS,features:_S,visible:"visible"===_,name:"Transition.Child"})))}),PS=lw(function(e,t){let n=null!==(0,r.useContext)(TS),s=null!==Dw();return r.createElement(r.Fragment,null,!n&&s?r.createElement(AS,d({ref:t},e)):r.createElement(RS,d({ref:t},e)))}),DS=Object.assign(AS,{Child:PS,Root:AS});const OS=["id","open","onClose","initialFocus","role","autoFocus","__demoMode","unmount"],NS=["transition","open"],MS=["id","transition"],FS=["transition"],US=["id"];var jS=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(jS||{}),BS=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(BS||{});let VS={0:(e,t)=>e.titleId===t.id?e:d(d({},e),{},{titleId:t.id})},zS=(0,r.createContext)(null);function GS(e){let t=(0,r.useContext)(zS);if(null===t){let t=new Error("<".concat(e," /> is missing a parent <Dialog /> component."));throw Error.captureStackTrace&&Error.captureStackTrace(t,GS),t}return t}function HS(e,t){return uE(t.type,VS,e,t)}zS.displayName="DialogContext";let KS=lw(function(e,t){let n=(0,r.useId)(),{id:s="headlessui-dialog-".concat(n),open:i,onClose:o,initialFocus:l,role:c="dialog",autoFocus:u=!0,__demoMode:d=!1,unmount:h=!1}=e,f=a(e,OS),p=(0,r.useRef)(!1);c="dialog"===c||"alertdialog"===c?c:(p.current||(p.current=!0,console.warn("Invalid role [".concat(c,"] passed to <Dialog />. Only `dialog` and and `alertdialog` are supported. Using `dialog` instead."))),"dialog");let g=Dw();void 0===i&&null!==g&&(i=(g&Pw.Open)===Pw.Open);let m=(0,r.useRef)(null),v=Cw(m,t),y=ZE(m.current),b=i?0:1,[E,w]=(0,r.useReducer)(HS,{titleId:null,descriptionId:null,panelRef:(0,r.createRef)()}),S=yE(()=>o(!1)),T=yE(e=>w({type:0,id:e})),k=!!xw()&&0===b,[x,I]=function(){let e=(0,r.useContext)(hS),t=(0,r.useRef)([]),n=yE(n=>(t.current.push(n),e&&e.register(n),()=>s(n))),s=yE(n=>{let r=t.current.indexOf(n);-1!==r&&t.current.splice(r,1),e&&e.unregister(n)}),i=(0,r.useMemo)(()=>({register:n,unregister:s,portals:t}),[n,s,t]);return[t,(0,r.useMemo)(()=>function(e){let{children:t}=e;return r.createElement(hS.Provider,{value:i},t)},[i])]}(),L={get current(){var e;return null!=(e=E.panelRef.current)?e:m.current}},C=yw(),{resolveContainers:_}=function(){let{defaultContainers:e=[],portals:t,mainTreeNode:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=yE(()=>{var r,s;let i=TE(n),a=[];for(let t of e)null!==t&&(RE(t)?a.push(t):"current"in t&&RE(t.current)&&a.push(t.current));if(null!=t&&t.current)for(let e of t.current)a.push(e);for(let e of null!=(r=null==i?void 0:i.querySelectorAll("html > *, body > *"))?r:[])e!==document.body&&e!==document.head&&RE(e)&&"headlessui-portal-root"!==e.id&&(n&&(e.contains(n)||e.contains(null==(s=null==n?void 0:n.getRootNode())?void 0:s.host))||a.some(t=>e.contains(t))||a.push(e));return a});return{resolveContainers:r,contains:yE(e=>r().some(t=>t.contains(e)))}}({mainTreeNode:C,portals:x,defaultContainers:[L]}),A=null!==g&&(g&Pw.Closing)===Pw.Closing;AE(!d&&!A&&k,{allowed:yE(()=>{var e,t;return[null!=(t=null==(e=m.current)?void 0:e.closest("[data-headlessui-portal]"))?t:null]}),disallowed:yE(()=>{var e;return[null!=(e=null==C?void 0:C.closest("body > *:not(#headlessui-portal-root)"))?e:null]})});let R=mE.get(null);Kb(()=>{if(k)return R.actions.push(s),()=>R.actions.pop(s)},[R,s,k]);let P=bE(R,(0,r.useCallback)(e=>R.selectors.isTop(e,s),[R,s]));XE(P,_,e=>{e.preventDefault(),S()}),SE(P,null==y?void 0:y.defaultView,e=>{e.preventDefault(),e.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur(),S()}),kw(!d&&!A&&k,y,_),function(e,t,n){let s=Wb(e=>{let t=e.getBoundingClientRect();0===t.x&&0===t.y&&0===t.width&&0===t.height&&n()});(0,r.useEffect)(()=>{if(!e)return;let n=null===t?null:PE(t)?t:t.current;if(!n)return;let r=Xb();if("undefined"!=typeof ResizeObserver){let e=new ResizeObserver(()=>s.current(n));e.observe(n),r.add(()=>e.disconnect())}if("undefined"!=typeof IntersectionObserver){let e=new IntersectionObserver(()=>s.current(n));e.observe(n),r.add(()=>e.disconnect())}return()=>r.dispose()},[t,s,e])}(k,m,S);let[D,O]=function(){let[e,t]=(0,r.useState)([]);return[e.length>0?e.join(" "):void 0,(0,r.useMemo)(()=>function(e){let n=yE(e=>(t(t=>[...t,e]),()=>t(t=>{let n=t.slice(),r=n.indexOf(e);return-1!==r&&n.splice(r,1),n}))),s=(0,r.useMemo)(()=>({register:n,slot:e.slot,name:e.name,props:e.props,value:e.value}),[n,e.slot,e.name,e.props,e.value]);return r.createElement(Bw.Provider,{value:s},e.children)},[t])]}(),N=(0,r.useMemo)(()=>[{dialogState:b,close:S,setTitleId:T,unmount:h},E],[b,S,T,h,E]),M=Iw({open:0===b}),F={ref:v,id:s,role:c,tabIndex:-1,"aria-modal":d?void 0:0===b||void 0,"aria-labelledby":E.titleId,"aria-describedby":D,unmount:h},U=!function(){var e;let[t]=(0,r.useState)(()=>"undefined"!=typeof window&&"function"==typeof window.matchMedia?window.matchMedia("(pointer: coarse)"):null),[n,s]=(0,r.useState)(null!=(e=null==t?void 0:t.matches)&&e);return Kb(()=>{if(t)return t.addEventListener("change",e),()=>t.removeEventListener("change",e);function e(e){s(e.matches)}},[t]),n}(),j=Jw.None;k&&!d&&(j|=Jw.RestoreFocus,j|=Jw.TabLock,u&&(j|=Jw.AutoFocus),U&&(j|=Jw.InitialFocus));let B=sw();return r.createElement(Nw,null,r.createElement(Fw,{force:!0},r.createElement(gS,null,r.createElement(zS.Provider,{value:N},r.createElement(pS,{target:m},r.createElement(Fw,{force:!1},r.createElement(O,{slot:M},r.createElement(I,null,r.createElement(eS,{initialFocus:l,initialFocusFallback:m,containers:_,features:j},r.createElement(Aw,{value:S},B({ourProps:F,theirProps:f,slot:M,defaultTag:WS,features:qS,visible:0===b,name:"Dialog"})))))))))))}),WS="div",qS=nw.RenderStrategy|nw.Static;let YS=lw(function(e,t){let{transition:n=!1,open:s}=e,i=a(e,NS),o=Dw(),l=e.hasOwnProperty("open")||null!==o,c=e.hasOwnProperty("onClose");if(!l&&!c)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!l)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!c)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!o&&"boolean"!=typeof e.open)throw new Error("You provided an `open` prop to the `Dialog`, but the value is not a boolean. Received: ".concat(e.open));if("function"!=typeof e.onClose)throw new Error("You provided an `onClose` prop to the `Dialog`, but the value is not a function. Received: ".concat(e.onClose));return void 0===s&&!n||i.static?r.createElement(vw,null,r.createElement(KS,d({ref:t,open:s},i))):r.createElement(vw,null,r.createElement(DS,{show:s,transition:n,unmount:i.unmount},r.createElement(KS,d({ref:t},i))))}),QS=lw(function(e,t){let n=(0,r.useId)(),{id:s="headlessui-dialog-panel-".concat(n),transition:i=!1}=e,o=a(e,MS),[{dialogState:l,unmount:c},u]=GS("Dialog.Panel"),h=Cw(t,u.panelRef),f=Iw({open:0===l}),p=yE(e=>{e.stopPropagation()}),g={ref:h,id:s,onClick:p},m=i?PS:r.Fragment,v=i?{unmount:c}:{},y=sw();return r.createElement(m,d({},v),y({ourProps:g,theirProps:o,slot:f,defaultTag:"div",name:"Dialog.Panel"}))}),XS=(lw(function(e,t){let{transition:n=!1}=e,s=a(e,FS),[{dialogState:i,unmount:o}]=GS("Dialog.Backdrop"),l=Iw({open:0===i}),c={ref:t,"aria-hidden":!0},u=n?PS:r.Fragment,h=n?{unmount:o}:{},f=sw();return r.createElement(u,d({},h),f({ourProps:c,theirProps:s,slot:l,defaultTag:"div",name:"Dialog.Backdrop"}))}),lw(function(e,t){let n=(0,r.useId)(),{id:s="headlessui-dialog-title-".concat(n)}=e,i=a(e,US),[{dialogState:o,setTitleId:l}]=GS("Dialog.Title"),c=Cw(t);(0,r.useEffect)(()=>(l(s),()=>l(null)),[s,l]);let u=Iw({open:0===o}),d={ref:c,id:s};return sw()({ourProps:d,theirProps:i,slot:u,defaultTag:"h2",name:"Dialog.Title"})})),ZS=Object.assign(YS,{Panel:QS,Title:XS,Description:Gw});function JS(){const{t:e}=Bb(),t=xe(),{clientId:n}=Ie(),[s,i]=(0,r.useState)(""),[a,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(""),[h,f]=(0,r.useState)(!1),[p,g]=(0,r.useState)("");return(0,ub.jsxs)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center px-4 relative",children:[(0,ub.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 w-full max-w-sm",children:[(0,ub.jsx)("h1",{className:"text-2xl font-bold text-center text-gray-800 mb-6",children:e("title")}),u&&(0,ub.jsx)("div",{className:"bg-red-50 border border-red-300 text-red-700 p-3 rounded mb-4 text-sm",children:u}),(0,ub.jsxs)("form",{onSubmit:async function(e){if(e.preventDefault(),s&&a){d(""),c(!0);try{const e=await function(e,t,n){return Rr(e.app)?Promise.reject(is(e)):$i(bn(e),ji.credential(t,n)).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&sa(e),t})}(ob,s,a),r=e.user,i=await r.getIdToken(!0);localStorage.setItem("idToken",i);const o=await Rv(Tm(lb,"users",r.uid));if(!o.exists())throw new Error("Your account was not found.");const l=o.data();if(!l.clientId)throw new Error("Invalid client session.");if(n&&l.clientId!==n)throw new Error("Access denied for this tenant.");localStorage.setItem("clientId",l.clientId),t("/".concat(l.clientId,"/dashboard"),{replace:!0})}catch(r){d(r.message)}finally{c(!1)}}},children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"text-gray-700 font-medium text-sm",children:e("email")}),(0,ub.jsx)("input",{autoFocus:!0,type:"email",value:s,onChange:e=>i(e.target.value),className:"border rounded w-full p-2 mt-1 mb-4 focus:ring-blue-500 focus:border-blue-500",placeholder:e("placeholderEmail"),required:!0})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"text-gray-700 font-medium text-sm",children:e("password")}),(0,ub.jsx)("input",{type:"password",value:a,onChange:e=>o(e.target.value),className:"border rounded w-full p-2 mt-1 mb-6 focus:ring-blue-500 focus:border-blue-500",placeholder:e("placeholderPassword"),required:!0})]}),(0,ub.jsx)("button",{disabled:l,className:"w-full py-2 rounded font-semibold text-white transition\n              ".concat(l?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"),children:e(l?"signingIn":"login")}),(0,ub.jsx)("button",{type:"button",onClick:()=>f(!0),className:"mt-3 w-full text-blue-600 text-sm hover:underline",children:e("forgot")})]}),(0,ub.jsxs)("p",{className:"text-xs text-gray-400 text-center mt-6",children:["\xa9 ",e("year",{year:(new Date).getFullYear()})]})]}),(0,ub.jsxs)(ZS,{open:h,onClose:()=>f(!1),className:"relative z-50",children:[(0,ub.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,ub.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,ub.jsxs)(ZS.Panel,{className:"bg-white rounded-lg p-6 max-w-sm w-full shadow-xl",children:[(0,ub.jsx)(ZS.Title,{className:"text-lg font-bold mb-2",children:e("forgot")}),(0,ub.jsx)("p",{className:"text-sm mb-4",children:e("enterEmail")}),(0,ub.jsx)("input",{type:"email",className:"border rounded w-full p-2 mb-4",value:s,onChange:e=>i(e.target.value),placeholder:e("placeholderEmail")}),(0,ub.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,ub.jsx)("button",{className:"px-4 py-2 rounded bg-gray-100",onClick:()=>f(!1),children:"Cancel"}),(0,ub.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 text-white",onClick:async function(){if(s){d("");try{const t=window.location.origin;await async function(e,t,n){const r=di(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&ra(r,s,n),await wi(r,s,"getOobCode",Ri,"EMAIL_PASSWORD_PROVIDER")}(ob,s,{url:"".concat(t,"/").concat(n,"/login"),handleCodeInApp:!1}),f(!1),g(e("resetSent")),setTimeout(()=>g(""),3500)}catch(t){d(t.message)}}else d(e("enterEmail"))},children:"Send"})]})]})})]}),p&&(0,ub.jsx)("div",{className:"absolute top-4 right-4 bg-green-600 text-white py-2 px-4 rounded shadow-lg animate-fadeIn",children:p})]})}const $S=["base"],eT=["padTo","floor"];class tT extends Error{}class nT extends tT{constructor(e){super("Invalid DateTime: ".concat(e.toMessage()))}}class rT extends tT{constructor(e){super("Invalid Interval: ".concat(e.toMessage()))}}class sT extends tT{constructor(e){super("Invalid Duration: ".concat(e.toMessage()))}}class iT extends tT{}class aT extends tT{constructor(e){super("Invalid unit ".concat(e))}}class oT extends tT{}class lT extends tT{constructor(){super("Zone is an abstract class")}}const cT="numeric",uT="short",dT="long",hT={year:cT,month:cT,day:cT},fT={year:cT,month:uT,day:cT},pT={year:cT,month:uT,day:cT,weekday:uT},gT={year:cT,month:dT,day:cT},mT={year:cT,month:dT,day:cT,weekday:dT},vT={hour:cT,minute:cT},yT={hour:cT,minute:cT,second:cT},bT={hour:cT,minute:cT,second:cT,timeZoneName:uT},ET={hour:cT,minute:cT,second:cT,timeZoneName:dT},wT={hour:cT,minute:cT,hourCycle:"h23"},ST={hour:cT,minute:cT,second:cT,hourCycle:"h23"},TT={hour:cT,minute:cT,second:cT,hourCycle:"h23",timeZoneName:uT},kT={hour:cT,minute:cT,second:cT,hourCycle:"h23",timeZoneName:dT},xT={year:cT,month:cT,day:cT,hour:cT,minute:cT},IT={year:cT,month:cT,day:cT,hour:cT,minute:cT,second:cT},LT={year:cT,month:uT,day:cT,hour:cT,minute:cT},CT={year:cT,month:uT,day:cT,hour:cT,minute:cT,second:cT},_T={year:cT,month:uT,day:cT,weekday:uT,hour:cT,minute:cT},AT={year:cT,month:dT,day:cT,hour:cT,minute:cT,timeZoneName:uT},RT={year:cT,month:dT,day:cT,hour:cT,minute:cT,second:cT,timeZoneName:uT},PT={year:cT,month:dT,day:cT,weekday:dT,hour:cT,minute:cT,timeZoneName:dT},DT={year:cT,month:dT,day:cT,weekday:dT,hour:cT,minute:cT,second:cT,timeZoneName:dT};class OT{get type(){throw new lT}get name(){throw new lT}get ianaName(){return this.name}get isUniversal(){throw new lT}offsetName(e,t){throw new lT}formatOffset(e,t){throw new lT}offset(e){throw new lT}equals(e){throw new lT}get isValid(){throw new lT}}let NT=null;class MT extends OT{static get instance(){return null===NT&&(NT=new MT),NT}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,t){let{format:n,locale:r}=t;return nx(e,n,r)}formatOffset(e,t){return ax(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}const FT=new Map;const UT={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};const jT=new Map;class BT extends OT{static create(e){let t=jT.get(e);return void 0===t&&jT.set(e,t=new BT(e)),t}static resetCache(){jT.clear(),FT.clear()}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(_w){return!1}}constructor(e){super(),this.zoneName=e,this.valid=BT.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,t){let{format:n,locale:r}=t;return nx(e,n,r,this.name)}formatOffset(e,t){return ax(this.offset(e),t)}offset(e){if(!this.valid)return NaN;const t=new Date(e);if(isNaN(t))return NaN;const n=function(e){let t=FT.get(e);return void 0===t&&(t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),FT.set(e,t)),t}(this.name);let[r,s,i,a,o,l,c]=n.formatToParts?function(e,t){const n=e.formatToParts(t),r=[];for(let s=0;s<n.length;s++){const{type:e,value:t}=n[s],i=UT[e];"era"===e?r[i]=t:Nk(i)||(r[i]=parseInt(t,10))}return r}(n,t):function(e,t){const n=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,s,i,a,o,l,c,u]=r;return[a,s,i,o,l,c,u]}(n,t);"BC"===a&&(r=1-Math.abs(r));let u=+t;const d=u%1e3;return u-=d>=0?d:1e3+d,(Jk({year:r,month:s,day:i,hour:24===o?0:o,minute:l,second:c,millisecond:0})-u)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let VT={};const zT=new Map;function GT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=JSON.stringify([e,t]);let r=zT.get(n);return void 0===r&&(r=new Intl.DateTimeFormat(e,t),zT.set(n,r)),r}const HT=new Map;const KT=new Map;let WT=null;const qT=new Map;function YT(e){let t=qT.get(e);return void 0===t&&(t=new Intl.DateTimeFormat(e).resolvedOptions(),qT.set(e,t)),t}const QT=new Map;function XT(e,t,n,r){const s=e.listingMode();return"error"===s?null:"en"===s?n(t):r(t)}class ZT{constructor(e,t,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;const{padTo:r,floor:s}=n,i=a(n,eT);if(!t||Object.keys(i).length>0){const t=d({useGrouping:!1},n);n.padTo>0&&(t.minimumIntegerDigits=n.padTo),this.inf=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=JSON.stringify([e,t]);let r=HT.get(n);return void 0===r&&(r=new Intl.NumberFormat(e,t),HT.set(n,r)),r}(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return Hk(this.floor?Math.floor(e):Yk(e,3),this.padTo)}}class JT{constructor(e,t,n){let r;if(this.opts=n,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const t=e.offset/60*-1,n=t>=0?"Etc/GMT+".concat(t):"Etc/GMT".concat(t);0!==e.offset&&BT.create(n).valid?(r=n,this.dt=e):(r="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,r=e.zone.name):(r="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s=d({},this.opts);s.timeZone=s.timeZone||r,this.dtf=GT(t,s)}format(){return this.originalZone?this.formatToParts().map(e=>{let{value:t}=e;return t}).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(e=>{if("timeZoneName"===e.type){const t=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return d(d({},e),{},{value:t})}return e}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class $T{constructor(e,t,n){this.opts=d({style:"long"},n),!t&&Uk()&&(this.rtf=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{base:n}=t,r=a(t,$S),s=JSON.stringify([e,r]);let i=KT.get(s);return void 0===i&&(i=new Intl.RelativeTimeFormat(e,t),KT.set(s,i)),i}(e,n))}format(e,t){return this.rtf?this.rtf.format(e,t):function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"always",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},i=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===n&&i){const n="days"===e;switch(t){case 1:return n?"tomorrow":"next ".concat(s[e][0]);case-1:return n?"yesterday":"last ".concat(s[e][0]);case 0:return n?"today":"this ".concat(s[e][0])}}const a=Object.is(t,-0)||t<0,o=Math.abs(t),l=1===o,c=s[e],u=r?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return a?"".concat(o," ").concat(u," ago"):"in ".concat(o," ").concat(u)}(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const ek={firstDay:1,minimalDays:4,weekend:[6,7]};class tk{static fromOpts(e){return tk.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i=e||bk.defaultLocale,a=i||(s?"en-US":WT||(WT=(new Intl.DateTimeFormat).resolvedOptions().locale,WT)),o=t||bk.defaultNumberingSystem,l=n||bk.defaultOutputCalendar,c=zk(r)||bk.defaultWeekSettings;return new tk(a,o,l,c,i)}static resetCache(){WT=null,zT.clear(),HT.clear(),KT.clear(),qT.clear(),QT.clear()}static fromObject(){let{locale:e,numberingSystem:t,outputCalendar:n,weekSettings:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return tk.create(e,t,n,r)}constructor(e,t,n,r,s){const[i,a,o]=function(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const n=e.indexOf("-u-");if(-1===n)return[e];{let t,r;try{t=GT(e).resolvedOptions(),r=e}catch(_w){const i=e.substring(0,n);t=GT(i).resolvedOptions(),r=i}const{numberingSystem:s,calendar:i}=t;return[r,s,i]}}(e);this.locale=i,this.numberingSystem=t||a||null,this.outputCalendar=n||o||null,this.weekSettings=r,this.intl=function(e,t,n){return n||t?(e.includes("-u-")||(e+="-u"),n&&(e+="-ca-".concat(n)),t&&(e+="-nu-".concat(t)),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===YT(e.locale).numberingSystem)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=(null===this.numberingSystem||"latn"===this.numberingSystem)&&(null===this.outputCalendar||"gregory"===this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?tk.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,zk(e.weekSettings)||this.weekSettings,e.defaultToEN||!1):this}redefaultToEN(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.clone(d(d({},e),{},{defaultToEN:!0}))}redefaultToSystem(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.clone(d(d({},e),{},{defaultToEN:!1}))}months(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return XT(this,e,dx,()=>{const n="ja"===this.intl||this.intl.startsWith("ja-");t&=!n;const r=t?{month:e,day:"numeric"}:{month:e},s=t?"format":"standalone";if(!this.monthsCache[s][e]){const t=n?e=>this.dtFormatter(e,r).format():e=>this.extract(e,r,"month");this.monthsCache[s][e]=function(e){const t=[];for(let n=1;n<=12;n++){const r=yL.utc(2009,n,1);t.push(e(r))}return t}(t)}return this.monthsCache[s][e]})}weekdays(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return XT(this,e,gx,()=>{const n=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},r=t?"format":"standalone";return this.weekdaysCache[r][e]||(this.weekdaysCache[r][e]=function(e){const t=[];for(let n=1;n<=7;n++){const r=yL.utc(2016,11,13+n);t.push(e(r))}return t}(e=>this.extract(e,n,"weekday"))),this.weekdaysCache[r][e]})}meridiems(){return XT(this,void 0,()=>mx,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[yL.utc(2016,11,13,9),yL.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return XT(this,e,Ex,()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[yL.utc(-40,1,1),yL.utc(2017,1,1)].map(e=>this.extract(e,t,"era"))),this.eraCache[e]})}extract(e,t,n){const r=this.dtFormatter(e,t).formatToParts().find(e=>e.type.toLowerCase()===n);return r?r.value:null}numberFormatter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ZT(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new JT(e,this.intl,t)}relFormatter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new $T(this.intl,this.isEnglish(),e)}listFormatter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=JSON.stringify([e,t]);let r=VT[n];return r||(r=new Intl.ListFormat(e,t),VT[n]=r),r}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||YT(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:jk()?function(e){let t=QT.get(e);if(!t){const n=new Intl.Locale(e);t="getWeekInfo"in n?n.getWeekInfo():n.weekInfo,"minimalDays"in t||(t=d(d({},ek),t)),QT.set(e,t)}return t}(this.locale):ek}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return"Locale(".concat(this.locale,", ").concat(this.numberingSystem,", ").concat(this.outputCalendar,")")}}let nk=null;class rk extends OT{static get utcInstance(){return null===nk&&(nk=new rk(0)),nk}static instance(e){return 0===e?rk.utcInstance:new rk(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new rk(rx(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":"UTC".concat(ax(this.fixed,"narrow"))}get ianaName(){return 0===this.fixed?"Etc/UTC":"Etc/GMT".concat(ax(-this.fixed,"narrow"))}offsetName(){return this.name}formatOffset(e,t){return ax(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class sk extends OT{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function ik(e,t){if(Nk(e)||null===e)return t;if(e instanceof OT)return e;if(function(e){return"string"===typeof e}(e)){const n=e.toLowerCase();return"default"===n?t:"local"===n||"system"===n?MT.instance:"utc"===n||"gmt"===n?rk.utcInstance:rk.parseSpecifier(n)||BT.create(e)}return Mk(e)?rk.instance(e):"object"===typeof e&&"offset"in e&&"function"===typeof e.offset?e:new sk(e)}const ak={arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",tibt:"[\u0f20-\u0f29]",latn:"\\d"},ok={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},lk=ak.hanidec.replace(/[\[|\]]/g,"").split("");const ck=new Map;function uk(e){let{numberingSystem:t}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=t||"latn";let s=ck.get(r);void 0===s&&(s=new Map,ck.set(r,s));let i=s.get(n);return void 0===i&&(i=new RegExp("".concat(ak[r]).concat(n)),s.set(n,i)),i}let dk,hk=()=>Date.now(),fk="system",pk=null,gk=null,mk=null,vk=60,yk=null;class bk{static get now(){return hk}static set now(e){hk=e}static set defaultZone(e){fk=e}static get defaultZone(){return ik(fk,MT.instance)}static get defaultLocale(){return pk}static set defaultLocale(e){pk=e}static get defaultNumberingSystem(){return gk}static set defaultNumberingSystem(e){gk=e}static get defaultOutputCalendar(){return mk}static set defaultOutputCalendar(e){mk=e}static get defaultWeekSettings(){return yk}static set defaultWeekSettings(e){yk=zk(e)}static get twoDigitCutoffYear(){return vk}static set twoDigitCutoffYear(e){vk=e%100}static get throwOnInvalid(){return dk}static set throwOnInvalid(e){dk=e}static resetCaches(){tk.resetCache(),BT.resetCache(),yL.resetCache(),ck.clear()}}class Ek{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?"".concat(this.reason,": ").concat(this.explanation):this.reason}}const wk=[0,31,59,90,120,151,181,212,243,273,304,334],Sk=[0,31,60,91,121,152,182,213,244,274,305,335];function Tk(e,t){return new Ek("unit out of range","you specified ".concat(t," (of type ").concat(typeof t,") as a ").concat(e,", which is invalid"))}function kk(e,t,n){const r=new Date(Date.UTC(e,t-1,n));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return 0===s?7:s}function xk(e,t,n){return n+(Qk(e)?Sk:wk)[t-1]}function Ik(e,t){const n=Qk(e)?Sk:wk,r=n.findIndex(e=>e<t);return{month:r+1,day:t-n[r]}}function Lk(e,t){return(e-t+7)%7+1}function Ck(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const{year:r,month:s,day:i}=e,a=xk(r,s,i),o=Lk(kk(r,s,i),n);let l,c=Math.floor((a-o+14-t)/7);return c<1?(l=r-1,c=ex(l,t,n)):c>ex(r,t,n)?(l=r+1,c=1):l=r,d({weekYear:l,weekNumber:c,weekday:o},ox(e))}function _k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const{weekYear:r,weekNumber:s,weekday:i}=e,a=Lk(kk(r,1,t),n),o=Xk(r);let l,c=7*s+i-a-7+t;c<1?(l=r-1,c+=Xk(l)):c>o?(l=r+1,c-=Xk(r)):l=r;const{month:u,day:h}=Ik(l,c);return d({year:l,month:u,day:h},ox(e))}function Ak(e){const{year:t,month:n,day:r}=e;return d({year:t,ordinal:xk(t,n,r)},ox(e))}function Rk(e){const{year:t,ordinal:n}=e,{month:r,day:s}=Ik(t,n);return d({year:t,month:r,day:s},ox(e))}function Pk(e,t){if(!Nk(e.localWeekday)||!Nk(e.localWeekNumber)||!Nk(e.localWeekYear)){if(!Nk(e.weekday)||!Nk(e.weekNumber)||!Nk(e.weekYear))throw new iT("Cannot mix locale-based week fields with ISO-based week fields");return Nk(e.localWeekday)||(e.weekday=e.localWeekday),Nk(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),Nk(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function Dk(e){const t=Fk(e.year),n=Gk(e.month,1,12),r=Gk(e.day,1,Zk(e.year,e.month));return t?n?!r&&Tk("day",e.day):Tk("month",e.month):Tk("year",e.year)}function Ok(e){const{hour:t,minute:n,second:r,millisecond:s}=e,i=Gk(t,0,23)||24===t&&0===n&&0===r&&0===s,a=Gk(n,0,59),o=Gk(r,0,59),l=Gk(s,0,999);return i?a?o?!l&&Tk("millisecond",s):Tk("second",r):Tk("minute",n):Tk("hour",t)}function Nk(e){return"undefined"===typeof e}function Mk(e){return"number"===typeof e}function Fk(e){return"number"===typeof e&&e%1===0}function Uk(){try{return"undefined"!==typeof Intl&&!!Intl.RelativeTimeFormat}catch(_w){return!1}}function jk(){try{return"undefined"!==typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(_w){return!1}}function Bk(e,t,n){if(0!==e.length)return e.reduce((e,r)=>{const s=[t(r),r];return e&&n(e[0],s[0])===e[0]?e:s},null)[1]}function Vk(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function zk(e){if(null==e)return null;if("object"!==typeof e)throw new oT("Week settings must be an object");if(!Gk(e.firstDay,1,7)||!Gk(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some(e=>!Gk(e,1,7)))throw new oT("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function Gk(e,t,n){return Fk(e)&&e>=t&&e<=n}function Hk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;let n;return n=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),n}function Kk(e){return Nk(e)||null===e||""===e?void 0:parseInt(e,10)}function Wk(e){return Nk(e)||null===e||""===e?void 0:parseFloat(e)}function qk(e){if(!Nk(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function Yk(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"round";const r=10**t;switch(n){case"expand":return e>0?Math.ceil(e*r)/r:Math.floor(e*r)/r;case"trunc":return Math.trunc(e*r)/r;case"round":return Math.round(e*r)/r;case"floor":return Math.floor(e*r)/r;case"ceil":return Math.ceil(e*r)/r;default:throw new RangeError("Value rounding ".concat(n," is out of range"))}}function Qk(e){return e%4===0&&(e%100!==0||e%400===0)}function Xk(e){return Qk(e)?366:365}function Zk(e,t){const n=function(e,t){return e-t*Math.floor(e/t)}(t-1,12)+1;return 2===n?Qk(e+(t-n)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function Jk(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function $k(e,t,n){return-Lk(kk(e,1,t),n)+t-1}function ex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=$k(e,t,n),s=$k(e+1,t,n);return(Xk(e)-r+s)/7}function tx(e){return e>99?e:e>bk.twoDigitCutoffYear?1900+e:2e3+e}function nx(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=new Date(e),i={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(i.timeZone=r);const a=d({timeZoneName:t},i),o=new Intl.DateTimeFormat(n,a).formatToParts(s).find(e=>"timezonename"===e.type.toLowerCase());return o?o.value:null}function rx(e,t){let n=parseInt(e,10);Number.isNaN(n)&&(n=0);const r=parseInt(t,10)||0;return 60*n+(n<0||Object.is(n,-0)?-r:r)}function sx(e){const t=Number(e);if("boolean"===typeof e||""===e||!Number.isFinite(t))throw new oT("Invalid unit value ".concat(e));return t}function ix(e,t){const n={};for(const r in e)if(Vk(e,r)){const s=e[r];if(void 0===s||null===s)continue;n[t(r)]=sx(s)}return n}function ax(e,t){const n=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return"".concat(s).concat(Hk(n,2),":").concat(Hk(r,2));case"narrow":return"".concat(s).concat(n).concat(r>0?":".concat(r):"");case"techie":return"".concat(s).concat(Hk(n,2)).concat(Hk(r,2));default:throw new RangeError("Value format ".concat(t," is out of range for property format"))}}function ox(e){return function(e,t){return t.reduce((t,n)=>(t[n]=e[n],t),{})}(e,["hour","minute","second","millisecond"])}const lx=["January","February","March","April","May","June","July","August","September","October","November","December"],cx=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ux=["J","F","M","A","M","J","J","A","S","O","N","D"];function dx(e){switch(e){case"narrow":return[...ux];case"short":return[...cx];case"long":return[...lx];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const hx=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],fx=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],px=["M","T","W","T","F","S","S"];function gx(e){switch(e){case"narrow":return[...px];case"short":return[...fx];case"long":return[...hx];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const mx=["AM","PM"],vx=["Before Christ","Anno Domini"],yx=["BC","AD"],bx=["B","A"];function Ex(e){switch(e){case"narrow":return[...bx];case"short":return[...yx];case"long":return[...vx];default:return null}}function wx(e,t){let n="";for(const r of e)r.literal?n+=r.val:n+=t(r.val);return n}const Sx={D:hT,DD:fT,DDD:gT,DDDD:mT,t:vT,tt:yT,ttt:bT,tttt:ET,T:wT,TT:ST,TTT:TT,TTTT:kT,f:xT,ff:LT,fff:AT,ffff:PT,F:IT,FF:CT,FFF:RT,FFFF:DT};class Tx{static create(e){return new Tx(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}static parseFormat(e){let t=null,n="",r=!1;const s=[];for(let i=0;i<e.length;i++){const a=e.charAt(i);"'"===a?((n.length>0||r)&&s.push({literal:r||/^\s+$/.test(n),val:""===n?"'":n}),t=null,n="",r=!r):r||a===t?n+=a:(n.length>0&&s.push({literal:/^\s+$/.test(n),val:n}),n=a,t=a)}return n.length>0&&s.push({literal:r||/^\s+$/.test(n),val:n}),s}static macroTokenToFormatOpts(e){return Sx[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(e,d(d({},this.opts),t)).format()}dtFormatter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loc.dtFormatter(e,d(d({},this.opts),t))}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(this.opts.forceSimple)return Hk(e,t);const r=d({},this.opts);return t>0&&(r.padTo=t),n&&(r.signDisplay=n),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,t){const n="en"===this.loc.listingMode(),r=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,s=(t,n)=>this.loc.extract(e,t,n),i=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",a=()=>n?function(e){return mx[e.hour<12?0:1]}(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),o=(t,r)=>n?function(e,t){return dx(t)[e.month-1]}(e,t):s(r?{month:t}:{month:t,day:"numeric"},"month"),l=(t,r)=>n?function(e,t){return gx(t)[e.weekday-1]}(e,t):s(r?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),c=t=>{const n=Tx.macroTokenToFormatOpts(t);return n?this.formatWithSystemDefault(e,n):t},u=t=>n?function(e,t){return Ex(t)[e.year<0?0:1]}(e,t):s({era:t},"era");return wx(Tx.parseFormat(t),t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return i({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return i({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return i({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return r?s({day:"numeric"},"day"):this.num(e.day);case"dd":return r?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return r?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return r?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return o("short",!0);case"LLLL":return o("long",!0);case"LLLLL":return o("narrow",!0);case"M":return r?s({month:"numeric"},"month"):this.num(e.month);case"MM":return r?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return o("short",!1);case"MMMM":return o("long",!1);case"MMMMM":return o("narrow",!1);case"y":return r?s({year:"numeric"},"year"):this.num(e.year);case"yy":return r?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return r?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return r?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return u("short");case"GG":return u("long");case"GGGGG":return u("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return c(t)}})}formatDurationFromString(e,t){const n="negativeLargestOnly"===this.opts.signMode?-1:1,r=e=>{switch(e[0]){case"S":return"milliseconds";case"s":return"seconds";case"m":return"minutes";case"h":return"hours";case"d":return"days";case"w":return"weeks";case"M":return"months";case"y":return"years";default:return null}},s=Tx.parseFormat(t),i=s.reduce((e,t)=>{let{literal:n,val:r}=t;return n?e:e.concat(r)},[]),a=e.shiftTo(...i.map(r).filter(e=>e));return wx(s,((e,t)=>s=>{const i=r(s);if(i){const r=t.isNegativeDuration&&i!==t.largestUnit?n:1;let a;return a="negativeLargestOnly"===this.opts.signMode&&i!==t.largestUnit?"never":"all"===this.opts.signMode?"always":"auto",this.num(e.get(i)*r,s.length,a)}return s})(a,{isNegativeDuration:a<0,largestUnit:Object.keys(a.values)[0]}))}}const kx=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function xx(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce((e,t)=>e+t.source,"");return RegExp("^".concat(r,"$"))}function Ix(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>t.reduce((t,n)=>{let[r,s,i]=t;const[a,o,l]=n(e,i);return[d(d({},r),a),o||s,l]},[{},null,1]).slice(0,2)}function Lx(e){if(null==e)return[null,null];for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const[s,i]of n){const t=s.exec(e);if(t)return i(t)}return[null,null]}function Cx(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(e,n)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=Kk(e[n+s]);return[r,null,n+s]}}const _x=/(?:([Zz])|([+-]\d\d)(?::?(\d\d))?)/,Ax="(?:".concat(_x.source,"?(?:\\[(").concat(kx.source,")\\])?)?"),Rx=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Px=RegExp("".concat(Rx.source).concat(Ax)),Dx=RegExp("(?:[Tt]".concat(Px.source,")?")),Ox=Cx("weekYear","weekNumber","weekDay"),Nx=Cx("year","ordinal"),Mx=RegExp("".concat(Rx.source," ?(?:").concat(_x.source,"|(").concat(kx.source,"))?")),Fx=RegExp("(?: ".concat(Mx.source,")?"));function Ux(e,t,n){const r=e[t];return Nk(r)?n:Kk(r)}function jx(e,t){return[{hours:Ux(e,t,0),minutes:Ux(e,t+1,0),seconds:Ux(e,t+2,0),milliseconds:qk(e[t+3])},null,t+4]}function Bx(e,t){const n=!e[t]&&!e[t+1],r=rx(e[t+1],e[t+2]);return[{},n?null:rk.instance(r),t+3]}function Vx(e,t){return[{},e[t]?BT.create(e[t]):null,t+1]}const zx=RegExp("^T?".concat(Rx.source,"$")),Gx=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Hx(e){const[t,n,r,s,i,a,o,l,c]=e,u="-"===t[0],d=l&&"-"===l[0],h=function(e){return void 0!==e&&(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||e&&u)?-e:e};return[{years:h(Wk(n)),months:h(Wk(r)),weeks:h(Wk(s)),days:h(Wk(i)),hours:h(Wk(a)),minutes:h(Wk(o)),seconds:h(Wk(l),"-0"===l),milliseconds:h(qk(c),d)}]}const Kx={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Wx(e,t,n,r,s,i,a){const o={year:2===t.length?tx(Kk(t)):Kk(t),month:cx.indexOf(n)+1,day:Kk(r),hour:Kk(s),minute:Kk(i)};return a&&(o.second=Kk(a)),e&&(o.weekday=e.length>3?hx.indexOf(e)+1:fx.indexOf(e)+1),o}const qx=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Yx(e){const[,t,n,r,s,i,a,o,l,c,u,d]=e,h=Wx(t,s,r,n,i,a,o);let f;return f=l?Kx[l]:c?0:rx(u,d),[h,new rk(f)]}const Qx=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Xx=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Zx=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Jx(e){const[,t,n,r,s,i,a,o]=e;return[Wx(t,s,r,n,i,a,o),rk.utcInstance]}function $x(e){const[,t,n,r,s,i,a,o]=e;return[Wx(t,o,n,r,s,i,a),rk.utcInstance]}const eI=xx(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Dx),tI=xx(/(\d{4})-?W(\d\d)(?:-?(\d))?/,Dx),nI=xx(/(\d{4})-?(\d{3})/,Dx),rI=xx(Px),sI=Ix(function(e,t){return[{year:Ux(e,t),month:Ux(e,t+1,1),day:Ux(e,t+2,1)},null,t+3]},jx,Bx,Vx),iI=Ix(Ox,jx,Bx,Vx),aI=Ix(Nx,jx,Bx,Vx),oI=Ix(jx,Bx,Vx);const lI=Ix(jx);const cI=xx(/(\d{4})-(\d\d)-(\d\d)/,Fx),uI=xx(Mx),dI=Ix(jx,Bx,Vx);const hI="Invalid Duration",fI={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},pI=d({years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6}},fI),gI=365.2425,mI=30.436875,vI=d({years:{quarters:4,months:12,weeks:52.1775,days:gI,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:mI,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3}},fI),yI=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],bI=yI.slice(0).reverse();function EI(e,t){const n={values:arguments.length>2&&void 0!==arguments[2]&&arguments[2]?t.values:d(d({},e.values),t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new kI(n)}function wI(e,t){var n;let r=null!==(n=t.milliseconds)&&void 0!==n?n:0;for(const s of bI.slice(1))t[s]&&(r+=t[s]*e[s].milliseconds);return r}function SI(e,t){const n=wI(e,t)<0?-1:1;yI.reduceRight((r,s)=>{if(Nk(t[s]))return r;if(r){const i=t[r]*n,a=e[s][r],o=Math.floor(i/a);t[s]+=o*n,t[r]-=o*a*n}return s},null),yI.reduce((n,r)=>{if(Nk(t[r]))return n;if(n){const s=t[n]%1;t[n]-=s,t[r]+=s*e[n][r]}return r},null)}function TI(e){const t={};for(const[n,r]of Object.entries(e))0!==r&&(t[n]=r);return t}class kI{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let n=t?vI:pI;e.matrix&&(n=e.matrix),this.values=e.values,this.loc=e.loc||tk.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=n,this.isLuxonDuration=!0}static fromMillis(e,t){return kI.fromObject({milliseconds:e},t)}static fromObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==e||"object"!==typeof e)throw new oT("Duration.fromObject: argument expected to be an object, got ".concat(null===e?"null":typeof e));return new kI({values:ix(e,kI.normalizeUnit),loc:tk.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(Mk(e))return kI.fromMillis(e);if(kI.isDuration(e))return e;if("object"===typeof e)return kI.fromObject(e);throw new oT("Unknown duration argument ".concat(e," of type ").concat(typeof e))}static fromISO(e,t){const[n]=function(e){return Lx(e,[Gx,Hx])}(e);return n?kI.fromObject(n,t):kI.invalid("unparsable",'the input "'.concat(e,"\" can't be parsed as ISO 8601"))}static fromISOTime(e,t){const[n]=function(e){return Lx(e,[zx,lI])}(e);return n?kI.fromObject(n,t):kI.invalid("unparsable",'the input "'.concat(e,"\" can't be parsed as ISO 8601"))}static invalid(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)throw new oT("need to specify a reason the Duration is invalid");const n=e instanceof Ek?e:new Ek(e,t);if(bk.throwOnInvalid)throw new sT(n);return new kI({invalid:n})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new aT(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=d(d({},t),{},{floor:!1!==t.round&&!1!==t.floor});return this.isValid?Tx.create(this.loc,n).formatDurationFromString(this,e):hI}toHuman(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return hI;const t=!1!==e.showZeros,n=yI.map(n=>{const r=this.values[n];return Nk(r)||0===r&&!t?null:this.loc.numberFormatter(d(d({style:"unit",unitDisplay:"long"},e),{},{unit:n.slice(0,-1)})).format(r)}).filter(e=>e);return this.loc.listFormatter(d({type:"conjunction",style:e.listStyle||"narrow"},e)).format(n)}toObject(){return this.isValid?d({},this.values):{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=Yk(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;e=d(d({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},e),{},{includeOffset:!1});return yL.fromMillis(t,{zone:"UTC"}).toISOTime(e)}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?"Duration { values: ".concat(JSON.stringify(this.values)," }"):"Duration { Invalid, reason: ".concat(this.invalidReason," }")}toMillis(){return this.isValid?wI(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=kI.fromDurationLike(e),n={};for(const r of yI)(Vk(t.values,r)||Vk(this.values,r))&&(n[r]=t.get(r)+this.get(r));return EI(this,{values:n},!0)}minus(e){if(!this.isValid)return this;const t=kI.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const n of Object.keys(this.values))t[n]=sx(e(this.values[n],n));return EI(this,{values:t},!0)}get(e){return this[kI.normalizeUnit(e)]}set(e){if(!this.isValid)return this;return EI(this,{values:d(d({},this.values),ix(e,kI.normalizeUnit))})}reconfigure(){let{locale:e,numberingSystem:t,conversionAccuracy:n,matrix:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return EI(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:r,conversionAccuracy:n})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return SI(this.matrix,e),EI(this,{values:e},!0)}rescale(){if(!this.isValid)return this;return EI(this,{values:TI(this.normalize().shiftToAll().toObject())},!0)}shiftTo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!this.isValid)return this;if(0===t.length)return this;t=t.map(e=>kI.normalizeUnit(e));const r={},s={},i=this.toObject();let a;for(const o of yI)if(t.indexOf(o)>=0){a=o;let e=0;for(const n in s)e+=this.matrix[n][o]*s[n],s[n]=0;Mk(i[o])&&(e+=i[o]);const t=Math.trunc(e);r[o]=t,s[o]=(1e3*e-1e3*t)/1e3}else Mk(i[o])&&(s[o]=i[o]);for(const o in s)0!==s[o]&&(r[a]+=o===a?s[o]:s[o]/this.matrix[a][o]);return SI(this.matrix,r),EI(this,{values:r},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return EI(this,{values:e},!0)}removeZeros(){if(!this.isValid)return this;return EI(this,{values:TI(this.values)},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;function t(e,t){return void 0===e||0===e?void 0===t||0===t:e===t}for(const n of yI)if(!t(this.values[n],e.values[n]))return!1;return!0}}const xI="Invalid Interval";class II{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)throw new oT("need to specify a reason the Interval is invalid");const n=e instanceof Ek?e:new Ek(e,t);if(bk.throwOnInvalid)throw new rT(n);return new II({invalid:n})}static fromDateTimes(e,t){const n=bL(e),r=bL(t),s=function(e,t){return e&&e.isValid?t&&t.isValid?t<e?II.invalid("end before start","The end of an interval must be after its start, but you had start=".concat(e.toISO()," and end=").concat(t.toISO())):null:II.invalid("missing or invalid end"):II.invalid("missing or invalid start")}(n,r);return null==s?new II({start:n,end:r}):s}static after(e,t){const n=kI.fromDurationLike(t),r=bL(e);return II.fromDateTimes(r,r.plus(n))}static before(e,t){const n=kI.fromDurationLike(t),r=bL(e);return II.fromDateTimes(r.minus(n),r)}static fromISO(e,t){const[n,r]=(e||"").split("/",2);if(n&&r){let e,s,i,a;try{e=yL.fromISO(n,t),s=e.isValid}catch(r){s=!1}try{i=yL.fromISO(r,t),a=i.isValid}catch(r){a=!1}if(s&&a)return II.fromDateTimes(e,i);if(s){const n=kI.fromISO(r,t);if(n.isValid)return II.after(e,n)}else if(a){const e=kI.fromISO(n,t);if(e.isValid)return II.before(i,e)}}return II.invalid("unparsable",'the input "'.concat(e,"\" can't be parsed as ISO 8601"))}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"milliseconds";return this.isValid?this.toDuration(e).get(e):NaN}count(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"milliseconds",t=arguments.length>1?arguments[1]:void 0;if(!this.isValid)return NaN;const n=this.start.startOf(e,t);let r;return r=null!==t&&void 0!==t&&t.useLocaleWeeks?this.end.reconfigure({locale:n.locale}):this.end,r=r.startOf(e,t),Math.floor(r.diff(n,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&(this.s<=e&&this.e>e)}set(){let{start:e,end:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?II.fromDateTimes(e||this.s,t||this.e):this}splitAt(){if(!this.isValid)return[];for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.map(bL).filter(e=>this.contains(e)).sort((e,t)=>e.toMillis()-t.toMillis()),s=[];let{s:i}=this,a=0;for(;i<this.e;){const e=r[a]||this.e,t=+e>+this.e?this.e:e;s.push(II.fromDateTimes(i,t)),i=t,a+=1}return s}splitBy(e){const t=kI.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let n,{s:r}=this,s=1;const i=[];for(;r<this.e;){const e=this.start.plus(t.mapUnits(e=>e*s));n=+e>+this.e?this.e:e,i.push(II.fromDateTimes(r,n)),r=n,s+=1}return i}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e===+e.s}abutsEnd(e){return!!this.isValid&&+e.e===+this.s}engulfs(e){return!!this.isValid&&(this.s<=e.s&&this.e>=e.e)}equals(e){return!(!this.isValid||!e.isValid)&&(this.s.equals(e.s)&&this.e.equals(e.e))}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,n=this.e<e.e?this.e:e.e;return t>=n?null:II.fromDateTimes(t,n)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,n=this.e>e.e?this.e:e.e;return II.fromDateTimes(t,n)}static merge(e){const[t,n]=e.sort((e,t)=>e.s-t.s).reduce((e,t)=>{let[n,r]=e;return r?r.overlaps(t)||r.abutsStart(t)?[n,r.union(t)]:[n.concat([r]),t]:[n,t]},[[],null]);return n&&t.push(n),t}static xor(e){let t=null,n=0;const r=[],s=e.map(e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}]),i=Array.prototype.concat(...s).sort((e,t)=>e.time-t.time);for(const a of i)n+="s"===a.type?1:-1,1===n?t=a.time:(t&&+t!==+a.time&&r.push(II.fromDateTimes(t,a.time)),t=null);return II.merge(r)}difference(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return II.xor([this].concat(t)).map(e=>this.intersection(e)).filter(e=>e&&!e.isEmpty())}toString(){return this.isValid?"[".concat(this.s.toISO()," \u2013 ").concat(this.e.toISO(),")"):xI}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?"Interval { start: ".concat(this.s.toISO(),", end: ").concat(this.e.toISO()," }"):"Interval { Invalid, reason: ".concat(this.invalidReason," }")}toLocaleString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hT,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isValid?Tx.create(this.s.loc.clone(t),e).formatInterval(this):xI}toISO(e){return this.isValid?"".concat(this.s.toISO(e),"/").concat(this.e.toISO(e)):xI}toISODate(){return this.isValid?"".concat(this.s.toISODate(),"/").concat(this.e.toISODate()):xI}toISOTime(e){return this.isValid?"".concat(this.s.toISOTime(e),"/").concat(this.e.toISOTime(e)):xI}toFormat(e){let{separator:t=" \u2013 "}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isValid?"".concat(this.s.toFormat(e)).concat(t).concat(this.e.toFormat(e)):xI}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):kI.invalid(this.invalidReason)}mapEndpoints(e){return II.fromDateTimes(e(this.s),e(this.e))}}class LI{static hasDST(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bk.defaultZone;const t=yL.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return BT.isValidZone(e)}static normalizeZone(e){return ik(e,bk.defaultZone)}static getStartOfWeek(){let{locale:e=null,locObj:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t||tk.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek(){let{locale:e=null,locObj:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t||tk.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays(){let{locale:e=null,locObj:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t||tk.create(e)).getWeekendDays().slice()}static months(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long",{locale:t=null,numberingSystem:n=null,locObj:r=null,outputCalendar:s="gregory"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(r||tk.create(t,n,s)).months(e)}static monthsFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long",{locale:t=null,numberingSystem:n=null,locObj:r=null,outputCalendar:s="gregory"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(r||tk.create(t,n,s)).months(e,!0)}static weekdays(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long",{locale:t=null,numberingSystem:n=null,locObj:r=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(r||tk.create(t,n,null)).weekdays(e)}static weekdaysFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long",{locale:t=null,numberingSystem:n=null,locObj:r=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(r||tk.create(t,n,null)).weekdays(e,!0)}static meridiems(){let{locale:e=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return tk.create(e).meridiems()}static eras(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short",{locale:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return tk.create(t,null,"gregory").eras(e)}static features(){return{relative:Uk(),localeWeek:jk()}}}function CI(e,t){const n=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=n(t)-n(e);return Math.floor(kI.fromMillis(r).as("days"))}function _I(e,t,n,r){let[s,i,a,o]=function(e,t,n){const r=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const n=CI(e,t);return(n-n%7)/7}],["days",CI]],s={},i=e;let a,o;for(const[l,c]of r)n.indexOf(l)>=0&&(a=l,s[l]=c(e,t),o=i.plus(s),o>t?(s[l]--,(e=i.plus(s))>t&&(o=e,s[l]--,e=i.plus(s))):e=o);return[e,s,o,a]}(e,t,n);const l=t-s,c=n.filter(e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0);0===c.length&&(a<t&&(a=s.plus({[o]:1})),a!==s&&(i[o]=(i[o]||0)+l/(a-s)));const u=kI.fromObject(i,r);return c.length>0?kI.fromMillis(l,r).shiftTo(...c).plus(u):u}function AI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;return{regex:e,deser:e=>{let[n]=e;return t(function(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);if(-1!==e[n].search(ak.hanidec))t+=lk.indexOf(e[n]);else for(const e in ok){const[n,s]=ok[e];r>=n&&r<=s&&(t+=r-n)}}return parseInt(t,10)}return t}(n))}}}const RI=String.fromCharCode(160),PI="[ ".concat(RI,"]"),DI=new RegExp(PI,"g");function OI(e){return e.replace(/\./g,"\\.?").replace(DI,PI)}function NI(e){return e.replace(/\./g,"").replace(DI," ").toLowerCase()}function MI(e,t){return null===e?null:{regex:RegExp(e.map(OI).join("|")),deser:n=>{let[r]=n;return e.findIndex(e=>NI(r)===NI(e))+t}}}function FI(e,t){return{regex:e,deser:e=>{let[,t,n]=e;return rx(t,n)},groups:t}}function UI(e){return{regex:e,deser:e=>{let[t]=e;return t}}}const jI={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let BI=null;function VI(e,t){return Array.prototype.concat(...e.map(e=>function(e,t){if(e.literal)return e;const n=HI(Tx.macroTokenToFormatOpts(e.val),t);return null==n||n.includes(void 0)?e:n}(e,t)))}class zI{constructor(e,t){if(this.locale=e,this.format=t,this.tokens=VI(Tx.parseFormat(t),e),this.units=this.tokens.map(t=>function(e,t){const n=uk(t),r=uk(t,"{2}"),s=uk(t,"{3}"),i=uk(t,"{4}"),a=uk(t,"{6}"),o=uk(t,"{1,2}"),l=uk(t,"{1,3}"),c=uk(t,"{1,6}"),u=uk(t,"{1,9}"),d=uk(t,"{2,4}"),h=uk(t,"{4,6}"),f=e=>{return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:e=>{let[t]=e;return t},literal:!0};var t},p=(p=>{if(e.literal)return f(p);switch(p.val){case"G":return MI(t.eras("short"),0);case"GG":return MI(t.eras("long"),0);case"y":return AI(c);case"yy":case"kk":return AI(d,tx);case"yyyy":case"kkkk":return AI(i);case"yyyyy":return AI(h);case"yyyyyy":return AI(a);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return AI(o);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return AI(r);case"MMM":return MI(t.months("short",!0),1);case"MMMM":return MI(t.months("long",!0),1);case"LLL":return MI(t.months("short",!1),1);case"LLLL":return MI(t.months("long",!1),1);case"o":case"S":return AI(l);case"ooo":case"SSS":return AI(s);case"u":return UI(u);case"uu":return UI(o);case"uuu":case"E":case"c":return AI(n);case"a":return MI(t.meridiems(),0);case"EEE":return MI(t.weekdays("short",!1),1);case"EEEE":return MI(t.weekdays("long",!1),1);case"ccc":return MI(t.weekdays("short",!0),1);case"cccc":return MI(t.weekdays("long",!0),1);case"Z":case"ZZ":return FI(new RegExp("([+-]".concat(o.source,")(?::(").concat(r.source,"))?")),2);case"ZZZ":return FI(new RegExp("([+-]".concat(o.source,")(").concat(r.source,")?")),2);case"z":return UI(/[a-z_+-/]{1,256}?/i);case" ":return UI(/[^\S\n\r]/);default:return f(p)}})(e)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return p.token=e,p}(t,e)),this.disqualifyingUnit=this.units.find(e=>e.invalidReason),!this.disqualifyingUnit){const[e,t]=function(e){const t=e.map(e=>e.regex).reduce((e,t)=>"".concat(e,"(").concat(t.source,")"),"");return["^".concat(t,"$"),e]}(this.units);this.regex=RegExp(e,"i"),this.handlers=t}}explainFromTokens(e){if(this.isValid){const[t,n]=function(e,t,n){const r=e.match(t);if(r){const e={};let t=1;for(const s in n)if(Vk(n,s)){const i=n[s],a=i.groups?i.groups+1:1;!i.literal&&i.token&&(e[i.token.val[0]]=i.deser(r.slice(t,t+a))),t+=a}return[r,e]}return[r,{}]}(e,this.regex,this.handlers),[r,s,i]=n?function(e){let t,n=null;Nk(e.z)||(n=BT.create(e.z)),Nk(e.Z)||(n||(n=new rk(e.Z)),t=e.Z),Nk(e.q)||(e.M=3*(e.q-1)+1),Nk(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),Nk(e.u)||(e.S=qk(e.u));const r=Object.keys(e).reduce((t,n)=>{const r=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(n);return r&&(t[r]=e[n]),t},{});return[r,n,t]}(n):[null,null,void 0];if(Vk(n,"a")&&Vk(n,"H"))throw new iT("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:t,matches:n,result:r,zone:s,specificOffset:i}}return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function GI(e,t,n){return new zI(e,n).explainFromTokens(t)}function HI(e,t){if(!e)return null;const n=Tx.create(t,e).dtFormatter((BI||(BI=yL.fromMillis(1555555555555)),BI)),r=n.formatToParts(),s=n.resolvedOptions();return r.map(t=>function(e,t,n){const{type:r,value:s}=e;if("literal"===r){const e=/^\s+$/.test(s);return{literal:!e,val:e?" ":s}}const i=t[r];let a=r;"hour"===r&&(a=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":n.hour12?"hour12":"hour24");let o=jI[a];if("object"===typeof o&&(o=o[i]),o)return{literal:!1,val:o}}(t,e,s))}const KI="Invalid DateTime",WI=864e13;function qI(e){return new Ek("unsupported zone",'the zone "'.concat(e.name,'" is not supported'))}function YI(e){return null===e.weekData&&(e.weekData=Ck(e.c)),e.weekData}function QI(e){return null===e.localWeekData&&(e.localWeekData=Ck(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function XI(e,t){const n={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new yL(d(d(d({},n),t),{},{old:n}))}function ZI(e,t,n){let r=e-60*t*1e3;const s=n.offset(r);if(t===s)return[r,t];r-=60*(s-t)*1e3;const i=n.offset(r);return s===i?[r,s]:[e-60*Math.min(s,i)*1e3,Math.max(s,i)]}function JI(e,t){const n=new Date(e+=60*t*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function $I(e,t,n){return ZI(Jk(e),t,n)}function eL(e,t){const n=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),i=d(d({},e.c),{},{year:r,month:s,day:Math.min(e.c.day,Zk(r,s))+Math.trunc(t.days)+7*Math.trunc(t.weeks)}),a=kI.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),o=Jk(i);let[l,c]=ZI(o,n,e.zone);return 0!==a&&(l+=a,c=e.zone.offset(l)),{ts:l,o:c}}function tL(e,t,n,r,s,i){const{setZone:a,zone:o}=n;if(e&&0!==Object.keys(e).length||t){const r=t||o,s=yL.fromObject(e,d(d({},n),{},{zone:r,specificOffset:i}));return a?s:s.setZone(o)}return yL.invalid(new Ek("unparsable",'the input "'.concat(s,"\" can't be parsed as ").concat(r)))}function nL(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.isValid?Tx.create(tk.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(e,t):null}function rL(e,t,n){const r=e.c.year>9999||e.c.year<0;let s="";if(r&&e.c.year>=0&&(s+="+"),s+=Hk(e.c.year,r?6:4),"year"===n)return s;if(t){if(s+="-",s+=Hk(e.c.month),"month"===n)return s;s+="-"}else if(s+=Hk(e.c.month),"month"===n)return s;return s+=Hk(e.c.day),s}function sL(e,t,n,r,s,i,a){let o=!n||0!==e.c.millisecond||0!==e.c.second,l="";switch(a){case"day":case"month":case"year":break;default:if(l+=Hk(e.c.hour),"hour"===a)break;if(t){if(l+=":",l+=Hk(e.c.minute),"minute"===a)break;o&&(l+=":",l+=Hk(e.c.second))}else{if(l+=Hk(e.c.minute),"minute"===a)break;o&&(l+=Hk(e.c.second))}if("second"===a)break;!o||r&&0===e.c.millisecond||(l+=".",l+=Hk(e.c.millisecond,3))}return s&&(e.isOffsetFixed&&0===e.offset&&!i?l+="Z":e.o<0?(l+="-",l+=Hk(Math.trunc(-e.o/60)),l+=":",l+=Hk(Math.trunc(-e.o%60))):(l+="+",l+=Hk(Math.trunc(e.o/60)),l+=":",l+=Hk(Math.trunc(e.o%60)))),i&&(l+="["+e.zone.ianaName+"]"),l}const iL={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},aL={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},oL={ordinal:1,hour:0,minute:0,second:0,millisecond:0},lL=["year","month","day","hour","minute","second","millisecond"],cL=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],uL=["year","ordinal","hour","minute","second","millisecond"];function dL(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new aT(e);return t}function hL(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return dL(e)}}function fL(e,t){const n=ik(t.zone,bk.defaultZone);if(!n.isValid)return yL.invalid(qI(n));const r=tk.fromObject(t);let s,i;if(Nk(e.year))s=bk.now();else{for(const n of lL)Nk(e[n])&&(e[n]=iL[n]);const t=Dk(e)||Ok(e);if(t)return yL.invalid(t);const r=function(e){if(void 0===mL&&(mL=bk.now()),"iana"!==e.type)return e.offset(mL);const t=e.name;let n=vL.get(t);return void 0===n&&(n=e.offset(mL),vL.set(t,n)),n}(n);[s,i]=$I(e,r,n)}return new yL({ts:s,zone:n,loc:r,o:i})}function pL(e,t,n){const r=!!Nk(n.round)||n.round,s=Nk(n.rounding)?"trunc":n.rounding,i=(e,i)=>{e=Yk(e,r||n.calendary?0:2,n.calendary?"round":s);return t.loc.clone(n).relFormatter(n).format(e,i)},a=r=>n.calendary?t.hasSame(e,r)?0:t.startOf(r).diff(e.startOf(r),r).get(r):t.diff(e,r).get(r);if(n.unit)return i(a(n.unit),n.unit);for(const o of n.units){const e=a(o);if(Math.abs(e)>=1)return i(e,o)}return i(e>t?-0:0,n.units[n.units.length-1])}function gL(e){let t,n={};return e.length>0&&"object"===typeof e[e.length-1]?(n=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[n,t]}let mL;const vL=new Map;class yL{constructor(e){const t=e.zone||bk.defaultZone;let n=e.invalid||(Number.isNaN(e.ts)?new Ek("invalid input"):null)||(t.isValid?null:qI(t));this.ts=Nk(e.ts)?bk.now():e.ts;let r=null,s=null;if(!n){if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[r,s]=[e.old.c,e.old.o];else{const i=Mk(e.o)&&!e.old?e.o:t.offset(this.ts);r=JI(this.ts,i),n=Number.isNaN(r.year)?new Ek("invalid input"):null,r=n?null:r,s=n?null:i}}this._zone=t,this.loc=e.loc||tk.create(),this.invalid=n,this.weekData=null,this.localWeekData=null,this.c=r,this.o=s,this.isLuxonDateTime=!0}static now(){return new yL({})}static local(){const[e,t]=gL(arguments),[n,r,s,i,a,o,l]=t;return fL({year:n,month:r,day:s,hour:i,minute:a,second:o,millisecond:l},e)}static utc(){const[e,t]=gL(arguments),[n,r,s,i,a,o,l]=t;return e.zone=rk.utcInstance,fL({year:n,month:r,day:s,hour:i,minute:a,second:o,millisecond:l},e)}static fromJSDate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=function(e){return"[object Date]"===Object.prototype.toString.call(e)}(e)?e.valueOf():NaN;if(Number.isNaN(n))return yL.invalid("invalid input");const r=ik(t.zone,bk.defaultZone);return r.isValid?new yL({ts:n,zone:r,loc:tk.fromObject(t)}):yL.invalid(qI(r))}static fromMillis(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Mk(e))return e<-WI||e>WI?yL.invalid("Timestamp out of range"):new yL({ts:e,zone:ik(t.zone,bk.defaultZone),loc:tk.fromObject(t)});throw new oT("fromMillis requires a numerical input, but received a ".concat(typeof e," with value ").concat(e))}static fromSeconds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Mk(e))return new yL({ts:1e3*e,zone:ik(t.zone,bk.defaultZone),loc:tk.fromObject(t)});throw new oT("fromSeconds requires a numerical input")}static fromObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e||{};const n=ik(t.zone,bk.defaultZone);if(!n.isValid)return yL.invalid(qI(n));const r=tk.fromObject(t),s=ix(e,hL),{minDaysInFirstWeek:i,startOfWeek:a}=Pk(s,r),o=bk.now(),l=Nk(t.specificOffset)?n.offset(o):t.specificOffset,c=!Nk(s.ordinal),u=!Nk(s.year),d=!Nk(s.month)||!Nk(s.day),h=u||d,f=s.weekYear||s.weekNumber;if((h||c)&&f)throw new iT("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(d&&c)throw new iT("Can't mix ordinal dates with month/day");const p=f||s.weekday&&!h;let g,m,v=JI(o,l);p?(g=cL,m=aL,v=Ck(v,i,a)):c?(g=uL,m=oL,v=Ak(v)):(g=lL,m=iL);let y=!1;for(const x of g){Nk(s[x])?s[x]=y?m[x]:v[x]:y=!0}const b=p?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=Fk(e.weekYear),s=Gk(e.weekNumber,1,ex(e.weekYear,t,n)),i=Gk(e.weekday,1,7);return r?s?!i&&Tk("weekday",e.weekday):Tk("week",e.weekNumber):Tk("weekYear",e.weekYear)}(s,i,a):c?function(e){const t=Fk(e.year),n=Gk(e.ordinal,1,Xk(e.year));return t?!n&&Tk("ordinal",e.ordinal):Tk("year",e.year)}(s):Dk(s),E=b||Ok(s);if(E)return yL.invalid(E);const w=p?_k(s,i,a):c?Rk(s):s,[S,T]=$I(w,l,n),k=new yL({ts:S,zone:n,o:T,loc:r});return s.weekday&&h&&e.weekday!==k.weekday?yL.invalid("mismatched weekday","you can't specify both a weekday of ".concat(s.weekday," and a date of ").concat(k.toISO())):k.isValid?k:yL.invalid(k.invalid)}static fromISO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[n,r]=function(e){return Lx(e,[eI,sI],[tI,iI],[nI,aI],[rI,oI])}(e);return tL(n,r,t,"ISO 8601",e)}static fromRFC2822(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[n,r]=function(e){return Lx(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[qx,Yx])}(e);return tL(n,r,t,"RFC 2822",e)}static fromHTTP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[n,r]=function(e){return Lx(e,[Qx,Jx],[Xx,Jx],[Zx,$x])}(e);return tL(n,r,t,"HTTP",t)}static fromFormat(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Nk(e)||Nk(t))throw new oT("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:s=null}=n,i=tk.fromOpts({locale:r,numberingSystem:s,defaultToEN:!0}),[a,o,l,c]=function(e,t,n){const{result:r,zone:s,specificOffset:i,invalidReason:a}=GI(e,t,n);return[r,s,i,a]}(i,e,t);return c?yL.invalid(c):tL(a,o,n,"format ".concat(t),e,l)}static fromString(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return yL.fromFormat(e,t,n)}static fromSQL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[n,r]=function(e){return Lx(e,[cI,sI],[uI,dI])}(e);return tL(n,r,t,"SQL",e)}static invalid(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)throw new oT("need to specify a reason the DateTime is invalid");const n=e instanceof Ek?e:new Ek(e,t);if(bk.throwOnInvalid)throw new nT(n);return new yL({invalid:n})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=HI(e,tk.fromObject(t));return n?n.map(e=>e?e.val:null).join(""):null}static expandFormat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return VI(Tx.parseFormat(e),tk.fromObject(t)).map(e=>e.val).join("")}static resetCache(){mL=void 0,vL.clear()}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?YI(this).weekYear:NaN}get weekNumber(){return this.isValid?YI(this).weekNumber:NaN}get weekday(){return this.isValid?YI(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?QI(this).weekday:NaN}get localWeekNumber(){return this.isValid?QI(this).weekNumber:NaN}get localWeekYear(){return this.isValid?QI(this).weekYear:NaN}get ordinal(){return this.isValid?Ak(this.c).ordinal:NaN}get monthShort(){return this.isValid?LI.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?LI.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?LI.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?LI.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,n=Jk(this.c),r=this.zone.offset(n-e),s=this.zone.offset(n+e),i=this.zone.offset(n-r*t),a=this.zone.offset(n-s*t);if(i===a)return[this];const o=n-i*t,l=n-a*t,c=JI(o,i),u=JI(l,a);return c.hour===u.hour&&c.minute===u.minute&&c.second===u.second&&c.millisecond===u.millisecond?[XI(this,{ts:o}),XI(this,{ts:l})]:[this]}get isInLeapYear(){return Qk(this.year)}get daysInMonth(){return Zk(this.year,this.month)}get daysInYear(){return this.isValid?Xk(this.year):NaN}get weeksInWeekYear(){return this.isValid?ex(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?ex(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{locale:t,numberingSystem:n,calendar:r}=Tx.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:n,outputCalendar:r}}toUTC(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.setZone(rk.instance(e),t)}toLocal(){return this.setZone(bk.defaultZone)}setZone(e){let{keepLocalTime:t=!1,keepCalendarTime:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((e=ik(e,bk.defaultZone)).equals(this.zone))return this;if(e.isValid){let r=this.ts;if(t||n){const t=e.offset(this.ts),n=this.toObject();[r]=$I(n,t,e)}return XI(this,{ts:r,zone:e})}return yL.invalid(qI(e))}reconfigure(){let{locale:e,numberingSystem:t,outputCalendar:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return XI(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:n})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=ix(e,hL),{minDaysInFirstWeek:n,startOfWeek:r}=Pk(t,this.loc),s=!Nk(t.weekYear)||!Nk(t.weekNumber)||!Nk(t.weekday),i=!Nk(t.ordinal),a=!Nk(t.year),o=!Nk(t.month)||!Nk(t.day),l=a||o,c=t.weekYear||t.weekNumber;if((l||i)&&c)throw new iT("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&i)throw new iT("Can't mix ordinal dates with month/day");let u;s?u=_k(d(d({},Ck(this.c,n,r)),t),n,r):Nk(t.ordinal)?(u=d(d({},this.toObject()),t),Nk(t.day)&&(u.day=Math.min(Zk(u.year,u.month),u.day))):u=Rk(d(d({},Ak(this.c)),t));const[h,f]=$I(u,this.o,this.zone);return XI(this,{ts:h,o:f})}plus(e){if(!this.isValid)return this;return XI(this,eL(this,kI.fromDurationLike(e)))}minus(e){if(!this.isValid)return this;return XI(this,eL(this,kI.fromDurationLike(e).negate()))}startOf(e){let{useLocaleWeeks:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isValid)return this;const n={},r=kI.normalizeUnit(e);switch(r){case"years":n.month=1;case"quarters":case"months":n.day=1;case"weeks":case"days":n.hour=0;case"hours":n.minute=0;case"minutes":n.second=0;case"seconds":n.millisecond=0}if("weeks"===r)if(t){const e=this.loc.getStartOfWeek(),{weekday:t}=this;t<e&&(n.weekNumber=this.weekNumber-1),n.weekday=e}else n.weekday=1;if("quarters"===r){const e=Math.ceil(this.month/3);n.month=3*(e-1)+1}return this.set(n)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isValid?Tx.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):KI}toLocaleString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hT,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isValid?Tx.create(this.loc.clone(t),e).formatDateTime(this):KI}toLocaleParts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?Tx.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO(){let{format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:n=!1,includeOffset:r=!0,extendedZone:s=!1,precision:i="milliseconds"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return null;i=dL(i);const a="extended"===e;let o=rL(this,a,i);return lL.indexOf(i)>=3&&(o+="T"),o+=sL(this,a,t,n,r,s,i),o}toISODate(){let{format:e="extended",precision:t="day"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?rL(this,"extended"===e,dL(t)):null}toISOWeekDate(){return nL(this,"kkkk-'W'WW-c")}toISOTime(){let{suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:n=!0,includePrefix:r=!1,extendedZone:s=!1,format:i="extended",precision:a="milliseconds"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?(a=dL(a),(r&&lL.indexOf(a)>=3?"T":"")+sL(this,"extended"===i,t,e,n,s,a)):null}toRFC2822(){return nL(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return nL(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?rL(this,!0):null}toSQLTime(){let{includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:n=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r="HH:mm:ss.SSS";return(t||e)&&(n&&(r+=" "),t?r+="z":e&&(r+="ZZ")),nL(this,r,!0)}toSQL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?"".concat(this.toSQLDate()," ").concat(this.toSQLTime(e)):null}toString(){return this.isValid?this.toISO():KI}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?"DateTime { ts: ".concat(this.toISO(),", zone: ").concat(this.zone.name,", locale: ").concat(this.locale," }"):"DateTime { Invalid, reason: ".concat(this.invalidReason," }")}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return{};const t=d({},this.c);return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"milliseconds",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.isValid||!e.isValid)return kI.invalid("created by diffing an invalid DateTime");const r=d({locale:this.locale,numberingSystem:this.numberingSystem},n),s=(o=t,Array.isArray(o)?o:[o]).map(kI.normalizeUnit),i=e.valueOf()>this.valueOf(),a=_I(i?this:e,i?e:this,s,r);var o;return i?a.negate():a}diffNow(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"milliseconds",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.diff(yL.now(),e,t)}until(e){return this.isValid?II.fromDateTimes(this,e):this}hasSame(e,t,n){if(!this.isValid)return!1;const r=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(t,n)<=r&&r<=s.endOf(t,n)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return null;const t=e.base||yL.fromObject({},{zone:this.zone}),n=e.padding?this<t?-e.padding:e.padding:0;let r=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(r=e.unit,s=void 0),pL(t,this.plus(n),d(d({},e),{},{numeric:"always",units:r,unit:s}))}toRelativeCalendar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?pL(e.base||yL.fromObject({},{zone:this.zone}),this,d(d({},e),{},{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!t.every(yL.isDateTime))throw new oT("min requires all arguments be DateTimes");return Bk(t,e=>e.valueOf(),Math.min)}static max(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!t.every(yL.isDateTime))throw new oT("max requires all arguments be DateTimes");return Bk(t,e=>e.valueOf(),Math.max)}static fromFormatExplain(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{locale:r=null,numberingSystem:s=null}=n;return GI(tk.fromOpts({locale:r,numberingSystem:s,defaultToEN:!0}),e,t)}static fromStringExplain(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return yL.fromFormatExplain(e,t,n)}static buildFormatParser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{locale:n=null,numberingSystem:r=null}=t,s=tk.fromOpts({locale:n,numberingSystem:r,defaultToEN:!0});return new zI(s,e)}static fromFormatParser(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Nk(e)||Nk(t))throw new oT("fromFormatParser requires an input string and a format parser");const{locale:r=null,numberingSystem:s=null}=n,i=tk.fromOpts({locale:r,numberingSystem:s,defaultToEN:!0});if(!i.equals(t.locale))throw new oT("fromFormatParser called with a locale of ".concat(i,", ")+"but the format parser was created for ".concat(t.locale));const{result:a,zone:o,specificOffset:l,invalidReason:c}=t.explainFromTokens(e);return c?yL.invalid(c):tL(a,o,n,"format ".concat(t.format),e,l)}static get DATE_SHORT(){return hT}static get DATE_MED(){return fT}static get DATE_MED_WITH_WEEKDAY(){return pT}static get DATE_FULL(){return gT}static get DATE_HUGE(){return mT}static get TIME_SIMPLE(){return vT}static get TIME_WITH_SECONDS(){return yT}static get TIME_WITH_SHORT_OFFSET(){return bT}static get TIME_WITH_LONG_OFFSET(){return ET}static get TIME_24_SIMPLE(){return wT}static get TIME_24_WITH_SECONDS(){return ST}static get TIME_24_WITH_SHORT_OFFSET(){return TT}static get TIME_24_WITH_LONG_OFFSET(){return kT}static get DATETIME_SHORT(){return xT}static get DATETIME_SHORT_WITH_SECONDS(){return IT}static get DATETIME_MED(){return LT}static get DATETIME_MED_WITH_SECONDS(){return CT}static get DATETIME_MED_WITH_WEEKDAY(){return _T}static get DATETIME_FULL(){return AT}static get DATETIME_FULL_WITH_SECONDS(){return RT}static get DATETIME_HUGE(){return PT}static get DATETIME_HUGE_WITH_SECONDS(){return DT}}function bL(e){if(yL.isDateTime(e))return e;if(e&&e.valueOf&&Mk(e.valueOf()))return yL.fromJSDate(e);if(e&&"object"===typeof e)return yL.fromObject(e);throw new oT("Unknown datetime argument: ".concat(e,", of type ").concat(typeof e))}function EL(e){let{icon:t,label:n,menuKey:r,activeMenu:s,collapsed:i,onChangeMenu:a,danger:o,logoutButton:l}=e;const c=s===r,{logout:u}=hb(),d=xe(),h=localStorage.getItem("clientId");return(0,ub.jsx)("li",{children:(0,ub.jsxs)("button",{onClick:async()=>{if(l)try{await u()}finally{d("/".concat(h,"/login"))}else a(r)},className:"w-full flex items-center gap-3 px-3 py-2 rounded-xl transition-colors ".concat(c?"bg-blue-50 text-blue-600 dark:bg-blue-900/40 dark:text-blue-300":o?"text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30":"hover:bg-slate-100 dark:hover:bg-slate-800"),children:[(0,ub.jsx)("i",{className:"bx ".concat(t," text-xl min-w-[1.75rem]")}),!i&&(0,ub.jsx)("span",{className:"text-sm",children:n})]})})}const wL=function(e){let{collapsed:t,activeMenu:n,onChangeMenu:r,isDark:s}=e;const i=s?"bg-slate-900 border-slate-800":"bg-white border-slate-200";return(0,ub.jsxs)("aside",{className:"".concat(i," hidden sm:flex flex-col border-r transition-all duration-200 ").concat(t?"w-18 md:w-20":"w-60"),children:[(0,ub.jsxs)("div",{className:"flex items-center gap-2 px-4 py-4 border-b border-slate-700/20",children:[(0,ub.jsx)("i",{className:"bx bxs-smile bx-md text-blue-500"}),!t&&(0,ub.jsx)("span",{className:"font-bold text-lg tracking-tight",children:"AutoCaster - View"})]}),(0,ub.jsxs)("nav",{className:"flex-1 flex flex-col justify-between py-4",children:[(0,ub.jsxs)("ul",{className:"space-y-1",children:[(0,ub.jsx)(EL,{icon:"bxs-dashboard",label:"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9",menuKey:"dashboard",activeMenu:n,collapsed:t,onChangeMenu:r}),(0,ub.jsx)(EL,{icon:"bxs-camera",label:"\u30ab\u30e1\u30e9 \u8ffd\u52a0",menuKey:"cameras",activeMenu:n,collapsed:t,onChangeMenu:r}),(0,ub.jsx)(EL,{icon:"bx-credit-card",label:"\u30ab\u30e1\u30e9 \u30b9\u30c6\u30fc\u30bf\u30b9",menuKey:"camera-status",activeMenu:n,collapsed:t,onChangeMenu:r}),(0,ub.jsx)(EL,{icon:"bx-image",label:"\u30d5\u30ec\u30fc\u30e0 \u7ba1\u7406",menuKey:"frames",activeMenu:n,collapsed:t,onChangeMenu:r}),(0,ub.jsx)(EL,{icon:"bx-qr",label:"QR \u30b3\u30fc\u30c9",menuKey:"qr",activeMenu:n,collapsed:t,onChangeMenu:r}),(0,ub.jsx)(EL,{icon:"bx-report",label:"\u30ec\u30dd\u30fc\u30c8",menuKey:"report",activeMenu:n,collapsed:t,onChangeMenu:r})]}),(0,ub.jsxs)("ul",{className:"space-y-1 border-t border-slate-700/20 pt-4 mt-4",children:[(0,ub.jsx)(EL,{icon:"bxs-cog",label:"\u8a2d\u5b9a",menuKey:"settings",activeMenu:n,collapsed:t,onChangeMenu:r}),(0,ub.jsx)(EL,{icon:"bx-power-off",label:"Logout",menuKey:"logout",collapsed:t,danger:!0,logoutButton:!0})]})]})]})};const SL=function(e){let{isDark:t,setIsDark:n,sidebarCollapsed:s,setSidebarCollapsed:i,showSearch:a=!0,showDarkMode:o=!0,showNotification:l=!0,showProfile:c=!0}=e;const[u,d]=(0,r.useState)(!1),[h,f]=(0,r.useState)(!1),p=(xe(),(0,r.useRef)(null)),g=(0,r.useRef)(null),m=t?"bg-slate-900 border-slate-800":"bg-white border-slate-200";return(0,r.useEffect)(()=>{function e(e){p.current&&!p.current.contains(e.target)&&d(!1),g.current&&!g.current.contains(e.target)&&f(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,ub.jsxs)("header",{className:"".concat(m," sticky top-0 z-20 border-b flex items-center gap-4 px-4 sm:px-6 h-14"),children:[(0,ub.jsx)("button",{type:"button",className:"inline-flex items-center justify-center rounded-md p-2 hover:bg-slate-200/60 dark:hover:bg-slate-800/80",onClick:()=>i(e=>!e),children:(0,ub.jsx)("i",{className:"bx bx-menu text-xl"})}),(0,ub.jsx)("a",{href:"#",className:"hidden md:inline text-sm font-medium ".concat(t?"text-slate-200":"text-slate-700"," hover:text-blue-500"),children:"Categories"}),!a&&(0,ub.jsx)("div",{className:"ml-auto"})]})};const TL=function(e){let{stats:t}=e;return(0,ub.jsxs)("ul",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-2",children:[(0,ub.jsxs)("li",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-4 flex items-center gap-4",children:[(0,ub.jsx)("div",{className:"w-16 h-16 rounded-xl flex items-center justify-center bg-blue-100 text-blue-600 text-3xl",children:(0,ub.jsx)("i",{className:"bx bxs-calendar-check"})}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("h3",{className:"text-xl font-semibold",children:t.totalCameras}),(0,ub.jsx)("p",{className:"text-slate-500 dark:text-slate-400",children:"Active Cameras"})]})]}),(0,ub.jsxs)("li",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-4 flex items-center gap-4",children:[(0,ub.jsx)("div",{className:"w-16 h-16 rounded-xl flex items-center justify-center bg-yellow-100 text-yellow-600 text-3xl",children:(0,ub.jsx)("i",{className:"bx bxs-group"})}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("h3",{className:"text-xl font-semibold",children:t.totalCapturesToday}),(0,ub.jsx)("p",{className:"text-slate-500 dark:text-slate-400",children:"Captures today"})]})]}),(0,ub.jsxs)("li",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-4 flex items-center gap-4",children:[(0,ub.jsx)("div",{className:"w-16 h-16 rounded-xl flex items-center justify-center bg-orange-100 text-orange-600 text-3xl",children:(0,ub.jsx)("i",{className:"bx bxs-dollar-circle"})}),(0,ub.jsxs)("div",{children:[(0,ub.jsxs)("h3",{className:"text-xl font-semibold",children:["\xa5",t.totalRevenue.toLocaleString()]}),(0,ub.jsx)("p",{className:"text-slate-500 dark:text-slate-400",children:"Total Revenue"})]})]})]})};const kL=function(e){let{status:t}=e,n="bg-slate-200 text-slate-700 dark:bg-slate-800 dark:text-slate-100";return"Active"===t&&(n="bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300"),"Warning"===t&&(n="bg-yellow-100 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-300"),"Offline"===t&&(n="bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300"),(0,ub.jsx)("span",{className:"inline-flex px-3 py-1 rounded-full text-xs font-semibold ".concat(n),children:t})};const xL=function(e){let{cameras:t,onOpenAdd:n,onOpenEdit:r,onOpenView:s,onRequestDelete:i,compact:a=!1,canEdit:o=()=>!0}=e;return(0,ub.jsxs)("div",{className:"".concat("bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl"," p-4 overflow-x-auto"),children:[(0,ub.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,ub.jsx)("h3",{className:"text-lg font-semibold flex-1",children:"\u30ab\u30e1\u30e9\u4e00\u89a7"}),!a&&(0,ub.jsx)(ub.Fragment,{}),(0,ub.jsx)("button",{className:"px-3 py-2 bg-blue-500 text-white rounded-xl text-sm hover:bg-blue-600",onClick:n,children:"\uff0b \u30ab\u30e1\u30e9\u8ffd\u52a0"})]}),(0,ub.jsxs)("table",{className:"min-w-full text-sm",children:[(0,ub.jsx)("thead",{className:"border-b border-slate-200 dark:border-slate-800 text-slate-500 dark:text-slate-400",children:(0,ub.jsxs)("tr",{children:[(0,ub.jsx)("th",{className:"text-left py-2 pr-3",children:"\u30ab\u30e1\u30e9\u540d"}),(0,ub.jsx)("th",{className:"text-left py-2 pr-3",children:"\u8a2d\u7f6e\u5834\u6240"}),(0,ub.jsx)("th",{className:"text-left py-2 pr-3 hidden md:table-cell",children:"\u672c\u65e5\u306e\u64ae\u5f71\u6570"}),(0,ub.jsx)("th",{className:"text-left py-2 pr-3 hidden md:table-cell",children:"\u6709\u6599\u64ae\u5f71\u6570"}),(0,ub.jsx)("th",{className:"text-left py-2 pr-3",children:"\u72b6\u614b"}),(0,ub.jsx)("th",{className:"text-left py-2 pr-3",children:"\u64cd\u4f5c"})]})}),(0,ub.jsxs)("tbody",{children:[t.map(e=>{var t,n;return(0,ub.jsxs)("tr",{className:"border-b last:border-b-0 border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/60",children:[(0,ub.jsx)("td",{className:"py-3 pr-3",children:(0,ub.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ub.jsx)("button",{type:"button",onClick:()=>s(e),className:"w-9 h-9 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-colors",title:"\u8a73\u7d30\u3092\u898b\u308b",children:(0,ub.jsx)("i",{className:"bx bxs-camera text-lg"})}),(0,ub.jsxs)("div",{className:"flex flex-col",children:[(0,ub.jsx)("span",{className:"font-medium",children:e.name}),(0,ub.jsxs)("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["ID\uff1a",e.id]})]})]})}),(0,ub.jsx)("td",{className:"py-3 pr-3",children:(0,ub.jsx)("span",{className:"text-xs sm:text-sm",children:e.locationName||e.location||"\u672a\u8a2d\u5b9a"})}),(0,ub.jsx)("td",{className:"py-3 pr-3 hidden md:table-cell font-medium",children:null!==(t=e.todayCaptures)&&void 0!==t?t:0}),(0,ub.jsx)("td",{className:"py-3 pr-3 hidden md:table-cell",children:null!==(n=e.paidCaptures)&&void 0!==n?n:0}),(0,ub.jsx)("td",{className:"py-3 pr-3",children:(0,ub.jsx)(kL,{status:e.status})}),(0,ub.jsx)("td",{className:"py-3 pr-3 text-xs",children:(0,ub.jsxs)("div",{className:"flex gap-1",children:[(0,ub.jsx)("button",{className:"px-2 py-1 rounded-lg ".concat(o(e)?"bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600":"bg-slate-200 dark:bg-slate-700 opacity-40 cursor-not-allowed"),disabled:!o(e),onClick:()=>o(e)&&r(e),title:o(e)?"\u7de8\u96c6":"\u304a\u652f\u6255\u3044\u304c\u5fc5\u8981\u3067\u3059",children:"\u7de8\u96c6"}),(0,ub.jsx)("button",{className:"px-2 py-1 rounded-lg ".concat(o(e)?"bg-red-500 text-white hover:bg-red-600":"bg-red-400 text-white opacity-40 cursor-not-allowed"),disabled:!o(e),onClick:()=>o(e)&&i(e),title:o(e)?"\u524a\u9664":"\u304a\u652f\u6255\u3044\u304c\u5fc5\u8981\u3067\u3059",children:"\u524a\u9664"})]})})]},e.id)}),0===t.length&&(0,ub.jsx)("tr",{children:(0,ub.jsx)("td",{colSpan:6,className:"py-6 text-center text-slate-500 dark:text-slate-400 text-sm",children:"\u30ab\u30e1\u30e9\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u300c\uff0b \u30ab\u30e1\u30e9\u8ffd\u52a0\u300d\u304b\u3089\u767b\u9332\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})})]})]})]})};var IL,LL;function CL(e){return CL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CL(e)}function _L(e){var t=function(e,t){if("object"!=CL(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=CL(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==CL(t)?t:t+""}function AL(e,t,n){return(t=_L(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function RL(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var PL=(LL||(LL=1,IL=function(e,t,n,r,s,i,a,o){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,s,i,a,o],u=0;(l=new Error(t.replace(/%s/g,function(){return c[u++]}))).name="Invariant Violation"}throw l.framesToPop=1,l}}),IL),DL=RL(PL),OL=(0,r.createContext)(null);function NL(e,t,n,r){var s,i,a={};return s=e,i=(e,s)=>{var i=n[s];i!==t[s]&&(a[s]=i,e(r,i))},Object.keys(s).forEach(e=>i(s[e],e)),a}function ML(e,t,n){var r,s,i,a=(r=n,s=function(n,r,s){return"function"===typeof e[s]&&n.push(google.maps.event.addListener(t,r,e[s])),n},i=[],Object.keys(r).reduce(function(e,t){return s(e,r[t],t)},i));return a}function FL(e){google.maps.event.removeListener(e)}function UL(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(FL)}function jL(e){var{updaterMap:t,eventMap:n,prevProps:r,nextProps:s,instance:i}=e,a=ML(s,i,n);return NL(t,r,s,i),a}var BL={onDblClick:"dblclick",onDragEnd:"dragend",onDragStart:"dragstart",onMapTypeIdChanged:"maptypeid_changed",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseDown:"mousedown",onMouseUp:"mouseup",onRightClick:"rightclick",onTilesLoaded:"tilesloaded",onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onDrag:"drag",onHeadingChanged:"heading_changed",onIdle:"idle",onProjectionChanged:"projection_changed",onResize:"resize",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed"},VL={extraMapTypes(e,t){t.forEach(function(t,n){e.mapTypes.set(String(n),t)})},center(e,t){e.setCenter(t)},clickableIcons(e,t){e.setClickableIcons(t)},heading(e,t){e.setHeading(t)},mapTypeId(e,t){e.setMapTypeId(t)},options(e,t){e.setOptions(t)},streetView(e,t){e.setStreetView(t)},tilt(e,t){e.setTilt(t)},zoom(e,t){e.setZoom(t)}};(0,r.memo)(function(e){var{children:t,options:n,id:s,mapContainerStyle:i,mapContainerClassName:a,center:o,onClick:l,onDblClick:c,onDrag:u,onDragEnd:d,onDragStart:h,onMouseMove:f,onMouseOut:p,onMouseOver:g,onMouseDown:m,onMouseUp:v,onRightClick:y,onCenterChanged:b,onLoad:E,onUnmount:w}=e,[S,T]=(0,r.useState)(null),k=(0,r.useRef)(null),[x,I]=(0,r.useState)(null),[L,C]=(0,r.useState)(null),[_,A]=(0,r.useState)(null),[R,P]=(0,r.useState)(null),[D,O]=(0,r.useState)(null),[N,M]=(0,r.useState)(null),[F,U]=(0,r.useState)(null),[j,B]=(0,r.useState)(null),[V,z]=(0,r.useState)(null),[G,H]=(0,r.useState)(null),[K,W]=(0,r.useState)(null),[q,Y]=(0,r.useState)(null);return(0,r.useEffect)(()=>{n&&null!==S&&S.setOptions(n)},[S,n]),(0,r.useEffect)(()=>{null!==S&&"undefined"!==typeof o&&S.setCenter(o)},[S,o]),(0,r.useEffect)(()=>{S&&c&&(null!==L&&google.maps.event.removeListener(L),C(google.maps.event.addListener(S,"dblclick",c)))},[c]),(0,r.useEffect)(()=>{S&&d&&(null!==_&&google.maps.event.removeListener(_),A(google.maps.event.addListener(S,"dragend",d)))},[d]),(0,r.useEffect)(()=>{S&&h&&(null!==R&&google.maps.event.removeListener(R),P(google.maps.event.addListener(S,"dragstart",h)))},[h]),(0,r.useEffect)(()=>{S&&m&&(null!==D&&google.maps.event.removeListener(D),O(google.maps.event.addListener(S,"mousedown",m)))},[m]),(0,r.useEffect)(()=>{S&&f&&(null!==N&&google.maps.event.removeListener(N),M(google.maps.event.addListener(S,"mousemove",f)))},[f]),(0,r.useEffect)(()=>{S&&p&&(null!==F&&google.maps.event.removeListener(F),U(google.maps.event.addListener(S,"mouseout",p)))},[p]),(0,r.useEffect)(()=>{S&&g&&(null!==j&&google.maps.event.removeListener(j),B(google.maps.event.addListener(S,"mouseover",g)))},[g]),(0,r.useEffect)(()=>{S&&v&&(null!==V&&google.maps.event.removeListener(V),z(google.maps.event.addListener(S,"mouseup",v)))},[v]),(0,r.useEffect)(()=>{S&&y&&(null!==G&&google.maps.event.removeListener(G),H(google.maps.event.addListener(S,"rightclick",y)))},[y]),(0,r.useEffect)(()=>{S&&l&&(null!==K&&google.maps.event.removeListener(K),W(google.maps.event.addListener(S,"click",l)))},[l]),(0,r.useEffect)(()=>{S&&u&&(null!==q&&google.maps.event.removeListener(q),Y(google.maps.event.addListener(S,"drag",u)))},[u]),(0,r.useEffect)(()=>{S&&b&&(null!==x&&google.maps.event.removeListener(x),I(google.maps.event.addListener(S,"center_changed",b)))},[l]),(0,r.useEffect)(()=>{var e=null===k.current?null:new google.maps.Map(k.current,n);return T(e),null!==e&&E&&E(e),()=>{null!==e&&w&&w(e)}},[]),(0,ub.jsx)("div",{id:s,ref:k,style:i,className:a,children:(0,ub.jsx)(OL.Provider,{value:S,children:null!==S?t:null})})});class zL extends r.PureComponent{constructor(){super(...arguments),AL(this,"state",{map:null}),AL(this,"registeredEvents",[]),AL(this,"mapRef",null),AL(this,"getInstance",()=>null===this.mapRef?null:new google.maps.Map(this.mapRef,this.props.options)),AL(this,"panTo",e=>{var t=this.getInstance();t&&t.panTo(e)}),AL(this,"setMapCallback",()=>{null!==this.state.map&&this.props.onLoad&&this.props.onLoad(this.state.map)}),AL(this,"getRef",e=>{this.mapRef=e})}componentDidMount(){var e=this.getInstance();this.registeredEvents=jL({updaterMap:VL,eventMap:BL,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{map:e}},this.setMapCallback)}componentDidUpdate(e){null!==this.state.map&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:VL,eventMap:BL,prevProps:e,nextProps:this.props,instance:this.state.map}))}componentWillUnmount(){null!==this.state.map&&(this.props.onUnmount&&this.props.onUnmount(this.state.map),UL(this.registeredEvents))}render(){return(0,ub.jsx)("div",{id:this.props.id,ref:this.getRef,style:this.props.mapContainerStyle,className:this.props.mapContainerClassName,children:(0,ub.jsx)(OL.Provider,{value:this.state.map,children:null!==this.state.map?this.props.children:null})})}}function GL(e,t,n,r,s,i,a){try{var o=e[i](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,s)}function HL(e){return function(){var t=this,n=arguments;return new Promise(function(r,s){var i=e.apply(t,n);function a(e){GL(i,r,s,a,o,"next",e)}function o(e){GL(i,r,s,a,o,"throw",e)}a(void 0)})}}function KL(e){var{googleMapsApiKey:t,googleMapsClientId:n,version:r="weekly",language:s,region:i,libraries:a,channel:o,mapIds:l,authReferrerPolicy:c,apiUrl:u="https://maps.googleapis.com"}=e,d=[];return DL(t&&n||!(t&&n),"You need to specify either googleMapsApiKey or googleMapsClientId for @react-google-maps/api load script to work. You cannot use both at the same time."),t?d.push("key=".concat(t)):n&&d.push("client=".concat(n)),r&&d.push("v=".concat(r)),s&&d.push("language=".concat(s)),i&&d.push("region=".concat(i)),a&&a.length&&d.push("libraries=".concat(a.sort().join(","))),o&&d.push("channel=".concat(o)),l&&l.length&&d.push("map_ids=".concat(l.join(","))),c&&d.push("auth_referrer_policy=".concat(c)),d.push("loading=async"),d.push("callback=initMap"),"".concat(u,"/maps/api/js?").concat(d.join("&"))}var WL="undefined"!==typeof document;function qL(e){var{url:t,id:n,nonce:r}=e;return WL?new Promise(function(e,s){var i=document.getElementById(n),a=window;if(i){var o=i.getAttribute("data-state");if(i.src===t&&"error"!==o){if("ready"===o)return e(n);var l=a.initMap,c=i.onerror;return a.initMap=function(){l&&l(),e(n)},void(i.onerror=function(e){c&&c(e),s(e)})}i.remove()}var u=document.createElement("script");u.type="text/javascript",u.src=t,u.id=n,u.async=!0,u.nonce=r||"",u.onerror=function(e){u.setAttribute("data-state","error"),s(e)},a.initMap=function(){u.setAttribute("data-state","ready"),e(n)},document.head.appendChild(u)}).catch(e=>{throw console.error("injectScript error: ",e),e}):Promise.reject(new Error("document is undefined"))}function YL(e){var t=e.href;return!(!t||0!==t.indexOf("https://fonts.googleapis.com/css?family=Roboto")&&0!==t.indexOf("https://fonts.googleapis.com/css?family=Google+Sans+Text"))||("style"===e.tagName.toLowerCase()&&e.styleSheet&&e.styleSheet.cssText&&0===e.styleSheet.cssText.replace("\r\n","").indexOf(".gm-style")?(e.styleSheet.cssText="",!0):"style"===e.tagName.toLowerCase()&&e.innerHTML&&0===e.innerHTML.replace("\r\n","").indexOf(".gm-style")?(e.innerHTML="",!0):"style"===e.tagName.toLowerCase()&&!e.styleSheet&&!e.innerHTML)}function QL(){var e=document.getElementsByTagName("head")[0];if(e){var t=e.insertBefore.bind(e);e.insertBefore=function(n,r){return YL(n)||Reflect.apply(t,e,[n,r]),n};var n=e.appendChild.bind(e);e.appendChild=function(t){return YL(t)||Reflect.apply(n,e,[t]),t}}}var XL=!1;function ZL(){return(0,ub.jsx)("div",{children:"Loading..."})}var JL,$L={id:"script-loader",version:"weekly"};class eC extends r.PureComponent{constructor(){super(...arguments),AL(this,"check",null),AL(this,"state",{loaded:!1}),AL(this,"cleanupCallback",()=>{delete window.google.maps,this.injectScript()}),AL(this,"isCleaningUp",HL(function*(){return new Promise(function(e){if(XL){if(WL)var t=window.setInterval(function(){XL||(window.clearInterval(t),e())},1)}else e()})})),AL(this,"cleanup",()=>{XL=!0;var e=document.getElementById(this.props.id);e&&e.parentNode&&e.parentNode.removeChild(e),Array.prototype.slice.call(document.getElementsByTagName("script")).filter(function(e){return"string"===typeof e.src&&e.src.includes("maps.googleapis")}).forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),Array.prototype.slice.call(document.getElementsByTagName("link")).filter(function(e){return"https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Google+Sans"===e.href}).forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),Array.prototype.slice.call(document.getElementsByTagName("style")).filter(function(e){return void 0!==e.innerText&&e.innerText.length>0&&e.innerText.includes(".gm-")}).forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})}),AL(this,"injectScript",()=>{this.props.preventGoogleFontsLoading&&QL(),DL(!!this.props.id,'LoadScript requires "id" prop to be a string: %s',this.props.id),qL({id:this.props.id,nonce:this.props.nonce,url:KL(this.props)}).then(()=>{this.props.onLoad&&this.props.onLoad(),this.setState(function(){return{loaded:!0}})}).catch(e=>{this.props.onError&&this.props.onError(e),console.error("\n          There has been an Error with loading Google Maps API script, please check that you provided correct google API key (".concat(this.props.googleMapsApiKey||"-",") or Client ID (").concat(this.props.googleMapsClientId||"-",") to <LoadScript />\n          Otherwise it is a Network issue.\n        "))})}),AL(this,"getRef",e=>{this.check=e})}componentDidMount(){if(WL){if(window.google&&window.google.maps&&!XL)return void console.error("google api is already presented");this.isCleaningUp().then(this.injectScript).catch(function(e){console.error("Error at injecting script after cleaning up: ",e)})}}componentDidUpdate(e){this.props.libraries!==e.libraries&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),WL&&e.language!==this.props.language&&(this.cleanup(),this.setState(function(){return{loaded:!1}},this.cleanupCallback))}componentWillUnmount(){if(WL){this.cleanup();window.setTimeout(()=>{this.check||(delete window.google,XL=!1)},1),this.props.onUnmount&&this.props.onUnmount()}}render(){return(0,ub.jsxs)(ub.Fragment,{children:[(0,ub.jsx)("div",{ref:this.getRef}),this.state.loaded?this.props.children:this.props.loadingElement||(0,ub.jsx)(ZL,{})]})}}function tC(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}AL(eC,"defaultProps",$L);var nC=["loadingElement","onLoad","onError","onUnmount","children"],rC=(0,ub.jsx)(ZL,{});var sC=(0,r.memo)(function(e){var{loadingElement:t,onLoad:n,onError:s,onUnmount:i,children:a}=e,o=tC(e,nC),{isLoaded:l,loadError:c}=function(e){var{id:t=$L.id,version:n=$L.version,nonce:s,googleMapsApiKey:i,googleMapsClientId:a,language:o,region:l,libraries:c,preventGoogleFontsLoading:u,channel:d,mapIds:h,authReferrerPolicy:f,apiUrl:p="https://maps.googleapis.com"}=e,g=(0,r.useRef)(!1),[m,v]=(0,r.useState)(!1),[y,b]=(0,r.useState)(void 0);(0,r.useEffect)(function(){return g.current=!0,()=>{g.current=!1}},[]),(0,r.useEffect)(function(){WL&&u&&QL()},[u]),(0,r.useEffect)(function(){m&&DL(!!window.google,"useLoadScript was marked as loaded, but window.google is not present. Something went wrong.")},[m]);var E=KL({version:n,googleMapsApiKey:i,googleMapsClientId:a,language:o,region:l,libraries:c,channel:d,mapIds:h,authReferrerPolicy:f,apiUrl:p});(0,r.useEffect)(function(){function e(){g.current&&(v(!0),JL=E)}WL&&(window.google&&window.google.maps&&JL===E?e():qL({id:t,url:E,nonce:s}).then(e).catch(function(e){g.current&&b(e),console.warn("\n        There has been an Error with loading Google Maps API script, please check that you provided correct google API key (".concat(i||"-",") or Client ID (").concat(a||"-",")\n        Otherwise it is a Network issue.\n      ")),console.error(e)}))},[t,E,s]);var w=(0,r.useRef)(void 0);return(0,r.useEffect)(function(){w.current&&c!==w.current&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),w.current=c},[c]),{isLoaded:m,loadError:y,url:E}}(o);return(0,r.useEffect)(function(){l&&"function"===typeof n&&n()},[l,n]),(0,r.useEffect)(function(){c&&"function"===typeof s&&s(c)},[c,s]),(0,r.useEffect)(function(){return()=>{i&&i()}},[i]),l?a:t||rC});"function"===typeof SuppressedError&&SuppressedError;var iC;!function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE"}(iC||(iC={}));function aC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function oC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aC(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aC(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var lC={},cC={options(e,t){e.setOptions(t)}};(0,r.memo)(function(e){var{options:t,onLoad:n,onUnmount:s}=e,i=(0,r.useContext)(OL),[a,o]=(0,r.useState)(null);return(0,r.useEffect)(()=>{null!==a&&a.setMap(i)},[i]),(0,r.useEffect)(()=>{t&&null!==a&&a.setOptions(t)},[a,t]),(0,r.useEffect)(()=>{var e=new google.maps.TrafficLayer(oC(oC({},t),{},{map:i}));return o(e),n&&n(e),()=>{null!==a&&(s&&s(a),a.setMap(null))}},[]),null});class uC extends r.PureComponent{constructor(){super(...arguments),AL(this,"state",{trafficLayer:null}),AL(this,"setTrafficLayerCallback",()=>{null!==this.state.trafficLayer&&this.props.onLoad&&this.props.onLoad(this.state.trafficLayer)}),AL(this,"registeredEvents",[])}componentDidMount(){var e=new google.maps.TrafficLayer(oC(oC({},this.props.options),{},{map:this.context}));this.registeredEvents=jL({updaterMap:cC,eventMap:lC,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{trafficLayer:e}},this.setTrafficLayerCallback)}componentDidUpdate(e){null!==this.state.trafficLayer&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:cC,eventMap:lC,prevProps:e,nextProps:this.props,instance:this.state.trafficLayer}))}componentWillUnmount(){null!==this.state.trafficLayer&&(this.props.onUnmount&&this.props.onUnmount(this.state.trafficLayer),UL(this.registeredEvents),this.state.trafficLayer.setMap(null))}render(){return null}}AL(uC,"contextType",OL);(0,r.memo)(function(e){var{onLoad:t,onUnmount:n}=e,s=(0,r.useContext)(OL),[i,a]=(0,r.useState)(null);return(0,r.useEffect)(()=>{null!==i&&i.setMap(s)},[s]),(0,r.useEffect)(()=>{var e=new google.maps.BicyclingLayer;return a(e),e.setMap(s),t&&t(e),()=>{null!==e&&(n&&n(e),e.setMap(null))}},[]),null});class dC extends r.PureComponent{constructor(){super(...arguments),AL(this,"state",{bicyclingLayer:null}),AL(this,"setBicyclingLayerCallback",()=>{null!==this.state.bicyclingLayer&&(this.state.bicyclingLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.bicyclingLayer))})}componentDidMount(){var e=new google.maps.BicyclingLayer;this.setState(()=>({bicyclingLayer:e}),this.setBicyclingLayerCallback)}componentWillUnmount(){null!==this.state.bicyclingLayer&&(this.props.onUnmount&&this.props.onUnmount(this.state.bicyclingLayer),this.state.bicyclingLayer.setMap(null))}render(){return null}}AL(dC,"contextType",OL);(0,r.memo)(function(e){var{onLoad:t,onUnmount:n}=e,s=(0,r.useContext)(OL),[i,a]=(0,r.useState)(null);return(0,r.useEffect)(()=>{null!==i&&i.setMap(s)},[s]),(0,r.useEffect)(()=>{var e=new google.maps.TransitLayer;return a(e),e.setMap(s),t&&t(e),()=>{null!==i&&(n&&n(i),i.setMap(null))}},[]),null});class hC extends r.PureComponent{constructor(){super(...arguments),AL(this,"state",{transitLayer:null}),AL(this,"setTransitLayerCallback",()=>{null!==this.state.transitLayer&&(this.state.transitLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.transitLayer))})}componentDidMount(){var e=new google.maps.TransitLayer;this.setState(function(){return{transitLayer:e}},this.setTransitLayerCallback)}componentWillUnmount(){null!==this.state.transitLayer&&(this.props.onUnmount&&this.props.onUnmount(this.state.transitLayer),this.state.transitLayer.setMap(null))}render(){return null}}function fC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fC(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fC(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(hC,"contextType",OL);var gC={onCircleComplete:"circlecomplete",onMarkerComplete:"markercomplete",onOverlayComplete:"overlaycomplete",onPolygonComplete:"polygoncomplete",onPolylineComplete:"polylinecomplete",onRectangleComplete:"rectanglecomplete"},mC={drawingMode(e,t){e.setDrawingMode(t)},options(e,t){e.setOptions(t)}};(0,r.memo)(function(e){var{options:t,drawingMode:n,onCircleComplete:s,onMarkerComplete:i,onOverlayComplete:a,onPolygonComplete:o,onPolylineComplete:l,onRectangleComplete:c,onLoad:u,onUnmount:d}=e,h=(0,r.useContext)(OL),[f,p]=(0,r.useState)(null),[g,m]=(0,r.useState)(null),[v,y]=(0,r.useState)(null),[b,E]=(0,r.useState)(null),[w,S]=(0,r.useState)(null),[T,k]=(0,r.useState)(null),[x,I]=(0,r.useState)(null);return(0,r.useEffect)(()=>{null!==f&&f.setMap(h)},[h]),(0,r.useEffect)(()=>{t&&null!==f&&f.setOptions(t)},[f,t]),(0,r.useEffect)(()=>{null!==f&&f.setDrawingMode(null!==n&&void 0!==n?n:null)},[f,n]),(0,r.useEffect)(()=>{f&&s&&(null!==g&&google.maps.event.removeListener(g),m(google.maps.event.addListener(f,"circlecomplete",s)))},[f,s]),(0,r.useEffect)(()=>{f&&i&&(null!==v&&google.maps.event.removeListener(v),y(google.maps.event.addListener(f,"markercomplete",i)))},[f,i]),(0,r.useEffect)(()=>{f&&a&&(null!==b&&google.maps.event.removeListener(b),E(google.maps.event.addListener(f,"overlaycomplete",a)))},[f,a]),(0,r.useEffect)(()=>{f&&o&&(null!==w&&google.maps.event.removeListener(w),S(google.maps.event.addListener(f,"polygoncomplete",o)))},[f,o]),(0,r.useEffect)(()=>{f&&l&&(null!==T&&google.maps.event.removeListener(T),k(google.maps.event.addListener(f,"polylinecomplete",l)))},[f,l]),(0,r.useEffect)(()=>{f&&c&&(null!==x&&google.maps.event.removeListener(x),I(google.maps.event.addListener(f,"rectanglecomplete",c)))},[f,c]),(0,r.useEffect)(()=>{DL(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing);var e=new google.maps.drawing.DrawingManager(pC(pC({},t),{},{map:h}));return n&&e.setDrawingMode(n),s&&m(google.maps.event.addListener(e,"circlecomplete",s)),i&&y(google.maps.event.addListener(e,"markercomplete",i)),a&&E(google.maps.event.addListener(e,"overlaycomplete",a)),o&&S(google.maps.event.addListener(e,"polygoncomplete",o)),l&&k(google.maps.event.addListener(e,"polylinecomplete",l)),c&&I(google.maps.event.addListener(e,"rectanglecomplete",c)),p(e),u&&u(e),()=>{null!==f&&(g&&google.maps.event.removeListener(g),v&&google.maps.event.removeListener(v),b&&google.maps.event.removeListener(b),w&&google.maps.event.removeListener(w),T&&google.maps.event.removeListener(T),x&&google.maps.event.removeListener(x),d&&d(f),f.setMap(null))}},[]),null});class vC extends r.PureComponent{constructor(e){super(e),AL(this,"registeredEvents",[]),AL(this,"state",{drawingManager:null}),AL(this,"setDrawingManagerCallback",()=>{null!==this.state.drawingManager&&this.props.onLoad&&this.props.onLoad(this.state.drawingManager)}),DL(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing)}componentDidMount(){var e=new google.maps.drawing.DrawingManager(pC(pC({},this.props.options),{},{map:this.context}));this.registeredEvents=jL({updaterMap:mC,eventMap:gC,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{drawingManager:e}},this.setDrawingManagerCallback)}componentDidUpdate(e){null!==this.state.drawingManager&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:mC,eventMap:gC,prevProps:e,nextProps:this.props,instance:this.state.drawingManager}))}componentWillUnmount(){null!==this.state.drawingManager&&(this.props.onUnmount&&this.props.onUnmount(this.state.drawingManager),UL(this.registeredEvents),this.state.drawingManager.setMap(null))}render(){return null}}function yC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function bC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yC(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yC(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(vC,"contextType",OL);var EC={onAnimationChanged:"animation_changed",onClick:"click",onClickableChanged:"clickable_changed",onCursorChanged:"cursor_changed",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDraggableChanged:"draggable_changed",onDragStart:"dragstart",onFlatChanged:"flat_changed",onIconChanged:"icon_changed",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onPositionChanged:"position_changed",onRightClick:"rightclick",onShapeChanged:"shape_changed",onTitleChanged:"title_changed",onVisibleChanged:"visible_changed",onZindexChanged:"zindex_changed"},wC={animation(e,t){e.setAnimation(t)},clickable(e,t){e.setClickable(t)},cursor(e,t){e.setCursor(t)},draggable(e,t){e.setDraggable(t)},icon(e,t){e.setIcon(t)},label(e,t){e.setLabel(t)},map(e,t){e.setMap(t)},opacity(e,t){e.setOpacity(t)},options(e,t){e.setOptions(t)},position(e,t){e.setPosition(t)},shape(e,t){e.setShape(t)},title(e,t){e.setTitle(t)},visible(e,t){e.setVisible(t)},zIndex(e,t){e.setZIndex(t)}},SC={};(0,r.memo)(function(e){var{position:t,options:n,clusterer:s,noClustererRedraw:i,children:a,draggable:o,visible:l,animation:c,clickable:u,cursor:d,icon:h,label:f,opacity:p,shape:g,title:m,zIndex:v,onClick:y,onDblClick:b,onDrag:E,onDragEnd:w,onDragStart:S,onMouseOut:T,onMouseOver:k,onMouseUp:x,onMouseDown:I,onRightClick:L,onClickableChanged:C,onCursorChanged:_,onAnimationChanged:A,onDraggableChanged:R,onFlatChanged:P,onIconChanged:D,onPositionChanged:O,onShapeChanged:N,onTitleChanged:M,onVisibleChanged:F,onZindexChanged:U,onLoad:j,onUnmount:B}=e,V=(0,r.useContext)(OL),[z,G]=(0,r.useState)(null),[H,K]=(0,r.useState)(null),[W,q]=(0,r.useState)(null),[Y,Q]=(0,r.useState)(null),[X,Z]=(0,r.useState)(null),[J,$]=(0,r.useState)(null),[ee,te]=(0,r.useState)(null),[ne,re]=(0,r.useState)(null),[se,ie]=(0,r.useState)(null),[ae,oe]=(0,r.useState)(null),[le,ce]=(0,r.useState)(null),[ue,de]=(0,r.useState)(null),[he,fe]=(0,r.useState)(null),[pe,ge]=(0,r.useState)(null),[me,ve]=(0,r.useState)(null),[ye,be]=(0,r.useState)(null),[Ee,we]=(0,r.useState)(null),[Se,Te]=(0,r.useState)(null),[ke,xe]=(0,r.useState)(null),[Ie,Le]=(0,r.useState)(null),[Ce,_e]=(0,r.useState)(null),[Ae,Re]=(0,r.useState)(null);(0,r.useEffect)(()=>{null!==z&&z.setMap(V)},[V]),(0,r.useEffect)(()=>{"undefined"!==typeof n&&null!==z&&z.setOptions(n)},[z,n]),(0,r.useEffect)(()=>{"undefined"!==typeof o&&null!==z&&z.setDraggable(o)},[z,o]),(0,r.useEffect)(()=>{t&&null!==z&&z.setPosition(t)},[z,t]),(0,r.useEffect)(()=>{"undefined"!==typeof l&&null!==z&&z.setVisible(l)},[z,l]),(0,r.useEffect)(()=>{null===z||void 0===z||z.setAnimation(c)},[z,c]),(0,r.useEffect)(()=>{z&&void 0!==u&&z.setClickable(u)},[z,u]),(0,r.useEffect)(()=>{z&&void 0!==d&&z.setCursor(d)},[z,d]),(0,r.useEffect)(()=>{z&&void 0!==h&&z.setIcon(h)},[z,h]),(0,r.useEffect)(()=>{z&&void 0!==f&&z.setLabel(f)},[z,f]),(0,r.useEffect)(()=>{z&&void 0!==p&&z.setOpacity(p)},[z,p]),(0,r.useEffect)(()=>{z&&void 0!==g&&z.setShape(g)},[z,g]),(0,r.useEffect)(()=>{z&&void 0!==m&&z.setTitle(m)},[z,m]),(0,r.useEffect)(()=>{z&&void 0!==v&&z.setZIndex(v)},[z,v]),(0,r.useEffect)(()=>{z&&b&&(null!==H&&google.maps.event.removeListener(H),K(google.maps.event.addListener(z,"dblclick",b)))},[b]),(0,r.useEffect)(()=>{z&&w&&(null!==W&&google.maps.event.removeListener(W),q(google.maps.event.addListener(z,"dragend",w)))},[w]),(0,r.useEffect)(()=>{z&&S&&(null!==Y&&google.maps.event.removeListener(Y),Q(google.maps.event.addListener(z,"dragstart",S)))},[S]),(0,r.useEffect)(()=>{z&&I&&(null!==X&&google.maps.event.removeListener(X),Z(google.maps.event.addListener(z,"mousedown",I)))},[I]),(0,r.useEffect)(()=>{z&&T&&(null!==J&&google.maps.event.removeListener(J),$(google.maps.event.addListener(z,"mouseout",T)))},[T]),(0,r.useEffect)(()=>{z&&k&&(null!==ee&&google.maps.event.removeListener(ee),te(google.maps.event.addListener(z,"mouseover",k)))},[k]),(0,r.useEffect)(()=>{z&&x&&(null!==ne&&google.maps.event.removeListener(ne),re(google.maps.event.addListener(z,"mouseup",x)))},[x]),(0,r.useEffect)(()=>{z&&L&&(null!==se&&google.maps.event.removeListener(se),ie(google.maps.event.addListener(z,"rightclick",L)))},[L]),(0,r.useEffect)(()=>{z&&y&&(null!==ae&&google.maps.event.removeListener(ae),oe(google.maps.event.addListener(z,"click",y)))},[y]),(0,r.useEffect)(()=>{z&&E&&(null!==le&&google.maps.event.removeListener(le),ce(google.maps.event.addListener(z,"drag",E)))},[E]),(0,r.useEffect)(()=>{z&&C&&(null!==ue&&google.maps.event.removeListener(ue),de(google.maps.event.addListener(z,"clickable_changed",C)))},[C]),(0,r.useEffect)(()=>{z&&_&&(null!==he&&google.maps.event.removeListener(he),fe(google.maps.event.addListener(z,"cursor_changed",_)))},[_]),(0,r.useEffect)(()=>{z&&A&&(null!==pe&&google.maps.event.removeListener(pe),ge(google.maps.event.addListener(z,"animation_changed",A)))},[A]),(0,r.useEffect)(()=>{z&&R&&(null!==me&&google.maps.event.removeListener(me),ve(google.maps.event.addListener(z,"draggable_changed",R)))},[R]),(0,r.useEffect)(()=>{z&&P&&(null!==ye&&google.maps.event.removeListener(ye),be(google.maps.event.addListener(z,"flat_changed",P)))},[P]),(0,r.useEffect)(()=>{z&&D&&(null!==Ee&&google.maps.event.removeListener(Ee),we(google.maps.event.addListener(z,"icon_changed",D)))},[D]),(0,r.useEffect)(()=>{z&&O&&(null!==Se&&google.maps.event.removeListener(Se),Te(google.maps.event.addListener(z,"position_changed",O)))},[O]),(0,r.useEffect)(()=>{z&&N&&(null!==ke&&google.maps.event.removeListener(ke),xe(google.maps.event.addListener(z,"shape_changed",N)))},[N]),(0,r.useEffect)(()=>{z&&M&&(null!==Ie&&google.maps.event.removeListener(Ie),Le(google.maps.event.addListener(z,"title_changed",M)))},[M]),(0,r.useEffect)(()=>{z&&F&&(null!==Ce&&google.maps.event.removeListener(Ce),_e(google.maps.event.addListener(z,"visible_changed",F)))},[F]),(0,r.useEffect)(()=>{z&&U&&(null!==Ae&&google.maps.event.removeListener(Ae),Re(google.maps.event.addListener(z,"zindex_changed",U)))},[U]),(0,r.useEffect)(()=>{var e=bC(bC(bC({},n||SC),s?SC:{map:V}),{},{position:t}),r=new google.maps.Marker(e);return s?s.addMarker(r,!!i):r.setMap(V),t&&r.setPosition(t),"undefined"!==typeof l&&r.setVisible(l),"undefined"!==typeof o&&r.setDraggable(o),"undefined"!==typeof u&&r.setClickable(u),"string"===typeof d&&r.setCursor(d),h&&r.setIcon(h),"undefined"!==typeof f&&r.setLabel(f),"undefined"!==typeof p&&r.setOpacity(p),g&&r.setShape(g),"string"===typeof m&&r.setTitle(m),"number"===typeof v&&r.setZIndex(v),b&&K(google.maps.event.addListener(r,"dblclick",b)),w&&q(google.maps.event.addListener(r,"dragend",w)),S&&Q(google.maps.event.addListener(r,"dragstart",S)),I&&Z(google.maps.event.addListener(r,"mousedown",I)),T&&$(google.maps.event.addListener(r,"mouseout",T)),k&&te(google.maps.event.addListener(r,"mouseover",k)),x&&re(google.maps.event.addListener(r,"mouseup",x)),L&&ie(google.maps.event.addListener(r,"rightclick",L)),y&&oe(google.maps.event.addListener(r,"click",y)),E&&ce(google.maps.event.addListener(r,"drag",E)),C&&de(google.maps.event.addListener(r,"clickable_changed",C)),_&&fe(google.maps.event.addListener(r,"cursor_changed",_)),A&&ge(google.maps.event.addListener(r,"animation_changed",A)),R&&ve(google.maps.event.addListener(r,"draggable_changed",R)),P&&be(google.maps.event.addListener(r,"flat_changed",P)),D&&we(google.maps.event.addListener(r,"icon_changed",D)),O&&Te(google.maps.event.addListener(r,"position_changed",O)),N&&xe(google.maps.event.addListener(r,"shape_changed",N)),M&&Le(google.maps.event.addListener(r,"title_changed",M)),F&&_e(google.maps.event.addListener(r,"visible_changed",F)),U&&Re(google.maps.event.addListener(r,"zindex_changed",U)),G(r),j&&j(r),()=>{null!==H&&google.maps.event.removeListener(H),null!==W&&google.maps.event.removeListener(W),null!==Y&&google.maps.event.removeListener(Y),null!==X&&google.maps.event.removeListener(X),null!==J&&google.maps.event.removeListener(J),null!==ee&&google.maps.event.removeListener(ee),null!==ne&&google.maps.event.removeListener(ne),null!==se&&google.maps.event.removeListener(se),null!==ae&&google.maps.event.removeListener(ae),null!==ue&&google.maps.event.removeListener(ue),null!==he&&google.maps.event.removeListener(he),null!==pe&&google.maps.event.removeListener(pe),null!==me&&google.maps.event.removeListener(me),null!==ye&&google.maps.event.removeListener(ye),null!==Ee&&google.maps.event.removeListener(Ee),null!==Se&&google.maps.event.removeListener(Se),null!==Ie&&google.maps.event.removeListener(Ie),null!==Ce&&google.maps.event.removeListener(Ce),null!==Ae&&google.maps.event.removeListener(Ae),B&&B(r),s?s.removeMarker(r,!!i):r&&r.setMap(null)}},[]);var Pe=(0,r.useMemo)(()=>a?r.Children.map(a,e=>{if(!(0,r.isValidElement)(e))return e;var t=e;return(0,r.cloneElement)(t,{anchor:z})}):null,[a,z]);return(0,ub.jsx)(ub.Fragment,{children:Pe})||null});class TC extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[])}componentDidMount(){var e=this;return HL(function*(){var t=bC(bC(bC({},e.props.options||SC),e.props.clusterer?SC:{map:e.context}),{},{position:e.props.position});e.marker=new google.maps.Marker(t),e.props.clusterer?e.props.clusterer.addMarker(e.marker,!!e.props.noClustererRedraw):e.marker.setMap(e.context),e.registeredEvents=jL({updaterMap:wC,eventMap:EC,prevProps:{},nextProps:e.props,instance:e.marker}),e.props.onLoad&&e.props.onLoad(e.marker)})()}componentDidUpdate(e){this.marker&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:wC,eventMap:EC,prevProps:e,nextProps:this.props,instance:this.marker}))}componentWillUnmount(){this.marker&&(this.props.onUnmount&&this.props.onUnmount(this.marker),UL(this.registeredEvents),this.props.clusterer?this.props.clusterer.removeMarker(this.marker,!!this.props.noClustererRedraw):this.marker&&this.marker.setMap(null))}render(){var e=this.props.children?r.Children.map(this.props.children,e=>{if(!(0,r.isValidElement)(e))return e;var t=e;return(0,r.cloneElement)(t,{anchor:this.marker})}):null;return e||null}}AL(TC,"contextType",OL);var kC=function(){function e(t,n){t.getClusterer().extend(e,google.maps.OverlayView),this.cluster=t,this.clusterClassName=this.cluster.getClusterer().getClusterClass(),this.className=this.clusterClassName,this.styles=n,this.center=void 0,this.div=null,this.sums=null,this.visible=!1,this.boundsChangedListener=null,this.url="",this.height=0,this.width=0,this.anchorText=[0,0],this.anchorIcon=[0,0],this.textColor="black",this.textSize=11,this.textDecoration="none",this.fontWeight="bold",this.fontStyle="normal",this.fontFamily="Arial,sans-serif",this.backgroundPosition="0 0",this.cMouseDownInCluster=null,this.cDraggingMapByCluster=null,this.timeOut=null,this.setMap(t.getMap()),this.onBoundsChanged=this.onBoundsChanged.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onClick=this.onClick.bind(this),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onAdd=this.onAdd.bind(this),this.onRemove=this.onRemove.bind(this),this.draw=this.draw.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.useStyle=this.useStyle.bind(this),this.setCenter=this.setCenter.bind(this),this.getPosFromLatLng=this.getPosFromLatLng.bind(this)}return e.prototype.onBoundsChanged=function(){this.cDraggingMapByCluster=this.cMouseDownInCluster},e.prototype.onMouseDown=function(){this.cMouseDownInCluster=!0,this.cDraggingMapByCluster=!1},e.prototype.onClick=function(e){if(this.cMouseDownInCluster=!1,!this.cDraggingMapByCluster){var t=this.cluster.getClusterer();if(google.maps.event.trigger(t,"click",this.cluster),google.maps.event.trigger(t,"clusterclick",this.cluster),t.getZoomOnClick()){var n=t.getMaxZoom(),r=this.cluster.getBounds(),s=t.getMap();null!==s&&"fitBounds"in s&&s.fitBounds(r),this.timeOut=window.setTimeout(function(){var e=t.getMap();if(null!==e){"fitBounds"in e&&e.fitBounds(r);var s=e.getZoom()||0;null!==n&&s>n&&e.setZoom(n+1)}},100)}e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}},e.prototype.onMouseOver=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseover",this.cluster)},e.prototype.onMouseOut=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseout",this.cluster)},e.prototype.onAdd=function(){var e;this.div=document.createElement("div"),this.div.className=this.className,this.visible&&this.show(),null===(e=this.getPanes())||void 0===e||e.overlayMouseTarget.appendChild(this.div);var t=this.getMap();null!==t&&(this.boundsChangedListener=google.maps.event.addListener(t,"bounds_changed",this.onBoundsChanged),this.div.addEventListener("mousedown",this.onMouseDown),this.div.addEventListener("click",this.onClick),this.div.addEventListener("mouseover",this.onMouseOver),this.div.addEventListener("mouseout",this.onMouseOut))},e.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.hide(),null!==this.boundsChangedListener&&google.maps.event.removeListener(this.boundsChangedListener),this.div.removeEventListener("mousedown",this.onMouseDown),this.div.removeEventListener("click",this.onClick),this.div.removeEventListener("mouseover",this.onMouseOver),this.div.removeEventListener("mouseout",this.onMouseOut),this.div.parentNode.removeChild(this.div),null!==this.timeOut&&(window.clearTimeout(this.timeOut),this.timeOut=null),this.div=null)},e.prototype.draw=function(){if(this.visible&&null!==this.div&&this.center){var e=this.getPosFromLatLng(this.center);this.div.style.top=null!==e?"".concat(e.y,"px"):"0",this.div.style.left=null!==e?"".concat(e.x,"px"):"0"}},e.prototype.hide=function(){this.div&&(this.div.style.display="none"),this.visible=!1},e.prototype.show=function(){var e,t,n,r,s,i;if(this.div&&this.center){var a=null===this.sums||"undefined"===typeof this.sums.title||""===this.sums.title?this.cluster.getClusterer().getTitle():this.sums.title,o=this.backgroundPosition.split(" "),l=parseInt((null===(e=o[0])||void 0===e?void 0:e.replace(/^\s+|\s+$/g,""))||"0",10),c=parseInt((null===(t=o[1])||void 0===t?void 0:t.replace(/^\s+|\s+$/g,""))||"0",10),u=this.getPosFromLatLng(this.center);this.div.className=this.className,this.div.setAttribute("style","cursor: pointer; position: absolute; top: ".concat(null!==u?"".concat(u.y,"px"):"0","; left: ").concat(null!==u?"".concat(u.x,"px"):"0","; width: ").concat(this.width,"px; height: ").concat(this.height,"px; "));var d=document.createElement("img");d.alt=a,d.src=this.url,d.width=this.width,d.height=this.height,d.setAttribute("style","position: absolute; top: ".concat(c,"px; left: ").concat(l,"px")),this.cluster.getClusterer().enableRetinaIcons||(d.style.clip="rect(-".concat(c,"px, -").concat(l+this.width,"px, -").concat(c+this.height,", -").concat(l,")"));var h=document.createElement("div");h.setAttribute("style","position: absolute; top: ".concat(this.anchorText[0],"px; left: ").concat(this.anchorText[1],"px; color: ").concat(this.textColor,"; font-size: ").concat(this.textSize,"px; font-family: ").concat(this.fontFamily,"; font-weight: ").concat(this.fontWeight,"; fontStyle: ").concat(this.fontStyle,"; text-decoration: ").concat(this.textDecoration,"; text-align: center; width: ").concat(this.width,"px; line-height: ").concat(this.height,"px")),(null===(n=this.sums)||void 0===n?void 0:n.text)&&(h.innerText="".concat(null===(r=this.sums)||void 0===r?void 0:r.text)),(null===(s=this.sums)||void 0===s?void 0:s.html)&&(h.innerHTML="".concat(null===(i=this.sums)||void 0===i?void 0:i.html)),this.div.innerHTML="",this.div.appendChild(d),this.div.appendChild(h),this.div.title=a,this.div.style.display=""}this.visible=!0},e.prototype.useStyle=function(e){this.sums=e;var t=this.cluster.getClusterer().getStyles(),n=t[Math.min(t.length-1,Math.max(0,e.index-1))];n&&(this.url=n.url,this.height=n.height,this.width=n.width,n.className&&(this.className="".concat(this.clusterClassName," ").concat(n.className)),this.anchorText=n.anchorText||[0,0],this.anchorIcon=n.anchorIcon||[this.height/2,this.width/2],this.textColor=n.textColor||"black",this.textSize=n.textSize||11,this.textDecoration=n.textDecoration||"none",this.fontWeight=n.fontWeight||"bold",this.fontStyle=n.fontStyle||"normal",this.fontFamily=n.fontFamily||"Arial,sans-serif",this.backgroundPosition=n.backgroundPosition||"0 0")},e.prototype.setCenter=function(e){this.center=e},e.prototype.getPosFromLatLng=function(e){var t=this.getProjection().fromLatLngToDivPixel(e);return null!==t&&(t.x-=this.anchorIcon[1],t.y-=this.anchorIcon[0]),t},e}(),xC=function(){function e(e){this.markerClusterer=e,this.map=this.markerClusterer.getMap(),this.gridSize=this.markerClusterer.getGridSize(),this.minClusterSize=this.markerClusterer.getMinimumClusterSize(),this.averageCenter=this.markerClusterer.getAverageCenter(),this.markers=[],this.center=void 0,this.bounds=null,this.clusterIcon=new kC(this,this.markerClusterer.getStyles()),this.getSize=this.getSize.bind(this),this.getMarkers=this.getMarkers.bind(this),this.getCenter=this.getCenter.bind(this),this.getMap=this.getMap.bind(this),this.getClusterer=this.getClusterer.bind(this),this.getBounds=this.getBounds.bind(this),this.remove=this.remove.bind(this),this.addMarker=this.addMarker.bind(this),this.isMarkerInClusterBounds=this.isMarkerInClusterBounds.bind(this),this.calculateBounds=this.calculateBounds.bind(this),this.updateIcon=this.updateIcon.bind(this),this.isMarkerAlreadyAdded=this.isMarkerAlreadyAdded.bind(this)}return e.prototype.getSize=function(){return this.markers.length},e.prototype.getMarkers=function(){return this.markers},e.prototype.getCenter=function(){return this.center},e.prototype.getMap=function(){return this.map},e.prototype.getClusterer=function(){return this.markerClusterer},e.prototype.getBounds=function(){for(var e=new google.maps.LatLngBounds(this.center,this.center),t=0,n=this.getMarkers();t<n.length;t++){var r=n[t].getPosition();r&&e.extend(r)}return e},e.prototype.remove=function(){this.clusterIcon.setMap(null),this.markers=[],delete this.markers},e.prototype.addMarker=function(e){var t,n;if(this.isMarkerAlreadyAdded(e))return!1;if(this.center){if(this.averageCenter&&(n=e.getPosition())){var r=this.markers.length+1;this.center=new google.maps.LatLng((this.center.lat()*(r-1)+n.lat())/r,(this.center.lng()*(r-1)+n.lng())/r),this.calculateBounds()}}else(n=e.getPosition())&&(this.center=n,this.calculateBounds());e.isAdded=!0,this.markers.push(e);var s=this.markers.length,i=this.markerClusterer.getMaxZoom(),a=null===(t=this.map)||void 0===t?void 0:t.getZoom();if(null!==i&&"undefined"!==typeof a&&a>i)e.getMap()!==this.map&&e.setMap(this.map);else if(s<this.minClusterSize)e.getMap()!==this.map&&e.setMap(this.map);else if(s===this.minClusterSize)for(var o=0,l=this.markers;o<l.length;o++){l[o].setMap(null)}else e.setMap(null);return!0},e.prototype.isMarkerInClusterBounds=function(e){if(null!==this.bounds){var t=e.getPosition();if(t)return this.bounds.contains(t)}return!1},e.prototype.calculateBounds=function(){this.bounds=this.markerClusterer.getExtendedBounds(new google.maps.LatLngBounds(this.center,this.center))},e.prototype.updateIcon=function(){var e,t=this.markers.length,n=this.markerClusterer.getMaxZoom(),r=null===(e=this.map)||void 0===e?void 0:e.getZoom();null!==n&&"undefined"!==typeof r&&r>n||t<this.minClusterSize?this.clusterIcon.hide():(this.center&&this.clusterIcon.setCenter(this.center),this.clusterIcon.useStyle(this.markerClusterer.getCalculator()(this.markers,this.markerClusterer.getStyles().length)),this.clusterIcon.show())},e.prototype.isMarkerAlreadyAdded=function(e){if(this.markers.includes)return this.markers.includes(e);for(var t=0;t<this.markers.length;t++)if(e===this.markers[t])return!0;return!1},e}();function IC(e,t){var n=e.length,r=n.toString().length,s=Math.min(r,t);return{text:n.toString(),index:s,title:""}}var LC=[53,56,66,78,90],CC=function(){function e(t,n,r){void 0===n&&(n=[]),void 0===r&&(r={}),this.getMinimumClusterSize=this.getMinimumClusterSize.bind(this),this.setMinimumClusterSize=this.setMinimumClusterSize.bind(this),this.getEnableRetinaIcons=this.getEnableRetinaIcons.bind(this),this.setEnableRetinaIcons=this.setEnableRetinaIcons.bind(this),this.addToClosestCluster=this.addToClosestCluster.bind(this),this.getImageExtension=this.getImageExtension.bind(this),this.setImageExtension=this.setImageExtension.bind(this),this.getExtendedBounds=this.getExtendedBounds.bind(this),this.getAverageCenter=this.getAverageCenter.bind(this),this.setAverageCenter=this.setAverageCenter.bind(this),this.getTotalClusters=this.getTotalClusters.bind(this),this.fitMapToMarkers=this.fitMapToMarkers.bind(this),this.getIgnoreHidden=this.getIgnoreHidden.bind(this),this.setIgnoreHidden=this.setIgnoreHidden.bind(this),this.getClusterClass=this.getClusterClass.bind(this),this.setClusterClass=this.setClusterClass.bind(this),this.getTotalMarkers=this.getTotalMarkers.bind(this),this.getZoomOnClick=this.getZoomOnClick.bind(this),this.setZoomOnClick=this.setZoomOnClick.bind(this),this.getBatchSizeIE=this.getBatchSizeIE.bind(this),this.setBatchSizeIE=this.setBatchSizeIE.bind(this),this.createClusters=this.createClusters.bind(this),this.onZoomChanged=this.onZoomChanged.bind(this),this.getImageSizes=this.getImageSizes.bind(this),this.setImageSizes=this.setImageSizes.bind(this),this.getCalculator=this.getCalculator.bind(this),this.setCalculator=this.setCalculator.bind(this),this.removeMarkers=this.removeMarkers.bind(this),this.resetViewport=this.resetViewport.bind(this),this.getImagePath=this.getImagePath.bind(this),this.setImagePath=this.setImagePath.bind(this),this.pushMarkerTo=this.pushMarkerTo.bind(this),this.removeMarker=this.removeMarker.bind(this),this.clearMarkers=this.clearMarkers.bind(this),this.setupStyles=this.setupStyles.bind(this),this.getGridSize=this.getGridSize.bind(this),this.setGridSize=this.setGridSize.bind(this),this.getClusters=this.getClusters.bind(this),this.getMaxZoom=this.getMaxZoom.bind(this),this.setMaxZoom=this.setMaxZoom.bind(this),this.getMarkers=this.getMarkers.bind(this),this.addMarkers=this.addMarkers.bind(this),this.getStyles=this.getStyles.bind(this),this.setStyles=this.setStyles.bind(this),this.addMarker=this.addMarker.bind(this),this.onRemove=this.onRemove.bind(this),this.getTitle=this.getTitle.bind(this),this.setTitle=this.setTitle.bind(this),this.repaint=this.repaint.bind(this),this.onIdle=this.onIdle.bind(this),this.redraw=this.redraw.bind(this),this.onAdd=this.onAdd.bind(this),this.draw=this.draw.bind(this),this.extend=this.extend.bind(this),this.extend(e,google.maps.OverlayView),this.markers=[],this.clusters=[],this.listeners=[],this.activeMap=null,this.ready=!1,this.gridSize=r.gridSize||60,this.minClusterSize=r.minimumClusterSize||2,this.maxZoom=r.maxZoom||null,this.styles=r.styles||[],this.title=r.title||"",this.zoomOnClick=!0,void 0!==r.zoomOnClick&&(this.zoomOnClick=r.zoomOnClick),this.averageCenter=!1,void 0!==r.averageCenter&&(this.averageCenter=r.averageCenter),this.ignoreHidden=!1,void 0!==r.ignoreHidden&&(this.ignoreHidden=r.ignoreHidden),this.enableRetinaIcons=!1,void 0!==r.enableRetinaIcons&&(this.enableRetinaIcons=r.enableRetinaIcons),this.imagePath=r.imagePath||"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",this.imageExtension=r.imageExtension||"png",this.imageSizes=r.imageSizes||LC,this.calculator=r.calculator||IC,this.batchSize=r.batchSize||2e3,this.batchSizeIE=r.batchSizeIE||500,this.clusterClass=r.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize=this.batchSizeIE),this.timerRefStatic=null,this.setupStyles(),this.addMarkers(n,!0),this.setMap(t)}return e.prototype.onZoomChanged=function(){var e,t;this.resetViewport(!1),(null===(e=this.getMap())||void 0===e?void 0:e.getZoom())!==(this.get("minZoom")||0)&&(null===(t=this.getMap())||void 0===t?void 0:t.getZoom())!==this.get("maxZoom")||google.maps.event.trigger(this,"idle")},e.prototype.onIdle=function(){this.redraw()},e.prototype.onAdd=function(){var e=this.getMap();this.activeMap=e,this.ready=!0,this.repaint(),null!==e&&(this.listeners=[google.maps.event.addListener(e,"zoom_changed",this.onZoomChanged),google.maps.event.addListener(e,"idle",this.onIdle)])},e.prototype.onRemove=function(){for(var e=0,t=this.markers;e<t.length;e++){var n=t[e];n.getMap()!==this.activeMap&&n.setMap(this.activeMap)}for(var r=0,s=this.clusters;r<s.length;r++){s[r].remove()}this.clusters=[];for(var i=0,a=this.listeners;i<a.length;i++){var o=a[i];google.maps.event.removeListener(o)}this.listeners=[],this.activeMap=null,this.ready=!1},e.prototype.draw=function(){},e.prototype.getMap=function(){return null},e.prototype.getPanes=function(){return null},e.prototype.getProjection=function(){return{fromContainerPixelToLatLng:function(){return null},fromDivPixelToLatLng:function(){return null},fromLatLngToContainerPixel:function(){return null},fromLatLngToDivPixel:function(){return null},getVisibleRegion:function(){return null},getWorldWidth:function(){return 0}}},e.prototype.setMap=function(){},e.prototype.addListener=function(){return{remove:function(){}}},e.prototype.bindTo=function(){},e.prototype.get=function(){},e.prototype.notify=function(){},e.prototype.set=function(){},e.prototype.setValues=function(){},e.prototype.unbind=function(){},e.prototype.unbindAll=function(){},e.prototype.setupStyles=function(){if(!(this.styles.length>0))for(var e=0;e<this.imageSizes.length;e++)this.styles.push({url:"".concat(this.imagePath+(e+1),".").concat(this.imageExtension),height:this.imageSizes[e]||0,width:this.imageSizes[e]||0})},e.prototype.fitMapToMarkers=function(){for(var e=this.getMarkers(),t=new google.maps.LatLngBounds,n=0,r=e;n<r.length;n++){var s=r[n].getPosition();s&&t.extend(s)}var i=this.getMap();null!==i&&"fitBounds"in i&&i.fitBounds(t)},e.prototype.getGridSize=function(){return this.gridSize},e.prototype.setGridSize=function(e){this.gridSize=e},e.prototype.getMinimumClusterSize=function(){return this.minClusterSize},e.prototype.setMinimumClusterSize=function(e){this.minClusterSize=e},e.prototype.getMaxZoom=function(){return this.maxZoom},e.prototype.setMaxZoom=function(e){this.maxZoom=e},e.prototype.getStyles=function(){return this.styles},e.prototype.setStyles=function(e){this.styles=e},e.prototype.getTitle=function(){return this.title},e.prototype.setTitle=function(e){this.title=e},e.prototype.getZoomOnClick=function(){return this.zoomOnClick},e.prototype.setZoomOnClick=function(e){this.zoomOnClick=e},e.prototype.getAverageCenter=function(){return this.averageCenter},e.prototype.setAverageCenter=function(e){this.averageCenter=e},e.prototype.getIgnoreHidden=function(){return this.ignoreHidden},e.prototype.setIgnoreHidden=function(e){this.ignoreHidden=e},e.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons},e.prototype.setEnableRetinaIcons=function(e){this.enableRetinaIcons=e},e.prototype.getImageExtension=function(){return this.imageExtension},e.prototype.setImageExtension=function(e){this.imageExtension=e},e.prototype.getImagePath=function(){return this.imagePath},e.prototype.setImagePath=function(e){this.imagePath=e},e.prototype.getImageSizes=function(){return this.imageSizes},e.prototype.setImageSizes=function(e){this.imageSizes=e},e.prototype.getCalculator=function(){return this.calculator},e.prototype.setCalculator=function(e){this.calculator=e},e.prototype.getBatchSizeIE=function(){return this.batchSizeIE},e.prototype.setBatchSizeIE=function(e){this.batchSizeIE=e},e.prototype.getClusterClass=function(){return this.clusterClass},e.prototype.setClusterClass=function(e){this.clusterClass=e},e.prototype.getMarkers=function(){return this.markers},e.prototype.getTotalMarkers=function(){return this.markers.length},e.prototype.getClusters=function(){return this.clusters},e.prototype.getTotalClusters=function(){return this.clusters.length},e.prototype.addMarker=function(e,t){this.pushMarkerTo(e),t||this.redraw()},e.prototype.addMarkers=function(e,t){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];r&&this.pushMarkerTo(r)}t||this.redraw()},e.prototype.pushMarkerTo=function(e){var t=this;e.getDraggable()&&google.maps.event.addListener(e,"dragend",function(){t.ready&&(e.isAdded=!1,t.repaint())}),e.isAdded=!1,this.markers.push(e)},e.prototype.removeMarker_=function(e){var t=-1;if(this.markers.indexOf)t=this.markers.indexOf(e);else for(var n=0;n<this.markers.length;n++)if(e===this.markers[n]){t=n;break}return-1!==t&&(e.setMap(null),this.markers.splice(t,1),!0)},e.prototype.removeMarker=function(e,t){var n=this.removeMarker_(e);return!t&&n&&this.repaint(),n},e.prototype.removeMarkers=function(e,t){for(var n=!1,r=0,s=e;r<s.length;r++){var i=s[r];n=n||this.removeMarker_(i)}return!t&&n&&this.repaint(),n},e.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers=[]},e.prototype.repaint=function(){var e=this.clusters.slice();this.clusters=[],this.resetViewport(!1),this.redraw(),setTimeout(function(){for(var t=0,n=e;t<n.length;t++){n[t].remove()}},0)},e.prototype.getExtendedBounds=function(e){var t=this.getProjection(),n=t.fromLatLngToDivPixel(new google.maps.LatLng(e.getNorthEast().lat(),e.getNorthEast().lng()));null!==n&&(n.x+=this.gridSize,n.y-=this.gridSize);var r=t.fromLatLngToDivPixel(new google.maps.LatLng(e.getSouthWest().lat(),e.getSouthWest().lng()));if(null!==r&&(r.x-=this.gridSize,r.y+=this.gridSize),null!==n){var s=t.fromDivPixelToLatLng(n);null!==s&&e.extend(s)}if(null!==r){var i=t.fromDivPixelToLatLng(r);null!==i&&e.extend(i)}return e},e.prototype.redraw=function(){this.createClusters(0)},e.prototype.resetViewport=function(e){for(var t=0,n=this.clusters;t<n.length;t++){n[t].remove()}this.clusters=[];for(var r=0,s=this.markers;r<s.length;r++){var i=s[r];i.isAdded=!1,e&&i.setMap(null)}},e.prototype.distanceBetweenPoints=function(e,t){var n=(t.lat()-e.lat())*Math.PI/180,r=(t.lng()-e.lng())*Math.PI/180,s=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e.lat()*Math.PI/180)*Math.cos(t.lat()*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371},e.prototype.isMarkerInBounds=function(e,t){var n=e.getPosition();return!!n&&t.contains(n)},e.prototype.addToClosestCluster=function(e){for(var t,n=4e4,r=null,s=0,i=this.clusters;s<i.length;s++){var a=(t=i[s]).getCenter(),o=e.getPosition();if(a&&o){var l=this.distanceBetweenPoints(a,o);l<n&&(n=l,r=t)}}r&&r.isMarkerInClusterBounds(e)?r.addMarker(e):((t=new xC(this)).addMarker(e),this.clusters.push(t))},e.prototype.createClusters=function(e){var t=this;if(this.ready){0===e&&(google.maps.event.trigger(this,"clusteringbegin",this),null!==this.timerRefStatic&&(window.clearTimeout(this.timerRefStatic),delete this.timerRefStatic));for(var n=this.getMap(),r=(null!==n&&"getBounds"in n?n.getBounds():null),s=((null===n||void 0===n?void 0:n.getZoom())||0)>3?new google.maps.LatLngBounds(null===r||void 0===r?void 0:r.getSouthWest(),null===r||void 0===r?void 0:r.getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625)),i=this.getExtendedBounds(s),a=Math.min(e+this.batchSize,this.markers.length),o=e;o<a;o++){var l=this.markers[o];l&&!l.isAdded&&this.isMarkerInBounds(l,i)&&(!this.ignoreHidden||this.ignoreHidden&&l.getVisible())&&this.addToClosestCluster(l)}if(a<this.markers.length)this.timerRefStatic=window.setTimeout(function(){t.createClusters(a)},0);else{this.timerRefStatic=null,google.maps.event.trigger(this,"clusteringend",this);for(var c=0,u=this.clusters;c<u.length;c++){u[c].updateIcon()}}}},e.prototype.extend=function(e,t){return function(e){for(var t in e.prototype){var n=t;this.prototype[n]=e.prototype[n]}return this}.apply(e,[t])},e}();function _C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var AC={onClick:"click",onClusteringBegin:"clusteringbegin",onClusteringEnd:"clusteringend",onMouseOut:"mouseout",onMouseOver:"mouseover"},RC={averageCenter(e,t){e.setAverageCenter(t)},batchSizeIE(e,t){e.setBatchSizeIE(t)},calculator(e,t){e.setCalculator(t)},clusterClass(e,t){e.setClusterClass(t)},enableRetinaIcons(e,t){e.setEnableRetinaIcons(t)},gridSize(e,t){e.setGridSize(t)},ignoreHidden(e,t){e.setIgnoreHidden(t)},imageExtension(e,t){e.setImageExtension(t)},imagePath(e,t){e.setImagePath(t)},imageSizes(e,t){e.setImageSizes(t)},maxZoom(e,t){e.setMaxZoom(t)},minimumClusterSize(e,t){e.setMinimumClusterSize(t)},styles(e,t){e.setStyles(t)},title(e,t){e.setTitle(t)},zoomOnClick(e,t){e.setZoomOnClick(t)}},PC={};(0,r.memo)(function(e){var{children:t,options:n,averageCenter:s,batchSizeIE:i,calculator:a,clusterClass:o,enableRetinaIcons:l,gridSize:c,ignoreHidden:u,imageExtension:d,imagePath:h,imageSizes:f,maxZoom:p,minimumClusterSize:g,styles:m,title:v,zoomOnClick:y,onClick:b,onClusteringBegin:E,onClusteringEnd:w,onMouseOver:S,onMouseOut:T,onLoad:k,onUnmount:x}=e,[I,L]=(0,r.useState)(null),C=(0,r.useContext)(OL),[_,A]=(0,r.useState)(null),[R,P]=(0,r.useState)(null),[D,O]=(0,r.useState)(null),[N,M]=(0,r.useState)(null),[F,U]=(0,r.useState)(null);return(0,r.useEffect)(()=>{I&&T&&(null!==N&&google.maps.event.removeListener(N),M(google.maps.event.addListener(I,AC.onMouseOut,T)))},[T]),(0,r.useEffect)(()=>{I&&S&&(null!==F&&google.maps.event.removeListener(F),U(google.maps.event.addListener(I,AC.onMouseOver,S)))},[S]),(0,r.useEffect)(()=>{I&&b&&(null!==_&&google.maps.event.removeListener(_),A(google.maps.event.addListener(I,AC.onClick,b)))},[b]),(0,r.useEffect)(()=>{I&&E&&(null!==R&&google.maps.event.removeListener(R),P(google.maps.event.addListener(I,AC.onClusteringBegin,E)))},[E]),(0,r.useEffect)(()=>{I&&w&&(null!==D&&google.maps.event.removeListener(D),P(google.maps.event.addListener(I,AC.onClusteringEnd,w)))},[w]),(0,r.useEffect)(()=>{"undefined"!==typeof s&&null!==I&&RC.averageCenter(I,s)},[I,s]),(0,r.useEffect)(()=>{"undefined"!==typeof i&&null!==I&&RC.batchSizeIE(I,i)},[I,i]),(0,r.useEffect)(()=>{"undefined"!==typeof a&&null!==I&&RC.calculator(I,a)},[I,a]),(0,r.useEffect)(()=>{"undefined"!==typeof o&&null!==I&&RC.clusterClass(I,o)},[I,o]),(0,r.useEffect)(()=>{"undefined"!==typeof l&&null!==I&&RC.enableRetinaIcons(I,l)},[I,l]),(0,r.useEffect)(()=>{"undefined"!==typeof c&&null!==I&&RC.gridSize(I,c)},[I,c]),(0,r.useEffect)(()=>{"undefined"!==typeof u&&null!==I&&RC.ignoreHidden(I,u)},[I,u]),(0,r.useEffect)(()=>{"undefined"!==typeof d&&null!==I&&RC.imageExtension(I,d)},[I,d]),(0,r.useEffect)(()=>{"undefined"!==typeof h&&null!==I&&RC.imagePath(I,h)},[I,h]),(0,r.useEffect)(()=>{"undefined"!==typeof f&&null!==I&&RC.imageSizes(I,f)},[I,f]),(0,r.useEffect)(()=>{"undefined"!==typeof p&&null!==I&&RC.maxZoom(I,p)},[I,p]),(0,r.useEffect)(()=>{"undefined"!==typeof g&&null!==I&&RC.minimumClusterSize(I,g)},[I,g]),(0,r.useEffect)(()=>{"undefined"!==typeof m&&null!==I&&RC.styles(I,m)},[I,m]),(0,r.useEffect)(()=>{"undefined"!==typeof v&&null!==I&&RC.title(I,v)},[I,v]),(0,r.useEffect)(()=>{"undefined"!==typeof y&&null!==I&&RC.zoomOnClick(I,y)},[I,y]),(0,r.useEffect)(()=>{if(C){var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_C(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_C(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n||PC),t=new CC(C,[],e);return s&&RC.averageCenter(t,s),i&&RC.batchSizeIE(t,i),a&&RC.calculator(t,a),o&&RC.clusterClass(t,o),l&&RC.enableRetinaIcons(t,l),c&&RC.gridSize(t,c),u&&RC.ignoreHidden(t,u),d&&RC.imageExtension(t,d),h&&RC.imagePath(t,h),f&&RC.imageSizes(t,f),p&&RC.maxZoom(t,p),g&&RC.minimumClusterSize(t,g),m&&RC.styles(t,m),v&&RC.title(t,v),y&&RC.zoomOnClick(t,y),T&&M(google.maps.event.addListener(t,AC.onMouseOut,T)),S&&U(google.maps.event.addListener(t,AC.onMouseOver,S)),b&&A(google.maps.event.addListener(t,AC.onClick,b)),E&&P(google.maps.event.addListener(t,AC.onClusteringBegin,E)),w&&O(google.maps.event.addListener(t,AC.onClusteringEnd,w)),L(t),k&&k(t),()=>{null!==N&&google.maps.event.removeListener(N),null!==F&&google.maps.event.removeListener(F),null!==_&&google.maps.event.removeListener(_),null!==R&&google.maps.event.removeListener(R),null!==D&&google.maps.event.removeListener(D),x&&x(t)}}},[]),null!==I&&t(I)||null});class DC extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{markerClusterer:null}),AL(this,"setClustererCallback",()=>{null!==this.state.markerClusterer&&this.props.onLoad&&this.props.onLoad(this.state.markerClusterer)})}componentDidMount(){if(this.context){var e=new CC(this.context,[],this.props.options);this.registeredEvents=jL({updaterMap:RC,eventMap:AC,prevProps:{},nextProps:this.props,instance:e}),this.setState(()=>({markerClusterer:e}),this.setClustererCallback)}}componentDidUpdate(e){this.state.markerClusterer&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:RC,eventMap:AC,prevProps:e,nextProps:this.props,instance:this.state.markerClusterer}))}componentWillUnmount(){null!==this.state.markerClusterer&&(this.props.onUnmount&&this.props.onUnmount(this.state.markerClusterer),UL(this.registeredEvents),this.state.markerClusterer.setMap(null))}render(){return null!==this.state.markerClusterer?this.props.children(this.state.markerClusterer):null}}function OC(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}AL(DC,"contextType",OL);var NC=function(){function e(t){void 0===t&&(t={}),this.getCloseClickHandler=this.getCloseClickHandler.bind(this),this.closeClickHandler=this.closeClickHandler.bind(this),this.createInfoBoxDiv=this.createInfoBoxDiv.bind(this),this.addClickHandler=this.addClickHandler.bind(this),this.getCloseBoxImg=this.getCloseBoxImg.bind(this),this.getBoxWidths=this.getBoxWidths.bind(this),this.setBoxStyle=this.setBoxStyle.bind(this),this.setPosition=this.setPosition.bind(this),this.getPosition=this.getPosition.bind(this),this.setOptions=this.setOptions.bind(this),this.setContent=this.setContent.bind(this),this.setVisible=this.setVisible.bind(this),this.getContent=this.getContent.bind(this),this.getVisible=this.getVisible.bind(this),this.setZIndex=this.setZIndex.bind(this),this.getZIndex=this.getZIndex.bind(this),this.onRemove=this.onRemove.bind(this),this.panBox=this.panBox.bind(this),this.extend=this.extend.bind(this),this.close=this.close.bind(this),this.draw=this.draw.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.open=this.open.bind(this),this.extend(e,google.maps.OverlayView),this.content=t.content||"",this.disableAutoPan=t.disableAutoPan||!1,this.maxWidth=t.maxWidth||0,this.pixelOffset=t.pixelOffset||new google.maps.Size(0,0),this.position=t.position||new google.maps.LatLng(0,0),this.zIndex=t.zIndex||null,this.boxClass=t.boxClass||"infoBox",this.boxStyle=t.boxStyle||{},this.closeBoxMargin=t.closeBoxMargin||"2px",this.closeBoxURL=t.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",""===t.closeBoxURL&&(this.closeBoxURL=""),this.infoBoxClearance=t.infoBoxClearance||new google.maps.Size(1,1),"undefined"===typeof t.visible&&("undefined"===typeof t.isHidden?t.visible=!0:t.visible=!t.isHidden),this.isHidden=!t.visible,this.alignBottom=t.alignBottom||!1,this.pane=t.pane||"floatPane",this.enableEventPropagation=t.enableEventPropagation||!1,this.div=null,this.closeListener=null,this.moveListener=null,this.mapListener=null,this.contextListener=null,this.eventListeners=null,this.fixedWidthSet=null}return e.prototype.createInfoBoxDiv=function(){var e=this;if(!this.div){this.div=document.createElement("div"),this.setBoxStyle(),"string"===typeof this.content?this.div.innerHTML=this.getCloseBoxImg()+this.content:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(this.content));var t=this.getPanes();if(null!==t&&t[this.pane].appendChild(this.div),this.addClickHandler(),this.div.style.width)this.fixedWidthSet=!0;else if(0!==this.maxWidth&&this.div.offsetWidth>this.maxWidth)this.div.style.width=this.maxWidth+"px",this.fixedWidthSet=!0;else{var n=this.getBoxWidths();this.div.style.width=this.div.offsetWidth-n.left-n.right+"px",this.fixedWidthSet=!1}if(this.panBox(this.disableAutoPan),!this.enableEventPropagation){this.eventListeners=[];for(var r=0,s=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"];r<s.length;r++){var i=s[r];this.eventListeners.push(google.maps.event.addListener(this.div,i,OC))}this.eventListeners.push(google.maps.event.addListener(this.div,"mouseover",function(){e.div&&(e.div.style.cursor="default")}))}this.contextListener=google.maps.event.addListener(this.div,"contextmenu",function(t){t.returnValue=!1,t.preventDefault&&t.preventDefault(),e.enableEventPropagation||OC(t)}),google.maps.event.trigger(this,"domready")}},e.prototype.getCloseBoxImg=function(){var e="";return""!==this.closeBoxURL&&(e='<img alt=""',e+=' aria-hidden="true"',e+=" src='"+this.closeBoxURL+"'",e+=" align=right",e+=" style='",e+=" position: relative;",e+=" cursor: pointer;",e+=" margin: "+this.closeBoxMargin+";",e+="'>"),e},e.prototype.addClickHandler=function(){this.closeListener=this.div&&this.div.firstChild&&""!==this.closeBoxURL?google.maps.event.addListener(this.div.firstChild,"click",this.getCloseClickHandler()):null},e.prototype.closeClickHandler=function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),google.maps.event.trigger(this,"closeclick"),this.close()},e.prototype.getCloseClickHandler=function(){return this.closeClickHandler},e.prototype.panBox=function(e){if(this.div&&!e){var t=this.getMap();if(t instanceof google.maps.Map){var n=0,r=0,s=t.getBounds();s&&!s.contains(this.position)&&t.setCenter(this.position);var i=t.getDiv(),a=i.offsetWidth,o=i.offsetHeight,l=this.pixelOffset.width,c=this.pixelOffset.height,u=this.div.offsetWidth,d=this.div.offsetHeight,h=this.infoBoxClearance.width,f=this.infoBoxClearance.height,p=this.getProjection().fromLatLngToContainerPixel(this.position);null!==p&&(p.x<-l+h?n=p.x+l-h:p.x+u+l+h>a&&(n=p.x+u+l+h-a),this.alignBottom?p.y<-c+f+d?r=p.y+c-f-d:p.y+c+f>o&&(r=p.y+c+f-o):p.y<-c+f?r=p.y+c-f:p.y+d+c+f>o&&(r=p.y+d+c+f-o)),0===n&&0===r||t.panBy(n,r)}}},e.prototype.setBoxStyle=function(){if(this.div){this.div.className=this.boxClass,this.div.style.cssText="";var e=this.boxStyle;for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this.div.style[t]=e[t]);if(this.div.style.webkitTransform="translateZ(0)","undefined"!==typeof this.div.style.opacity&&""!==this.div.style.opacity){var n=parseFloat(this.div.style.opacity||"");this.div.style.msFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+100*n+')"',this.div.style.filter="alpha(opacity="+100*n+")"}this.div.style.position="absolute",this.div.style.visibility="hidden",null!==this.zIndex&&(this.div.style.zIndex=this.zIndex+""),this.div.style.overflow||(this.div.style.overflow="auto")}},e.prototype.getBoxWidths=function(){var e={top:0,bottom:0,left:0,right:0};if(!this.div)return e;if(document.defaultView){var t=this.div.ownerDocument,n=t&&t.defaultView?t.defaultView.getComputedStyle(this.div,""):null;n&&(e.top=parseInt(n.borderTopWidth||"",10)||0,e.bottom=parseInt(n.borderBottomWidth||"",10)||0,e.left=parseInt(n.borderLeftWidth||"",10)||0,e.right=parseInt(n.borderRightWidth||"",10)||0)}else if(document.documentElement.currentStyle){var r=this.div.currentStyle;r&&(e.top=parseInt(r.borderTopWidth||"",10)||0,e.bottom=parseInt(r.borderBottomWidth||"",10)||0,e.left=parseInt(r.borderLeftWidth||"",10)||0,e.right=parseInt(r.borderRightWidth||"",10)||0)}return e},e.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.div.parentNode.removeChild(this.div),this.div=null)},e.prototype.draw=function(){if(this.createInfoBoxDiv(),this.div){var e=this.getProjection().fromLatLngToDivPixel(this.position);null!==e&&(this.div.style.left=e.x+this.pixelOffset.width+"px",this.alignBottom?this.div.style.bottom=-(e.y+this.pixelOffset.height)+"px":this.div.style.top=e.y+this.pixelOffset.height+"px"),this.isHidden?this.div.style.visibility="hidden":this.div.style.visibility="visible"}},e.prototype.setOptions=function(e){void 0===e&&(e={}),"undefined"!==typeof e.boxClass&&(this.boxClass=e.boxClass,this.setBoxStyle()),"undefined"!==typeof e.boxStyle&&(this.boxStyle=e.boxStyle,this.setBoxStyle()),"undefined"!==typeof e.content&&this.setContent(e.content),"undefined"!==typeof e.disableAutoPan&&(this.disableAutoPan=e.disableAutoPan),"undefined"!==typeof e.maxWidth&&(this.maxWidth=e.maxWidth),"undefined"!==typeof e.pixelOffset&&(this.pixelOffset=e.pixelOffset),"undefined"!==typeof e.alignBottom&&(this.alignBottom=e.alignBottom),"undefined"!==typeof e.position&&this.setPosition(e.position),"undefined"!==typeof e.zIndex&&this.setZIndex(e.zIndex),"undefined"!==typeof e.closeBoxMargin&&(this.closeBoxMargin=e.closeBoxMargin),"undefined"!==typeof e.closeBoxURL&&(this.closeBoxURL=e.closeBoxURL),"undefined"!==typeof e.infoBoxClearance&&(this.infoBoxClearance=e.infoBoxClearance),"undefined"!==typeof e.isHidden&&(this.isHidden=e.isHidden),"undefined"!==typeof e.visible&&(this.isHidden=!e.visible),"undefined"!==typeof e.enableEventPropagation&&(this.enableEventPropagation=e.enableEventPropagation),this.div&&this.draw()},e.prototype.setContent=function(e){this.content=e,this.div&&(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.fixedWidthSet||(this.div.style.width=""),"string"===typeof e?this.div.innerHTML=this.getCloseBoxImg()+e:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(e)),this.fixedWidthSet||(this.div.style.width=this.div.offsetWidth+"px","string"===typeof e?this.div.innerHTML=this.getCloseBoxImg()+e:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(e))),this.addClickHandler()),google.maps.event.trigger(this,"content_changed")},e.prototype.setPosition=function(e){this.position=e,this.div&&this.draw(),google.maps.event.trigger(this,"position_changed")},e.prototype.setVisible=function(e){this.isHidden=!e,this.div&&(this.div.style.visibility=this.isHidden?"hidden":"visible")},e.prototype.setZIndex=function(e){this.zIndex=e,this.div&&(this.div.style.zIndex=e+""),google.maps.event.trigger(this,"zindex_changed")},e.prototype.getContent=function(){return this.content},e.prototype.getPosition=function(){return this.position},e.prototype.getZIndex=function(){return this.zIndex},e.prototype.getVisible=function(){var e=this.getMap();return"undefined"!==typeof e&&null!==e&&!this.isHidden},e.prototype.show=function(){this.isHidden=!1,this.div&&(this.div.style.visibility="visible")},e.prototype.hide=function(){this.isHidden=!0,this.div&&(this.div.style.visibility="hidden")},e.prototype.open=function(e,t){var n=this;t&&(this.position=t.getPosition(),this.moveListener=google.maps.event.addListener(t,"position_changed",function(){var e=t.getPosition();n.setPosition(e)}),this.mapListener=google.maps.event.addListener(t,"map_changed",function(){n.setMap(t.map)})),this.setMap(e),this.div&&this.panBox()},e.prototype.close=function(){if(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.eventListeners){for(var e=0,t=this.eventListeners;e<t.length;e++){var n=t[e];google.maps.event.removeListener(n)}this.eventListeners=null}this.moveListener&&(google.maps.event.removeListener(this.moveListener),this.moveListener=null),this.mapListener&&(google.maps.event.removeListener(this.mapListener),this.mapListener=null),this.contextListener&&(google.maps.event.removeListener(this.contextListener),this.contextListener=null),this.setMap(null)},e.prototype.extend=function(e,t){return function(e){for(var t in e.prototype)Object.prototype.hasOwnProperty.call(this,t)||(this.prototype[t]=e.prototype[t]);return this}.apply(e,[t])},e}(),MC=["position"],FC=["position"];function UC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function jC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UC(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UC(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var BC={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},VC={options(e,t){e.setOptions(t)},position(e,t){t instanceof google.maps.LatLng?e.setPosition(t):e.setPosition(new google.maps.LatLng(t.lat,t.lng))},visible(e,t){e.setVisible(t)},zIndex(e,t){e.setZIndex(t)}},zC={};var GC,HC;(0,r.memo)(function(e){var{children:t,anchor:n,options:s,position:i,zIndex:a,onCloseClick:o,onDomReady:l,onContentChanged:c,onPositionChanged:u,onZindexChanged:d,onLoad:h,onUnmount:f}=e,p=(0,r.useContext)(OL),[g,m]=(0,r.useState)(null),[v,y]=(0,r.useState)(null),[b,E]=(0,r.useState)(null),[w,S]=(0,r.useState)(null),[T,k]=(0,r.useState)(null),[x,I]=(0,r.useState)(null),L=(0,r.useRef)(null);return(0,r.useEffect)(()=>{p&&null!==g&&(g.close(),n?g.open(p,n):g.getPosition()&&g.open(p))},[p,g,n]),(0,r.useEffect)(()=>{s&&null!==g&&g.setOptions(s)},[g,s]),(0,r.useEffect)(()=>{if(i&&null!==g){var e=i instanceof google.maps.LatLng?i:new google.maps.LatLng(i.lat,i.lng);g.setPosition(e)}},[i]),(0,r.useEffect)(()=>{"number"===typeof a&&null!==g&&g.setZIndex(a)},[a]),(0,r.useEffect)(()=>{g&&o&&(null!==v&&google.maps.event.removeListener(v),y(google.maps.event.addListener(g,"closeclick",o)))},[o]),(0,r.useEffect)(()=>{g&&l&&(null!==b&&google.maps.event.removeListener(b),E(google.maps.event.addListener(g,"domready",l)))},[l]),(0,r.useEffect)(()=>{g&&c&&(null!==w&&google.maps.event.removeListener(w),S(google.maps.event.addListener(g,"content_changed",c)))},[c]),(0,r.useEffect)(()=>{g&&u&&(null!==T&&google.maps.event.removeListener(T),k(google.maps.event.addListener(g,"position_changed",u)))},[u]),(0,r.useEffect)(()=>{g&&d&&(null!==x&&google.maps.event.removeListener(x),I(google.maps.event.addListener(g,"zindex_changed",d)))},[d]),(0,r.useEffect)(()=>{if(p){var e,t=s||zC,{position:r}=t,i=tC(t,MC);!r||r instanceof google.maps.LatLng||(e=new google.maps.LatLng(r.lat,r.lng));var a=new NC(jC(jC({},i),e?{position:e}:{}));L.current=document.createElement("div"),m(a),o&&y(google.maps.event.addListener(a,"closeclick",o)),l&&E(google.maps.event.addListener(a,"domready",l)),c&&S(google.maps.event.addListener(a,"content_changed",c)),u&&k(google.maps.event.addListener(a,"position_changed",u)),d&&I(google.maps.event.addListener(a,"zindex_changed",d)),a.setContent(L.current),n?a.open(p,n):a.getPosition()?a.open(p):DL(!1,"You must provide either an anchor or a position prop for <InfoBox>."),h&&h(a)}return()=>{null!==g&&(v&&google.maps.event.removeListener(v),w&&google.maps.event.removeListener(w),b&&google.maps.event.removeListener(b),T&&google.maps.event.removeListener(T),x&&google.maps.event.removeListener(x),f&&f(g),g.close())}},[]),L.current?(0,rS.createPortal)(r.Children.only(t),L.current):null});class KC extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"containerElement",null),AL(this,"state",{infoBox:null}),AL(this,"open",(e,t)=>{t?null!==this.context&&e.open(this.context,t):e.getPosition()?null!==this.context&&e.open(this.context):DL(!1,"You must provide either an anchor or a position prop for <InfoBox>.")}),AL(this,"setInfoBoxCallback",()=>{null!==this.state.infoBox&&null!==this.containerElement&&(this.state.infoBox.setContent(this.containerElement),this.open(this.state.infoBox,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoBox))})}componentDidMount(){var e,t=this.props.options||{},{position:n}=t,r=tC(t,FC);!n||n instanceof google.maps.LatLng||(e=new google.maps.LatLng(n.lat,n.lng));var s=new NC(jC(jC({},r),e?{position:e}:{}));this.containerElement=document.createElement("div"),this.registeredEvents=jL({updaterMap:VC,eventMap:BC,prevProps:{},nextProps:this.props,instance:s}),this.setState({infoBox:s},this.setInfoBoxCallback)}componentDidUpdate(e){var{infoBox:t}=this.state;null!==t&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:VC,eventMap:BC,prevProps:e,nextProps:this.props,instance:t}))}componentWillUnmount(){var{onUnmount:e}=this.props,{infoBox:t}=this.state;null!==t&&(e&&e(t),UL(this.registeredEvents),t.close())}render(){return this.containerElement?(0,rS.createPortal)(r.Children.only(this.props.children),this.containerElement):null}}AL(KC,"contextType",OL);var WC=(HC||(HC=1,GC=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,s,i;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(s=r;0!==s--;)if(!e(t[s],n[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(s=r;0!==s--;)if(!Object.prototype.hasOwnProperty.call(n,i[s]))return!1;for(s=r;0!==s--;){var a=i[s];if(!e(t[a],n[a]))return!1}return!0}return t!==t&&n!==n}),GC),qC=RL(WC),YC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class QC{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");var r=n>>4;if(1!==r)throw new Error("Got v".concat(r," data when expected v").concat(1,"."));var s=YC[15&n];if(!s)throw new Error("Unrecognized array type.");var[i]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new QC(a,i,s,e)}constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,r=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;var s=YC.indexOf(this.ArrayType),i=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-a%8)%8;if(s<0)throw new Error("Unexpected typed array class: ".concat(n,"."));r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+i+a+o),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+s]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){var n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){var e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return XC(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:s,coords:i,nodeSize:a}=this,o=[0,s.length-1,0],l=[];o.length;){var c=o.pop()||0,u=o.pop()||0,d=o.pop()||0;if(u-d<=a)for(var h=d;h<=u;h++){var f=i[2*h],p=i[2*h+1];f>=e&&f<=n&&p>=t&&p<=r&&l.push(s[h])}else{var g=d+u>>1,m=i[2*g],v=i[2*g+1];m>=e&&m<=n&&v>=t&&v<=r&&l.push(s[g]),(0===c?e<=m:t<=v)&&(o.push(d),o.push(g-1),o.push(1-c)),(0===c?n>=m:r>=v)&&(o.push(g+1),o.push(u),o.push(1-c))}}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:r,coords:s,nodeSize:i}=this,a=[0,r.length-1,0],o=[],l=n*n;a.length;){var c=a.pop()||0,u=a.pop()||0,d=a.pop()||0;if(u-d<=i)for(var h=d;h<=u;h++)e_(s[2*h],s[2*h+1],e,t)<=l&&o.push(r[h]);else{var f=d+u>>1,p=s[2*f],g=s[2*f+1];e_(p,g,e,t)<=l&&o.push(r[f]),(0===c?e-n<=p:t-n<=g)&&(a.push(d),a.push(f-1),a.push(1-c)),(0===c?e+n>=p:t+n>=g)&&(a.push(f+1),a.push(u),a.push(1-c))}}return o}}function XC(e,t,n,r,s,i){if(!(s-r<=n)){var a=r+s>>1;ZC(e,t,a,r,s,i),XC(e,t,n,r,a-1,1-i),XC(e,t,n,a+1,s,1-i)}}function ZC(e,t,n,r,s,i){for(;s>r;){if(s-r>600){var a=s-r+1,o=n-r+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(o-a/2<0?-1:1);ZC(e,t,n,Math.max(r,Math.floor(n-o*c/a+u)),Math.min(s,Math.floor(n+(a-o)*c/a+u)),i)}var d=t[2*n+i],h=r,f=s;for(JC(e,t,r,n),t[2*s+i]>d&&JC(e,t,r,s);h<f;){for(JC(e,t,h,f),h++,f--;t[2*h+i]<d;)h++;for(;t[2*f+i]>d;)f--}t[2*r+i]===d?JC(e,t,r,f):JC(e,t,++f,s),f<=n&&(r=f+1),n<=f&&(s=f-1)}}function JC(e,t,n,r){$C(e,n,r),$C(t,2*n,2*r),$C(t,2*n+1,2*r+1)}function $C(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function e_(e,t,n,r){var s=e-n,i=t-r;return s*s+i*i}var t_,n_={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},r_=Math.fround||(t_=new Float32Array(1),e=>(t_[0]=+e,t_[0]));class s_{constructor(e){this.options=Object.assign(Object.create(n_),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){var{log:t,minZoom:n,maxZoom:r}=this.options;t&&console.time("total time");var s="prepare ".concat(e.length," points");t&&console.time(s),this.points=e;for(var i=[],a=0;a<e.length;a++){var o=e[a];if(o.geometry){var[l,c]=o.geometry.coordinates,u=r_(o_(l)),d=r_(l_(c));i.push(u,d,1/0,a,-1,1),this.options.reduce&&i.push(0)}}var h=this.trees[r+1]=this._createTree(i);t&&console.timeEnd(s);for(var f=r;f>=n;f--){var p=+Date.now();h=this.trees[f]=this._createTree(this._cluster(h,f)),t&&console.log("z%d: %d clusters in %dms",f,h.numItems,+Date.now()-p)}return t&&console.timeEnd("total time"),this}getClusters(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),s=180===e[2]?180:((e[2]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,s=180;else if(n>s){var a=this.getClusters([n,r,180,i],t),o=this.getClusters([-180,r,s,i],t);return a.concat(o)}var l=this.trees[this._limitZoom(t)],c=l.range(o_(n),l_(i),o_(s),l_(r)),u=l.data,d=[];for(var h of c){var f=this.stride*h;d.push(u[f+5]>1?i_(u,f,this.clusterProps):this.points[u[f+3]])}return d}getChildren(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",s=this.trees[n];if(!s)throw new Error(r);var i=s.data;if(t*this.stride>=i.length)throw new Error(r);var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),o=i[t*this.stride],l=i[t*this.stride+1],c=s.within(o,l,a),u=[];for(var d of c){var h=d*this.stride;i[h+4]===e&&u.push(i[h+5]>1?i_(i,h,this.clusterProps):this.points[i[h+3]])}if(0===u.length)throw new Error(r);return u}getLeaves(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r}getTile(e,t,n){var r=this.trees[this._limitZoom(e)],s=Math.pow(2,e),{extent:i,radius:a}=this.options,o=a/i,l=(n-o)/s,c=(n+1+o)/s,u={features:[]};return this._addTileFeatures(r.range((t-o)/s,l,(t+1+o)/s,c),r.data,t,n,s,u),0===t&&this._addTileFeatures(r.range(1-o/s,l,1,c),r.data,s,n,s,u),t===s-1&&this._addTileFeatures(r.range(0,l,o/s,c),r.data,-1,n,s,u),u.features.length?u:null}getClusterExpansionZoom(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,r,s){var i=this.getChildren(t);for(var a of i){var o=a.properties;if(o&&o.cluster?s+o.point_count<=r?s+=o.point_count:s=this._appendLeaves(e,o.cluster_id,n,r,s):s<r?s++:e.push(a),e.length===n)break}return s}_createTree(e){for(var t=new QC(e.length/this.stride|0,this.options.nodeSize,Float32Array),n=0;n<e.length;n+=this.stride)t.add(e[n],e[n+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,n,r,s,i){for(var a of e){var o=a*this.stride,l=t[o+5]>1,c=void 0,u=void 0,d=void 0;if(l)c=a_(t,o,this.clusterProps),u=t[o],d=t[o+1];else{var h=this.points[t[o+3]];c=h.properties;var[f,p]=h.geometry.coordinates;u=o_(f),d=l_(p)}var g={type:1,geometry:[[Math.round(this.options.extent*(u*s-n)),Math.round(this.options.extent*(d*s-r))]],tags:c},m=void 0;void 0!==(m=l||this.options.generateId?t[o+3]:this.points[t[o+3]].id)&&(g.id=m),i.features.push(g)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){for(var{radius:n,extent:r,reduce:s,minPoints:i}=this.options,a=n/(r*Math.pow(2,t)),o=e.data,l=[],c=this.stride,u=0;u<o.length;u+=c)if(!(o[u+2]<=t)){o[u+2]=t;var d=o[u],h=o[u+1],f=e.within(o[u],o[u+1],a),p=o[u+5],g=p;for(var m of f){var v=m*c;o[v+2]>t&&(g+=o[v+5])}if(g>p&&g>=i){var y=d*p,b=h*p,E=void 0,w=-1,S=(u/c<<5)+(t+1)+this.points.length;for(var T of f){var k=T*c;if(!(o[k+2]<=t)){o[k+2]=t;var x=o[k+5];y+=o[k]*x,b+=o[k+1]*x,o[k+4]=S,s&&(E||(E=this._map(o,u,!0),w=this.clusterProps.length,this.clusterProps.push(E)),s(E,this._map(o,k)))}}o[u+4]=S,l.push(y/g,b/g,1/0,S,-1,g),s&&l.push(w)}else{for(var I=0;I<c;I++)l.push(o[u+I]);if(g>1)for(var L of f){var C=L*c;if(!(o[C+2]<=t)){o[C+2]=t;for(var _=0;_<c;_++)l.push(o[C+_])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+5]>1){var r=this.clusterProps[e[t+6]];return n?Object.assign({},r):r}var s=this.points[e[t+3]].properties,i=this.options.map(s);return n&&i===s?Object.assign({},i):i}}function i_(e,t,n){return{type:"Feature",id:e[t+3],properties:a_(e,t,n),geometry:{type:"Point",coordinates:[c_(e[t]),u_(e[t+1])]}}}function a_(e,t,n){var r=e[t+5],s=r>=1e4?"".concat(Math.round(r/1e3),"k"):r>=1e3?"".concat(Math.round(r/100)/10,"k"):r,i=e[t+6],a=-1===i?{}:Object.assign({},n[i]);return Object.assign(a,{cluster:!0,cluster_id:e[t+3],point_count:r,point_count_abbreviated:s})}function o_(e){return e/360+.5}function l_(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function c_(e){return 360*(e-.5)}function u_(e){var t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function d_(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}class h_{static isAdvancedMarkerAvailable(e){return google.maps.marker&&!0===e.getMapCapabilities().isAdvancedMarkersAvailable}static isAdvancedMarker(e){return google.maps.marker&&e instanceof google.maps.marker.AdvancedMarkerElement}static setMap(e,t){this.isAdvancedMarker(e)?e.map=t:e.setMap(t)}static getPosition(e){if(this.isAdvancedMarker(e)){if(e.position){if(e.position instanceof google.maps.LatLng)return e.position;if(e.position.lat&&e.position.lng)return new google.maps.LatLng(e.position.lat,e.position.lng)}return new google.maps.LatLng(null)}return e.getPosition()}static getVisible(e){return!!this.isAdvancedMarker(e)||e.getVisible()}}class f_{constructor(e){var{markers:t,position:n}=e;this.markers=t,n&&(n instanceof google.maps.LatLng?this._position=n:this._position=new google.maps.LatLng(n))}get bounds(){if(0!==this.markers.length||this._position){var e=new google.maps.LatLngBounds(this._position,this._position);for(var t of this.markers)e.extend(h_.getPosition(t));return e}}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(e=>h_.getVisible(e)).length}push(e){this.markers.push(e)}delete(){this.marker&&(h_.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}}class p_{constructor(e){var{maxZoom:t=16}=e;this.maxZoom=t}noop(e){var{markers:t}=e;return m_(t)}}var g_,m_=e=>e.map(e=>new f_({position:h_.getPosition(e),markers:[e]}));class v_ extends p_{constructor(e){var{maxZoom:t,radius:n=60}=e,r=d_(e,["maxZoom","radius"]);super({maxZoom:t}),this.state={zoom:-1},this.superCluster=new s_(Object.assign({maxZoom:this.maxZoom,radius:n},r))}calculate(e){var t=!1,n={zoom:e.map.getZoom()};if(!qC(e.markers,this.markers)){t=!0,this.markers=[...e.markers];var r=this.markers.map(e=>{var t=h_.getPosition(e);return{type:"Feature",geometry:{type:"Point",coordinates:[t.lng(),t.lat()]},properties:{marker:e}}});this.superCluster.load(r)}return t||(this.state.zoom<=this.maxZoom||n.zoom<=this.maxZoom)&&(t=!qC(this.state,n)),this.state=n,t&&(this.clusters=this.cluster(e)),{clusters:this.clusters,changed:t}}cluster(e){var{map:t}=e;return this.superCluster.getClusters([-180,-90,180,90],Math.round(t.getZoom())).map(e=>this.transformCluster(e))}transformCluster(e){var{geometry:{coordinates:[t,n]},properties:r}=e;if(r.cluster)return new f_({markers:this.superCluster.getLeaves(r.cluster_id,1/0).map(e=>e.properties.marker),position:{lat:n,lng:t}});var s=r.marker;return new f_({markers:[s],position:h_.getPosition(s)})}}class y_{constructor(e,t){this.markers={sum:e.length};var n=t.map(e=>e.count),r=n.reduce((e,t)=>e+t,0);this.clusters={count:t.length,markers:{mean:r/t.length,sum:r,min:Math.min(...n),max:Math.max(...n)}}}}class b_{render(e,t,n){var{count:r,position:s}=e,i=r>Math.max(10,t.clusters.markers.mean)?"#ff0000":"#0000ff",a='<svg fill="'.concat(i,'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" width="50" height="50">\n<circle cx="120" cy="120" opacity=".6" r="70" />\n<circle cx="120" cy="120" opacity=".3" r="90" />\n<circle cx="120" cy="120" opacity=".2" r="110" />\n<text x="50%" y="50%" style="fill:#fff" text-anchor="middle" font-size="50" dominant-baseline="middle" font-family="roboto,arial,sans-serif">').concat(r,"</text>\n</svg>"),o="Cluster of ".concat(r," markers"),l=Number(google.maps.Marker.MAX_ZINDEX)+r;if(h_.isAdvancedMarkerAvailable(n)){var c=(new DOMParser).parseFromString(a,"image/svg+xml").documentElement;c.setAttribute("transform","translate(0 25)");var u={map:n,position:s,zIndex:l,title:o,content:c};return new google.maps.marker.AdvancedMarkerElement(u)}var d={position:s,zIndex:l,title:o,icon:{url:"data:image/svg+xml;base64,".concat(btoa(a)),anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(d)}}class E_{constructor(){!function(e,t){for(var n in t.prototype)e.prototype[n]=t.prototype[n]}(E_,google.maps.OverlayView)}}!function(e){e.CLUSTERING_BEGIN="clusteringbegin",e.CLUSTERING_END="clusteringend",e.CLUSTER_CLICK="click"}(g_||(g_={}));var w_=(e,t,n)=>{n.fitBounds(t.bounds)};class S_ extends E_{constructor(e){var{map:t,markers:n=[],algorithmOptions:r={},algorithm:s=new v_(r),renderer:i=new b_,onClusterClick:a=w_}=e;super(),this.markers=[...n],this.clusters=[],this.algorithm=s,this.renderer=i,this.onClusterClick=a,t&&this.setMap(t)}addMarker(e,t){this.markers.includes(e)||(this.markers.push(e),t||this.render())}addMarkers(e,t){e.forEach(e=>{this.addMarker(e,!0)}),t||this.render()}removeMarker(e,t){var n=this.markers.indexOf(e);return-1!==n&&(h_.setMap(e,null),this.markers.splice(n,1),t||this.render(),!0)}removeMarkers(e,t){var n=!1;return e.forEach(e=>{n=this.removeMarker(e,!0)||n}),n&&!t&&this.render(),n}clearMarkers(e){this.markers.length=0,e||this.render()}render(){var e=this.getMap();if(e instanceof google.maps.Map&&e.getProjection()){google.maps.event.trigger(this,g_.CLUSTERING_BEGIN,this);var{clusters:t,changed:n}=this.algorithm.calculate({markers:this.markers,map:e,mapCanvasProjection:this.getProjection()});if(n||void 0==n){var r=new Set;for(var s of t)1==s.markers.length&&r.add(s.markers[0]);var i=[];for(var a of this.clusters)null!=a.marker&&(1==a.markers.length?r.has(a.marker)||h_.setMap(a.marker,null):i.push(a.marker));this.clusters=t,this.renderClusters(),requestAnimationFrame(()=>i.forEach(e=>h_.setMap(e,null)))}google.maps.event.trigger(this,g_.CLUSTERING_END,this)}}onAdd(){this.idleListener=this.getMap().addListener("idle",this.render.bind(this)),this.render()}onRemove(){google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(e=>h_.setMap(e,null)),this.clusters.forEach(e=>e.delete()),this.clusters=[]}renderClusters(){var e=new y_(this.markers,this.clusters),t=this.getMap();this.clusters.forEach(n=>{1===n.markers.length?n.marker=n.markers[0]:(n.marker=this.renderer.render(n,e,t),n.markers.forEach(e=>h_.setMap(e,null)),this.onClusterClick&&n.marker.addListener("click",e=>{google.maps.event.trigger(this,g_.CLUSTER_CLICK,n),this.onClusterClick(e,n,t)})),h_.setMap(n.marker,t)})}}function T_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T_(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function x_(e){var t=function(){DL(!!r.useContext,"useGoogleMap is React hook and requires React version 16.8+");var e=(0,r.useContext)(OL);return DL(!!e,"useGoogleMap needs a GoogleMap available up in the tree"),e}(),[n,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(t&&null===n){var r=new S_(k_(k_({},e),{},{map:t}));s(r)}},[t]),n}(0,r.memo)(function(e){var{children:t,options:n}=e,r=x_(n);return null!==r?t(r):null});var I_={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},L_={options(e,t){e.setOptions(t)},position(e,t){e.setPosition(t)},zIndex(e,t){e.setZIndex(t)}};(0,r.memo)(function(e){var{children:t,anchor:n,options:s,position:i,zIndex:a,onCloseClick:o,onDomReady:l,onContentChanged:c,onPositionChanged:u,onZindexChanged:d,onLoad:h,onUnmount:f}=e,p=(0,r.useContext)(OL),[g,m]=(0,r.useState)(null),[v,y]=(0,r.useState)(null),[b,E]=(0,r.useState)(null),[w,S]=(0,r.useState)(null),[T,k]=(0,r.useState)(null),[x,I]=(0,r.useState)(null),L=(0,r.useRef)(null);return(0,r.useEffect)(()=>{null!==g&&(g.close(),n?g.open(p,n):g.getPosition()&&g.open(p))},[p,g,n]),(0,r.useEffect)(()=>{s&&null!==g&&g.setOptions(s)},[g,s]),(0,r.useEffect)(()=>{i&&null!==g&&g.setPosition(i)},[i]),(0,r.useEffect)(()=>{"number"===typeof a&&null!==g&&g.setZIndex(a)},[a]),(0,r.useEffect)(()=>{g&&o&&(null!==v&&google.maps.event.removeListener(v),y(google.maps.event.addListener(g,"closeclick",o)))},[o]),(0,r.useEffect)(()=>{g&&l&&(null!==b&&google.maps.event.removeListener(b),E(google.maps.event.addListener(g,"domready",l)))},[l]),(0,r.useEffect)(()=>{g&&c&&(null!==w&&google.maps.event.removeListener(w),S(google.maps.event.addListener(g,"content_changed",c)))},[c]),(0,r.useEffect)(()=>{g&&u&&(null!==T&&google.maps.event.removeListener(T),k(google.maps.event.addListener(g,"position_changed",u)))},[u]),(0,r.useEffect)(()=>{g&&d&&(null!==x&&google.maps.event.removeListener(x),I(google.maps.event.addListener(g,"zindex_changed",d)))},[d]),(0,r.useEffect)(()=>{var e=new google.maps.InfoWindow(s);return m(e),L.current=document.createElement("div"),o&&y(google.maps.event.addListener(e,"closeclick",o)),l&&E(google.maps.event.addListener(e,"domready",l)),c&&S(google.maps.event.addListener(e,"content_changed",c)),u&&k(google.maps.event.addListener(e,"position_changed",u)),d&&I(google.maps.event.addListener(e,"zindex_changed",d)),e.setContent(L.current),i&&e.setPosition(i),a&&e.setZIndex(a),n?e.open(p,n):e.getPosition()?e.open(p):DL(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>."),h&&h(e),()=>{v&&google.maps.event.removeListener(v),w&&google.maps.event.removeListener(w),b&&google.maps.event.removeListener(b),T&&google.maps.event.removeListener(T),x&&google.maps.event.removeListener(x),f&&f(e),e.close()}},[]),L.current?(0,rS.createPortal)(r.Children.only(t),L.current):null});class C_ extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"containerElement",null),AL(this,"state",{infoWindow:null}),AL(this,"open",(e,t)=>{t?e.open(this.context,t):e.getPosition()?e.open(this.context):DL(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>.")}),AL(this,"setInfoWindowCallback",()=>{null!==this.state.infoWindow&&null!==this.containerElement&&(this.state.infoWindow.setContent(this.containerElement),this.open(this.state.infoWindow,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoWindow))})}componentDidMount(){var e=new google.maps.InfoWindow(this.props.options);this.containerElement=document.createElement("div"),this.registeredEvents=jL({updaterMap:L_,eventMap:I_,prevProps:{},nextProps:this.props,instance:e}),this.setState(()=>({infoWindow:e}),this.setInfoWindowCallback)}componentDidUpdate(e){null!==this.state.infoWindow&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:L_,eventMap:I_,prevProps:e,nextProps:this.props,instance:this.state.infoWindow}))}componentWillUnmount(){null!==this.state.infoWindow&&(UL(this.registeredEvents),this.props.onUnmount&&this.props.onUnmount(this.state.infoWindow),this.state.infoWindow.close())}render(){return this.containerElement?(0,rS.createPortal)(r.Children.only(this.props.children),this.containerElement):null}}function __(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function A_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?__(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):__(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(C_,"contextType",OL);var R_={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},P_={draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},path(e,t){e.setPath(t)},visible(e,t){e.setVisible(t)}},D_={};(0,r.memo)(function(e){var{options:t,draggable:n,editable:s,visible:i,path:a,onDblClick:o,onDragEnd:l,onDragStart:c,onMouseDown:u,onMouseMove:d,onMouseOut:h,onMouseOver:f,onMouseUp:p,onRightClick:g,onClick:m,onDrag:v,onLoad:y,onUnmount:b}=e,E=(0,r.useContext)(OL),[w,S]=(0,r.useState)(null),[T,k]=(0,r.useState)(null),[x,I]=(0,r.useState)(null),[L,C]=(0,r.useState)(null),[_,A]=(0,r.useState)(null),[R,P]=(0,r.useState)(null),[D,O]=(0,r.useState)(null),[N,M]=(0,r.useState)(null),[F,U]=(0,r.useState)(null),[j,B]=(0,r.useState)(null),[V,z]=(0,r.useState)(null),[G,H]=(0,r.useState)(null);return(0,r.useEffect)(()=>{null!==w&&w.setMap(E)},[E]),(0,r.useEffect)(()=>{"undefined"!==typeof t&&null!==w&&w.setOptions(t)},[w,t]),(0,r.useEffect)(()=>{"undefined"!==typeof n&&null!==w&&w.setDraggable(n)},[w,n]),(0,r.useEffect)(()=>{"undefined"!==typeof s&&null!==w&&w.setEditable(s)},[w,s]),(0,r.useEffect)(()=>{"undefined"!==typeof i&&null!==w&&w.setVisible(i)},[w,i]),(0,r.useEffect)(()=>{"undefined"!==typeof a&&null!==w&&w.setPath(a)},[w,a]),(0,r.useEffect)(()=>{w&&o&&(null!==T&&google.maps.event.removeListener(T),k(google.maps.event.addListener(w,"dblclick",o)))},[o]),(0,r.useEffect)(()=>{w&&l&&(null!==x&&google.maps.event.removeListener(x),I(google.maps.event.addListener(w,"dragend",l)))},[l]),(0,r.useEffect)(()=>{w&&c&&(null!==L&&google.maps.event.removeListener(L),C(google.maps.event.addListener(w,"dragstart",c)))},[c]),(0,r.useEffect)(()=>{w&&u&&(null!==_&&google.maps.event.removeListener(_),A(google.maps.event.addListener(w,"mousedown",u)))},[u]),(0,r.useEffect)(()=>{w&&d&&(null!==R&&google.maps.event.removeListener(R),P(google.maps.event.addListener(w,"mousemove",d)))},[d]),(0,r.useEffect)(()=>{w&&h&&(null!==D&&google.maps.event.removeListener(D),O(google.maps.event.addListener(w,"mouseout",h)))},[h]),(0,r.useEffect)(()=>{w&&f&&(null!==N&&google.maps.event.removeListener(N),M(google.maps.event.addListener(w,"mouseover",f)))},[f]),(0,r.useEffect)(()=>{w&&p&&(null!==F&&google.maps.event.removeListener(F),U(google.maps.event.addListener(w,"mouseup",p)))},[p]),(0,r.useEffect)(()=>{w&&g&&(null!==j&&google.maps.event.removeListener(j),B(google.maps.event.addListener(w,"rightclick",g)))},[g]),(0,r.useEffect)(()=>{w&&m&&(null!==V&&google.maps.event.removeListener(V),z(google.maps.event.addListener(w,"click",m)))},[m]),(0,r.useEffect)(()=>{w&&v&&(null!==G&&google.maps.event.removeListener(G),H(google.maps.event.addListener(w,"drag",v)))},[v]),(0,r.useEffect)(()=>{var e=new google.maps.Polyline(A_(A_({},t||D_),{},{map:E}));return a&&e.setPath(a),"undefined"!==typeof i&&e.setVisible(i),"undefined"!==typeof s&&e.setEditable(s),"undefined"!==typeof n&&e.setDraggable(n),o&&k(google.maps.event.addListener(e,"dblclick",o)),l&&I(google.maps.event.addListener(e,"dragend",l)),c&&C(google.maps.event.addListener(e,"dragstart",c)),u&&A(google.maps.event.addListener(e,"mousedown",u)),d&&P(google.maps.event.addListener(e,"mousemove",d)),h&&O(google.maps.event.addListener(e,"mouseout",h)),f&&M(google.maps.event.addListener(e,"mouseover",f)),p&&U(google.maps.event.addListener(e,"mouseup",p)),g&&B(google.maps.event.addListener(e,"rightclick",g)),m&&z(google.maps.event.addListener(e,"click",m)),v&&H(google.maps.event.addListener(e,"drag",v)),S(e),y&&y(e),()=>{null!==T&&google.maps.event.removeListener(T),null!==x&&google.maps.event.removeListener(x),null!==L&&google.maps.event.removeListener(L),null!==_&&google.maps.event.removeListener(_),null!==R&&google.maps.event.removeListener(R),null!==D&&google.maps.event.removeListener(D),null!==N&&google.maps.event.removeListener(N),null!==F&&google.maps.event.removeListener(F),null!==j&&google.maps.event.removeListener(j),null!==V&&google.maps.event.removeListener(V),b&&b(e),e.setMap(null)}},[]),null});class O_ extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{polyline:null}),AL(this,"setPolylineCallback",()=>{null!==this.state.polyline&&this.props.onLoad&&this.props.onLoad(this.state.polyline)})}componentDidMount(){var e=new google.maps.Polyline(A_(A_({},this.props.options),{},{map:this.context}));this.registeredEvents=jL({updaterMap:P_,eventMap:R_,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{polyline:e}},this.setPolylineCallback)}componentDidUpdate(e){null!==this.state.polyline&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:P_,eventMap:R_,prevProps:e,nextProps:this.props,instance:this.state.polyline}))}componentWillUnmount(){null!==this.state.polyline&&(this.props.onUnmount&&this.props.onUnmount(this.state.polyline),UL(this.registeredEvents),this.state.polyline.setMap(null))}render(){return null}}function N_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N_(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(O_,"contextType",OL);var F_={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},U_={draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},path(e,t){e.setPath(t)},paths(e,t){e.setPaths(t)},visible(e,t){e.setVisible(t)}};(0,r.memo)(function(e){var{options:t,draggable:n,editable:s,visible:i,path:a,paths:o,onDblClick:l,onDragEnd:c,onDragStart:u,onMouseDown:d,onMouseMove:h,onMouseOut:f,onMouseOver:p,onMouseUp:g,onRightClick:m,onClick:v,onDrag:y,onLoad:b,onUnmount:E,onEdit:w}=e,S=(0,r.useContext)(OL),[T,k]=(0,r.useState)(null),[x,I]=(0,r.useState)(null),[L,C]=(0,r.useState)(null),[_,A]=(0,r.useState)(null),[R,P]=(0,r.useState)(null),[D,O]=(0,r.useState)(null),[N,M]=(0,r.useState)(null),[F,U]=(0,r.useState)(null),[j,B]=(0,r.useState)(null),[V,z]=(0,r.useState)(null),[G,H]=(0,r.useState)(null),[K,W]=(0,r.useState)(null);return(0,r.useEffect)(()=>{null!==T&&T.setMap(S)},[S]),(0,r.useEffect)(()=>{"undefined"!==typeof t&&null!==T&&T.setOptions(t)},[T,t]),(0,r.useEffect)(()=>{"undefined"!==typeof n&&null!==T&&T.setDraggable(n)},[T,n]),(0,r.useEffect)(()=>{"undefined"!==typeof s&&null!==T&&T.setEditable(s)},[T,s]),(0,r.useEffect)(()=>{"undefined"!==typeof i&&null!==T&&T.setVisible(i)},[T,i]),(0,r.useEffect)(()=>{"undefined"!==typeof a&&null!==T&&T.setPath(a)},[T,a]),(0,r.useEffect)(()=>{"undefined"!==typeof o&&null!==T&&T.setPaths(o)},[T,o]),(0,r.useEffect)(()=>{T&&"function"===typeof l&&(null!==x&&google.maps.event.removeListener(x),I(google.maps.event.addListener(T,"dblclick",l)))},[l]),(0,r.useEffect)(()=>{T&&(google.maps.event.addListener(T.getPath(),"insert_at",()=>{null===w||void 0===w||w(T)}),google.maps.event.addListener(T.getPath(),"set_at",()=>{null===w||void 0===w||w(T)}),google.maps.event.addListener(T.getPath(),"remove_at",()=>{null===w||void 0===w||w(T)}))},[T,w]),(0,r.useEffect)(()=>{T&&"function"===typeof c&&(null!==L&&google.maps.event.removeListener(L),C(google.maps.event.addListener(T,"dragend",c)))},[c]),(0,r.useEffect)(()=>{T&&"function"===typeof u&&(null!==_&&google.maps.event.removeListener(_),A(google.maps.event.addListener(T,"dragstart",u)))},[u]),(0,r.useEffect)(()=>{T&&"function"===typeof d&&(null!==R&&google.maps.event.removeListener(R),P(google.maps.event.addListener(T,"mousedown",d)))},[d]),(0,r.useEffect)(()=>{T&&"function"===typeof h&&(null!==D&&google.maps.event.removeListener(D),O(google.maps.event.addListener(T,"mousemove",h)))},[h]),(0,r.useEffect)(()=>{T&&"function"===typeof f&&(null!==N&&google.maps.event.removeListener(N),M(google.maps.event.addListener(T,"mouseout",f)))},[f]),(0,r.useEffect)(()=>{T&&"function"===typeof p&&(null!==F&&google.maps.event.removeListener(F),U(google.maps.event.addListener(T,"mouseover",p)))},[p]),(0,r.useEffect)(()=>{T&&"function"===typeof g&&(null!==j&&google.maps.event.removeListener(j),B(google.maps.event.addListener(T,"mouseup",g)))},[g]),(0,r.useEffect)(()=>{T&&"function"===typeof m&&(null!==V&&google.maps.event.removeListener(V),z(google.maps.event.addListener(T,"rightclick",m)))},[m]),(0,r.useEffect)(()=>{T&&"function"===typeof v&&(null!==G&&google.maps.event.removeListener(G),H(google.maps.event.addListener(T,"click",v)))},[v]),(0,r.useEffect)(()=>{T&&"function"===typeof y&&(null!==K&&google.maps.event.removeListener(K),W(google.maps.event.addListener(T,"drag",y)))},[y]),(0,r.useEffect)(()=>{var e=new google.maps.Polygon(M_(M_({},t),{},{map:S}));return a&&e.setPath(a),o&&e.setPaths(o),"undefined"!==typeof i&&e.setVisible(i),"undefined"!==typeof s&&e.setEditable(s),"undefined"!==typeof n&&e.setDraggable(n),l&&I(google.maps.event.addListener(e,"dblclick",l)),c&&C(google.maps.event.addListener(e,"dragend",c)),u&&A(google.maps.event.addListener(e,"dragstart",u)),d&&P(google.maps.event.addListener(e,"mousedown",d)),h&&O(google.maps.event.addListener(e,"mousemove",h)),f&&M(google.maps.event.addListener(e,"mouseout",f)),p&&U(google.maps.event.addListener(e,"mouseover",p)),g&&B(google.maps.event.addListener(e,"mouseup",g)),m&&z(google.maps.event.addListener(e,"rightclick",m)),v&&H(google.maps.event.addListener(e,"click",v)),y&&W(google.maps.event.addListener(e,"drag",y)),k(e),b&&b(e),()=>{null!==x&&google.maps.event.removeListener(x),null!==L&&google.maps.event.removeListener(L),null!==_&&google.maps.event.removeListener(_),null!==R&&google.maps.event.removeListener(R),null!==D&&google.maps.event.removeListener(D),null!==N&&google.maps.event.removeListener(N),null!==F&&google.maps.event.removeListener(F),null!==j&&google.maps.event.removeListener(j),null!==V&&google.maps.event.removeListener(V),null!==G&&google.maps.event.removeListener(G),E&&E(e),e.setMap(null)}},[]),null});class j_ extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[])}componentDidMount(){var e=this.props.options||{};this.polygon=new google.maps.Polygon(e),this.polygon.setMap(this.context),this.registeredEvents=jL({updaterMap:U_,eventMap:F_,prevProps:{},nextProps:this.props,instance:this.polygon}),this.props.onLoad&&this.props.onLoad(this.polygon)}componentDidUpdate(e){this.polygon&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:U_,eventMap:F_,prevProps:e,nextProps:this.props,instance:this.polygon}))}componentWillUnmount(){this.polygon&&(this.props.onUnmount&&this.props.onUnmount(this.polygon),UL(this.registeredEvents),this.polygon&&this.polygon.setMap(null))}render(){return null}}function B_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function V_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B_(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(j_,"contextType",OL);var z_={onBoundsChanged:"bounds_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},G_={bounds(e,t){e.setBounds(t)},draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},visible(e,t){e.setVisible(t)}};(0,r.memo)(function(e){var{options:t,bounds:n,draggable:s,editable:i,visible:a,onDblClick:o,onDragEnd:l,onDragStart:c,onMouseDown:u,onMouseMove:d,onMouseOut:h,onMouseOver:f,onMouseUp:p,onRightClick:g,onClick:m,onDrag:v,onBoundsChanged:y,onLoad:b,onUnmount:E}=e,w=(0,r.useContext)(OL),[S,T]=(0,r.useState)(null),[k,x]=(0,r.useState)(null),[I,L]=(0,r.useState)(null),[C,_]=(0,r.useState)(null),[A,R]=(0,r.useState)(null),[P,D]=(0,r.useState)(null),[O,N]=(0,r.useState)(null),[M,F]=(0,r.useState)(null),[U,j]=(0,r.useState)(null),[B,V]=(0,r.useState)(null),[z,G]=(0,r.useState)(null),[H,K]=(0,r.useState)(null),[W,q]=(0,r.useState)(null);return(0,r.useEffect)(()=>{null!==S&&S.setMap(w)},[w]),(0,r.useEffect)(()=>{"undefined"!==typeof t&&null!==S&&S.setOptions(t)},[S,t]),(0,r.useEffect)(()=>{"undefined"!==typeof s&&null!==S&&S.setDraggable(s)},[S,s]),(0,r.useEffect)(()=>{"undefined"!==typeof i&&null!==S&&S.setEditable(i)},[S,i]),(0,r.useEffect)(()=>{"undefined"!==typeof a&&null!==S&&S.setVisible(a)},[S,a]),(0,r.useEffect)(()=>{"undefined"!==typeof n&&null!==S&&S.setBounds(n)},[S,n]),(0,r.useEffect)(()=>{S&&o&&(null!==k&&google.maps.event.removeListener(k),x(google.maps.event.addListener(S,"dblclick",o)))},[o]),(0,r.useEffect)(()=>{S&&l&&(null!==I&&google.maps.event.removeListener(I),L(google.maps.event.addListener(S,"dragend",l)))},[l]),(0,r.useEffect)(()=>{S&&c&&(null!==C&&google.maps.event.removeListener(C),_(google.maps.event.addListener(S,"dragstart",c)))},[c]),(0,r.useEffect)(()=>{S&&u&&(null!==A&&google.maps.event.removeListener(A),R(google.maps.event.addListener(S,"mousedown",u)))},[u]),(0,r.useEffect)(()=>{S&&d&&(null!==P&&google.maps.event.removeListener(P),D(google.maps.event.addListener(S,"mousemove",d)))},[d]),(0,r.useEffect)(()=>{S&&h&&(null!==O&&google.maps.event.removeListener(O),N(google.maps.event.addListener(S,"mouseout",h)))},[h]),(0,r.useEffect)(()=>{S&&f&&(null!==M&&google.maps.event.removeListener(M),F(google.maps.event.addListener(S,"mouseover",f)))},[f]),(0,r.useEffect)(()=>{S&&p&&(null!==U&&google.maps.event.removeListener(U),j(google.maps.event.addListener(S,"mouseup",p)))},[p]),(0,r.useEffect)(()=>{S&&g&&(null!==B&&google.maps.event.removeListener(B),V(google.maps.event.addListener(S,"rightclick",g)))},[g]),(0,r.useEffect)(()=>{S&&m&&(null!==z&&google.maps.event.removeListener(z),G(google.maps.event.addListener(S,"click",m)))},[m]),(0,r.useEffect)(()=>{S&&v&&(null!==H&&google.maps.event.removeListener(H),K(google.maps.event.addListener(S,"drag",v)))},[v]),(0,r.useEffect)(()=>{S&&y&&(null!==W&&google.maps.event.removeListener(W),q(google.maps.event.addListener(S,"bounds_changed",y)))},[y]),(0,r.useEffect)(()=>{var e=new google.maps.Rectangle(V_(V_({},t),{},{map:w}));return"undefined"!==typeof a&&e.setVisible(a),"undefined"!==typeof i&&e.setEditable(i),"undefined"!==typeof s&&e.setDraggable(s),"undefined"!==typeof n&&e.setBounds(n),o&&x(google.maps.event.addListener(e,"dblclick",o)),l&&L(google.maps.event.addListener(e,"dragend",l)),c&&_(google.maps.event.addListener(e,"dragstart",c)),u&&R(google.maps.event.addListener(e,"mousedown",u)),d&&D(google.maps.event.addListener(e,"mousemove",d)),h&&N(google.maps.event.addListener(e,"mouseout",h)),f&&F(google.maps.event.addListener(e,"mouseover",f)),p&&j(google.maps.event.addListener(e,"mouseup",p)),g&&V(google.maps.event.addListener(e,"rightclick",g)),m&&G(google.maps.event.addListener(e,"click",m)),v&&K(google.maps.event.addListener(e,"drag",v)),y&&q(google.maps.event.addListener(e,"bounds_changed",y)),T(e),b&&b(e),()=>{null!==k&&google.maps.event.removeListener(k),null!==I&&google.maps.event.removeListener(I),null!==C&&google.maps.event.removeListener(C),null!==A&&google.maps.event.removeListener(A),null!==P&&google.maps.event.removeListener(P),null!==O&&google.maps.event.removeListener(O),null!==M&&google.maps.event.removeListener(M),null!==U&&google.maps.event.removeListener(U),null!==B&&google.maps.event.removeListener(B),null!==z&&google.maps.event.removeListener(z),null!==H&&google.maps.event.removeListener(H),null!==W&&google.maps.event.removeListener(W),E&&E(e),e.setMap(null)}},[]),null});class H_ extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{rectangle:null}),AL(this,"setRectangleCallback",()=>{null!==this.state.rectangle&&this.props.onLoad&&this.props.onLoad(this.state.rectangle)})}componentDidMount(){var e=new google.maps.Rectangle(V_(V_({},this.props.options),{},{map:this.context}));this.registeredEvents=jL({updaterMap:G_,eventMap:z_,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{rectangle:e}},this.setRectangleCallback)}componentDidUpdate(e){null!==this.state.rectangle&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:G_,eventMap:z_,prevProps:e,nextProps:this.props,instance:this.state.rectangle}))}componentWillUnmount(){null!==this.state.rectangle&&(this.props.onUnmount&&this.props.onUnmount(this.state.rectangle),UL(this.registeredEvents),this.state.rectangle.setMap(null))}render(){return null}}function K_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function W_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K_(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(H_,"contextType",OL);var q_={onCenterChanged:"center_changed",onRadiusChanged:"radius_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},Y_={center(e,t){e.setCenter(t)},draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},radius(e,t){e.setRadius(t)},visible(e,t){e.setVisible(t)}},Q_={};(0,r.memo)(function(e){var{options:t,center:n,radius:s,draggable:i,editable:a,visible:o,onDblClick:l,onDragEnd:c,onDragStart:u,onMouseDown:d,onMouseMove:h,onMouseOut:f,onMouseOver:p,onMouseUp:g,onRightClick:m,onClick:v,onDrag:y,onCenterChanged:b,onRadiusChanged:E,onLoad:w,onUnmount:S}=e,T=(0,r.useContext)(OL),[k,x]=(0,r.useState)(null),[I,L]=(0,r.useState)(null),[C,_]=(0,r.useState)(null),[A,R]=(0,r.useState)(null),[P,D]=(0,r.useState)(null),[O,N]=(0,r.useState)(null),[M,F]=(0,r.useState)(null),[U,j]=(0,r.useState)(null),[B,V]=(0,r.useState)(null),[z,G]=(0,r.useState)(null),[H,K]=(0,r.useState)(null),[W,q]=(0,r.useState)(null),[Y,Q]=(0,r.useState)(null),[X,Z]=(0,r.useState)(null);return(0,r.useEffect)(()=>{null!==k&&k.setMap(T)},[T]),(0,r.useEffect)(()=>{"undefined"!==typeof t&&null!==k&&k.setOptions(t)},[k,t]),(0,r.useEffect)(()=>{"undefined"!==typeof i&&null!==k&&k.setDraggable(i)},[k,i]),(0,r.useEffect)(()=>{"undefined"!==typeof a&&null!==k&&k.setEditable(a)},[k,a]),(0,r.useEffect)(()=>{"undefined"!==typeof o&&null!==k&&k.setVisible(o)},[k,o]),(0,r.useEffect)(()=>{"number"===typeof s&&null!==k&&k.setRadius(s)},[k,s]),(0,r.useEffect)(()=>{"undefined"!==typeof n&&null!==k&&k.setCenter(n)},[k,n]),(0,r.useEffect)(()=>{k&&l&&(null!==I&&google.maps.event.removeListener(I),L(google.maps.event.addListener(k,"dblclick",l)))},[l]),(0,r.useEffect)(()=>{k&&c&&(null!==C&&google.maps.event.removeListener(C),_(google.maps.event.addListener(k,"dragend",c)))},[c]),(0,r.useEffect)(()=>{k&&u&&(null!==A&&google.maps.event.removeListener(A),R(google.maps.event.addListener(k,"dragstart",u)))},[u]),(0,r.useEffect)(()=>{k&&d&&(null!==P&&google.maps.event.removeListener(P),D(google.maps.event.addListener(k,"mousedown",d)))},[d]),(0,r.useEffect)(()=>{k&&h&&(null!==O&&google.maps.event.removeListener(O),N(google.maps.event.addListener(k,"mousemove",h)))},[h]),(0,r.useEffect)(()=>{k&&f&&(null!==M&&google.maps.event.removeListener(M),F(google.maps.event.addListener(k,"mouseout",f)))},[f]),(0,r.useEffect)(()=>{k&&p&&(null!==U&&google.maps.event.removeListener(U),j(google.maps.event.addListener(k,"mouseover",p)))},[p]),(0,r.useEffect)(()=>{k&&g&&(null!==B&&google.maps.event.removeListener(B),V(google.maps.event.addListener(k,"mouseup",g)))},[g]),(0,r.useEffect)(()=>{k&&m&&(null!==z&&google.maps.event.removeListener(z),G(google.maps.event.addListener(k,"rightclick",m)))},[m]),(0,r.useEffect)(()=>{k&&v&&(null!==H&&google.maps.event.removeListener(H),K(google.maps.event.addListener(k,"click",v)))},[v]),(0,r.useEffect)(()=>{k&&y&&(null!==W&&google.maps.event.removeListener(W),q(google.maps.event.addListener(k,"drag",y)))},[y]),(0,r.useEffect)(()=>{k&&b&&(null!==Y&&google.maps.event.removeListener(Y),Q(google.maps.event.addListener(k,"center_changed",b)))},[v]),(0,r.useEffect)(()=>{k&&E&&(null!==X&&google.maps.event.removeListener(X),Z(google.maps.event.addListener(k,"radius_changed",E)))},[E]),(0,r.useEffect)(()=>{var e=new google.maps.Circle(W_(W_({},t||Q_),{},{map:T}));return"number"===typeof s&&e.setRadius(s),"undefined"!==typeof n&&e.setCenter(n),"number"===typeof s&&e.setRadius(s),"undefined"!==typeof o&&e.setVisible(o),"undefined"!==typeof a&&e.setEditable(a),"undefined"!==typeof i&&e.setDraggable(i),l&&L(google.maps.event.addListener(e,"dblclick",l)),c&&_(google.maps.event.addListener(e,"dragend",c)),u&&R(google.maps.event.addListener(e,"dragstart",u)),d&&D(google.maps.event.addListener(e,"mousedown",d)),h&&N(google.maps.event.addListener(e,"mousemove",h)),f&&F(google.maps.event.addListener(e,"mouseout",f)),p&&j(google.maps.event.addListener(e,"mouseover",p)),g&&V(google.maps.event.addListener(e,"mouseup",g)),m&&G(google.maps.event.addListener(e,"rightclick",m)),v&&K(google.maps.event.addListener(e,"click",v)),y&&q(google.maps.event.addListener(e,"drag",y)),b&&Q(google.maps.event.addListener(e,"center_changed",b)),E&&Z(google.maps.event.addListener(e,"radius_changed",E)),x(e),w&&w(e),()=>{null!==I&&google.maps.event.removeListener(I),null!==C&&google.maps.event.removeListener(C),null!==A&&google.maps.event.removeListener(A),null!==P&&google.maps.event.removeListener(P),null!==O&&google.maps.event.removeListener(O),null!==M&&google.maps.event.removeListener(M),null!==U&&google.maps.event.removeListener(U),null!==B&&google.maps.event.removeListener(B),null!==z&&google.maps.event.removeListener(z),null!==H&&google.maps.event.removeListener(H),null!==Y&&google.maps.event.removeListener(Y),null!==X&&google.maps.event.removeListener(X),S&&S(e),e.setMap(null)}},[]),null});class X_ extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{circle:null}),AL(this,"setCircleCallback",()=>{null!==this.state.circle&&this.props.onLoad&&this.props.onLoad(this.state.circle)})}componentDidMount(){var e=new google.maps.Circle(W_(W_({},this.props.options),{},{map:this.context}));this.registeredEvents=jL({updaterMap:Y_,eventMap:q_,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{circle:e}},this.setCircleCallback)}componentDidUpdate(e){null!==this.state.circle&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:Y_,eventMap:q_,prevProps:e,nextProps:this.props,instance:this.state.circle}))}componentWillUnmount(){var e;null!==this.state.circle&&(this.props.onUnmount&&this.props.onUnmount(this.state.circle),UL(this.registeredEvents),null===(e=this.state.circle)||void 0===e||e.setMap(null))}render(){return null}}function Z_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function J_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z_(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(X_,"contextType",OL);var $_={onClick:"click",onDblClick:"dblclick",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick",onAddFeature:"addfeature",onRemoveFeature:"removefeature",onRemoveProperty:"removeproperty",onSetGeometry:"setgeometry",onSetProperty:"setproperty"},eA={add(e,t){e.add(t)},addgeojson(e,t,n){e.addGeoJson(t,n)},contains(e,t){e.contains(t)},foreach(e,t){e.forEach(t)},loadgeojson(e,t,n,r){e.loadGeoJson(t,n,r)},overridestyle(e,t,n){e.overrideStyle(t,n)},remove(e,t){e.remove(t)},revertstyle(e,t){e.revertStyle(t)},controlposition(e,t){e.setControlPosition(t)},controls(e,t){e.setControls(t)},drawingmode(e,t){e.setDrawingMode(t)},map(e,t){e.setMap(t)},style(e,t){e.setStyle(t)},togeojson(e,t){e.toGeoJson(t)}};(0,r.memo)(function(e){var{options:t,onClick:n,onDblClick:s,onMouseDown:i,onMouseMove:a,onMouseOut:o,onMouseOver:l,onMouseUp:c,onRightClick:u,onAddFeature:d,onRemoveFeature:h,onRemoveProperty:f,onSetGeometry:p,onSetProperty:g,onLoad:m,onUnmount:v}=e,y=(0,r.useContext)(OL),[b,E]=(0,r.useState)(null),[w,S]=(0,r.useState)(null),[T,k]=(0,r.useState)(null),[x,I]=(0,r.useState)(null),[L,C]=(0,r.useState)(null),[_,A]=(0,r.useState)(null),[R,P]=(0,r.useState)(null),[D,O]=(0,r.useState)(null),[N,M]=(0,r.useState)(null),[F,U]=(0,r.useState)(null),[j,B]=(0,r.useState)(null),[V,z]=(0,r.useState)(null),[G,H]=(0,r.useState)(null),[K,W]=(0,r.useState)(null);return(0,r.useEffect)(()=>{null!==b&&b.setMap(y)},[y]),(0,r.useEffect)(()=>{b&&s&&(null!==w&&google.maps.event.removeListener(w),S(google.maps.event.addListener(b,"dblclick",s)))},[s]),(0,r.useEffect)(()=>{b&&i&&(null!==T&&google.maps.event.removeListener(T),k(google.maps.event.addListener(b,"mousedown",i)))},[i]),(0,r.useEffect)(()=>{b&&a&&(null!==x&&google.maps.event.removeListener(x),I(google.maps.event.addListener(b,"mousemove",a)))},[a]),(0,r.useEffect)(()=>{b&&o&&(null!==L&&google.maps.event.removeListener(L),C(google.maps.event.addListener(b,"mouseout",o)))},[o]),(0,r.useEffect)(()=>{b&&l&&(null!==_&&google.maps.event.removeListener(_),A(google.maps.event.addListener(b,"mouseover",l)))},[l]),(0,r.useEffect)(()=>{b&&c&&(null!==R&&google.maps.event.removeListener(R),P(google.maps.event.addListener(b,"mouseup",c)))},[c]),(0,r.useEffect)(()=>{b&&u&&(null!==D&&google.maps.event.removeListener(D),O(google.maps.event.addListener(b,"rightclick",u)))},[u]),(0,r.useEffect)(()=>{b&&n&&(null!==N&&google.maps.event.removeListener(N),M(google.maps.event.addListener(b,"click",n)))},[n]),(0,r.useEffect)(()=>{b&&d&&(null!==F&&google.maps.event.removeListener(F),U(google.maps.event.addListener(b,"addfeature",d)))},[d]),(0,r.useEffect)(()=>{b&&h&&(null!==j&&google.maps.event.removeListener(j),B(google.maps.event.addListener(b,"removefeature",h)))},[h]),(0,r.useEffect)(()=>{b&&f&&(null!==V&&google.maps.event.removeListener(V),z(google.maps.event.addListener(b,"removeproperty",f)))},[f]),(0,r.useEffect)(()=>{b&&p&&(null!==G&&google.maps.event.removeListener(G),H(google.maps.event.addListener(b,"setgeometry",p)))},[p]),(0,r.useEffect)(()=>{b&&g&&(null!==K&&google.maps.event.removeListener(K),W(google.maps.event.addListener(b,"setproperty",g)))},[g]),(0,r.useEffect)(()=>{if(null!==y){var e=new google.maps.Data(J_(J_({},t),{},{map:y}));s&&S(google.maps.event.addListener(e,"dblclick",s)),i&&k(google.maps.event.addListener(e,"mousedown",i)),a&&I(google.maps.event.addListener(e,"mousemove",a)),o&&C(google.maps.event.addListener(e,"mouseout",o)),l&&A(google.maps.event.addListener(e,"mouseover",l)),c&&P(google.maps.event.addListener(e,"mouseup",c)),u&&O(google.maps.event.addListener(e,"rightclick",u)),n&&M(google.maps.event.addListener(e,"click",n)),d&&U(google.maps.event.addListener(e,"addfeature",d)),h&&B(google.maps.event.addListener(e,"removefeature",h)),f&&z(google.maps.event.addListener(e,"removeproperty",f)),p&&H(google.maps.event.addListener(e,"setgeometry",p)),g&&W(google.maps.event.addListener(e,"setproperty",g)),E(e),m&&m(e)}return()=>{b&&(null!==w&&google.maps.event.removeListener(w),null!==T&&google.maps.event.removeListener(T),null!==x&&google.maps.event.removeListener(x),null!==L&&google.maps.event.removeListener(L),null!==_&&google.maps.event.removeListener(_),null!==R&&google.maps.event.removeListener(R),null!==D&&google.maps.event.removeListener(D),null!==N&&google.maps.event.removeListener(N),null!==F&&google.maps.event.removeListener(F),null!==j&&google.maps.event.removeListener(j),null!==V&&google.maps.event.removeListener(V),null!==G&&google.maps.event.removeListener(G),null!==K&&google.maps.event.removeListener(K),v&&v(b),b.setMap(null))}},[]),null});class tA extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{data:null}),AL(this,"setDataCallback",()=>{null!==this.state.data&&this.props.onLoad&&this.props.onLoad(this.state.data)})}componentDidMount(){if(null!==this.context){var e=new google.maps.Data(J_(J_({},this.props.options),{},{map:this.context}));this.registeredEvents=jL({updaterMap:eA,eventMap:$_,prevProps:{},nextProps:this.props,instance:e}),this.setState(()=>({data:e}),this.setDataCallback)}}componentDidUpdate(e){null!==this.state.data&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:eA,eventMap:$_,prevProps:e,nextProps:this.props,instance:this.state.data}))}componentWillUnmount(){null!==this.state.data&&(this.props.onUnmount&&this.props.onUnmount(this.state.data),UL(this.registeredEvents),this.state.data&&this.state.data.setMap(null))}render(){return null}}function nA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nA(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nA(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(tA,"contextType",OL);var sA={onClick:"click",onDefaultViewportChanged:"defaultviewport_changed",onStatusChanged:"status_changed"},iA={options(e,t){e.setOptions(t)},url(e,t){e.setUrl(t)},zIndex(e,t){e.setZIndex(t)}};class aA extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{kmlLayer:null}),AL(this,"setKmlLayerCallback",()=>{null!==this.state.kmlLayer&&this.props.onLoad&&this.props.onLoad(this.state.kmlLayer)})}componentDidMount(){var e=new google.maps.KmlLayer(rA(rA({},this.props.options),{},{map:this.context}));this.registeredEvents=jL({updaterMap:iA,eventMap:sA,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{kmlLayer:e}},this.setKmlLayerCallback)}componentDidUpdate(e){null!==this.state.kmlLayer&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:iA,eventMap:sA,prevProps:e,nextProps:this.props,instance:this.state.kmlLayer}))}componentWillUnmount(){null!==this.state.kmlLayer&&(this.props.onUnmount&&this.props.onUnmount(this.state.kmlLayer),UL(this.registeredEvents),this.state.kmlLayer.setMap(null))}render(){return null}}function oA(e,t){return"function"===typeof t?t(e.offsetWidth,e.offsetHeight):{x:0,y:0}}function lA(e,t){return new t(e.lat,e.lng)}function cA(e,t){return new t(new google.maps.LatLng(e.ne.lat,e.ne.lng),new google.maps.LatLng(e.sw.lat,e.sw.lng))}function uA(e,t,n,r){return void 0!==n?function(e,t,n){var r=e&&e.fromLatLngToDivPixel(n.getNorthEast()),s=e&&e.fromLatLngToDivPixel(n.getSouthWest());return r&&s?{left:"".concat(s.x+t.x,"px"),top:"".concat(r.y+t.y,"px"),width:"".concat(r.x-s.x-t.x,"px"),height:"".concat(s.y-r.y-t.y,"px")}:{left:"-9999px",top:"-9999px"}}(e,t,function(e,t,n){return e instanceof t?e:n(e,t)}(n,google.maps.LatLngBounds,cA)):function(e,t,n){var r=e&&e.fromLatLngToDivPixel(n);if(r){var{x:s,y:i}=r;return{left:"".concat(s+t.x,"px"),top:"".concat(i+t.y,"px")}}return{left:"-9999px",top:"-9999px"}}(e,t,function(e,t,n){return e instanceof t?e:n(e,t)}(r,google.maps.LatLng,lA))}function dA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function hA(e,t,n,r,s){class i extends google.maps.OverlayView{constructor(e,t,n,r){super(),this.container=e,this.pane=t,this.position=n,this.bounds=r}onAdd(){var e,t=null===(e=this.getPanes())||void 0===e?void 0:e[this.pane];null===t||void 0===t||t.appendChild(this.container)}draw(){var e=this.getProjection(),t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dA(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dA(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},this.container?oA(this.container,s):{x:0,y:0}),n=uA(e,t,this.bounds,this.position);for(var[r,i]of Object.entries(n))this.container.style[r]=i}onRemove(){null!==this.container.parentNode&&this.container.parentNode.removeChild(this.container)}}return new i(e,t,n,r)}function fA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pA(e){return e?(e instanceof google.maps.LatLng?e:new google.maps.LatLng(e.lat,e.lng))+"":""}function gA(e){return e?(e instanceof google.maps.LatLngBounds?e:new google.maps.LatLngBounds(new google.maps.LatLng(e.south,e.east),new google.maps.LatLng(e.north,e.west)))+"":""}AL(aA,"contextType",OL);(0,r.memo)(function(e){var{position:t,bounds:n,mapPaneName:s,zIndex:i,onLoad:a,onUnmount:o,getPixelPositionOffset:l,children:c}=e,u=(0,r.useContext)(OL),d=(0,r.useMemo)(()=>{var e=document.createElement("div");return e.style.position="absolute",e},[]),h=(0,r.useMemo)(()=>hA(d,s,t,n,l),[d,s,t,n]);return(0,r.useEffect)(()=>(null===a||void 0===a||a(h),null===h||void 0===h||h.setMap(u),()=>{null===o||void 0===o||o(h),null===h||void 0===h||h.setMap(null)}),[u,h]),(0,r.useEffect)(()=>{d.style.zIndex="".concat(i)},[i,d]),rS.createPortal(c,d)});class mA extends r.PureComponent{constructor(e){super(e),AL(this,"state",{paneEl:null,containerStyle:{position:"absolute"}}),AL(this,"updatePane",()=>{var e=this.props.mapPaneName,t=this.overlayView.getPanes();DL(!!e,"OverlayView requires props.mapPaneName but got %s",e),t?this.setState({paneEl:t[e]}):this.setState({paneEl:null})}),AL(this,"onAdd",()=>{var e,t;this.updatePane(),null===(e=(t=this.props).onLoad)||void 0===e||e.call(t,this.overlayView)}),AL(this,"onPositionElement",()=>{var e,t,n,r,s,i,a=this.overlayView.getProjection(),o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fA(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fA(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({x:0,y:0},this.containerRef.current?oA(this.containerRef.current,this.props.getPixelPositionOffset):{}),l=uA(a,o,this.props.bounds,this.props.position);(s=l,i={left:this.state.containerStyle.left,top:this.state.containerStyle.top,width:this.state.containerStyle.width,height:this.state.containerStyle.height},s.left!==i.left||s.top!==i.top||s.width!==i.height||s.height!==i.height)&&this.setState({containerStyle:{top:null!==(e=l.top)&&void 0!==e?e:0,left:null!==(t=l.left)&&void 0!==t?t:0,width:null!==(n=l.width)&&void 0!==n?n:0,height:null!==(r=l.height)&&void 0!==r?r:0,position:"absolute"}})}),AL(this,"draw",()=>{this.onPositionElement()}),AL(this,"onRemove",()=>{var e,t;this.setState(()=>({paneEl:null})),null===(e=(t=this.props).onUnmount)||void 0===e||e.call(t,this.overlayView)}),this.containerRef=(0,r.createRef)();var t=new google.maps.OverlayView;t.onAdd=this.onAdd,t.draw=this.draw,t.onRemove=this.onRemove,this.overlayView=t}componentDidMount(){this.overlayView.setMap(this.context)}componentDidUpdate(e){var t=pA(e.position),n=pA(this.props.position),r=gA(e.bounds),s=gA(this.props.bounds);t===n&&r===s||this.overlayView.draw(),e.mapPaneName!==this.props.mapPaneName&&this.updatePane()}componentWillUnmount(){this.overlayView.setMap(null)}render(){var e=this.state.paneEl;return e?rS.createPortal((0,ub.jsx)("div",{ref:this.containerRef,style:this.state.containerStyle,children:r.Children.only(this.props.children)}),e):null}}function vA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function yA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vA(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vA(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(mA,"FLOAT_PANE","floatPane"),AL(mA,"MAP_PANE","mapPane"),AL(mA,"MARKER_LAYER","markerLayer"),AL(mA,"OVERLAY_LAYER","overlayLayer"),AL(mA,"OVERLAY_MOUSE_TARGET","overlayMouseTarget"),AL(mA,"contextType",OL);var bA={onDblClick:"dblclick",onClick:"click"},EA={opacity(e,t){e.setOpacity(t)}};(0,r.memo)(function(e){var{url:t,bounds:n,options:s,visible:i}=e,a=(0,r.useContext)(OL),o=new google.maps.LatLngBounds(new google.maps.LatLng(n.south,n.west),new google.maps.LatLng(n.north,n.east)),l=(0,r.useMemo)(()=>new google.maps.GroundOverlay(t,o,s),[]);return(0,r.useEffect)(()=>{null!==l&&l.setMap(a)},[a]),(0,r.useEffect)(()=>{"undefined"!==typeof t&&null!==l&&(l.set("url",t),l.setMap(a))},[l,t]),(0,r.useEffect)(()=>{"undefined"!==typeof i&&null!==l&&l.setOpacity(i?1:0)},[l,i]),(0,r.useEffect)(()=>{var e=new google.maps.LatLngBounds(new google.maps.LatLng(n.south,n.west),new google.maps.LatLng(n.north,n.east));"undefined"!==typeof n&&null!==l&&(l.set("bounds",e),l.setMap(a))},[l,n]),null});class wA extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{groundOverlay:null}),AL(this,"setGroundOverlayCallback",()=>{null!==this.state.groundOverlay&&this.props.onLoad&&this.props.onLoad(this.state.groundOverlay)})}componentDidMount(){DL(!!this.props.url||!!this.props.bounds,"For GroundOverlay, url and bounds are passed in to constructor and are immutable after instantiated. This is the behavior of Google Maps JavaScript API v3 ( See https://developers.google.com/maps/documentation/javascript/reference#GroundOverlay) Hence, use the corresponding two props provided by `react-google-maps-api`, url and bounds. In some cases, you'll need the GroundOverlay component to reflect the changes of url and bounds. You can leverage the React's key property to remount the component. Typically, just `key={url}` would serve your need. See https://github.com/tomchentw/react-google-maps/issues/655");var e=new google.maps.GroundOverlay(this.props.url,this.props.bounds,yA(yA({},this.props.options),{},{map:this.context}));this.registeredEvents=jL({updaterMap:EA,eventMap:bA,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{groundOverlay:e}},this.setGroundOverlayCallback)}componentDidUpdate(e){null!==this.state.groundOverlay&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:EA,eventMap:bA,prevProps:e,nextProps:this.props,instance:this.state.groundOverlay}))}componentWillUnmount(){this.state.groundOverlay&&(this.props.onUnmount&&this.props.onUnmount(this.state.groundOverlay),this.state.groundOverlay.setMap(null))}render(){return null}}function SA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function TA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SA(Object(n),!0).forEach(function(t){AL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SA(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}AL(wA,"defaultProps",{onLoad:function(){}}),AL(wA,"contextType",OL);var kA={},xA={data(e,t){e.setData(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)}};(0,r.memo)(function(e){var{data:t,onLoad:n,onUnmount:s,options:i}=e,a=(0,r.useContext)(OL),[o,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{google.maps.visualization||DL(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} in useJsApiScript? %s',google.maps.visualization)},[]),(0,r.useEffect)(()=>{DL(!!t,"data property is required in HeatmapLayer %s",t)},[t]),(0,r.useEffect)(()=>{null!==o&&o.setMap(a)},[a]),(0,r.useEffect)(()=>{i&&null!==o&&o.setOptions(i)},[o,i]),(0,r.useEffect)(()=>{var e=new google.maps.visualization.HeatmapLayer(TA(TA({},i),{},{data:t,map:a}));return l(e),n&&n(e),()=>{null!==o&&(s&&s(o),o.setMap(null))}},[]),null});class IA extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{heatmapLayer:null}),AL(this,"setHeatmapLayerCallback",()=>{null!==this.state.heatmapLayer&&this.props.onLoad&&this.props.onLoad(this.state.heatmapLayer)})}componentDidMount(){DL(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} to <LoadScript />? %s',google.maps.visualization),DL(!!this.props.data,"data property is required in HeatmapLayer %s",this.props.data);var e=new google.maps.visualization.HeatmapLayer(TA(TA({},this.props.options),{},{data:this.props.data,map:this.context}));this.registeredEvents=jL({updaterMap:xA,eventMap:kA,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{heatmapLayer:e}},this.setHeatmapLayerCallback)}componentDidUpdate(e){UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:xA,eventMap:kA,prevProps:e,nextProps:this.props,instance:this.state.heatmapLayer})}componentWillUnmount(){null!==this.state.heatmapLayer&&(this.props.onUnmount&&this.props.onUnmount(this.state.heatmapLayer),UL(this.registeredEvents),this.state.heatmapLayer.setMap(null))}render(){return null}}AL(IA,"contextType",OL);var LA={onCloseClick:"closeclick",onPanoChanged:"pano_changed",onPositionChanged:"position_changed",onPovChanged:"pov_changed",onResize:"resize",onStatusChanged:"status_changed",onVisibleChanged:"visible_changed",onZoomChanged:"zoom_changed"},CA={register(e,t,n){e.registerPanoProvider(t,n)},links(e,t){e.setLinks(t)},motionTracking(e,t){e.setMotionTracking(t)},options(e,t){e.setOptions(t)},pano(e,t){e.setPano(t)},position(e,t){e.setPosition(t)},pov(e,t){e.setPov(t)},visible(e,t){e.setVisible(t)},zoom(e,t){e.setZoom(t)}};class _A extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{streetViewPanorama:null}),AL(this,"setStreetViewPanoramaCallback",()=>{null!==this.state.streetViewPanorama&&this.props.onLoad&&this.props.onLoad(this.state.streetViewPanorama)})}componentDidMount(){var e,t,n=null!==(e=null===(t=this.context)||void 0===t?void 0:t.getStreetView())&&void 0!==e?e:null;this.registeredEvents=jL({updaterMap:CA,eventMap:LA,prevProps:{},nextProps:this.props,instance:n}),this.setState(()=>({streetViewPanorama:n}),this.setStreetViewPanoramaCallback)}componentDidUpdate(e){null!==this.state.streetViewPanorama&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:CA,eventMap:LA,prevProps:e,nextProps:this.props,instance:this.state.streetViewPanorama}))}componentWillUnmount(){null!==this.state.streetViewPanorama&&(this.props.onUnmount&&this.props.onUnmount(this.state.streetViewPanorama),UL(this.registeredEvents),this.state.streetViewPanorama.setVisible(!1))}render(){return null}}AL(_A,"contextType",OL);class AA extends r.PureComponent{constructor(){super(...arguments),AL(this,"state",{streetViewService:null}),AL(this,"setStreetViewServiceCallback",()=>{null!==this.state.streetViewService&&this.props.onLoad&&this.props.onLoad(this.state.streetViewService)})}componentDidMount(){var e=new google.maps.StreetViewService;this.setState(function(){return{streetViewService:e}},this.setStreetViewServiceCallback)}componentWillUnmount(){null!==this.state.streetViewService&&this.props.onUnmount&&this.props.onUnmount(this.state.streetViewService)}render(){return null}}AL(AA,"contextType",OL);r.PureComponent;var RA={onDirectionsChanged:"directions_changed"},PA={directions(e,t){e.setDirections(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},panel(e,t){e.setPanel(t)},routeIndex(e,t){e.setRouteIndex(t)}};class DA extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"state",{directionsRenderer:null}),AL(this,"setDirectionsRendererCallback",()=>{null!==this.state.directionsRenderer&&(this.state.directionsRenderer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.directionsRenderer))})}componentDidMount(){var e=new google.maps.DirectionsRenderer(this.props.options);this.registeredEvents=jL({updaterMap:PA,eventMap:RA,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{directionsRenderer:e}},this.setDirectionsRendererCallback)}componentDidUpdate(e){null!==this.state.directionsRenderer&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:PA,eventMap:RA,prevProps:e,nextProps:this.props,instance:this.state.directionsRenderer}))}componentWillUnmount(){null!==this.state.directionsRenderer&&(this.props.onUnmount&&this.props.onUnmount(this.state.directionsRenderer),UL(this.registeredEvents),this.state.directionsRenderer&&this.state.directionsRenderer.setMap(null))}render(){return null}}AL(DA,"contextType",OL);r.PureComponent;var OA={onPlacesChanged:"places_changed"},NA={bounds(e,t){e.setBounds(t)}};class MA extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"containerElement",(0,r.createRef)()),AL(this,"state",{searchBox:null}),AL(this,"setSearchBoxCallback",()=>{null!==this.state.searchBox&&this.props.onLoad&&this.props.onLoad(this.state.searchBox)})}componentDidMount(){if(DL(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places),null!==this.containerElement&&null!==this.containerElement.current){var e=this.containerElement.current.querySelector("input");if(null!==e){var t=new google.maps.places.SearchBox(e,this.props.options);this.registeredEvents=jL({updaterMap:NA,eventMap:OA,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{searchBox:t}},this.setSearchBoxCallback)}}}componentDidUpdate(e){null!==this.state.searchBox&&(UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:NA,eventMap:OA,prevProps:e,nextProps:this.props,instance:this.state.searchBox}))}componentWillUnmount(){null!==this.state.searchBox&&(this.props.onUnmount&&this.props.onUnmount(this.state.searchBox),UL(this.registeredEvents))}render(){return(0,ub.jsx)("div",{ref:this.containerElement,children:r.Children.only(this.props.children)})}}AL(MA,"contextType",OL);var FA={onPlaceChanged:"place_changed"},UA={bounds(e,t){e.setBounds(t)},restrictions(e,t){e.setComponentRestrictions(t)},fields(e,t){e.setFields(t)},options(e,t){e.setOptions(t)},types(e,t){e.setTypes(t)}};class jA extends r.PureComponent{constructor(){super(...arguments),AL(this,"registeredEvents",[]),AL(this,"containerElement",(0,r.createRef)()),AL(this,"state",{autocomplete:null}),AL(this,"setAutocompleteCallback",()=>{null!==this.state.autocomplete&&this.props.onLoad&&this.props.onLoad(this.state.autocomplete)})}componentDidMount(){var e;DL(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places);var t=null===(e=this.containerElement.current)||void 0===e?void 0:e.querySelector("input");if(t){var n=new google.maps.places.Autocomplete(t,this.props.options);this.registeredEvents=jL({updaterMap:UA,eventMap:FA,prevProps:{},nextProps:this.props,instance:n}),this.setState(()=>({autocomplete:n}),this.setAutocompleteCallback)}}componentDidUpdate(e){UL(this.registeredEvents),this.registeredEvents=jL({updaterMap:UA,eventMap:FA,prevProps:e,nextProps:this.props,instance:this.state.autocomplete})}componentWillUnmount(){null!==this.state.autocomplete&&UL(this.registeredEvents)}render(){return(0,ub.jsx)("div",{ref:this.containerElement,className:this.props.className,children:r.Children.only(this.props.children)})}}function BA(e){let{cameras:t}=e;const[n,s]=(0,r.useState)(null),i=(0,r.useRef)(null),[a,o]=(0,r.useState)(!1);const l=e=>"active"===e.paymentStatus?"rgba(0,200,0,0.9)":"rgba(255,0,0,0.85)",c=e=>({path:google.maps.SymbolPath.CIRCLE,fillColor:l(e),fillOpacity:1,strokeColor:"#fff",strokeWeight:2,scale:10});return(0,r.useEffect)(()=>{if(!a)return;const e=i.current;if(!e)return;const t=()=>{document.querySelectorAll(".camera-label").forEach(t=>{var n;const r=Number(t.dataset.lat),s=Number(t.dataset.lng),i=null===(n=e.getProjection())||void 0===n?void 0:n.fromLatLngToPoint(new window.google.maps.LatLng(r,s));if(!i)return;const a=Math.pow(2,e.getZoom());t.style.left="".concat(i.x*a,"px"),t.style.top="".concat(i.y*a,"px")})};t();const n=e.addListener("idle",t);return()=>google.maps.event.removeListener(n)},[a,t]),null!==t&&void 0!==t&&t.length?(0,ub.jsx)(sC,{googleMapsApiKey:"AIzaSyCGRWnLsX5MMzlvfMiby5vvH-CsXyD607s",onLoad:()=>o(!0),children:(0,ub.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[(0,ub.jsx)("style",{children:"\n          @keyframes pulse {\n            0% { transform: scale(1); opacity: 0.9 }\n            50% { transform: scale(1.3); opacity: 0.3 }\n            100% { transform: scale(1); opacity: 0.9 }\n          }\n        "}),(0,ub.jsx)("div",{className:"w-full h-[500px] relative",children:(0,ub.jsxs)(zL,{onLoad:function(e){i.current=e;const n=t.filter(e=>e.lat&&e.lng&&!isNaN(+e.lat)&&!isNaN(+e.lng));if(0===n.length)return;const r=new window.google.maps.LatLngBounds;n.forEach(e=>r.extend({lat:+e.lat,lng:+e.lng})),e.fitBounds(r)},mapContainerStyle:{width:"100%",height:"100%"},options:{streetViewControl:!1,mapTypeControl:!1},children:[a&&t.filter(e=>e.lat&&e.lng&&!isNaN(+e.lat)&&!isNaN(+e.lng)).map(e=>(0,ub.jsxs)(r.Fragment,{children:[(0,ub.jsx)("div",{className:"camera-label","data-lat":+e.lat,"data-lng":+e.lng,style:{position:"absolute",transform:"translate(-50%, -120%)",background:"rgba(0,0,0,0.75)",padding:"4px 10px",borderRadius:"12px",color:"#fff",fontSize:"12px",fontWeight:600,pointerEvents:"none",whiteSpace:"nowrap"},children:e.name}),(0,ub.jsx)(TC,{position:{lat:+e.lat,lng:+e.lng},icon:c(e),onClick:()=>s(e)}),(0,ub.jsx)("div",{className:"camera-label","data-lat":+e.lat,"data-lng":+e.lng,style:{position:"absolute",transform:"translate(-50%, -50%)",width:"18px",height:"18px",borderRadius:"50%",background:l(e),opacity:.4,animation:"pulse 1.8s infinite",pointerEvents:"none"}})]},e.id)),n&&(0,ub.jsx)(C_,{position:{lat:+n.lat,lng:+n.lng},onCloseClick:()=>s(null),children:(0,ub.jsxs)("div",{className:"text-sm",children:[(0,ub.jsx)("strong",{children:n.name}),(0,ub.jsxs)("div",{children:["ID: ",n.id]}),(0,ub.jsxs)("div",{children:["Status:"," ","active"===n.paymentStatus?"Active":"Inactive"]})]})})]})})]})}):(0,ub.jsx)("div",{className:"w-full h-[500px] bg-blue-100 rounded-xl flex items-center justify-center",children:(0,ub.jsx)("div",{className:"text-center text-blue-800 font-semibold text-lg",children:"No cameras added yet."})})}AL(jA,"defaultProps",{className:""}),AL(jA,"contextType",OL);const VA=function(e){let{onClose:t,onSubmit:n,editing:s}=e;const[i,a]=(0,r.useState)({name:"",ip:"",port:"",username:"",password:"",lat:"",lng:"",locationName:"",serial:"",status:"Active",paymentStatus:"inactive"});(0,r.useEffect)(()=>{s&&a({name:s.name||"",ip:s.ip||"",port:s.port||"",username:s.username||"",password:s.password||"",lat:s.lat||"",lng:s.lng||"",locationName:s.locationName||s.location||"",serial:s.serial||"",status:s.status||"Active",paymentStatus:s.paymentStatus||"inactive"})},[s]);const o="w-full px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-sm outline-none focus:ring-2 focus:ring-blue-400",l=(e,t)=>{a(n=>d(d({},n),{},{[e]:t}))};return(0,ub.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,ub.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[(0,ub.jsxs)("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,ub.jsx)("i",{className:"bx bxs-camera"}),s?"Edit Camera":"Add Camera"]}),(0,ub.jsxs)("form",{className:"space-y-3",onSubmit:e=>{e.preventDefault(),i.name.trim()&&n(i)},children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"Camera Name"}),(0,ub.jsx)("input",{className:o,value:i.name,onChange:e=>l("name",e.target.value)})]}),(0,ub.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"IP"}),(0,ub.jsx)("input",{className:o,value:i.ip,onChange:e=>l("ip",e.target.value)})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"Port"}),(0,ub.jsx)("input",{className:o,value:i.port,onChange:e=>l("port",e.target.value)})]})]}),(0,ub.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"User"}),(0,ub.jsx)("input",{className:o,value:i.username,onChange:e=>l("username",e.target.value)})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"Password"}),(0,ub.jsx)("input",{className:o,type:"password",value:i.password,onChange:e=>l("password",e.target.value)})]})]}),(0,ub.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"Latitude"}),(0,ub.jsx)("input",{className:o,value:i.lat,onChange:e=>l("lat",e.target.value)})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"Longitude"}),(0,ub.jsx)("input",{className:o,value:i.lng,onChange:e=>l("lng",e.target.value)})]})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"Location Name"}),(0,ub.jsx)("input",{className:o,value:i.locationName,onChange:e=>l("locationName",e.target.value)})]}),(0,ub.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"Serial"}),(0,ub.jsx)("input",{className:o,value:i.serial,onChange:e=>l("serial",e.target.value)})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"Status (Client Control)"}),(0,ub.jsxs)("select",{className:o,value:i.status,onChange:e=>l("status",e.target.value),children:[(0,ub.jsx)("option",{children:"Active"}),(0,ub.jsx)("option",{children:"Warning"}),(0,ub.jsx)("option",{children:"Offline"})]})]})]}),s&&(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-xs mb-1 text-slate-500",children:"Payment Status"}),(0,ub.jsx)("input",{className:o,value:i.paymentStatus,disabled:!0})]}),(0,ub.jsxs)("div",{className:"flex justify-end gap-2 pt-3",children:[(0,ub.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 rounded-xl bg-slate-200",children:"Cancel"}),(0,ub.jsx)("button",{className:"px-4 py-2 rounded-xl bg-blue-500 text-white",children:s?"Save":"Add"})]})]})]})})};function zA(e){if(!e)return"-";if("string"===typeof e)return e;if(e.toDate)try{return e.toDate().toLocaleString()}catch(t){return"-"}return"-"}const GA=function(e){var t,n;let{camera:r,onClose:s}=e;if(!r)return null;const i="text-xs text-slate-500 dark:text-slate-400",a="text-sm font-medium";return(0,ub.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,ub.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-2xl p-6 w-full max-w-xl shadow-2xl border border-slate-200 dark:border-slate-800",children:[(0,ub.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-4",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsxs)("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,ub.jsx)("i",{className:"bx bxs-camera"}),r.name]}),(0,ub.jsxs)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["ID: ",r.id," \xb7 Status:"," ",(0,ub.jsx)("span",{className:"font-medium",children:r.status})]})]}),(0,ub.jsx)("button",{className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",onClick:s,children:(0,ub.jsx)("i",{className:"bx bx-x text-2xl"})})]}),(0,ub.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm",children:[(0,ub.jsxs)("div",{className:"space-y-2",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:i,children:"Location"}),(0,ub.jsx)("div",{className:a,children:r.locationName||r.location||"-"})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:i,children:"IP / Port"}),(0,ub.jsxs)("div",{className:a,children:[r.ip||"-",r.port&&(0,ub.jsxs)("span",{className:"text-xs",children:[" :",r.port]})]})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:i,children:"Credentials"}),(0,ub.jsxs)("div",{className:a,children:[r.username?r.username:"-"," /"," ",r.password?"\u2022\u2022\u2022\u2022\u2022\u2022":"-"]})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:i,children:"Serial Number"}),(0,ub.jsx)("div",{className:a,children:r.serial||"-"})]})]}),(0,ub.jsxs)("div",{className:"space-y-2",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:i,children:"Latitude / Longitude"}),(0,ub.jsxs)("div",{className:a,children:[r.lat||"-",r.lat&&r.lng&&" / ",r.lng||""]})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:i,children:"Created At"}),(0,ub.jsx)("div",{className:a,children:zA(r.createdAt)})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:i,children:"Last Capture"}),(0,ub.jsx)("div",{className:a,children:zA(r.lastCaptureAt)})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:i,children:"Today Captures / Paid"}),(0,ub.jsxs)("div",{className:a,children:[null!==(t=r.todayCaptures)&&void 0!==t?t:0," / ",null!==(n=r.paidCaptures)&&void 0!==n?n:0]})]})]})]}),(0,ub.jsxs)("div",{className:"flex justify-between items-center pt-3",children:[(0,ub.jsxs)("button",{className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-xs sm:text-sm hover:bg-slate-200 dark:hover:bg-slate-700",onClick:()=>{const e=r.cameraId||r.id,t="/axis-ui/".concat(encodeURIComponent(e),"/camera/index.html#/video/installation");window.open(t,"_blank","noopener,noreferrer")},children:[(0,ub.jsx)("i",{className:"bx bxs-cog"}),"Camera Settings"]}),(0,ub.jsxs)("div",{className:"flex gap-2",children:[(0,ub.jsxs)("button",{className:"px-4 py-2 rounded-xl bg-emerald-500 text-white text-xs sm:text-sm hover:bg-emerald-600 inline-flex items-center gap-2",onClick:()=>{alert("Live view button clicked (demo)")},children:[(0,ub.jsx)("i",{className:"bx bx-play-circle"}),"Live View"]}),(0,ub.jsx)("button",{className:"px-4 py-2 rounded-xl bg-slate-200 dark:bg-slate-700 text-xs sm:text-sm hover:bg-slate-300 dark:hover:bg-slate-600",onClick:s,children:"Close"})]})]})]})})};const HA=function(e){let{camera:t,onCancel:n,onConfirm:r}=e;return t?(0,ub.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,ub.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-2xl p-5 w-full max-w-sm shadow-2xl border border-slate-200 dark:border-slate-800",children:[(0,ub.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,ub.jsx)("div",{className:"w-9 h-9 rounded-full bg-red-100 text-red-600 flex items-center justify-center",children:(0,ub.jsx)("i",{className:"bx bx-trash"})}),(0,ub.jsx)("h2",{className:"text-base font-semibold",children:"Delete Camera"})]}),(0,ub.jsxs)("p",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-300 mb-4",children:["Are you sure you want to delete"," ",(0,ub.jsx)("span",{className:"font-semibold",children:t.name})," (",(0,ub.jsx)("span",{className:"font-mono",children:t.id}),")? This action cannot be undone."]}),(0,ub.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,ub.jsx)("button",{className:"px-4 py-2 rounded-xl bg-slate-200 dark:bg-slate-700 text-xs sm:text-sm hover:bg-slate-300 dark:hover:bg-slate-600",onClick:n,children:"Cancel"}),(0,ub.jsx)("button",{className:"px-4 py-2 rounded-xl bg-red-500 text-white text-xs sm:text-sm hover:bg-red-600",onClick:r,children:"Delete"})]})]})}):null};function KA(e){let{open:t,onClose:n,camera:s,serverUrl:i,idToken:a,clientId:o,t:l,onCanceled:c}=e;const[u,d]=(0,r.useState)(!1);if(!t)return null;return(0,ub.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",children:(0,ub.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md p-5 border border-slate-200 dark:border-slate-800",children:[(0,ub.jsx)("h3",{className:"text-lg font-semibold mb-2",children:l("payment.cancelTitle")||"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u89e3\u7d04"}),(0,ub.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-4",children:l("payment.cancelConfirm")||"\u672c\u5f53\u306b\u89e3\u7d04\u3057\u307e\u3059\u304b\uff1f\uff08\u6b21\u56de\u8acb\u6c42\u65e5\u307e\u3067\u5229\u7528\u53ef\u80fd\uff09"}),(0,ub.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,ub.jsx)("button",{onClick:n,disabled:u,className:"px-3 py-2 rounded-xl bg-slate-200 dark:bg-slate-800 text-sm",children:l("common.close")||"\u9589\u3058\u308b"}),(0,ub.jsx)("button",{onClick:async()=>{if(null===s||void 0===s||!s.id||!o)return;d(!0);const e=Tm(lb,"clients",o,"cameras",s.id);try{await Ov(e,{uiCancelState:"processing",cancelRequestedAt:iv(),updatedAt:iv()});const u=await fetch("".concat(i,"/stripe/cancel-subscription"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a||"")},body:JSON.stringify({clientId:o,cameraId:s.id,atPeriodEnd:!0})}),d=await u.text();let h=null;try{h=d?JSON.parse(d):null}catch(l){}var t,r;if(!u.ok)throw await Ov(e,{uiCancelState:null,updatedAt:iv()}),new Error((null===(t=h)||void 0===t?void 0:t.error)||(null===(r=h)||void 0===r?void 0:r.message)||d||"Cancel failed");await Ov(e,{uiCancelState:"requested",cancelConfirmedAt:iv(),updatedAt:iv()}),null===c||void 0===c||c(),null===n||void 0===n||n()}catch(u){alert((null===u||void 0===u?void 0:u.message)||"Cancel failed")}finally{d(!1)}},disabled:u,className:"px-3 py-2 rounded-xl bg-red-600 text-white text-sm disabled:opacity-60",children:u?l("common.processing")||"\u51e6\u7406\u4e2d\u2026":l("payment.cancel")||"\u89e3\u7d04"})]})]})})}function WA(){const{clientId:e}=hb(),{t:t}=Bb(),[n,s]=(0,r.useState)([]),[i,a]=(0,r.useState)({}),[o,l]=(0,r.useState)(null),[c,u]=(0,r.useState)(null),[h,f]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[m,v]=(0,r.useState)(null),y="http://192.168.1.183:4450";const b=localStorage.getItem("idToken")||"";(0,r.useEffect)(()=>{new URLSearchParams(window.location.search).get("success")&&f(!0)},[]);const E=()=>({"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("idToken")||"")}),w=e=>{const t=(e=>{if(!e)return null;if("function"===typeof(null===e||void 0===e?void 0:e.toDate))return e.toDate();if("number"===typeof(null===e||void 0===e?void 0:e.seconds))return new Date(1e3*e.seconds);if("number"===typeof e)return new Date(e);if("string"===typeof e){const t=new Date(e);return Number.isNaN(t.getTime())?null:t}return null})(e);return t?t.toLocaleDateString("ja-JP"):"-"},S=e=>"processing"===(null===e||void 0===e?void 0:e.uiCancelState),T=e=>!0===(null===e||void 0===e?void 0:e.cancelAtPeriodEnd)||"Canceling"===(null===e||void 0===e?void 0:e.status),k=e=>"active"===(null===e||void 0===e?void 0:e.paymentStatus),x=e=>S(e)?"\u89e3\u7d04\u51e6\u7406\u4e2d":T(e)?"\u89e3\u7d04\u4e88\u5b9a\u65e5":"\u6b21\u56de\u8acb\u6c42\u65e5",I=(e,t)=>{const n=(null===t||void 0===t?void 0:t[0])||null,r=(null===n||void 0===n?void 0:n.periodEnd)||null;return T(e)?w((null===e||void 0===e?void 0:e.cancelEffectiveDate)||(null===e||void 0===e?void 0:e.nextBillingDate)||r):w((null===e||void 0===e?void 0:e.nextBillingDate)||r)};(0,r.useEffect)(()=>{if(!e)return;const t=Fv(Sm(lb,"clients",e,"cameras"),e=>{const t=e.docs.map(e=>d({id:e.id},e.data()));s(t)},e=>console.error("Camera onSnapshot error:",e));return()=>t()},[e]);const L=(0,r.useRef)({});(0,r.useEffect)(()=>{if(!e)return;const t=new Set(n.map(e=>e.id)),r=L.current;return Object.keys(r).forEach(e=>{if(!t.has(e)){try{var n;null===(n=r[e])||void 0===n||n.call(r)}catch(s){}delete r[e],a(t=>{const n=d({},t);return delete n[e],n})}}),n.forEach(t=>{if(r[t.id])return;const n=pv(Sm(lb,"clients",e,"cameras",t.id,"invoices"),bv("createdAt","desc"));r[t.id]=Fv(n,e=>{const n=e.docs.map(e=>d({id:e.id},e.data()));a(e=>d(d({},e),{},{[t.id]:n}))},e=>{console.error("Invoice onSnapshot error:",e),a(e=>d(d({},e),{},{[t.id]:[]}))})}),()=>{}},[e,n]),(0,r.useEffect)(()=>()=>{const e=L.current;Object.keys(e).forEach(t=>{try{var n;null===(n=e[t])||void 0===n||n.call(e)}catch(r){}}),L.current={}},[]);const C=(0,r.useMemo)(()=>"\u6b21\u56de\u8acb\u6c42\u65e5 / \u89e3\u7d04\u4e88\u5b9a\u65e5",[]);return(0,ub.jsxs)("div",{className:"".concat("bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl"," p-4 overflow-x-auto"),children:[(0,ub.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,ub.jsx)("h3",{className:"text-lg font-semibold flex-1",children:t("payment.cameraStatus")||"\u30ab\u30e1\u30e9\u8ab2\u91d1\u30b9\u30c6\u30fc\u30bf\u30b9"}),h&&(0,ub.jsx)("button",{onClick:()=>window.location.href="/".concat(e,"/dashboard"),className:"px-3 py-2 bg-green-600 text-white rounded-xl text-sm",children:t("payment.goDashboard")||"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3078"})]}),(0,ub.jsxs)("table",{className:"min-w-full text-sm",children:[(0,ub.jsx)("thead",{className:"border-b border-slate-200 dark:border-slate-800 text-slate-500 dark:text-slate-400",children:(0,ub.jsxs)("tr",{children:[(0,ub.jsx)("th",{className:"py-2 text-left",children:"\u30ab\u30e1\u30e9"}),(0,ub.jsx)("th",{className:"py-2 text-left",children:"\u72b6\u614b"}),(0,ub.jsx)("th",{className:"py-2 text-left",children:C}),(0,ub.jsx)("th",{className:"py-2 text-left",children:"\u30b5\u30d6\u30b9\u30afID"}),(0,ub.jsx)("th",{className:"py-2 text-left",children:"\u8acb\u6c42\u66f8"}),(0,ub.jsx)("th",{className:"py-2 text-left",children:"\u64cd\u4f5c"})]})}),(0,ub.jsxs)("tbody",{children:[n.map(t=>{const n=(null===i||void 0===i?void 0:i[t.id])||[],s=(e=>S(e)?{cls:"bg-yellow-100 text-yellow-800",label:"\u89e3\u7d04\u51e6\u7406\u4e2d"}:T(e)?{cls:"bg-orange-100 text-orange-800",label:"\u89e3\u7d04\u4e88\u5b9a"}:k(e)?{cls:"bg-green-100 text-green-700",label:"\u6709\u52b9"}:{cls:"bg-red-100 text-red-700",label:"\u7121\u52b9"})(t),a=S(t)||T(t);return(0,ub.jsxs)(r.Fragment,{children:[(0,ub.jsxs)("tr",{className:"border-b last:border-b-0 border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/60",children:[(0,ub.jsx)("td",{className:"py-3",children:(0,ub.jsxs)("div",{className:"flex flex-col",children:[(0,ub.jsx)("span",{className:"font-medium",children:t.name||"-"}),(0,ub.jsxs)("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["ID: ",t.id]})]})}),(0,ub.jsx)("td",{className:"py-3",children:(0,ub.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(s.cls),children:s.label})}),(0,ub.jsx)("td",{className:"py-3",children:(0,ub.jsxs)("div",{className:"leading-tight",children:[(0,ub.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:x(t)}),(0,ub.jsx)("div",{className:"font-medium",children:I(t,n)})]})}),(0,ub.jsx)("td",{className:"py-3 text-xs",children:t.subscriptionId||"-"}),(0,ub.jsxs)("td",{className:"py-3 text-xs",children:[n.length," \u4ef6"]}),(0,ub.jsx)("td",{className:"py-3",children:(0,ub.jsxs)("div",{className:"flex gap-1 text-xs",children:[!k(t)&&(0,ub.jsx)("button",{onClick:()=>(async(t,n)=>{if(e){u(t);try{var r,s,i;const o=await fetch("".concat(y,"/stripe/create-checkout-session"),{method:"POST",headers:E(),body:JSON.stringify({cameraId:t,priceId:n,clientId:e})}),l=await o.text();let c=null;try{c=l?JSON.parse(l):null}catch(a){c=null}if(!o.ok)throw new Error((null===(r=c)||void 0===r?void 0:r.error)||(null===(s=c)||void 0===s?void 0:s.message)||l||"Checkout failed");if(null===(i=c)||void 0===i||!i.url)throw new Error("Checkout URL missing from server response");window.location.href=c.url}catch(o){alert(o.message)}finally{u(null)}}})(t.id,t.priceId),disabled:c===t.id,className:"px-2 py-1 bg-blue-600 text-white rounded-lg disabled:opacity-60",children:"\u6709\u52b9\u5316"}),k(t)&&!a&&(0,ub.jsx)("button",{onClick:()=>{v(t),g(!0)},disabled:c===t.id,className:"px-2 py-1 bg-red-600 text-white rounded-lg disabled:opacity-60",children:"\u89e3\u7d04"}),(0,ub.jsx)("button",{className:"px-2 py-1 bg-slate-200 dark:bg-slate-800 rounded-lg",onClick:()=>l(o===t.id?null:t.id),children:"\u8a73\u7d30"})]})})]}),o===t.id&&(0,ub.jsx)("tr",{children:(0,ub.jsx)("td",{colSpan:6,className:"bg-slate-50 dark:bg-slate-800/40 p-3",children:0===n.length?(0,ub.jsx)("div",{className:"text-xs text-slate-500",children:"\u8acb\u6c42\u66f8\u306f\u3042\u308a\u307e\u305b\u3093"}):(0,ub.jsx)("div",{className:"space-y-2",children:n.map(n=>(0,ub.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-200 dark:border-slate-700 pb-2 text-xs",children:[(0,ub.jsxs)("div",{className:"min-w-0",children:[(0,ub.jsxs)("div",{className:"font-medium truncate",children:["\u8acb\u6c42\u66f8ID: ",n.invoiceId||n.id]}),(0,ub.jsxs)("div",{className:"text-slate-500 dark:text-slate-400",children:["\u652f\u6255\u65e5: ",w(n.paidAt||n.createdAt)," / \u91d1\u984d: \xa5",Number(n.amountPaid||n.amountDue||0).toLocaleString(),n.periodEnd?" / \u5bfe\u8c61: \u301c".concat(w(n.periodEnd)):""]})]}),(0,ub.jsx)("button",{onClick:()=>(async(t,n)=>{if(e)try{var r,s,i;const o=await fetch("".concat(y,"/stripe/invoice-pdf-url"),{method:"POST",headers:E(),body:JSON.stringify({cameraId:t,invoiceId:n,clientId:e})}),l=await o.text();let c=null;try{c=l?JSON.parse(l):null}catch(a){c=null}if(!o.ok)throw new Error((null===(r=c)||void 0===r?void 0:r.error)||(null===(s=c)||void 0===s?void 0:s.message)||l||"Download failed");if(null===(i=c)||void 0===i||!i.url)throw new Error("Invoice URL missing from server response");window.open(c.url,"_blank","noopener,noreferrer")}catch(o){alert(o.message)}})(t.id,n.invoiceId||n.id),className:"ml-3 px-2 py-1 rounded-lg bg-blue-600 text-white",children:"PDF"})]},n.id))})})})]},t.id)}),0===n.length&&(0,ub.jsx)("tr",{children:(0,ub.jsx)("td",{colSpan:6,className:"py-6 text-center text-slate-500 dark:text-slate-400 text-sm",children:"\u30ab\u30e1\u30e9\u304c\u3042\u308a\u307e\u305b\u3093"})})]})]}),(0,ub.jsx)(KA,{open:p,onClose:()=>{g(!1),v(null)},camera:m,serverUrl:y,idToken:b,clientId:e,t:t,onCanceled:()=>{}})]})}function qA(e){let{onSelect:t,onLoadOverlay:n}=e;const s=localStorage.getItem("clientId"),[i,a]=(0,r.useState)([]);return(0,r.useEffect)(()=>{!async function(){const e=await Pv(Sm(lb,"clients",s,"cameras"));a(e.docs.map(e=>d({id:e.id},e.data())))}()},[s]),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-sm mb-1 text-slate-700 dark:text-slate-300",children:"\u30ab\u30e1\u30e9"}),(0,ub.jsxs)("select",{onChange:async function(e){const r=e.target.value;if(t(r),!r)return;const i=await Rv(Tm(lb,"clients",s,"cameras",r));i.exists()&&i.data().overlay?n(i.data().overlay):n({frameId:null,logos:[]})},className:"w-full p-2 rounded bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700",children:[(0,ub.jsx)("option",{value:"",children:"\u30ab\u30e1\u30e9\u30ea\u30b9\u30c8"}),i.map(e=>(0,ub.jsx)("option",{value:e.id,children:e.name||e.id},e.id))]})]})}function YA(e){let{selectedFrames:t,selectedLogos:n,onFrameChange:s,onLogoChange:i,onItemsLoaded:a,limits:o}=e;const l=localStorage.getItem("clientId"),[c,u]=(0,r.useState)([]);function h(e){return"frame"===e.type?t.includes(e.id):n.some(t=>t.logoId===e.id)}return(0,r.useEffect)(()=>{if(!l)return;const e=Fv(Sm(lb,"clients",l,"frames"),e=>{const t=e.docs.map(e=>d({id:e.id},e.data())).filter(e=>e.fileName&&e.type&&e.storagePath);u(t),"function"===typeof a&&a(t)});return()=>e()},[l,a]),(0,r.useEffect)(()=>{const e=new Set(c.map(e=>e.id));t.length>0&&!e.has(t[0])&&s([]),i(n.filter(t=>e.has(t.logoId)))},[c]),(0,ub.jsxs)("div",{className:"space-y-2",children:[(0,ub.jsx)("div",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Frames / Logos (PNG)"}),0===c.length&&(0,ub.jsx)("div",{className:"text-xs text-slate-500",children:"No frames or logos uploaded"}),c.map(e=>(0,ub.jsxs)("div",{className:"flex items-center justify-between gap-3 p-2 rounded bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition",children:[(0,ub.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,ub.jsx)("input",{type:"checkbox",checked:h(e),onChange:r=>function(e,r){if("frame"===e.type)if(r){if(t.length>=o.maxFrames)return void alert("You can only select ".concat(o.maxFrames," frames"));s([e.id])}else s([]);else if(r){if(n.length>=o.maxLogos)return void alert("You can only select ".concat(o.maxLogos," logo(s)"));i([...n,{logoId:e.id,position:"top-right"}])}else i(n.filter(t=>t.logoId!==e.id))}(e,r.target.checked)}),(0,ub.jsxs)("div",{className:"flex flex-col",children:[(0,ub.jsx)("span",{className:"text-sm font-medium",children:e.fileName}),(0,ub.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[(0,ub.jsxs)("span",{children:["(",e.type,")"]}),e.isPaid?(0,ub.jsxs)("span",{className:"px-2 py-0.5 rounded bg-red-100 text-red-600 dark:bg-red-900/40 dark:text-red-300",children:["\xa5",e.price]}):(0,ub.jsx)("span",{className:"px-2 py-0.5 rounded bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300",children:"FREE"})]})]})]}),(0,ub.jsx)("button",{onClick:()=>async function(e){if(window.confirm('Delete "'.concat(e.fileName,'" ?')))try{await Nv(Tm(lb,"clients",l,"frames",e.id)),e.storagePath&&await rb(sb(cb,e.storagePath));const t=await Pv(Sm(lb,"clients",l,"cameras"));for(const n of t.docs){const t=n.data().overlay;if(!t)continue;const r={frameId:t.frameId===e.id?null:t.frameId,logos:(t.logos||[]).filter(t=>t.logoId!==e.id),updatedAt:new Date};await Ov(n.ref,{overlay:r})}}catch(t){alert("Delete failed: "+t.message)}}(e),className:"text-xs text-red-500 hover:underline",children:"Delete"})]},e.id))]})}function QA(e){let{logos:t,onChange:n}=e;if(null===t||void 0===t||!t.length)return null;const r=["top-left","top-center","top-right","center","bottom-left","bottom-center","bottom-right"];return(0,ub.jsxs)("div",{className:"p-3 rounded bg-slate-100 dark:bg-slate-800 space-y-2",children:[(0,ub.jsx)("div",{className:"text-sm font-semibold",children:"\u30ed\u30b4\u4f4d\u7f6e"}),t.map(e=>(0,ub.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ub.jsx)("div",{className:"text-xs text-slate-600 dark:text-slate-300 w-28 truncate",children:e.logoId}),(0,ub.jsx)("select",{className:"flex-1 p-2 rounded bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600",value:e.position||"top-right",onChange:t=>{return r=e.logoId,s=t.target.value,void n(e=>e.map(e=>e.logoId===r?d(d({},e),{},{position:s}):e));var r,s},children:r.map(e=>(0,ub.jsx)("option",{value:e,children:e},e))})]},e.logoId))]})}function XA(e){let{clientId:t,cameraId:n,frameIds:r,logos:s}=e;return(0,ub.jsx)("button",{onClick:async function(){if(!n)return void alert("Select a camera first");const e=Tm(lb,"clients",t,"cameras",n);await Ov(e,{overlay:{frameId:r.length?r[0]:null,logos:s,updatedAt:iv()}}),alert("Overlay settings saved for this camera")},className:"w-full py-2 rounded bg-green-600 hover:bg-green-700 text-white",children:"\u30ab\u30e1\u30e9\u306b\u4fdd\u5b58"})}function ZA(e){return Math.round(e/1048576*10)/10}function JA(){const e=localStorage.getItem("clientId"),[t,n]=(0,r.useState)("frame"),[s,i]=(0,r.useState)(null),[a,o]=(0,r.useState)(!1),[l,c]=(0,r.useState)(""),[u,h]=(0,r.useState)({maxFrames:5,maxLogos:1}),[f,p]=(0,r.useState)({frames:0,logos:0}),[g,m]=(0,r.useState)(!1),[v,y]=(0,r.useState)(""),[b,E]=(0,r.useState)(!1),[w,S]=(0,r.useState)(null),T=(0,r.useRef)(null),k=(0,r.useMemo)(()=>"frame"===t?f.frames>=u.maxFrames:f.logos>=u.maxLogos,[t,f,u]),x=(0,r.useMemo)(()=>"frame"===t?"Frame limit reached (".concat(u.maxFrames,")"):"Logo limit reached (".concat(u.maxLogos,")"),[t,u]),I=(0,r.useCallback)(async()=>{var t,n,r;if(!e)return;const s=await Rv(Tm(lb,"clients",e)),i=s.exists()?null===(t=s.data())||void 0===t?void 0:t.limits:null;h({maxFrames:null!==(n=null===i||void 0===i?void 0:i.maxFrames)&&void 0!==n?n:5,maxLogos:null!==(r=null===i||void 0===i?void 0:i.maxLogos)&&void 0!==r?r:1});const a=await Pv(Sm(lb,"clients",e,"frames"));let o=0,l=0;a.forEach(e=>{var t;const n=null===(t=e.data())||void 0===t?void 0:t.type;"frame"===n&&(o+=1),"logo"===n&&(l+=1)}),p({frames:o,logos:l})},[e]),L=(0,r.useCallback)(async()=>{if(!e)return;const t=pv(Sm(lb,"clients",e,"frames"),bv("createdAt","desc"),wv(1)),n=(await Pv(t)).docs[0];S(n?d({id:n.id},n.data()):null)},[e]);return(0,r.useEffect)(()=>{I()},[I]),(0,r.useEffect)(()=>{L()},[L,f.frames,f.logos]),(0,ub.jsxs)("div",{className:"space-y-3 p-4 rounded-xl border border-slate-300 dark:border-slate-700",children:[(0,ub.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ub.jsx)("div",{className:"text-sm font-semibold",children:"\u30d5\u30ec\u30fc\u30e0 / \u30ed\u30b4 \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"}),(0,ub.jsxs)("div",{className:"text-xs text-slate-500",children:["\u5229\u7528: ",f.frames,"/",u.maxFrames," \u30d5\u30ec\u30fc\u30e0 \xb7 ",f.logos,"/",u.maxLogos," \u30ed\u30b4"]})]}),v&&(0,ub.jsx)("div",{className:"text-xs p-2 rounded bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-200",children:v}),(0,ub.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,ub.jsx)("label",{className:"text-xs text-slate-500",children:"\u7a2e\u985e"}),(0,ub.jsxs)("select",{value:t,onChange:e=>n(e.target.value),className:"w-full p-2 rounded bg-slate-100 dark:bg-slate-800",disabled:g,children:[(0,ub.jsx)("option",{value:"frame",children:"\u30d5\u30ec\u30fc\u30e0"}),(0,ub.jsx)("option",{value:"logo",children:"\u30ed\u30b4"})]})]}),(0,ub.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,ub.jsx)("label",{className:"text-xs text-slate-500",children:"PNG \u30d5\u30a1\u30a4\u30eb"}),(0,ub.jsx)("input",{ref:T,type:"file",accept:"image/png",disabled:g,onChange:e=>{var t;return i((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)}}),s&&(0,ub.jsxs)("div",{className:"text-xs text-slate-500",children:["\u9078\u629e: ",(0,ub.jsx)("span",{className:"font-medium",children:s.name})," \xb7 ",ZA(s.size),"MB"]})]}),(0,ub.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,ub.jsx)("input",{type:"checkbox",checked:a,disabled:g,onChange:e=>o(e.target.checked)}),"\u6709\u6599\u30b3\u30f3\u30c6\u30f3\u30c4"]}),a&&(0,ub.jsx)("input",{type:"number",placeholder:"\u4fa1\u683c (\u5186)",value:l,disabled:g,onChange:e=>c(e.target.value),className:"w-full p-2 rounded bg-slate-100 dark:bg-slate-800"}),(0,ub.jsx)("button",{onClick:async function(){y("");const n=function(){if(!e)return"Missing clientId (localStorage). Please login again.";if(k)return x;if(!s)return"Please select a PNG image.";if(!function(e){if(!e)return!1;const t="image/png"===e.type,n=(e.name||"").toLowerCase().endsWith(".png");return t||n}(s))return"Only PNG files are allowed.";const n="logo"===t?2:5;if(s.size>1024*n*1024)return"File is too large. Max ".concat(n,"MB (your file: ").concat(ZA(s.size),"MB).");if(a){const e=Number(l);if(!l||Number.isNaN(e)||e<=0)return"Please enter a valid price.";if(e>1e5)return"Price too high (max 100,000)."}return""}();if(n)return void(n===x?E(!0):alert(n));m(!0);const r=globalThis.crypto&&"function"===typeof globalThis.crypto.randomUUID?globalThis.crypto.randomUUID():Date.now().toString(16)+"-"+Math.random().toString(16).slice(2)+"-"+Math.random().toString(16).slice(2),u=(d=s.name)?d.trim().replace(/\s+/g,"_").replace(/[^\w.\-]+/g,"").slice(0,80):"file.png";var d;const h="frames/".concat(e,"/").concat(t,"/").concat(r,".png"),f=sb(cb,h);try{await function(e,t,n){return Ky(e=bn(e),t,n)}(f,s,{contentType:"image/png",customMetadata:{clientId:String(e),type:String(t),originalName:u}});const n=await nb(f);await Mv(Sm(lb,"clients",e,"frames"),{type:t,fileName:u,storagePath:h,downloadUrl:n,isPaid:a,price:a?Number(l):0,createdAt:iv()}),i(null),T.current&&(T.current.value=""),o(!1),c(""),await I(),await L()}catch(p){try{await rb(f)}catch(HE){}y((null===p||void 0===p?void 0:p.message)||"Upload failed"),alert("Upload failed: "+((null===p||void 0===p?void 0:p.message)||"Unknown error"))}finally{m(!1)}},className:"w-full py-2 rounded text-white transition ".concat(k||g?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),disabled:k||g,children:g?"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u4e2d...":"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"}),(null===w||void 0===w?void 0:w.downloadUrl)&&(0,ub.jsxs)("div",{className:"pt-2 border-t border-slate-200 dark:border-slate-800",children:[(0,ub.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"\u6700\u65b0\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"}),(0,ub.jsxs)("div",{className:"flex items-center gap-3",children:[(0,ub.jsx)("img",{src:w.downloadUrl,alt:"latest",className:"w-16 h-16 rounded object-contain bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700"}),(0,ub.jsxs)("div",{className:"text-xs",children:[(0,ub.jsx)("div",{className:"font-medium",children:w.fileName}),(0,ub.jsxs)("div",{className:"text-slate-500",children:[w.type," \xb7 ",w.isPaid?"\xa5".concat(w.price):"FREE"]})]})]})]}),b&&(0,ub.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,ub.jsxs)("div",{className:"bg-white dark:bg-slate-900 p-5 rounded-xl w-80",children:[(0,ub.jsx)("div",{className:"font-semibold text-sm mb-2",children:"\u5236\u9650\u306b\u9054\u3057\u307e\u3057\u305f\u3002"}),(0,ub.jsxs)("div",{className:"text-xs text-slate-600 dark:text-slate-300 mb-4",children:[x,". Please upgrade your plan to add more."]}),(0,ub.jsx)("button",{onClick:()=>E(!1),className:"w-full py-2 bg-blue-600 text-white rounded",children:"OK"})]})})]})}const $A={},eR=e=>{const t=14;switch(e){case"top-left":return{top:t,left:t};case"top-center":return{top:t,left:"50%",transform:"translateX(-50%)"};case"top-right":default:return{top:t,right:t};case"center":return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};case"bottom-left":return{bottom:t,left:t};case"bottom-center":return{bottom:t,left:"50%",transform:"translateX(-50%)"};case"bottom-right":return{bottom:t,right:t}}};async function tR(e){if(!e)return"";if($A[e])return $A[e];const t=await nb(sb(cb,e));return $A[e]=t,t}function nR(e){return Array.isArray(e)?e:[]}function rR(e){let{selectedFrameId:t,selectedLogos:n,itemsMap:s,pendingFrameFile:i,pendingLogos:a}=e;const[o,l]=(0,r.useState)(""),[c,u]=(0,r.useState)({}),[d,h]=(0,r.useState)(""),f=(0,r.useRef)(""),p=(0,r.useRef)([]),g=(0,r.useRef)(""),m=(0,r.useRef)(""),v=(0,r.useMemo)(()=>nR(n),[n]),y=(0,r.useMemo)(()=>nR(a),[a]),b=(0,r.useMemo)(()=>v.map(e=>e.logoId).filter(Boolean).sort(),[v]);return(0,r.useEffect)(()=>{let e=!0;if(h(""),f.current&&(URL.revokeObjectURL(f.current),f.current=""),i){try{const e=URL.createObjectURL(i);f.current=e,l(e)}catch(r){h("Failed to preview local frame"),l("")}return()=>{e=!1}}if(!t)return g.current="",l(""),()=>{e=!1};const n="remote:".concat(t);if(g.current===n)return()=>{e=!1};return g.current=n,async function(){const n=null===s||void 0===s?void 0:s[t];if(null!==n&&void 0!==n&&n.storagePath)try{const t=await tR(n.storagePath);e&&l(t)}catch(r){e&&(h("Failed to load frame"),l(""))}else l("")}(),()=>{e=!1}},[i,t,s]),(0,r.useEffect)(()=>{let e=!0;if(h(""),p.current.length){for(const e of p.current)URL.revokeObjectURL(e);p.current=[]}const t=b.join("|"),n=y.map(e=>{var t,n;return"".concat((null===e||void 0===e?void 0:e.position)||"",":").concat((null===e||void 0===e||null===(t=e.file)||void 0===t?void 0:t.name)||"",":").concat((null===e||void 0===e||null===(n=e.file)||void 0===n?void 0:n.size)||0)}).join("|"),r="".concat(t,"::").concat(n);if(m.current===r)return()=>{e=!1};return m.current=r,async function(){const t={};for(const r of b){const i=null===s||void 0===s?void 0:s[r];if(null!==i&&void 0!==i&&i.storagePath)try{t[r]=await tR(i.storagePath)}catch(n){e&&h("Failed to load logo")}}y.forEach((n,r)=>{if(null!==n&&void 0!==n&&n.file)try{const e=URL.createObjectURL(n.file);p.current.push(e),t["local-".concat(r)]=e}catch(s){e&&h("Failed to preview local logo")}}),e&&u(t)}(),()=>{e=!1}},[b,y,s]),(0,ub.jsxs)("div",{className:"h-full",children:[(0,ub.jsx)("div",{className:"text-sm font-semibold mb-2",children:"\u30d7\u30ec\u30d3\u30e5\u30fc"}),(0,ub.jsxs)("div",{className:"rounded-xl border border-slate-300 bg-slate-100 p-3",children:[(0,ub.jsxs)("div",{className:"relative w-full aspect-video rounded-lg overflow-hidden bg-black",children:[(0,ub.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-slate-400 text-sm",children:"(\u30d7\u30ec\u30d3\u30e5\u30fc \u306e\u307f)"}),o&&(0,ub.jsx)("img",{src:o,alt:"frame",className:"absolute inset-0 w-full h-full object-fill pointer-events-none"}),v.map(e=>{const t=c[e.logoId];return t?(0,ub.jsx)("img",{src:t,alt:"logo",className:"absolute w-20 h-20 object-contain pointer-events-none",style:eR(e.position)},"saved-".concat(e.logoId)):null}),y.map((e,t)=>{const n=c["local-".concat(t)];return n?(0,ub.jsx)("img",{src:n,alt:"logo",className:"absolute w-20 h-20 object-contain pointer-events-none",style:eR(e.position)},"local-".concat(t)):null})]}),d&&(0,ub.jsx)("div",{className:"mt-2 text-xs text-red-500",children:d}),(0,ub.jsx)("div",{className:"mt-2 text-xs text-slate-500",children:".png\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})]})]})}function sR(){const e=localStorage.getItem("clientId"),[t,n]=(0,r.useState)(""),[s,i]=(0,r.useState)([]),[a,o]=(0,r.useState)([]),[l,c]=(0,r.useState)({}),[u,d]=(0,r.useState)({maxFrames:3,maxLogos:1});(0,r.useEffect)(()=>{e&&async function(){try{const r=await Rv(Tm(lb,"clients",e));if(r.exists()){const e=r.data();var t,n;if(e.limits)d({maxFrames:null!==(t=e.limits.maxFrames)&&void 0!==t?t:5,maxLogos:null!==(n=e.limits.maxLogos)&&void 0!==n?n:1})}}catch(r){console.warn("Failed to load client limits, using defaults",r)}}()},[e]);const h=(0,r.useCallback)(e=>{const t={};e.forEach(e=>{t[e.id]=e}),c(t)},[]);return(0,ub.jsx)("div",{className:"p-6 h-full bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100",children:(0,ub.jsxs)("div",{className:"flex gap-6 h-full",children:[(0,ub.jsxs)("div",{className:"w-1/2 space-y-5",children:[(0,ub.jsx)("h1",{className:"text-xl font-bold",children:"\u30d5\u30ec\u30fc\u30e0\u3068\u30ed\u30b4\u8ffd\u52a0"}),(0,ub.jsx)(qA,{onSelect:n,onLoadOverlay:function(e){i(null!==e&&void 0!==e&&e.frameId?[e.frameId]:[]),o((null===e||void 0===e?void 0:e.logos)||[])}}),(0,ub.jsx)(JA,{}),(0,ub.jsxs)("div",{className:"text-xs text-slate-500",children:["Plan limits: ",u.maxFrames," frame(s), ",u.maxLogos," logo(s)"]}),(0,ub.jsx)(YA,{selectedFrames:s,selectedLogos:a,onFrameChange:i,onLogoChange:o,onItemsLoaded:h,limits:u}),(0,ub.jsx)(QA,{logos:a,onChange:o}),(0,ub.jsx)(XA,{clientId:e,cameraId:t,frameIds:s,logos:a}),(0,ub.jsxs)("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:["Selected Camera: ",(0,ub.jsx)("b",{children:t||"None"})," / Frame:"," ",(0,ub.jsx)("b",{children:s[0]||"None"})," / Logos:"," ",(0,ub.jsx)("b",{children:a.length})]})]}),(0,ub.jsx)("div",{className:"w-1/2",children:(0,ub.jsx)(rR,{selectedFrameId:s[0]||null,selectedLogos:a,itemsMap:l})})]})})}var iR,aR=Object.defineProperty,oR=Object.getOwnPropertySymbols,lR=Object.prototype.hasOwnProperty,cR=Object.prototype.propertyIsEnumerable,uR=(e,t,n)=>t in e?aR(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dR=(e,t)=>{for(var n in t||(t={}))lR.call(t,n)&&uR(e,n,t[n]);if(oR)for(var n of oR(t))cR.call(t,n)&&uR(e,n,t[n]);return e},hR=(e,t)=>{var n={};for(var r in e)lR.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&oR)for(var r of oR(e))t.indexOf(r)<0&&cR.call(e,r)&&(n[r]=e[r]);return n};(e=>{const t=class t{constructor(e,n,r,i){if(this.version=e,this.errorCorrectionLevel=n,this.modules=[],this.isFunction=[],e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=4*e+17;let a=[];for(let t=0;t<this.size;t++)a.push(!1);for(let t=0;t<this.size;t++)this.modules.push(a.slice()),this.isFunction.push(a.slice());this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),-1==i){let e=1e9;for(let t=0;t<8;t++){this.applyMask(t),this.drawFormatBits(t);const n=this.getPenaltyScore();n<e&&(i=t,e=n),this.applyMask(t)}}s(0<=i&&i<=7),this.mask=i,this.applyMask(i),this.drawFormatBits(i),this.isFunction=[]}static encodeText(n,r){const s=e.QrSegment.makeSegments(n);return t.encodeSegments(s,r)}static encodeBinary(n,r){const s=e.QrSegment.makeBytes(n);return t.encodeSegments([s],r)}static encodeSegments(e,r){let i,o,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(!(t.MIN_VERSION<=l&&l<=c&&c<=t.MAX_VERSION)||u<-1||u>7)throw new RangeError("Invalid value");for(i=l;;i++){const n=8*t.getNumDataCodewords(i,r),s=a.getTotalBits(e,i);if(s<=n){o=s;break}if(i>=c)throw new RangeError("Data too long")}for(const n of[t.Ecc.MEDIUM,t.Ecc.QUARTILE,t.Ecc.HIGH])d&&o<=8*t.getNumDataCodewords(i,n)&&(r=n);let h=[];for(const t of e){n(t.mode.modeBits,4,h),n(t.numChars,t.mode.numCharCountBits(i),h);for(const e of t.getData())h.push(e)}s(h.length==o);const f=8*t.getNumDataCodewords(i,r);s(h.length<=f),n(0,Math.min(4,f-h.length),h),n(0,(8-h.length%8)%8,h),s(h.length%8==0);for(let t=236;h.length<f;t^=253)n(t,8,h);let p=[];for(;8*p.length<h.length;)p.push(0);return h.forEach((e,t)=>p[t>>>3]|=e<<7-(7&t)),new t(i,r,p,u)}getModule(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2==0),this.setFunctionModule(n,6,n%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),t=e.length;for(let n=0;n<t;n++)for(let r=0;r<t;r++)0==n&&0==r||0==n&&r==t-1||n==t-1&&0==r||this.drawAlignmentPattern(e[n],e[r]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const t=this.errorCorrectionLevel.formatBits<<3|e;let n=t;for(let r=0;r<10;r++)n=n<<1^1335*(n>>>9);const i=21522^(t<<10|n);s(i>>>15==0);for(let s=0;s<=5;s++)this.setFunctionModule(8,s,r(i,s));this.setFunctionModule(8,7,r(i,6)),this.setFunctionModule(8,8,r(i,7)),this.setFunctionModule(7,8,r(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,r(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,r(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,r(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let n=0;n<12;n++)e=e<<1^7973*(e>>>11);const t=this.version<<12|e;s(t>>>18==0);for(let n=0;n<18;n++){const e=r(t,n),s=this.size-11+n%3,i=Math.floor(n/3);this.setFunctionModule(s,i,e),this.setFunctionModule(i,s,e)}}drawFinderPattern(e,t){for(let n=-4;n<=4;n++)for(let r=-4;r<=4;r++){const s=Math.max(Math.abs(r),Math.abs(n)),i=e+r,a=t+n;0<=i&&i<this.size&&0<=a&&a<this.size&&this.setFunctionModule(i,a,2!=s&&4!=s)}}drawAlignmentPattern(e,t){for(let n=-2;n<=2;n++)for(let r=-2;r<=2;r++)this.setFunctionModule(e+r,t+n,1!=Math.max(Math.abs(r),Math.abs(n)))}setFunctionModule(e,t,n){this.modules[t][e]=n,this.isFunction[t][e]=!0}addEccAndInterleave(e){const n=this.version,r=this.errorCorrectionLevel;if(e.length!=t.getNumDataCodewords(n,r))throw new RangeError("Invalid argument");const i=t.NUM_ERROR_CORRECTION_BLOCKS[r.ordinal][n],a=t.ECC_CODEWORDS_PER_BLOCK[r.ordinal][n],o=Math.floor(t.getNumRawDataModules(n)/8),l=i-o%i,c=Math.floor(o/i);let u=[];const d=t.reedSolomonComputeDivisor(a);for(let s=0,f=0;s<i;s++){let n=e.slice(f,f+c-a+(s<l?0:1));f+=n.length;const r=t.reedSolomonComputeRemainder(n,d);s<l&&n.push(0),u.push(n.concat(r))}let h=[];for(let t=0;t<u[0].length;t++)u.forEach((e,n)=>{(t!=c-a||n>=l)&&h.push(e[t])});return s(h.length==o),h}drawCodewords(e){if(e.length!=Math.floor(t.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let n=0;for(let t=this.size-1;t>=1;t-=2){6==t&&(t=5);for(let s=0;s<this.size;s++)for(let i=0;i<2;i++){const a=t-i,o=0==(t+1&2)?this.size-1-s:s;!this.isFunction[o][a]&&n<8*e.length&&(this.modules[o][a]=r(e[n>>>3],7-(7&n)),n++)}}s(n==8*e.length)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let n=0;n<this.size;n++){let r;switch(e){case 0:r=(n+t)%2==0;break;case 1:r=t%2==0;break;case 2:r=n%3==0;break;case 3:r=(n+t)%3==0;break;case 4:r=(Math.floor(n/3)+Math.floor(t/2))%2==0;break;case 5:r=n*t%2+n*t%3==0;break;case 6:r=(n*t%2+n*t%3)%2==0;break;case 7:r=((n+t)%2+n*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][n]&&r&&(this.modules[t][n]=!this.modules[t][n])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let n=!1,r=0,i=[0,0,0,0,0,0,0];for(let a=0;a<this.size;a++)this.modules[s][a]==n?(r++,5==r?e+=t.PENALTY_N1:r>5&&e++):(this.finderPenaltyAddHistory(r,i),n||(e+=this.finderPenaltyCountPatterns(i)*t.PENALTY_N3),n=this.modules[s][a],r=1);e+=this.finderPenaltyTerminateAndCount(n,r,i)*t.PENALTY_N3}for(let s=0;s<this.size;s++){let n=!1,r=0,i=[0,0,0,0,0,0,0];for(let a=0;a<this.size;a++)this.modules[a][s]==n?(r++,5==r?e+=t.PENALTY_N1:r>5&&e++):(this.finderPenaltyAddHistory(r,i),n||(e+=this.finderPenaltyCountPatterns(i)*t.PENALTY_N3),n=this.modules[a][s],r=1);e+=this.finderPenaltyTerminateAndCount(n,r,i)*t.PENALTY_N3}for(let s=0;s<this.size-1;s++)for(let n=0;n<this.size-1;n++){const r=this.modules[s][n];r==this.modules[s][n+1]&&r==this.modules[s+1][n]&&r==this.modules[s+1][n+1]&&(e+=t.PENALTY_N2)}let n=0;for(const t of this.modules)n=t.reduce((e,t)=>e+(t?1:0),n);const r=this.size*this.size,i=Math.ceil(Math.abs(20*n-10*r)/r)-1;return s(0<=i&&i<=9),e+=i*t.PENALTY_N4,s(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(1==this.version)return[];{const e=Math.floor(this.version/7)+2,t=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*e-2));let n=[6];for(let r=this.size-7;n.length<e;r-=t)n.splice(1,0,r);return n}}static getNumRawDataModules(e){if(e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version number out of range");let n=(16*e+128)*e+64;if(e>=2){const t=Math.floor(e/7)+2;n-=(25*t-10)*t-55,e>=7&&(n-=36)}return s(208<=n&&n<=29648),n}static getNumDataCodewords(e,n){return Math.floor(t.getNumRawDataModules(e)/8)-t.ECC_CODEWORDS_PER_BLOCK[n.ordinal][e]*t.NUM_ERROR_CORRECTION_BLOCKS[n.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let n=[];for(let t=0;t<e-1;t++)n.push(0);n.push(1);let r=1;for(let s=0;s<e;s++){for(let e=0;e<n.length;e++)n[e]=t.reedSolomonMultiply(n[e],r),e+1<n.length&&(n[e]^=n[e+1]);r=t.reedSolomonMultiply(r,2)}return n}static reedSolomonComputeRemainder(e,n){let r=n.map(e=>0);for(const s of e){const e=s^r.shift();r.push(0),n.forEach((n,s)=>r[s]^=t.reedSolomonMultiply(n,e))}return r}static reedSolomonMultiply(e,t){if(e>>>8!=0||t>>>8!=0)throw new RangeError("Byte out of range");let n=0;for(let r=7;r>=0;r--)n=n<<1^285*(n>>>7),n^=(t>>>r&1)*e;return s(n>>>8==0),n}finderPenaltyCountPatterns(e){const t=e[1];s(t<=3*this.size);const n=t>0&&e[2]==t&&e[3]==3*t&&e[4]==t&&e[5]==t;return(n&&e[0]>=4*t&&e[6]>=t?1:0)+(n&&e[6]>=4*t&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,n){return e&&(this.finderPenaltyAddHistory(t,n),t=0),t+=this.size,this.finderPenaltyAddHistory(t,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(e,t){0==t[0]&&(e+=this.size),t.pop(),t.unshift(e)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];function n(e,t,n){if(t<0||t>31||e>>>t!=0)throw new RangeError("Value out of range");for(let r=t-1;r>=0;r--)n.push(e>>>r&1)}function r(e,t){return 0!=(e>>>t&1)}function s(e){if(!e)throw new Error("Assertion error")}e.QrCode=t;const i=class e{constructor(e,t,n){if(this.mode=e,this.numChars=t,this.bitData=n,t<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}static makeBytes(t){let r=[];for(const e of t)n(e,8,r);return new e(e.Mode.BYTE,t.length,r)}static makeNumeric(t){if(!e.isNumeric(t))throw new RangeError("String contains non-numeric characters");let r=[];for(let e=0;e<t.length;){const s=Math.min(t.length-e,3);n(parseInt(t.substring(e,e+s),10),3*s+1,r),e+=s}return new e(e.Mode.NUMERIC,t.length,r)}static makeAlphanumeric(t){if(!e.isAlphanumeric(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");let r,s=[];for(r=0;r+2<=t.length;r+=2){let i=45*e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r));i+=e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r+1)),n(i,11,s)}return r<t.length&&n(e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r)),6,s),new e(e.Mode.ALPHANUMERIC,t.length,s)}static makeSegments(t){return""==t?[]:e.isNumeric(t)?[e.makeNumeric(t)]:e.isAlphanumeric(t)?[e.makeAlphanumeric(t)]:[e.makeBytes(e.toUtf8ByteArray(t))]}static makeEci(t){let r=[];if(t<0)throw new RangeError("ECI assignment value out of range");if(t<128)n(t,8,r);else if(t<16384)n(2,2,r),n(t,14,r);else{if(!(t<1e6))throw new RangeError("ECI assignment value out of range");n(6,3,r),n(t,21,r)}return new e(e.Mode.ECI,0,r)}static isNumeric(t){return e.NUMERIC_REGEX.test(t)}static isAlphanumeric(t){return e.ALPHANUMERIC_REGEX.test(t)}getData(){return this.bitData.slice()}static getTotalBits(e,t){let n=0;for(const r of e){const e=r.mode.numCharCountBits(t);if(r.numChars>=1<<e)return 1/0;n+=4+e+r.bitData.length}return n}static toUtf8ByteArray(e){e=encodeURI(e);let t=[];for(let n=0;n<e.length;n++)"%"!=e.charAt(n)?t.push(e.charCodeAt(n)):(t.push(parseInt(e.substring(n+1,n+3),16)),n+=2);return t}};i.NUMERIC_REGEX=/^[0-9]*$/,i.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,i.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let a=i;e.QrSegment=i})(iR||(iR={})),(e=>{let t;(e=>{const t=class{constructor(e,t){this.ordinal=e,this.formatBits=t}};t.LOW=new t(0,1),t.MEDIUM=new t(1,0),t.QUARTILE=new t(2,3),t.HIGH=new t(3,2);e.Ecc=t})(t=e.QrCode||(e.QrCode={}))})(iR||(iR={})),(e=>{let t;(e=>{const t=class{constructor(e,t){this.modeBits=e,this.numBitsCharCount=t}numCharCountBits(e){return this.numBitsCharCount[Math.floor((e+7)/17)]}};t.NUMERIC=new t(1,[10,12,14]),t.ALPHANUMERIC=new t(2,[9,11,13]),t.BYTE=new t(4,[8,16,16]),t.KANJI=new t(8,[8,10,12]),t.ECI=new t(7,[0,0,0]);e.Mode=t})(t=e.QrSegment||(e.QrSegment={}))})(iR||(iR={}));var fR=iR,pR={L:fR.QrCode.Ecc.LOW,M:fR.QrCode.Ecc.MEDIUM,Q:fR.QrCode.Ecc.QUARTILE,H:fR.QrCode.Ecc.HIGH},gR=128,mR="L",vR="#FFFFFF",yR="#000000",bR=!1,ER=1;function wR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=[];return e.forEach(function(e,r){let s=null;e.forEach(function(i,a){if(!i&&null!==s)return n.push("M".concat(s+t," ").concat(r+t,"h").concat(a-s,"v1H").concat(s+t,"z")),void(s=null);if(a!==e.length-1)i&&null===s&&(s=a);else{if(!i)return;null===s?n.push("M".concat(a+t,",").concat(r+t," h1v1H").concat(a+t,"z")):n.push("M".concat(s+t,",").concat(r+t," h").concat(a+1-s,"v1H").concat(s+t,"z"))}})}),n.join("")}function SR(e,t){return e.slice().map((e,n)=>n<t.y||n>=t.y+t.h?e:e.map((e,n)=>(n<t.x||n>=t.x+t.w)&&e))}function TR(e){let{value:t,level:n,minVersion:s,includeMargin:i,marginSize:a,imageSettings:o,size:l,boostLevel:c}=e,u=r.useMemo(()=>{const e=(Array.isArray(t)?t:[t]).reduce((e,t)=>(e.push(...fR.QrSegment.makeSegments(t)),e),[]);return fR.QrCode.encodeSegments(e,pR[n],s,void 0,void 0,c)},[t,n,s,c]);const{cells:d,margin:h,numCells:f,calculatedImageSettings:p}=r.useMemo(()=>{let e=u.getModules();const t=function(e,t){return null!=t?Math.max(Math.floor(t),0):e?4:0}(i,a),n=e.length+2*t,r=function(e,t,n,r){if(null==r)return null;const s=e.length+2*n,i=Math.floor(.1*t),a=s/t,o=(r.width||i)*a,l=(r.height||i)*a,c=null==r.x?e.length/2-o/2:r.x*a,u=null==r.y?e.length/2-l/2:r.y*a,d=null==r.opacity?1:r.opacity;let h=null;if(r.excavate){let e=Math.floor(c),t=Math.floor(u);h={x:e,y:t,w:Math.ceil(o+c-e),h:Math.ceil(l+u-t)}}return{x:c,y:u,h:l,w:o,excavation:h,opacity:d,crossOrigin:r.crossOrigin}}(e,l,t,o);return{cells:e,margin:t,numCells:n,calculatedImageSettings:r}},[u,l,o,i,a]);return{qrcode:u,margin:h,cells:d,numCells:f,calculatedImageSettings:p}}var kR=function(){try{(new Path2D).addPath(new Path2D)}catch(_w){return!1}return!0}(),xR=r.forwardRef(function(e,t){const n=e,{value:s,size:i=gR,level:a=mR,bgColor:o=vR,fgColor:l=yR,includeMargin:c=bR,minVersion:u=ER,boostLevel:d,marginSize:h,imageSettings:f}=n,p=hR(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:g}=p,m=hR(p,["style"]),v=null==f?void 0:f.src,y=r.useRef(null),b=r.useRef(null),E=r.useCallback(e=>{y.current=e,"function"===typeof t?t(e):t&&(t.current=e)},[t]),[w,S]=r.useState(!1),{margin:T,cells:k,numCells:x,calculatedImageSettings:I}=TR({value:s,level:a,minVersion:u,boostLevel:d,includeMargin:c,marginSize:h,imageSettings:f,size:i});r.useEffect(()=>{if(null!=y.current){const e=y.current,t=e.getContext("2d");if(!t)return;let n=k;const r=b.current,s=null!=I&&null!==r&&r.complete&&0!==r.naturalHeight&&0!==r.naturalWidth;s&&null!=I.excavation&&(n=SR(k,I.excavation));const a=window.devicePixelRatio||1;e.height=e.width=i*a;const c=i/x*a;t.scale(c,c),t.fillStyle=o,t.fillRect(0,0,x,x),t.fillStyle=l,kR?t.fill(new Path2D(wR(n,T))):k.forEach(function(e,n){e.forEach(function(e,r){e&&t.fillRect(r+T,n+T,1,1)})}),I&&(t.globalAlpha=I.opacity),s&&t.drawImage(r,I.x+T,I.y+T,I.w,I.h)}}),r.useEffect(()=>{S(!1)},[v]);const L=dR({height:i,width:i},g);let C=null;return null!=v&&(C=r.createElement("img",{src:v,key:v,style:{display:"none"},onLoad:()=>{S(!0)},ref:b,crossOrigin:null==I?void 0:I.crossOrigin})),r.createElement(r.Fragment,null,r.createElement("canvas",dR({style:L,height:i,width:i,ref:E,role:"img"},m)),C)});function IR(e){let{size:t=18}=e;return(0,ub.jsxs)("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",children:[(0,ub.jsx)("path",{d:"M12 3v10m0 0 4-4m-4 4-4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,ub.jsx)("path",{d:"M4 17v3h16v-3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}function LR(){const{clientId:e}=hb(),[t,n]=(0,r.useState)([]),[s,i]=(0,r.useState)("active"),[a,o]=(0,r.useState)(""),l=(0,r.useRef)(new Map);(0,r.useEffect)(()=>{if(o(""),!e)return;return Fv(Sm(lb,"clients",e,"cameras"),e=>{const t=e.docs.map(e=>d({id:e.id},e.data()));n(t)},e=>{console.error("QR page error:",e),o("\u30ab\u30e1\u30e9\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")})},[e]);const c="http://192.168.1.183:4450",u=(0,r.useMemo)(()=>"all"===s?t:t.filter(e=>"active"===e.paymentStatus),[t,s]);return(0,ub.jsxs)("div",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-4",children:[(0,ub.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("h3",{className:"text-lg font-semibold",children:"QR\u30b3\u30fc\u30c9\u7ba1\u7406"}),(0,ub.jsxs)("div",{className:"text-xs text-slate-500 mt-1 break-all",children:["\u30d9\u30fc\u30b9URL\uff1a",c]}),(0,ub.jsxs)("div",{className:"text-xs text-slate-500 mt-1 break-all",children:["\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\uff1a",e||"-"]})]}),(0,ub.jsxs)("select",{className:"text-sm rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 px-3 py-2",value:s,onChange:e=>i(e.target.value),children:[(0,ub.jsx)("option",{value:"active",children:"\u6709\u52b9\u306a\u30ab\u30e1\u30e9\u306e\u307f"}),(0,ub.jsx)("option",{value:"all",children:"\u3059\u3079\u3066\u306e\u30ab\u30e1\u30e9"})]})]}),a&&(0,ub.jsx)("div",{className:"mt-3 p-3 rounded-xl bg-red-50 text-red-700 text-sm border border-red-200",children:a}),!e&&(0,ub.jsx)("div",{className:"mt-4 text-sm text-red-600",children:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\u518d\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}),e&&0===u.length&&!a&&(0,ub.jsx)("div",{className:"mt-6 text-sm text-slate-500",children:"\u8868\u793a\u3059\u308b\u30ab\u30e1\u30e9\u304c\u3042\u308a\u307e\u305b\u3093\u3002"}),(0,ub.jsx)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:u.map(e=>{const t="active"===e.paymentStatus,n="".concat(c,"/capture/?cameraId=").concat(encodeURIComponent(e.id));return(0,ub.jsxs)("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl p-4",children:[(0,ub.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:"font-semibold",children:e.name||"\u30ab\u30e1\u30e9"}),(0,ub.jsxs)("div",{className:"text-xs text-slate-500 break-all",children:["\u30ab\u30e1\u30e9ID\uff1a",e.id]})]}),(0,ub.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(t?"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-200":"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-200"),children:t?"\u6709\u52b9":"\u7121\u52b9"})]}),(0,ub.jsxs)("div",{className:"mt-3 relative",children:[(0,ub.jsx)("div",{className:"flex items-center justify-center bg-slate-50 dark:bg-slate-800 rounded-2xl p-4",children:(0,ub.jsx)("div",{className:"bg-white p-3 rounded-xl ".concat(t?"":"blur-sm"),ref:t=>{t?l.current.set(e.id,t):l.current.delete(e.id)},children:(0,ub.jsx)(xR,{value:n,size:230,level:"M"})})}),!t&&(0,ub.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,ub.jsx)("div",{className:"px-3 py-2 rounded-xl text-sm font-semibold bg-white/90 dark:bg-slate-950/80 border",children:"\u304a\u652f\u6255\u3044\u304c\u7121\u52b9\u3067\u3059"})})]}),(0,ub.jsx)("div",{className:"mt-3 text-xs text-slate-600 dark:text-slate-300 break-all",children:n}),(0,ub.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,ub.jsx)("button",{className:"px-3 py-2 rounded-xl text-sm ".concat(t?"bg-blue-600 text-white":"bg-slate-200 text-slate-400 cursor-not-allowed"),disabled:!t,onClick:()=>navigator.clipboard.writeText(n),children:"URL\u3092\u30b3\u30d4\u30fc"}),(0,ub.jsx)("a",{className:"px-3 py-2 rounded-xl text-sm ".concat(t?"bg-slate-200 dark:bg-slate-800":"bg-slate-200 text-slate-400 pointer-events-none"),href:t?n:void 0,target:"_blank",rel:"noreferrer",children:"\u958b\u304f"}),t&&(0,ub.jsxs)("button",{type:"button",className:"px-3 py-2 rounded-xl text-sm bg-emerald-600 text-white flex items-center gap-2",onClick:()=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"camera";try{const n=l.current.get(e),r=null===n||void 0===n?void 0:n.querySelector("canvas");if(!r)throw new Error("QR canvas not found");const s=r.toDataURL("image/png"),i=document.createElement("a");i.href=s;const a=String(t).replace(/[\\/:*?"<>|]/g,"_");i.download="TownCapture_QR_".concat(a,"_").concat(e,".png"),document.body.appendChild(i),i.click(),i.remove()}catch(_w){console.error(_w),alert("QR\u30b3\u30fc\u30c9\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}}(e.id,e.name),children:[(0,ub.jsx)(IR,{}),"QR\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"]})]}),(0,ub.jsx)("div",{className:"mt-2 text-xs text-slate-500",children:"\u203b \u30b9\u30de\u30db\u3067\u8aad\u307f\u53d6\u308b\u5834\u5408\u306f localhost \u306f\u4f7f\u3048\u307e\u305b\u3093"})]},e.id)})})]})}function CR(e){let{isDark:t}=e;const n=localStorage.getItem("clientId"),[s,i]=(0,r.useState)(!0),[a,o]=(0,r.useState)(!1),[l,c]=(0,r.useState)(null),[u,d]=(0,r.useState)(!1),[h,f]=(0,r.useState)(100),[p,g]=(0,r.useState)(300),[m,v]=(0,r.useState)(500);(0,r.useEffect)(()=>{(async()=>{try{if(!n)return;const s=Tm(lb,"clients",n,"settings","pricing"),i=await Rv(s);if(i.exists()){var e,t,r;const n=i.data();d(!!n.freeMode),f(Number(null!==(e=n.photoPrice)&&void 0!==e?e:100)),g(Number(null!==(t=n.video3Price)&&void 0!==t?t:300)),v(Number(null!==(r=n.video15Price)&&void 0!==r?r:500))}else await Dv(s,{freeMode:!1,photoPrice:100,video3Price:300,video15Price:500,updatedAt:iv()})}catch(_w){c({type:"error",text:_w.message})}finally{i(!1)}})()},[n]);const y=t?"bg-slate-900 border-slate-800 text-white":"bg-white border-slate-200 text-slate-900";return s?(0,ub.jsx)("div",{className:"p-6",children:"\u8aad\u307f\u8fbc\u307f\u4e2d\u2026"}):(0,ub.jsxs)("div",{className:"p-4 sm:p-6 max-w-3xl",children:[(0,ub.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"\u8a2d\u5b9a"}),(0,ub.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-6",children:"\u5199\u771f / 3\u79d2\u52d5\u753b / 15\u79d2\u52d5\u753b\u306e\u4fa1\u683c\u3092\u5909\u66f4\u3067\u304d\u307e\u3059\u3002\u7121\u6599\u30e2\u30fc\u30c9\u3092ON\u306b\u3059\u308b\u3068\u3001\u3059\u3079\u3066 \xa50 \u306b\u306a\u308a\u307e\u3059\u3002"}),(0,ub.jsxs)("div",{className:"border rounded-2xl p-4 sm:p-6 ".concat(y),children:[(0,ub.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:"font-semibold",children:"\u7121\u6599\u30e2\u30fc\u30c9"}),(0,ub.jsx)("div",{className:"text-sm opacity-75",children:"ON\u306b\u3059\u308b\u3068\u3001\u3059\u3079\u3066\u306e\u4fa1\u683c\u304c0\u5186\u306b\u306a\u308a\u307e\u3059\uff08\u652f\u6255\u3044\u4e0d\u8981\uff09\u3002"})]}),(0,ub.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,ub.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:u,onChange:e=>d(e.target.checked)}),(0,ub.jsx)("div",{className:"w-11 h-6 bg-slate-300 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:bg-blue-600 relative",children:(0,ub.jsx)("div",{className:"absolute top-0.5 left-0.5 bg-white w-5 h-5 rounded-full transition-all peer-checked:translate-x-5"})})]})]}),(0,ub.jsxs)("div",{className:"mt-6 grid sm:grid-cols-2 gap-4",children:[(0,ub.jsx)(_R,{label:"\u5199\u771f\u306e\u4fa1\u683c\uff08\xa5\uff09",value:h,setValue:f,disabled:u}),(0,ub.jsx)(_R,{label:"\u52d5\u753b 3\u79d2\u306e\u4fa1\u683c\uff08\xa5\uff09",value:p,setValue:g,disabled:u}),(0,ub.jsx)(_R,{label:"\u52d5\u753b 15\u79d2\u306e\u4fa1\u683c\uff08\xa5\uff09",value:m,setValue:v,disabled:u})]}),(0,ub.jsxs)("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[(0,ub.jsx)("button",{onClick:async function(){try{o(!0),c(null);const e=Tm(lb,"clients",n,"settings","pricing");await Dv(e,{freeMode:!!u,photoPrice:Number(h),video3Price:Number(p),video15Price:Number(m),updatedAt:iv()},{merge:!0}),c({type:"ok",text:"\u4fdd\u5b58\u3057\u307e\u3057\u305f \u2705"})}catch(_w){c({type:"error",text:_w.message})}finally{o(!1)}},disabled:a,className:"px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:a?"\u4fdd\u5b58\u4e2d\u2026":"\u4fdd\u5b58"}),"ok"===(null===l||void 0===l?void 0:l.type)&&(0,ub.jsx)("span",{className:"text-sm text-green-500",children:l.text}),"error"===(null===l||void 0===l?void 0:l.type)&&(0,ub.jsx)("span",{className:"text-sm text-red-500",children:l.text})]}),(0,ub.jsxs)("div",{className:"mt-4 text-xs opacity-70",children:["\u73fe\u5728\u306e\u9069\u7528\u4fa1\u683c\uff1a"," ",(0,ub.jsxs)("b",{children:["\u5199\u771f \xa5",u?0:h,"\u30013\u79d2 \xa5",u?0:p,"\u3001 15\u79d2 \xa5",u?0:m]})]})]})]})}function _R(e){let{label:t,value:n,setValue:r,disabled:s}=e;return(0,ub.jsxs)("div",{children:[(0,ub.jsx)("label",{className:"block text-sm font-medium mb-1",children:t}),(0,ub.jsx)("input",{type:"number",min:"0",step:"1",disabled:s,value:n,onChange:e=>r(e.target.value),className:"w-full px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 bg-transparent"}),s&&(0,ub.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"\u7121\u6599\u30e2\u30fc\u30c9\u304cON\u306e\u305f\u3081\u5909\u66f4\u3067\u304d\u307e\u305b\u3093"})]})}function AR(e){const t=null!==e&&void 0!==e&&e.toDate?e.toDate():new Date(e),n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(r,"-").concat(s)}function RR(e){return Number(e||0).toLocaleString("ja-JP")}function PR(){const{clientId:e}=hb(),[t,n]=(0,r.useState)(""),[s,i]=(0,r.useState)(""),[a,o]=(0,r.useState)("ALL"),[l,c]=(0,r.useState)([]),[u,h]=(0,r.useState)([]),[f,p]=(0,r.useState)(!1),[g,m]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{if(e)try{const t=(await Pv(Sm(lb,"clients",e,"cameras"))).docs.map(e=>{var t,n;return{id:e.id,name:(null===(t=e.data())||void 0===t?void 0:t.cameraName)||(null===(n=e.data())||void 0===n?void 0:n.name)||e.id}});t.sort((e,t)=>e.name.localeCompare(t.name,"ja")),c(t)}catch(_w){console.error(_w),m("Failed to load cameras.")}})()},[e]);const v=(0,r.useMemo)(()=>{const e={captureTotal:0,paidTotal:0,imageCount:0,video3sCount:0,video15sCount:0,earnTotal:0};for(const t of u)e.captureTotal+=t.captureTotal,e.paidTotal+=t.paidTotal,e.imageCount+=t.imageCount,e.video3sCount+=t.video3sCount,e.video15sCount+=t.video15sCount,e.earnTotal+=t.earnTotal;return e},[u]);return(0,ub.jsxs)("div",{style:{padding:20,maxWidth:1200,margin:"0 auto"},children:[(0,ub.jsx)("h2",{style:{marginBottom:12},children:"Report"}),(0,ub.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:12,background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12},children:[(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{style:{fontSize:12,color:"#64748b"},children:"Start date"}),(0,ub.jsx)("input",{type:"date",value:t,onChange:e=>n(e.target.value),style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb"}})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{style:{fontSize:12,color:"#64748b"},children:"End date"}),(0,ub.jsx)("input",{type:"date",value:s,onChange:e=>i(e.target.value),style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb"}})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{style:{fontSize:12,color:"#64748b"},children:"Camera"}),(0,ub.jsxs)("select",{value:a,onChange:e=>o(e.target.value),style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #e5e7eb"},children:[(0,ub.jsx)("option",{value:"ALL",children:"All cameras"}),l.map(e=>(0,ub.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,ub.jsx)("button",{onClick:async function(){if(m(""),h([]),!e)return m("Missing clientId.");if(!t||!s)return m("Please select start date and end date.");const n=function(e){const t=new Date(e);return t.setHours(0,0,0,0),t}(t),r=function(e){const t=new Date(e);return t.setHours(23,59,59,999),t}(s);if(n>r)return m("Start date must be before end date.");p(!0);try{const t=Sm(lb,"clients",e,"captures");let s;s="ALL"===a?pv(t,mv("createdAt",">=",n),mv("createdAt","<=",r),bv("createdAt","asc")):pv(t,mv("cameraId","==",a),mv("createdAt",">=",n),mv("createdAt","<=",r),bv("createdAt","asc"));const i=(await Pv(s)).docs.map(e=>d({id:e.id},e.data())),o=new Map;for(const e of i){const t=AR(e.createdAt),n=e.captureBucket||"image",r="paid"===e.paymentPhase,s=r?Number(e.amountPaid||0):0;o.has(t)||o.set(t,{date:t,captureTotal:0,paidTotal:0,imageCount:0,video3sCount:0,video15sCount:0,earnTotal:0});const i=o.get(t);i.captureTotal+=1,r&&(i.paidTotal+=1),"image"===n?i.imageCount+=1:"video_3s"===n?i.video3sCount+=1:"video_15s"===n&&(i.video15sCount+=1),i.earnTotal+=s}const l=Array.from(o.values()).sort((e,t)=>e.date.localeCompare(t.date));h(l)}catch(_w){console.error(_w),m("Failed to create report. Firestore may require an index (cameraId + createdAt).")}finally{p(!1)}},disabled:f,style:{padding:"10px 14px",borderRadius:10,border:"1px solid #3b82f6",background:f?"#93c5fd":"#3b82f6",color:"#fff",fontWeight:800},children:f?"Creating...":"Create report"})]}),g&&(0,ub.jsx)("div",{style:{marginTop:12,padding:10,borderRadius:10,background:"#fee2e2",color:"#b91c1c"},children:g}),u.length>0&&(0,ub.jsxs)(ub.Fragment,{children:[(0,ub.jsxs)("div",{style:{marginTop:14,display:"flex",gap:10,flexWrap:"wrap"},children:[(0,ub.jsx)(DR,{label:"Capture total",value:v.captureTotal}),(0,ub.jsx)(DR,{label:"Paid total",value:v.paidTotal}),(0,ub.jsx)(DR,{label:"Image count",value:v.imageCount}),(0,ub.jsx)(DR,{label:"3sec count",value:v.video3sCount}),(0,ub.jsx)(DR,{label:"15sec count",value:v.video15sCount}),(0,ub.jsx)(DR,{label:"Earn total (JPY)",value:"\xa5".concat(RR(v.earnTotal))})]}),(0,ub.jsx)("div",{style:{marginTop:14,overflowX:"auto",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12},children:(0,ub.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,ub.jsx)("thead",{children:(0,ub.jsxs)("tr",{style:{background:"#f8fafc"},children:[(0,ub.jsx)(OR,{children:"Date"}),(0,ub.jsx)(OR,{children:"Capture"}),(0,ub.jsx)(OR,{children:"Paid"}),(0,ub.jsx)(OR,{children:"Image"}),(0,ub.jsx)(OR,{children:"3sec"}),(0,ub.jsx)(OR,{children:"15sec"}),(0,ub.jsx)(OR,{children:"Earn"})]})}),(0,ub.jsxs)("tbody",{children:[u.map(e=>(0,ub.jsxs)("tr",{style:{borderTop:"1px solid #e5e7eb"},children:[(0,ub.jsx)(NR,{children:e.date}),(0,ub.jsx)(NR,{children:e.captureTotal}),(0,ub.jsx)(NR,{children:e.paidTotal}),(0,ub.jsx)(NR,{children:e.imageCount}),(0,ub.jsx)(NR,{children:e.video3sCount}),(0,ub.jsx)(NR,{children:e.video15sCount}),(0,ub.jsxs)(NR,{children:["\xa5",RR(e.earnTotal)]})]},e.date)),(0,ub.jsxs)("tr",{style:{borderTop:"2px solid #cbd5e1",background:"#f1f5f9",fontWeight:900},children:[(0,ub.jsx)(NR,{children:"Total"}),(0,ub.jsx)(NR,{children:v.captureTotal}),(0,ub.jsx)(NR,{children:v.paidTotal}),(0,ub.jsx)(NR,{children:v.imageCount}),(0,ub.jsx)(NR,{children:v.video3sCount}),(0,ub.jsx)(NR,{children:v.video15sCount}),(0,ub.jsxs)(NR,{children:["\xa5",RR(v.earnTotal)]})]})]})]})})]})]})}function DR(e){let{label:t,value:n}=e;return(0,ub.jsxs)("div",{style:{minWidth:170,padding:12,border:"1px solid #e5e7eb",borderRadius:12,background:"#fff"},children:[(0,ub.jsx)("div",{style:{fontSize:12,color:"#64748b"},children:t}),(0,ub.jsx)("div",{style:{fontSize:18,fontWeight:900},children:n})]})}function OR(e){let{children:t}=e;return(0,ub.jsx)("th",{style:{textAlign:"left",padding:12,fontSize:12,color:"#475569",whiteSpace:"nowrap"},children:t})}function NR(e){let{children:t}=e;return(0,ub.jsx)("td",{style:{padding:12,whiteSpace:"nowrap"},children:t})}xR.displayName="QRCodeCanvas",r.forwardRef(function(e,t){const n=e,{value:s,size:i=gR,level:a=mR,bgColor:o=vR,fgColor:l=yR,includeMargin:c=bR,minVersion:u=ER,boostLevel:d,title:h,marginSize:f,imageSettings:p}=n,g=hR(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:m,cells:v,numCells:y,calculatedImageSettings:b}=TR({value:s,level:a,minVersion:u,boostLevel:d,includeMargin:c,marginSize:f,imageSettings:p,size:i});let E=v,w=null;null!=p&&null!=b&&(null!=b.excavation&&(E=SR(v,b.excavation)),w=r.createElement("image",{href:p.src,height:b.h,width:b.w,x:b.x+m,y:b.y+m,preserveAspectRatio:"none",opacity:b.opacity,crossOrigin:b.crossOrigin}));const S=wR(E,m);return r.createElement("svg",dR({height:i,width:i,viewBox:"0 0 ".concat(y," ").concat(y),ref:t,role:"img"},g),!!h&&r.createElement("title",null,h),r.createElement("path",{fill:o,d:"M0,0 h".concat(y,"v").concat(y,"H0z"),shapeRendering:"crispEdges"}),r.createElement("path",{fill:l,d:S,shapeRendering:"crispEdges"}),w)}).displayName="QRCodeSVG";const MR=function(){const{user:e,clientId:t}=hb(),[n,s]=(0,r.useState)(!1),[i,a]=(0,r.useState)(!1),[o,l]=(0,r.useState)("dashboard"),[c,u]=(0,r.useState)([]),[h,f]=(0,r.useState)(!1),[p,g]=(0,r.useState)(null),[m,v]=(0,r.useState)(!1),[y,b]=(0,r.useState)(null),[E,w]=(0,r.useState)(!1),[S,T]=(0,r.useState)(null),k="price_1SeoLmFiGpyZE87M9ZOX2uoC",[x,I]=(0,r.useState)(()=>yL.now().setZone("Asia/Tokyo").toFormat("yyyy-LL-dd"));(0,r.useEffect)(()=>{const e=setInterval(()=>{I(yL.now().setZone("Asia/Tokyo").toFormat("yyyy-LL-dd"))},6e4);return()=>clearInterval(e)},[]);const L=(0,r.useCallback)(e=>{var t,n;const r=null===e||void 0===e||null===(t=e.dailyCaptures)||void 0===t?void 0:t[x],s=null===e||void 0===e?void 0:e["dailyCaptures.".concat(x)],i=Number(null!==(n=null!==r&&void 0!==r?r:s)&&void 0!==n?n:0);return Number.isFinite(i)?i:0},[x]);(0,r.useCallback)(e=>"active"!==(null===e||void 0===e?void 0:e.paymentStatus)?"Payment Issue":(null===e||void 0===e?void 0:e.status)||"Inactive",[]),(0,r.useCallback)(e=>{if("active"!==(null===e||void 0===e?void 0:e.paymentStatus))return"bg-red-100 text-red-700";switch(null===e||void 0===e?void 0:e.status){case"Active":return"bg-green-100 text-green-700";case"Offline":return"bg-gray-100 text-gray-700";case"Maintenance":return"bg-yellow-100 text-yellow-700";default:return"bg-slate-200 text-slate-600"}},[]),(0,r.useEffect)(()=>{if(!e||!t)return;const n=Fv(Sm(lb,"clients",t,"cameras"),e=>{const t=e.docs.map(e=>d({id:e.id},e.data()));u(t)},e=>console.error("Camera snapshot error:",e));return()=>n()},[e,t]);const C=(0,r.useMemo)(()=>c.map(e=>{var t,n;return d(d({},e),{},{todayCaptures:L(e),totalCaptures:Number(null!==(t=null===e||void 0===e?void 0:e.totalCaptures)&&void 0!==t?t:0)||0,paidCaptures:Number(null!==(n=null===e||void 0===e?void 0:e.paidCaptures)&&void 0!==n?n:0)||0})}),[c,L]),_=(0,r.useMemo)(()=>{const e=C.length,t=C.reduce((e,t)=>e+(Number(null===t||void 0===t?void 0:t.todayCaptures)||0),0),n=C.reduce((e,t)=>{var n;const r=Number(null!==(n=null===t||void 0===t?void 0:t.totalRevenueYen)&&void 0!==n?n:0);return e+(Number.isFinite(r)?r:0)},0);return{totalCameras:e,totalCapturesToday:t,totalRevenue:n}},[C]),A=n?"min-h-screen bg-slate-950 text-slate-100":"min-h-screen bg-slate-100 text-slate-900";return(0,ub.jsxs)("div",{className:A,children:[(0,ub.jsxs)("div",{className:"flex min-h-screen",children:[(0,ub.jsx)(wL,{collapsed:i,activeMenu:o,onChangeMenu:l,isDark:n}),(0,ub.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,ub.jsx)(SL,{isDark:n,setIsDark:s,sidebarCollapsed:i,setSidebarCollapsed:a}),(0,ub.jsxs)("main",{className:"flex-1 px-4 sm:px-6 py-6 overflow-y-auto",children:["dashboard"===o&&(0,ub.jsxs)(ub.Fragment,{children:[(0,ub.jsx)(TL,{stats:_}),(0,ub.jsx)("div",{className:"mt-6 flex flex-col lg:flex-row gap-4",children:(0,ub.jsx)("div",{className:"flex-1",children:(0,ub.jsx)(BA,{cameras:C})})})]}),"cameras"===o&&(0,ub.jsx)(xL,{cameras:C,onOpenAdd:()=>{g(null),f(!0)},onOpenEdit:e=>{g(e),f(!0)},onOpenView:e=>{b(e),v(!0)},onRequestDelete:e=>{T(e),w(!0)},canEdit:e=>"active"===(null===e||void 0===e?void 0:e.paymentStatus),compact:!1}),"camera-status"===o&&(0,ub.jsx)(WA,{}),"frames"===o&&(0,ub.jsx)(sR,{}),"qr"===o&&(0,ub.jsx)(LR,{}),"settings"===o&&(0,ub.jsx)(CR,{isDark:n}),"report"===o&&(0,ub.jsx)(PR,{})]})]})]}),h&&(0,ub.jsx)(VA,{editing:p,onClose:()=>f(!1),onSubmit:p?async e=>{if(t&&p)if("active"===(null===p||void 0===p?void 0:p.paymentStatus))try{const n=Tm(lb,"clients",t,"cameras",p.id);await Ov(n,e),g(null),f(!1)}catch(n){console.error("Update failed:",n),alert("Update failed")}else alert("Payment not active. Please activate the subscription first.\n\u304a\u652f\u6255\u3044\u72b6\u614b\u304c\u30a2\u30af\u30c6\u30a3\u30d6\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002")}:async e=>{if(t)try{await Mv(Sm(lb,"clients",t,"cameras"),d(d({},e),{},{priceId:k,paymentStatus:"inactive",subscriptionId:null,customerId:null,cancelAtPeriodEnd:!1,status:"Inactive",todayCaptures:0,paidCaptures:0,canceledCaptures:0,totalCaptures:0,totalRevenueYen:0,lastCaptureAt:null,createdAt:iv()})),f(!1)}catch(n){console.error("Add camera failed:",n),alert("Failed to add camera")}}}),m&&y&&(0,ub.jsx)(GA,{camera:y,onClose:()=>v(!1)}),E&&S&&(0,ub.jsx)(HA,{camera:S,onCancel:()=>w(!1),onConfirm:async()=>{if(t&&S)try{const e=Tm(lb,"clients",t,"cameras",S.id);await Nv(e),T(null),w(!1)}catch(e){console.error("Delete failed:",e),alert("Delete failed")}}})]})};function FR(){const{t:e}=Bb(),t=xe(),n=new URLSearchParams(window.location.search).get("oobCode"),[s,i]=(0,r.useState)(!1),[a,o]=(0,r.useState)(!0),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[m,v]=(0,r.useState)("");return(0,r.useEffect)(()=>{!async function(){try{const e=await ia(ob,n);c(e),i(!0)}catch(t){g(e("invalidLink"))}o(!1)}()},[n]),a?(0,ub.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,ub.jsx)("div",{className:"text-gray-600",children:e("checking")})}):s?(0,ub.jsxs)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center px-4 relative",children:[(0,ub.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 w-full max-w-sm",children:[(0,ub.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:e("resetTitle")}),p&&(0,ub.jsx)("div",{className:"bg-red-50 border border-red-300 text-red-700 p-3 rounded mb-4 text-sm",children:p}),(0,ub.jsxs)("form",{onSubmit:async function(r){if(r.preventDefault(),u===h)try{await async function(e,t,n){await Li(bn(e),{oobCode:t,newPassword:n}).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&sa(e),t})}(ob,n,u),v(e("passwordUpdated")),setTimeout(async()=>{try{const e=pv(Sm(lb,"users"),mv("email","==",l)),n=await Pv(e);if(n.empty)t("/login");else{const e=n.docs[0].data().clientId;t("/".concat(e,"/login"))}}catch(e){t("/login")}},1500)}catch(s){g(s.message)}else g(e("passwordNotMatch"))},children:[(0,ub.jsx)("label",{className:"block text-sm font-medium mb-1",children:e("newPassword")}),(0,ub.jsx)("input",{type:"password",value:u,onChange:e=>d(e.target.value),className:"border rounded w-full p-2 mb-4",required:!0}),(0,ub.jsx)("label",{className:"block text-sm font-medium mb-1",children:e("confirmPassword")}),(0,ub.jsx)("input",{type:"password",value:h,onChange:e=>f(e.target.value),className:"border rounded w-full p-2 mb-6",required:!0}),(0,ub.jsx)("button",{className:"w-full py-2 rounded font-semibold bg-blue-600 text-white hover:bg-blue-700",children:e("savePassword")})]})]}),m&&(0,ub.jsx)("div",{className:"absolute top-4 right-4 bg-green-600 text-white py-2 px-4 rounded shadow-lg animate-fadeIn",children:m})]}):(0,ub.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,ub.jsx)("div",{className:"text-red-600",children:p})})}function UR(){const e=Se().search;return(0,ub.jsx)(We,{to:"/reset-password".concat(e),replace:!0})}const jR=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},BR=Number.isSafeInteger||function(e){return"number"===typeof e&&Math.abs(e)<=VR},VR=Number.MAX_SAFE_INTEGER||9007199254740991;let zR=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),GR=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),HR=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var KR="manifest",WR="level",qR="audioTrack",YR="subtitleTrack",QR="main",XR="audio",ZR="subtitle";class JR{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class $R{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new JR(e),this.fast_=new JR(t),this.defaultTTFB_=r,this.ttfb_=new JR(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new JR(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new JR(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new JR(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){const n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function eP(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tP(){return tP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},tP.apply(null,arguments)}function nP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nP(Object(n),!0).forEach(function(t){eP(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nP(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class sP{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n="[".concat(e,"]:");this.trace=iP,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const iP=function(){},aP={trace:iP,debug:iP,log:iP,warn:iP,info:iP,error:iP};function oP(){return tP({},aP)}function lP(e,t,n){return t[e]?t[e].bind(t):function(e,t){const n=self.console[e];return n?n.bind(self.console,"".concat(t?"["+t+"] ":"","[").concat(e,"] >")):iP}(e,n)}const cP=oP();const uP=cP;function dP(){if("undefined"===typeof self)return;return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function hP(e,t){const n=Object.keys(e),r=Object.keys(t),s=n.length,i=r.length;return!s||!i||s===i&&!n.some(e=>-1===r.indexOf(e))}function fP(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("undefined"!==typeof TextDecoder){const n=new TextDecoder("utf-8").decode(e);if(t){const e=n.indexOf("\0");return-1!==e?n.substring(0,e):n}return n.replace(/\0/g,"")}const n=e.length;let r,s,i,a="",o=0;for(;o<n;){if(r=e[o++],0===r&&t)return a;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:s=e[o++],a+=String.fromCharCode((31&r)<<6|63&s);break;case 14:s=e[o++],i=e[o++],a+=String.fromCharCode((15&r)<<12|(63&s)<<6|63&i)}}return a}function pP(e){let t="";for(let n=0;n<e.length;n++){let r=e[n].toString(16);r.length<2&&(r="0"+r),t+=r}return t}function gP(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function mP(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var vP,yP={exports:{}};var bP=function(){return vP||(vP=1,e=yP,function(){var t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,i={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var s=i.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");return s.path=i.normalizePath(s.path),i.buildURLFromParts(s)}var a=i.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=i.normalizePath(a.path),i.buildURLFromParts(a)):t;var o=i.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=n.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var c={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var u=o.path,d=u.substring(0,u.lastIndexOf("/")+1)+a.path;c.path=i.normalizePath(d)}else c.path=o.path,a.params||(c.params=o.params,a.query||(c.query=o.query));return null===c.path&&(c.path=r.alwaysNormalize?i.normalizePath(a.path):a.path),i.buildURLFromParts(c)},parseURL:function(e){var n=t.exec(e);return n?{scheme:n[1]||"",netLoc:n[2]||"",path:n[3]||"",params:n[4]||"",query:n[5]||"",fragment:n[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=i}()),yP.exports;var e}();class EP{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var wP="audio",SP="video",TP="audiovideo";class kP{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"===typeof e&&(e={url:e}),this.base=e,function(e,t){const n=CP(e,t);n&&(n.enumerable=!0,Object.defineProperty(e,t,n))}(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;r=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[wP]:null,[SP]:null,[TP]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new EP),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=bP.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[wP]=null,e[SP]=null,e[TP]=null}}function xP(e){return"initSegment"!==e.sn}class IP extends kP{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(jR(e)&&jR(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(null==(e=this._decryptdata)||!e.keyId){const e=Object.keys(t);if(1===e.length){const n=this._decryptdata=t[e[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=jR(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t;const e=Object.keys(this.levelkeys),n=e.length;if(n>1||1===n&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){jR(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return xP(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const r=t[e];!r||null!=(n=this._decryptdata)&&n.keyId||(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,n,r,s){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,s)):a[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:s,partial:i}}}class LP extends kP{constructor(e,t,n,r,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const i=e.enumeratedString("BYTERANGE");i&&this.setByteRange(i,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function CP(e,t){const n=Object.getPrototypeOf(e);if(n){const e=Object.getOwnPropertyDescriptor(n,t);return e||CP(n,t)}}const _P=Math.pow(2,32)-1,AP=[].push,RP={video:1,audio:2,id3:3,text:4};function PP(e){return String.fromCharCode.apply(null,e)}function DP(e,t){const n=e[t]<<8|e[t+1];return n<0?65536+n:n}function OP(e,t){const n=MP(e,t);return n<0?4294967296+n:n}function NP(e,t){let n=OP(e,t);return n*=Math.pow(2,32),n+=OP(e,t+4),n}function MP(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function FP(e,t){const n=[];if(!t.length)return n;const r=e.byteLength;for(let s=0;s<r;){const i=OP(e,s),a=i>1?s+i:r;if(PP(e.subarray(s+4,s+8))===t[0])if(1===t.length)n.push(e.subarray(s+8,a));else{const r=FP(e.subarray(s+8,a),t.slice(1));r.length&&AP.apply(n,r)}s=a}return n}function UP(e){const t=[],n=e[0];let r=8;const s=OP(e,r);r+=4;let i=0,a=0;0===n?(i=OP(e,r),a=OP(e,r+4),r+=8):(i=NP(e,r),a=NP(e,r+8),r+=16),r+=2;let o=e.length+a;const l=DP(e,r);r+=2;for(let c=0;c<l;c++){let n=r;const i=OP(e,n);n+=4;const a=2147483647&i;if(1===(2147483648&i)>>>31)return uP.warn("SIDX has hierarchical references (not supported)"),null;const l=OP(e,n);n+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/s,start:o,end:o+a-1}}),o+=a,n+=4,r=n}return{earliestPresentationTime:i,timescale:s,version:n,referencesCount:l,references:t}}function jP(e){const t=[],n=FP(e,["moov","trak"]);for(let r=0;r<n.length;r++){const e=n[r],s=FP(e,["tkhd"])[0];if(s){let n=s[0];const r=OP(s,0===n?12:20),i=FP(e,["mdia","mdhd"])[0];if(i){n=i[0];const s=OP(i,0===n?12:20),a=FP(e,["mdia","hdlr"])[0];if(a){const n=PP(a.subarray(8,12)),i={soun:wP,vide:SP}[n],o=BP(FP(e,["mdia","minf","stbl","stsd"])[0]);i?(t[r]={timescale:s,type:i,stsd:o},t[i]=rP({timescale:s,id:r},o)):t[r]={timescale:s,type:n,stsd:o}}}}}return FP(e,["moov","mvex","trex"]).forEach(e=>{const n=OP(e,4),r=t[n];r&&(r.default={duration:OP(e,12),flags:OP(e,20)})}),t}function BP(e){const t=e.subarray(8),n=t.subarray(86),r=PP(t.subarray(4,8));let s,i=r;const a="enca"===r||"encv"===r;if(a){const e=FP(t,[r])[0];FP(e.subarray("enca"===r?28:78),["sinf"]).forEach(e=>{const t=FP(e,["schm"])[0];if(t){const n=PP(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=FP(e,["frma"])[0];t&&(i=PP(t))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const e=FP(n,["avcC"])[0];e&&e.length>3&&(i+="."+GP(e[1])+GP(e[2])+GP(e[3]),s=VP("avc1"===o?"dva1":"dvav",n));break}case"mp4a":{const e=FP(t,[r])[0],n=FP(e.subarray(28),["esds"])[0];if(n&&n.length>7){let e=4;if(3!==n[e++])break;e=zP(n,e),e+=2;const t=n[e++];if(128&t&&(e+=2),64&t&&(e+=n[e++]),4!==n[e++])break;e=zP(n,e);const r=n[e++];if(64!==r)break;if(i+="."+GP(r),e+=12,5!==n[e++])break;e=zP(n,e);const s=n[e++];let a=(248&s)>>3;31===a&&(a+=1+((7&s)<<3)+((224&n[e])>>5)),i+="."+a}break}case"hvc1":case"hev1":{const e=FP(n,["hvcC"])[0];if(e&&e.length>12){const t=e[1],n=["","A","B","C"][t>>6],r=31&t,s=OP(e,2),a=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);i+="."+n+r,i+="."+function(e){let t=0;for(let n=0;n<32;n++)t|=(e>>n&1)<<31-n;return t>>>0}(s).toString(16).toUpperCase(),i+="."+a+o;let c="";for(let e=l.length;e--;){const t=l[e];if(t||c){c="."+t.toString(16).toUpperCase()+c}}i+=c}s=VP("hev1"==o?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":i=VP(i,n)||i;break;case"vp09":{const e=FP(n,["vpcC"])[0];if(e&&e.length>6){const t=e[4],n=e[5],r=e[6]>>4&15;i+="."+HP(t)+"."+HP(n)+"."+HP(r)}break}case"av01":{const e=FP(n,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,r=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,c=2===t&&o?l?12:10:o?10:8,u=(16&e[2])>>4,d=(8&e[2])>>3,h=(4&e[2])>>2,f=3&e[2],p=1,g=1,m=1,v=0;i+="."+t+"."+HP(r)+a+"."+HP(c)+"."+u+"."+d+h+f+"."+HP(p)+"."+HP(g)+"."+HP(m)+"."+v,s=VP("dav1",n)}break}}return{codec:i,encrypted:a,supplemental:s}}function VP(e,t){const n=FP(t,["dvvC"]),r=n.length?n[0]:FP(t,["dvcC"])[0];if(r){const t=r[2]>>1&127,n=r[2]<<5&32|r[3]>>3&31;return e+"."+HP(t)+"."+HP(n)}}function zP(e,t){const n=t+5;for(;128&e[t++]&&t<n;);return t}function GP(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function HP(e){return(e<10?"0":"")+e}function KP(e,t){FP(e,["moov","trak"]).forEach(e=>{const n=FP(e,["mdia","minf","stbl","stsd"])[0];if(!n)return;const r=n.subarray(8);let s=FP(r,["enca"]);const i=s.length>0;i||(s=FP(r,["encv"])),s.forEach(e=>{FP(i?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{const n=WP(e);n&&t(n,i)})})})}function WP(e){const t=FP(e,["schm"])[0];if(t){const n=PP(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=FP(e,["schi","tenc"])[0];if(t)return t}}}function qP(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function YP(e,t){const n=[],r=t.samples,s=t.timescale,i=t.id;let a=!1;return FP(r,["moof"]).map(o=>{const l=o.byteOffset-8;FP(o,["traf"]).map(o=>{const c=FP(o,["tfdt"]).map(e=>{const t=e[0];let n=OP(e,4);return 1===t&&(n*=Math.pow(2,32),n+=OP(e,8)),n/s})[0];return void 0!==c&&(e=c),FP(o,["tfhd"]).map(c=>{const u=OP(c,4),d=16777215&OP(c,0);let h=0;const f=0!==(16&d);let p=0;const g=0!==(32&d);let m=8;u===i&&(0!==(1&d)&&(m+=8),0!==(2&d)&&(m+=4),0!==(8&d)&&(h=OP(c,m),m+=4),f&&(p=OP(c,m),m+=4),g&&(m+=4),"video"===t.type&&(a=QP(t.codec)),FP(o,["trun"]).map(i=>{const o=i[0],c=16777215&OP(i,0),u=0!==(1&c);let d=0;const f=0!==(4&c),g=0!==(256&c);let m=0;const v=0!==(512&c);let y=0;const b=0!==(1024&c),E=0!==(2048&c);let w=0;const S=OP(i,4);let T=8;u&&(d=OP(i,T),T+=4),f&&(T+=4);let k=d+l;for(let l=0;l<S;l++){if(g?(m=OP(i,T),T+=4):m=h,v?(y=OP(i,T),T+=4):y=p,b&&(T+=4),E&&(w=0===o?OP(i,T):MP(i,T),T+=4),t.type===SP){let t=0;for(;t<y;){const i=OP(r,k);if(k+=4,XP(a,r[k])){ZP(r.subarray(k,k+i),a?2:1,e+w/s,n)}k+=i,t+=i+4}}e+=m/s}}))})})}),n}function QP(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function XP(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function ZP(e,t,n,r){const s=JP(e);let i=0;i+=t;let a=0,o=0,l=0;for(;i<s.length;){a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(255===l);o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(255===l);const e=s.length-i;let t=i;if(o<e)i+=o;else if(o>e){uP.error("Malformed SEI payload. ".concat(o," is too small, only ").concat(e," bytes left to parse."));break}if(4===a){if(181===s[t++]){const e=DP(s,t);if(t+=2,49===e){const e=OP(s,t);if(t+=4,1195456820===e){const e=s[t++];if(3===e){const i=s[t++],o=64&i,l=o?2+3*(31&i):0,c=new Uint8Array(l);if(o){c[0]=i;for(let e=1;e<l;e++)c[e]=s[t++]}r.push({type:e,payloadType:a,pts:n,bytes:c})}}}}}else if(5===a&&o>16){const e=[];for(let n=0;n<16;n++){const r=s[t++].toString(16);e.push(1==r.length?"0"+r:r),3!==n&&5!==n&&7!==n&&9!==n||e.push("-")}const i=o-16,l=new Uint8Array(i);for(let n=0;n<i;n++)l[n]=s[t++];r.push({payloadType:a,pts:n,uuid:e.join(""),userData:fP(l),userDataBytes:l})}}}function JP(e){const t=e.byteLength,n=[];let r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;const s=t-n.length,i=new Uint8Array(s);let a=0;for(r=0;r<s;a++,r++)a===n[0]&&(a++,n.shift()),i[r]=e[a];return i}function $P(e,t,n){if(16!==e.byteLength)throw new RangeError("Invalid system id");let r,s,i;r=0,s=new Uint8Array,i=new Uint8Array;const a=new Uint8Array(4);return n.byteLength>0&&new DataView(a.buffer).setUint32(0,n.byteLength,!1),function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=n.length;let i=8,a=s;for(;a--;)i+=n[a].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=255&i,o.set(e,4),a=0,i=8;a<s;a++)o.set(n[a],i),i+=n[a].byteLength;return o}([112,115,115,104],new Uint8Array([0,0,0,0]),e,i,s,a,n)}function eD(e){const t=e.getUint32(0),n=e.byteOffset,r=e.byteLength;if(r<t)return{offset:n,size:r};if(1886614376!==e.getUint32(4))return{offset:n,size:t};const s=e.getUint32(8)>>>24;if(0!==s&&1!==s)return{offset:n,size:t};const i=e.buffer,a=pP(new Uint8Array(i,n+12,16));let o=null,l=null,c=0;if(0===s)c=28;else{const s=e.getUint32(28);if(!s||r<32+16*s)return{offset:n,size:t};o=[];for(let e=0;e<s;e++)o.push(new Uint8Array(i,n+32+16*e,16));c=32+16*s}if(!c)return{offset:n,size:t};const u=e.getUint32(c);return t-32<u?{offset:n,size:t}:(l=new Uint8Array(i,n+c+4,u),{version:s,systemId:a,kids:o,data:l,offset:n,size:t})}const tD=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),nD={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function rD(e,t){const n=nD[t];return!!n&&!!n[e.slice(0,4)]}function sD(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!e.split(",").some(e=>!iD(e,t,n))}function iD(e,t){var n;const r=dP(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);return null!=(n=null==r?void 0:r.isTypeSupported(aD(e,t)))&&n}function aD(e,t){return"".concat(t,"/mp4;codecs=").concat(e)}function oD(e){if(e){const t=e.substring(0,4);return nD.video[t]}return 2}function lD(e){const t=tD();return e.split(",").reduce((e,n)=>{const r=t&&QP(n)?9:nD.video[n];return r?(2*r+e)/(e?3:2):(nD.audio[n]+e)/(e?2:1)},0)}const cD={};const uD=/flac|opus|mp4a\.40\.34/i;function dD(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(uD,e=>function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(cD[e])return cD[e];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let s=0;s<n.length;s++){var r;if(iD(n[s],"audio",t))return cD[e]=n[s],n[s];if("mp3"===n[s]&&null!=(r=dP(t))&&r.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t))}function hD(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(fD(e,"audio")||fD(e,"video")))return e;if(t){const n=t.split(",");if(n.length>1){if(e)for(let t=n.length;t--;)if(n[t].substring(0,4)===e.substring(0,4))return n[t];return n[0]}}return t||e}function fD(e,t){return rD(e,t)&&iD(e,t)}function pD(e){if(e.startsWith("av01.")){const t=e.split("."),n=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=n[e-4];return t.join(".")}return e}function gD(e){const t=dP(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function mD(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const vD={supported:!1,smooth:!1,powerEfficient:!1},yD={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function bD(e,t){return{supported:!1,configurations:t,decodingInfoResults:[vD],error:e}}function ED(e,t,n,r,s,i){const a=e.videoCodec,o=e.audioCodec?e.audioGroups:null,l=null==i?void 0:i.audioCodec,c=null==i?void 0:i.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(null!=o&&o.length)try{d=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce((e,n)=>{if(n){const r=t.groups[n];if(!r)throw new Error("Audio track group ".concat(n," not found"));Object.keys(r.channels).forEach(t=>{e[t]=(e[t]||0)+r.channels[t]})}return e},{2:0})}catch(h){return!0}return void 0!==a&&(a.split(",").some(e=>QP(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(r,30)||"SDR"!==e.videoRange&&e.videoRange!==n||e.bitrate>Math.max(s,8e6))||!!d&&jR(u)&&Object.keys(d).some(e=>parseInt(e)>u)}function wD(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=e.videoCodec;if(!s&&!e.audioCodec||!n)return Promise.resolve(yD);const i=[],a=function(e){var t;const n=null==(t=e.videoCodec)?void 0:t.split(","),r=TD(e),s=e.width||640,i=e.height||480,a=e.frameRate||30,o=e.videoRange.toLowerCase();return n?n.map(e=>{const t={contentType:aD(pD(e),"video"),width:s,height:i,bitrate:r,framerate:a};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=a.length,l=function(e,t,n){var r;const s=null==(r=e.audioCodec)?void 0:r.split(","),i=TD(e);if(s&&e.audioGroups)return e.audioGroups.reduce((e,r)=>{var a;const o=r?null==(a=t.groups[r])?void 0:a.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===r){const r=parseFloat(t.channels||"");s.forEach(t=>{const s={contentType:aD(t,"audio"),bitrate:n?SD(t,i):i};r&&(s.channels=""+r),e.push(s)})}return e},e):e},[]);return[]}(e,t,o>0),c=l.length;for(let u=o||1*c||1;u--;){const e={type:"media-source"};if(o&&(e.video=a[u%o]),c){e.audio=l[u%c];const t=e.audio.bitrate;e.video&&t&&(e.video.bitrate-=t)}i.push(e)}if(s){const e=navigator.userAgent;if(s.split(",").some(e=>QP(e))&&tD())return Promise.resolve(bD(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(e,")")),i))}return Promise.all(i.map(e=>{const t=function(e){let t="";const{audio:n,video:r}=e;if(r){const e=mD(r.contentType);t+="".concat(e,"_r").concat(r.height,"x").concat(r.width,"f").concat(Math.ceil(r.framerate)).concat(r.transferFunction||"sd","_").concat(Math.ceil(r.bitrate/1e5))}if(n){const e=mD(n.contentType);t+="".concat(r?"_":"").concat(e,"_c").concat(n.channels)}return t}(e);return r[t]||(r[t]=n.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:i,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:i,decodingInfoResults:[],error:e}))}function SD(e,t){if(t<=1)return 1;let n=128e3;return"ec-3"===e?n=768e3:"ac-3"===e&&(n=64e4),Math.min(t/2,n)}function TD(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}const kD=["NONE","TYPE-0","TYPE-1",null];const xD=["SDR","PQ","HLG"];var ID="",LD="YES",CD="v2";function _D(e){const{canSkipUntil:t,canSkipDateRanges:n,age:r}=e;return t&&r<t/2?n?CD:LD:ID}class AD{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class RD{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=null==(t=e.supplemental)?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=",".concat(n.substring(0,4)))}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return PD(this._audioGroups,e)}hasSubtitleGroup(e){return PD(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function PD(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function DD(e,t){let n=!1,r=[];if(e&&(n="SDR"!==e,r=[e]),t){r=t.allowedVideoRanges||xD.slice(0);const e="SDR"!==r.join("")&&!t.videoCodec;n=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"===typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),n||(r=["SDR"])}return{preferHDR:n,allowedVideoRanges:r}}const OD=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(n,r)=>{if(e&&(r=e(n,r)),"object"===typeof r&&null!==r){if(t.has(r))return;t.add(r)}return r}})(t));function ND(e,t){uP.log('[abr] start candidates with "'.concat(e,'" ignored because ').concat(t))}function MD(e){return e.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function FD(e){if(!e)return e;const{lang:t,assocLang:n,characteristics:r,channels:s,audioCodec:i}=e;return{lang:t,assocLang:n,characteristics:r,channels:s,audioCodec:i}}function UD(e,t,n){if("attrs"in e){const n=t.indexOf(e);if(-1!==n)return n}for(let r=0;r<t.length;r++){if(jD(e,t[r],n))return r}return-1}function jD(e,t,n){const{groupId:r,name:s,lang:i,assocLang:a,default:o}=e,l=e.forced;return(void 0===r||t.groupId===r)&&(void 0===s||t.name===s)&&(void 0===i||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--";if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(i,t.lang))&&(void 0===i||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split(","),r=t.split(",");return n.length===r.length&&!n.some(e=>-1===r.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===n||n(e,t))}function BD(e,t){const{audioCodec:n,channels:r}=e;return(void 0===n||(t.audioCodec||"").substring(0,4)===n.substring(0,4))&&(void 0===r||r===(t.channels||"2"))}function VD(e,t,n){for(let r=t;r>-1;r--)if(n(e[r]))return r;for(let r=t+1;r<e.length;r++)if(n(e[r]))return r;return-1}function zD(e,t){var n;return!!e&&e!==(null==(n=t.loadLevelObj)?void 0:n.uri)}const GD=function(e,t){let n=0,r=e.length-1,s=null,i=null;for(;n<=r;){s=(n+r)/2|0,i=e[s];const a=t(i);if(a>0)n=s+1;else{if(!(a<0))return i;r=s-1}}return null};function HD(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,i=null;if(e){i=t[1+e.sn-t[0].sn]||null;const r=e.endDTS-n;r>0&&r<15e-7&&(n+=15e-7),i&&e.level!==i.level&&i.end<=e.end&&(i=t[2+e.sn-t[0].sn]||null)}else 0===n&&0===t[0].start&&(i=t[0]);if(i&&((!e||e.level===i.level)&&0===KD(n,r,i)||function(e,t,n){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const r=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),n);return e.start<=r}return!1}(i,e,Math.min(s,r))))return i;const a=GD(t,KD.bind(null,n,r));return!a||a===e&&i?i:a}function KD(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(n.start<=e&&n.start+n.duration>e)return 0;const r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function WD(e,t,n){const r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}function qD(e,t,n){if(e&&e.startCC<=t&&e.endCC>=t){let r=e.fragments;const{fragmentHint:s}=e;let i;return s&&(r=r.concat(s)),GD(r,e=>e.cc<t?1:e.cc>t?-1:(i=e,e.end<=n?1:e.start>n?-1:0)),i||null}return null}function YD(e){switch(e.details){case GR.FRAG_LOAD_TIMEOUT:case GR.KEY_LOAD_TIMEOUT:case GR.LEVEL_LOAD_TIMEOUT:case GR.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function QD(e){return e.details.startsWith("key")}function XD(e){return QD(e)&&!!e.frag&&!e.frag.decryptdata}function ZD(e,t){const n=YD(t);return e.default["".concat(n?"timeout":"error","Retry")]}function JD(e,t){const n="linear"===e.backoff?1:Math.pow(2,t);return Math.min(n*e.retryDelayMs,e.maxRetryDelayMs)}function $D(e){return rP(rP({},e),{errorRetry:null,timeoutRetry:null})}function eO(e,t,n,r){if(!e)return!1;const s=null==r?void 0:r.code,i=t<e.maxNumRetry&&(function(e){return tO(e)||!!e&&(e<400||e>499)}(s)||!!n);return e.shouldRetry?e.shouldRetry(e,t,n,r,i):i}function tO(e){return 0===e&&!1===navigator.onLine}var nO=0,rO=2,sO=3,iO=5,aO=0,oO=1,lO=2,cO=4;function uO(e){const t={action:nO,flags:aO};return e&&(t.resolved=!0),t}var dO="NOT_LOADED",hO="APPENDING",fO="PARTIAL",pO="OK";class gO{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.BUFFER_APPENDED,this.onBufferAppended,this),e.on(HR.FRAG_BUFFERED,this.onFragBuffered,this),e.on(HR.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.BUFFER_APPENDED,this.onBufferAppended,this),e.off(HR.FRAG_BUFFERED,this.onFragBuffered,this),e.off(HR.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let r=n.length;r--;){const t=n[r];if(!t)break;if(t.start<=e&&e<=t.end&&t.loaded)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,s=Object.keys(r);for(let i=s.length;i--;){const a=r[s[i]];if((null==a?void 0:a.body.type)===t&&(!n||a.buffered)){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,n,r,s){this.timeRanges&&(this.timeRanges[e]=t);const i=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(r=>{const a=this.fragments[r];if(!a)return;if(i>=a.body.sn)return;if(!a.buffered&&(!a.loaded||s))return void(a.body.type===n&&this.removeFragment(a.body));const o=a.range[e];o&&(0!==o.time.length?o.time.some(e=>{const n=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&this.removeFragment(a.body),n}):this.removeFragment(a.body))})}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const n=e.frag,r=vO(n),s=this.fragments[r];if(!s||s.buffered&&n.gap)return;const i=!n.relurl;Object.keys(t).forEach(r=>{const a=n.elementaryStreams[r];if(!a)return;const o=t[r],l=i||!0===a.partial;s.range[r]=this.getBufferedTimes(n,e.part,l,o)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,n),mO(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0;(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=yO(n,t=>t.fragment.sn>=e))}fragBuffered(e,t){const n=vO(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,n,r){const s={time:[],partial:n},i=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||i;for(let c=0;c<r.length;c++){const e=r.start(c)-this.bufferPadding,t=r.end(c)+this.bufferPadding;if(l>=e&&o<=t){s.time.push({startPTS:Math.max(i,r.start(c)),endPTS:Math.min(a,r.end(c))});break}if(i<t&&a>e){const e=Math.max(i,r.start(c)),t=Math.min(a,r.end(c));t>e&&(s.partial=!0,s.time.push({startPTS:e,endPTS:t}))}else if(a<=e)break}return s}getPartialFragment(e){let t,n,r,s=null,i=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const c=o[l];c&&mO(c)&&(n=c.body.start-a,r=c.body.end+a,e>=n&&e<=r&&(t=Math.min(e-n,r-e),i<=t&&(s=c.body,i=t)))}),s}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||mO(t))}getState(e){const t=vO(e),n=this.fragments[t];return n?n.buffered?mO(n)?fO:pO:hO:dO}isTimeBuffered(e,t,n){let r,s;for(let i=0;i<n.length;i++){if(r=n.start(i)-this.bufferPadding,s=n.end(i)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,s=vO(n);this.fragments[s]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:s,type:i}=t;if("initSegment"===n.sn)return;const a=n.type;if(r){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(r)}this.timeRanges=s;const o=s[i];this.detectEvictedFragments(i,o,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=vO(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const s=t[n[r]];if((null==s?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,n,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(i=>{const a=this.fragments[i];if(!a)return;const o=a.body;o.type!==n||r&&!o.gap||o.start<t&&o.end>e&&(a.buffered||s)&&this.removeFragment(o)})}removeFragment(e){const t=vO(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const t=e.sn;this.activePartLists[e.type]=yO(n,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function mO(e){var t,n,r;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(n=e.range.audio)&&n.partial||null!=(r=e.range.audiovideo)&&r.partial)}function vO(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.sn)}function yO(e,t){return e.filter(e=>{const n=t(e);return n||e.clearElementaryStreamInfo(),n})}var bO=0,EO=1;class wO{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case bO:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case EO:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error("[AESCrypto] invalid aes mode ".concat(this.aesMode))}}}class SO{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=t.getUint32(4*r);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],s=n[1],i=n[2],a=n[3],o=this.invSubMix,l=o[0],c=o[1],u=o[2],d=o[3],h=new Uint32Array(256);let f=0,p=0,g=0;for(g=0;g<256;g++)h[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let n=p^p<<1^p<<2^p<<3^p<<4;n=n>>>8^255&n^99,e[f]=n,t[n]=f;const o=h[f],g=h[o],m=h[g];let v=257*h[n]^16843008*n;r[f]=v<<24|v>>>8,s[f]=v<<16|v>>>16,i[f]=v<<8|v>>>24,a[f]=v,v=16843009*m^65537*g^257*o^16843008*f,l[n]=v<<24|v>>>8,c[n]=v<<16|v>>>16,u[n]=v<<8|v>>>24,d[n]=v,f?(f=o^h[h[h[m^o]]],p^=h[h[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const s=this.keySize=t.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);const i=this.ksRows=4*(s+6+1);let a,o;const l=this.keySchedule=new Uint32Array(i),c=this.invKeySchedule=new Uint32Array(i),u=this.sBox,d=this.rcon,h=this.invSubMix,f=h[0],p=h[1],g=h[2],m=h[3];let v,y;for(a=0;a<i;a++)a<s?v=l[a]=t[a]:(y=v,a%s===0?(y=y<<8|y>>>24,y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y],y^=d[a/s|0]<<24):s>6&&a%s===4&&(y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y]),l[a]=v=(l[a-s]^y)>>>0);for(o=0;o<i;o++)a=i-o,y=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?y:f[u[y>>>24]]^p[u[y>>>16&255]]^g[u[y>>>8&255]]^m[u[255&y]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,s=this.invKeySchedule,i=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],u=a[3],d=this.uint8ArrayToUint32Array_(n);let h=d[0],f=d[1],p=d[2],g=d[3];const m=new Int32Array(e),v=new Int32Array(m.length);let y,b,E,w,S,T,k,x,I,L,C,_,A,R;const P=this.networkToHostOrderSwap;for(;t<m.length;){for(I=P(m[t]),L=P(m[t+1]),C=P(m[t+2]),_=P(m[t+3]),S=I^s[0],T=_^s[1],k=C^s[2],x=L^s[3],A=4,R=1;R<r;R++)y=o[S>>>24]^l[T>>16&255]^c[k>>8&255]^u[255&x]^s[A],b=o[T>>>24]^l[k>>16&255]^c[x>>8&255]^u[255&S]^s[A+1],E=o[k>>>24]^l[x>>16&255]^c[S>>8&255]^u[255&T]^s[A+2],w=o[x>>>24]^l[S>>16&255]^c[T>>8&255]^u[255&k]^s[A+3],S=y,T=b,k=E,x=w,A+=4;y=i[S>>>24]<<24^i[T>>16&255]<<16^i[k>>8&255]<<8^i[255&x]^s[A],b=i[T>>>24]<<24^i[k>>16&255]<<16^i[x>>8&255]<<8^i[255&S]^s[A+1],E=i[k>>>24]<<24^i[x>>16&255]<<16^i[S>>8&255]<<8^i[255&T]^s[A+2],w=i[x>>>24]<<24^i[S>>16&255]<<16^i[T>>8&255]<<8^i[255&k]^s[A+3],v[t]=P(y^h),v[t+1]=P(w^f),v[t+2]=P(E^p),v[t+3]=P(b^g),h=I,f=L,p=C,g=_,t+=4}return v.buffer}}class TO{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=function(e){switch(e){case bO:return"AES-CBC";case EO:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode ".concat(e))}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class kO{constructor(e){let{removePKCS7Padding:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(_w){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?e.slice(0,t-n):e}(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((s,i)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,r);const o=this.flush();o?s(o.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:s,currentResult:i,remainderData:a}=this;if(r!==bO||16!==t.byteLength)return uP.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=qP(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;s&&(n=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new SO),l.expandKey(t);const c=i;return this.currentResult=l.decrypt(o.buffer,0,n),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new TO(this.subtle,t,r)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new wO(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,t)}).catch(s=>(uP.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(s.name,": ").concat(s.message)),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const s=this.flush();if(s)return s.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%16;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(uP.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}const xO=Math.pow(2,17);class IO{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new _O({type:zR.NETWORK_ERROR,details:GR.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a ".concat(n?"part list":"url")),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,i=r.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void o(CO(e));e.gap=!1}const l=this.loader=s?new s(r):new i(r),c=LO(e);e.loader=l;const u=$D(r.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:xO};e.stats=l.stats;const h={onSuccess:(t,n,r,s)=>{this.resetLoader(e,l);let i=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(i.slice(0,16)),i=i.slice(16)),a({frag:e,part:null,payload:i,networkDetails:s})},onError:(t,r,s,i)=>{this.resetLoader(e,l),o(new _O({type:zR.NETWORK_ERROR,details:GR.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:rP({url:n,data:void 0},t),error:new Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:s,stats:i}))},onAbort:(t,n,r)=>{this.resetLoader(e,l),o(new _O({type:zR.NETWORK_ERROR,details:GR.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:(t,n,r)=>{this.resetLoader(e,l),o(new _O({type:zR.NETWORK_ERROR,details:GR.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:r,stats:t}))}};t&&(h.onProgress=(n,r,s,i)=>t({frag:e,part:null,payload:s,networkDetails:i})),l.load(c,d,h)})}loadPart(e,t,n){this.abort();const r=this.config,s=r.fLoader,i=r.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(CO(e,t));const l=this.loader=s?new s(r):new i(r),c=LO(e,t);e.loader=l;const u=$D(r.fragLoadPolicy.default),d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:xO};t.stats=l.stats,l.load(c,d,{onSuccess:(r,s,i,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:r.data,networkDetails:o};n(c),a(c)},onError:(n,r,s,i)=>{this.resetLoader(e,l),o(new _O({type:zR.NETWORK_ERROR,details:GR.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:rP({url:c.url,data:void 0},n),error:new Error("HTTP Error ".concat(n.code," ").concat(n.text)),networkDetails:s,stats:i}))},onAbort:(n,r,s)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new _O({type:zR.NETWORK_ERROR,details:GR.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:s,stats:n}))},onTimeout:(n,r,s)=>{this.resetLoader(e,l),o(new _O({type:zR.NETWORK_ERROR,details:GR.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after ".concat(d.timeout,"ms")),networkDetails:s,stats:n}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,s=r.total;if(n.loaded+=r.loaded,s){const r=Math.round(e.duration/t.duration),i=Math.min(Math.round(n.loaded/s),r),a=(r-i)*Math.round(n.loaded/i);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);const i=n.loading,a=r.loading;i.start?i.first+=a.first-a.start:(i.start=a.start,i.first=a.first),i.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function LO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},s=n.byteRangeStartOffset,i=n.byteRangeEndOffset;if(jR(s)&&jR(i)){var a;let t=s,n=i;if("initSegment"===e.sn&&("AES-128"===(o=null==(a=e.decryptdata)?void 0:a.method)||"AES-256"===o)){const e=i-s;e%16&&(n=i+(16-e%16)),0!==s&&(r.resetIV=!0,t=s-16)}r.rangeStart=t,r.rangeEnd=n}var o;return r}function CO(e,t){const n=new Error("GAP ".concat(e.gap?"tag":"attribute"," found")),r={type:zR.MEDIA_ERROR,details:GR.FRAG_GAP,fatal:!1,frag:e,error:n,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new _O(r)}class _O extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class AO extends sP{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class RO{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=s,this.partial=i}}const PO={length:0,start:()=>0,end:()=>0};class DO{static isBuffered(e,t){if(e){const n=DO.getBuffered(e);for(let e=n.length;e--;)if(t>=n.start(e)&&t<=n.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=DO.getBuffered(e);return DO.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=DO.bufferedRanges(e);if(r.length)return DO.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let r=-1,s=[];if(n)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(r=c);const i=s.length;if(i){const t=s[i-1].end;e[c].start-t<n?e[c].end>t&&(s[i-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let i,a=0,o=t,l=t;for(let c=0;c<s.length;c++){const e=s[c].start,u=s[c].end;if(-1===r&&t>=e&&t<=u&&(r=c),t+n>=e&&t<u)o=e,l=u,a=l-t;else if(t+n<e){i=e;break}}return{len:a,start:o||0,end:l||0,nextStart:i,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||PO}catch(_w){return uP.log("failed to get media.buffered",_w),PO}}}const OO=/\{\$([a-zA-Z0-9-_]+)\}/g;function NO(e){return OO.test(e)}function MO(e,t){if(null!==e.variableList||e.hasVariableRefs){const n=e.variableList;return t.replace(OO,t=>{const r=t.substring(2,t.length-1),s=null==n?void 0:n[r];return void 0===s?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(r,'"'))),t):s})}return t}function FO(e,t,n){let r,s,i=e.variableList;if(i||(e.variableList=i={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{const e=new self.URL(n).searchParams;if(!e.has(r))throw new Error('"'.concat(r,'" does not match any query parameter in URI: "').concat(n,'"'));s=e.get(r)}catch(a){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(a.message)))}}else r=t.NAME,s=t.VALUE;r in i?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(r,'"'))):i[r]=s||""}function UO(e,t,n){const r=t.IMPORT;if(n&&r in n){let t=e.variableList;t||(e.variableList=t={}),t[r]=n[r]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(r,'"')))}const jO=/^(\d+)x(\d+)$/,BO=/(.+?)=(".*?"|.*?)(?:,|$)/g;class VO{constructor(e,t){"string"===typeof e&&(e=VO.parseAttrList(e,t)),tP(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const n=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)n[e]=parseInt(t.slice(2*e,2*e+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=jO.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={};for(BO.lastIndex=0;null!==(n=BO.exec(e));){const s=n[1].trim();let i=n[2];const a=0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1;let o=!1;if(a)i=i.slice(1,-1);else switch(s){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(a||o))i=MO(t,i);else if(!o&&!a)switch(s){case"CLOSED-CAPTIONS":if("NONE"===i)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":uP.warn("".concat(e,": attribute ").concat(s," is missing quotes"))}r[s]=i}return r}}function zO(e){return"ID"!==e&&"CLASS"!==e&&"CUE"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function GO(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class HO{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(r=null==t?void 0:t.tagOrder)?r:n,t){const n=t.attr;for(const t in n)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==n[t]){uP.warn('DATERANGE tag attribute: "'.concat(t,'" does not match for tags with ID: "').concat(e.ID,'"')),this._badValueForSameId=t;break}e=tP(new VO({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);jR(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(uP.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id,'": ').concat(e)),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(jR(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&jR(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class KO{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return!!this.fragments.length&&jR(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function WO(e,t){return e.length===t.length&&!e.some((e,n)=>e!==t[n])}function qO(e,t){return!e&&!t||!(!e||!t)&&WO(e,t)}function YO(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function QO(e){switch(e){case"AES-128":case"AES-256":return bO;case"AES-256-CTR":return EO;default:throw new Error("invalid full segment method ".concat(e))}}function XO(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function ZO(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function JO(e){const t=function(e,t,n){const r=e[t];e[t]=e[n],e[n]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function $O(e){const t=e.split(":");let n=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),r=e[e.length-1].split(",");if(2===r.length){const t="base64"===r[0],s=r[1];t?(e.splice(-1,1),n=XO(s)):n=function(e){const t=ZO(e).subarray(0,16),n=new Uint8Array(16);return n.set(t,16-t.length),n}(s)}}return n}const eN="undefined"!==typeof self?self:void 0;var tN={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},nN="org.w3.clearkey",rN="com.apple.streamingkeydelivery",sN="com.microsoft.playready",iN="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function aN(e){switch(e){case rN:return tN.FAIRPLAY;case sN:return tN.PLAYREADY;case iN:return tN.WIDEVINE;case nN:return tN.CLEARKEY}}function oN(e){switch(e){case tN.FAIRPLAY:return rN;case tN.PLAYREADY:return sN;case tN.WIDEVINE:return iN;case tN.CLEARKEY:return nN}}function lN(e){const{drmSystems:t,widevineLicenseUrl:n}=e,r=t?[tN.FAIRPLAY,tN.WIDEVINE,tN.PLAYREADY,tN.CLEARKEY].filter(e=>!!t[e]):[];return!r[tN.WIDEVINE]&&n&&r.push(tN.WIDEVINE),r}const cN=null!=eN&&null!=(uN=eN.navigator)&&uN.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var uN;function dN(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),n=String.fromCharCode.apply(null,Array.from(t)),r=n.substring(n.indexOf("<"),n.length),s=(new DOMParser).parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(s){const e=s.childNodes[0]?s.childNodes[0].nodeValue:s.getAttribute("VALUE");if(e){const t=XO(e).subarray(0,16);return JO(t),t}}return null}let hN={};class fN{static clearKeyUriToKeyIdMap(){hN={}}static setKeyIdForUri(e,t){hN[e]=t}static addKeyIdForUri(e){const t=Object.keys(hN).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),hN[e]=n,n}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5?arguments[5]:void 0;this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=s,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!YO(e),null!=i&&i.startsWith("0x")&&(this.keyId=new Uint8Array(gP(i)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&WO(e.keyFormatVersions,this.keyFormatVersions)&&qO(e.iv,this.iv)&&qO(e.keyId,this.keyId)}isSupported(){if(this.method){if(YO(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case rN:case iN:case sN:case nN:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(YO(this.method)){let t=this.iv;t||("number"!==typeof e&&(uP.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),e=0),t=function(e){const t=new Uint8Array(16);for(let n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}(e));return new fN(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.keyId){const e=hN[this.uri];if(e&&!WO(this.keyId,e)&&fN.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=$O(this.uri);if(n)switch(this.keyFormat){case iN:if(this.pssh=n,!this.keyId){const e=function(e){const t=[];if(e instanceof ArrayBuffer){const n=e.byteLength;let r=0;for(;r+32<n;){const n=eD(new DataView(e,r));t.push(n),r+=n.size}}return t}(n.buffer);if(e.length){var r;const t=e[0];this.keyId=null!=(r=t.kids)&&r.length?t.kids[0]:null}}this.keyId||(this.keyId=pN(t));break;case sN:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=$P(e,0,n),this.keyId=dN(n);break}default:{let e=n.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e;e=function(e){const t=null==e?void 0:e[iN];if(t)return t.keyId;return null}(t),e||(e=pN(t),e||(e=hN[this.uri])),e&&(this.keyId=e,fN.setKeyIdForUri(this.uri,e))}return this}}function pN(e){const t=null==e?void 0:e[sN];if(t){const e=$O(t.uri);if(e)return dN(e)}return null}const gN=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,mN=/#EXT-X-MEDIA:(.*)/g,vN=/^#EXT(?:INF|-X-TARGETDURATION):/m,yN=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),bN=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class EN{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return bP.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return vN.test(e)}static parseMasterPlaylist(e,t){const n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:NO(e)},r=[];if(gN.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let s;for(;null!=(s=gN.exec(e));)if(s[1]){var i;const e=new VO(s[1],n),a=MO(n,s[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:EN.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),xN(e.CODECS,o);const c=e["SUPPLEMENTAL-CODECS"];c&&(o.supplemental={},xN(c,o.supplemental)),null!=(i=o.unknownCodecs)&&i.length||r.push(o),n.levels.push(o)}else if(s[3]){const e=s[3],r=s[4];switch(e){case"SESSION-DATA":{const e=new VO(r,n),t=e["DATA-ID"];t&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[t]=e);break}case"SESSION-KEY":{const e=TN(r,t,n);e.encrypted&&e.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(e)):uP.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(r,'"'));break}case"DEFINE":FO(n,new VO(r,n),t);break;case"CONTENT-STEERING":{const e=new VO(r,n);n.contentSteering={uri:EN.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=kN(r)}}const a=r.length>0&&r.length<n.levels.length;return n.levels=a?r:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,n){let r;const s={},i=n.levels,a={AUDIO:i.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:i.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(mN.lastIndex=0;null!==(r=mN.exec(e));){const e=new VO(r[1],n),i=e.TYPE;if(i){const n=a[i],r=s[i]||[];s[i]=r;const l=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],u=e.CHANNELS,d=e.CHARACTERISTICS,h=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:i,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?EN.resolve(e.URI,t):""};if(c&&(f.assocLang=c),u&&(f.channels=u),d&&(f.characteristics=d),h&&(f.instreamId=h),null!=n&&n.length){const e=EN.findGroup(n,f.groupId)||n[0];IN(f,e,"audioCodec"),IN(f,e,"textCodec")}r.push(f)}}return s}static parseLevelPlaylist(e,t,n,r,s,i){var a;const o={url:t},l=new KO(t),c=l.fragments,u=[];let d,h,f,p,g=null,m=0,v=0,y=0,b=0,E=0,w=null,S=new IP(r,o),T=-1,k=!1,x=null;if(yN.lastIndex=0,l.m3u8=e,l.hasVariableRefs=NO(e),"#EXTM3U"!==(null==(a=yN.exec(e))?void 0:a[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(d=yN.exec(e));){k&&(k=!1,S=new IP(r,o),S.playlistOffset=y,S.setStart(y),S.sn=m,S.cc=b,E&&(S.bitrate=E),S.level=n,g&&(S.initSegment=g,g.rawProgramDateTime&&(S.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),x&&(S.setByteRange(x),x=null)));const e=d[1];if(e){S.duration=parseFloat(e);const t=(" "+d[2]).slice(1);S.title=t||null,S.tagList.push(t?["INF",e,t]:["INF",e])}else if(d[3]){if(jR(S.duration)){S.playlistOffset=y,S.setStart(y),f&&_N(S,f,l),S.sn=m,S.level=n,S.cc=b,c.push(S);const e=(" "+d[3]).slice(1);S.relurl=MO(l,e),LN(S,w,u),w=S,y+=S.duration,m++,v=0,k=!0}}else{if(d=d[0].match(bN),!d){uP.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<d.length&&void 0===d[h];h++);const e=(" "+d[h]).slice(1),s=(" "+d[h+1]).slice(1),a=d[h+2]?(" "+d[h+2]).slice(1):null;switch(e){case"BYTERANGE":w?S.setByteRange(s,w):S.setByteRange(s);break;case"PROGRAM-DATE-TIME":S.rawProgramDateTime=s,S.tagList.push(["PROGRAM-DATE-TIME",s]),-1===T&&(T=c.length);break;case"PLAYLIST-TYPE":l.type&&AN(l,e,d),l.type=s.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?AN(l,e,d):c.length>0&&RN(l,e,d),m=l.startSN=parseInt(s);break;case"SKIP":{l.skippedSegments&&AN(l,e,d);const t=new VO(s,l),n=t.decimalInteger("SKIPPED-SEGMENTS");if(jR(n)){l.skippedSegments+=n;for(let e=n;e--;)c.push(null);m+=n}const r=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(r.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&AN(l,e,d),l.targetduration=Math.max(parseInt(s),1);break;case"VERSION":null!==l.version&&AN(l,e,d),l.version=parseInt(s);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||AN(l,e,d),l.live=!1;break;case"#":(s||a)&&S.tagList.push(a?[s,a]:[s]);break;case"DISCONTINUITY":b++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([e]);break;case"BITRATE":S.tagList.push([e,s]),E=1e3*parseInt(s),jR(E)?S.bitrate=E:E=0;break;case"DATERANGE":{const e=new VO(s,l),t=new HO(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:uP.warn('Ignoring invalid DATERANGE tag: "'.concat(s,'"')),S.tagList.push(["EXT-X-DATERANGE",s]);break}case"DEFINE":{const e=new VO(s,l);"IMPORT"in e?UO(l,e,i):FO(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?AN(l,e,d):c.length>0&&RN(l,e,d),l.startCC=b=parseInt(s);break;case"KEY":{const e=TN(s,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={});const t=f[e.keyFormat];null!=t&&t.matches(e)||(t&&(f=tP({},f)),f[e.keyFormat]=e)}else uP.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(s,'"'));break}case"START":l.startTimeOffset=kN(s);break;case"MAP":{const e=new VO(s,l);if(S.duration){const t=new IP(r,o);CN(t,e,n,f),g=t,S.initSegment=g,g.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=g.rawProgramDateTime)}else{const t=S.byteRangeEndOffset;if(t){const e=S.byteRangeStartOffset;x="".concat(t-e,"@").concat(e)}else x=null;CN(S,e,n,f),g=S,k=!0}g.cc=b;break}case"SERVER-CONTROL":p&&AN(l,e,d),p=new VO(s),l.canBlockReload=p.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=p.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&p.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=p.optionalFloat("PART-HOLD-BACK",0),l.holdBack=p.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&AN(l,e,d);const t=new VO(s);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=v>0?e[e.length-1]:void 0,n=v++,r=new VO(s,l),i=new LP(r,S,o,n,t);e.push(i),S.duration+=i.duration;break}case"PRELOAD-HINT":{const e=new VO(s,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new VO(s,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:uP.warn("line parsed but not handled: ".concat(d))}}}w&&!w.relurl?(c.pop(),y-=w.duration,l.partList&&(l.fragmentHint=w)):l.partList&&(LN(S,w,u),S.cc=b,l.fragmentHint=S,f&&_N(S,f,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const I=c.length,L=c[0],C=c[I-1];if(y+=l.skippedSegments*l.targetduration,y>0&&I&&C){l.averagetargetduration=y/I;const e=C.sn;l.endSN="initSegment"!==e?e:0,l.live||(C.endList=!0),T>0&&(!function(e,t){let n=e[t];for(let r=t;r--;){const t=e[r];if(!t)return;t.programDateTime=n.programDateTime-1e3*t.duration,n=t}}(c,T),L&&u.unshift(L))}return l.fragmentHint&&(y+=l.fragmentHint.duration),l.totalduration=y,u.length&&l.dateRangeTagCount&&L&&wN(u,l),l.endCC=b,l}}function wN(e,t){let n=e.length;if(!n){if(!t.hasProgramDateTime)return;{const r=t.fragments[t.fragments.length-1];e.push(r),n++}}const r=e[n-1],s=t.live?1/0:t.totalduration,i=Object.keys(t.dateRanges);for(let o=i.length;o--;){const l=t.dateRanges[i[o]],c=l.startDate.getTime();l.tagAnchor=r.ref;for(let r=n;r--;){var a;if((null==(a=e[r])?void 0:a.sn)<t.startSN)break;const n=SN(t,c,e,r,s);if(-1!==n){l.tagAnchor=t.fragments[n].ref;break}}}}function SN(e,t,n,r,s){const i=n[r];if(i){const o=i.programDateTime;if(t>=o||0===r){var a;if(t<=o+1e3*(((null==(a=n[r+1])?void 0:a.start)||s)-i.start)){const s=n[r].sn-e.startSN;if(s<0)return-1;const i=e.fragments;if(i.length>n.length){for(let a=(n[r+1]||i[i.length-1]).sn-e.startSN;a>s;a--){const e=i[a].programDateTime;if(t>=e&&t<e+1e3*i[a].duration)return a}}return s}}}return-1}function TN(e,t,n){var r,s;const i=new VO(e,n),a=null!=(r=i.METHOD)?r:"",o=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,u=null!=(s=i.KEYFORMAT)?s:"identity";o&&i.IV&&!l&&uP.error("Invalid IV: ".concat(i.IV));const d=o?EN.resolve(o,t):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new fN(a,d,u,h,l,i.KEYID)}function kN(e){const t=new VO(e).decimalFloatingPoint("TIME-OFFSET");return jR(t)?t:null}function xN(e,t){let n=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const r=n.filter(t=>rD(t,e));r.length&&(t["".concat(e,"Codec")]=r.map(e=>e.split("/")[0]).join(","),n=n.filter(e=>-1===r.indexOf(e)))}),t.unknownCodecs=n}function IN(e,t,n){const r=t[n];r&&(e[n]=r)}function LN(e,t,n){e.rawProgramDateTime?n.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function CN(e,t,n,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function _N(e,t,n){e.levelkeys=t;const{encryptedFragments:r}=n;r.length&&r[r.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||r.push(e)}function AN(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must not appear more than once (").concat(n[0],")"))}function RN(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must appear before the first Media Segment (").concat(n[0],")"))}function PN(e,t){const n=t.startPTS;if(jR(n)){let r,s=0;t.sn>e.sn?(s=n-e.start,r=e):(s=e.start-n,r=t),r.duration!==s&&r.setDuration(s)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function DN(e,t,n,r,s,i,a){r-n<=0&&(a.warn("Fragment should have a positive duration",t),r=n+t.duration,i=s+t.duration);let o=n,l=r;const c=t.startPTS,u=t.endPTS;if(jR(c)){const d=Math.abs(c-n);e&&d>e.totalduration?a.warn("media timestamps and playlist times differ by ".concat(d,"s for level ").concat(t.level," ").concat(e.url)):jR(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,o=Math.max(n,c),n=Math.min(n,c),s=void 0!==t.startDTS?Math.min(s,t.startDTS):s,l=Math.min(r,u),r=Math.max(r,u),i=void 0!==t.endDTS?Math.max(i,t.endDTS):i}const d=n-t.start;0!==t.start&&t.setStart(n),t.setDuration(r-t.start),t.startPTS=n,t.maxStartPTS=o,t.startDTS=s,t.endPTS=r,t.minEndPTS=l,t.endDTS=i;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let f;const p=h-e.startSN,g=e.fragments;for(g[p]=t,f=p;f>0;f--)PN(g[f],g[f-1]);for(f=p;f<g.length-1;f++)PN(g[f],g[f+1]);return e.fragmentHint&&PN(g[g.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function ON(e,t,n){if(e===t)return;let r=null;const s=e.fragments;for(let u=s.length-1;u>=0;u--){const e=s[u].initSegment;if(e){r=e;break}}let i;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,n){const r=t.skippedSegments,s=Math.max(e.startSN,t.startSN)-t.startSN,i=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=s;c<=i;c++){const s=l[a+c];let i=o[c];if(r&&!i&&s&&(i=t.fragments[c]=s),s&&i){n(s,i,c,o);const r=s.relurl,a=i.relurl;if(r&&GN(r,a))return void(t.playlistParsingError=NN("media sequence mismatch ".concat(i.sn,":"),e,t,s,i));if(s.cc!==i.cc)return void(t.playlistParsingError=NN("discontinuity sequence mismatch (".concat(s.cc,"!=").concat(i.cc,")"),e,t,s,i))}}}(e,t,(e,n,s,a)=>{if((!t.startCC||t.skippedSegments)&&n.cc!==e.cc){const r=e.cc-n.cc;for(let e=s;e<a.length;e++)a[e].cc+=r;t.endCC=a[a.length-1].cc}jR(e.startPTS)&&jR(e.endPTS)&&(n.setStart(n.startPTS=e.startPTS),n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.setDuration(e.endPTS-e.startPTS),n.duration&&(i=n),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(n.elementaryStreams=e.elementaryStreams),n.loader=e.loader,e.hasStats&&(n.stats=e.stats),e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)});const a=t.fragments,o=t.fragmentHint?a.concat(t.fragmentHint):a;if(r&&o.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)}),t.skippedSegments){if(t.deltaUpdateFailed=a.some(e=>!e),t.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)a.shift();t.startSN=a[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,n){const{dateRanges:r,recentlyRemovedDateranges:s}=t,i=tP({},e);s&&s.forEach(e=>{delete i[e]});const a=Object.keys(i).length;if(!a)return r;return Object.keys(r).forEach(e=>{const t=i[e],s=new HO(r[e].attr,t);s.isValid?(i[e]=s,t||(s.tagOrder+=a)):n.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(OD(r[e].attr),'"'))}),i}(e.dateRanges,t,n));const r=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<o.length;e++)null===o[e].programDateTime&&LN(o[e],o[e-1],r);wN(r,t)}t.endCC=a[a.length-1].cc}if(!t.startCC){var l;const n=jN(e,t.startSN-1);t.startCC=null!=(l=null==n?void 0:n.cc)?l:a[0].cc}!function(e,t,n){if(e&&t){let r=0;for(let s=0,i=e.length;s<=i;s++){const i=e[s],a=t[s+r];i&&a&&i.index===a.index&&i.fragment.sn===a.fragment.sn?n(i,a):r--}}}(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),i?DN(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,n):MN(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const c=t.advancedDateTime;if(t.advanced&&c){const e=t.edge;t.driftStart||(t.driftStartTime=c,t.driftStart=e),t.driftEndTime=c,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function NN(e,t,n,r,s){return new Error("".concat(e," ").concat(s.url,"\nPlaylist starting @").concat(t.startSN,"\n").concat(t.m3u8,"\n\nPlaylist starting @").concat(n.startSN,"\n").concat(n.m3u8))}function MN(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=t.startSN+t.skippedSegments-e.startSN,s=e.fragments,i=r>=0;let a=0;if(i&&r<s.length)a=s[r].start;else if(i&&t.startSN===e.endSN+1)a=e.fragmentEnd;else if(i&&n)a=e.fragmentStart+r*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;a=e.fragmentStart}FN(t,a)}function FN(e,t){if(t){const n=e.fragments;for(let r=e.skippedSegments;r<n.length;r++)n[r].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function UN(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=1e3*e.targetduration;if(e.updated){const r=e.fragments,s=4;if(r.length&&n*s>t){const e=1e3*r[r.length-1].duration;e<n&&(n=e)}}else n/=2;return Math.round(n)}function jN(e,t,n){if(!e)return null;let r=e.fragments[t-e.startSN];return r||(r=e.fragmentHint,r&&r.sn===t?r:t<e.startSN&&n&&n.sn===t?n:null)}function BN(e,t,n){return e?VN(e.partList,t,n):null}function VN(e,t,n){if(e)for(let r=e.length;r--;){const s=e[r];if(s.index===n&&s.fragment.sn===t)return s}return null}function zN(e){e.forEach((e,t)=>{var n;null==(n=e.details)||n.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function GN(e,t){return!(e===t||!t)&&HN(e)!==HN(t)}function HN(e){return e.replace(/\?[^?]*$/,"")}function KN(e,t){for(let r=0,s=e.length;r<s;r++){var n;if((null==(n=e[r])?void 0:n.cc)===t)return e[r]}return null}function WN(e,t){const n=e.start+t;e.startPTS=n,e.setStart(n),e.endPTS=n+e.duration}function qN(e,t){const n=t.fragments;for(let r=0,s=n.length;r<s;r++)WN(n[r],e);t.fragmentHint&&WN(t.fragmentHint,e),t.alignedSliding=!0}function YN(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const n=Math.min(t.endCC,e.endCC),r=KN(t.fragments,n),s=KN(e.fragments,n);if(!r||!s)return;uP.log("Aligning playlist at start of dicontinuity sequence ".concat(n));qN(r.start-s.start,e)}function QN(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const n=e.fragments,r=t.fragments;if(!n.length||!r.length)return;let s,i;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(s=KN(r,a),i=KN(n,a)),s&&i||(s=r[Math.floor(r.length/2)],i=KN(n,s.cc)||n[Math.floor(n.length/2)]);const o=s.programDateTime,l=i.programDateTime;if(!o||!l)return;qN((l-o)/1e3-(i.start-s.start),e)}function XN(e,t,n){ZN(e,t,n),e.addEventListener(t,n)}function ZN(e,t,n){e.removeEventListener(t,n)}const JN=function(e){let t="";const n=e.length;for(let r=0;r<n;r++)t+="[".concat(e.start(r).toFixed(3),"-").concat(e.end(r).toFixed(3),"]");return t},$N="STOPPED",eM="IDLE",tM="KEY_LOADING",nM="FRAG_LOADING",rM="FRAG_LOADING_WAITING_RETRY",sM="WAITING_TRACK",iM="PARSING",aM="PARSED",oM="ENDED",lM="ERROR",cM="WAITING_INIT_PTS",uM="WAITING_LEVEL";class dM extends AO{constructor(e,t,n,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=$N,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:n,mediaBuffer:r,state:s}=this,i=n?n.currentTime:0,a=DO.bufferInfo(r||n,i,e.maxBufferHole),o=!a.len;if(this.log("Media seeking to ".concat(jR(i)?i.toFixed(3):i,", state: ").concat(s,", ").concat(o?"out of":"in"," buffer")),this.state===oM)this.resetLoadingState();else if(t){const n=e.maxFragLookUpTolerance,r=t.start-n,s=t.start+t.duration+n;if(o||s<a.start||r>a.end){const e=i>s;(i<r||e)&&(e&&t.loader&&(this.log("Cancelling fragment load for seek (sn: ".concat(t.sn,")")),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(n){this.fragmentTracker.removeFragmentsInRange(i,1/0,this.playlistType,!0);if(i>this.lastCurrentTime&&(this.lastCurrentTime=i),!this.loadingParts){const e=Math.max(a.end,i),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log("LL-Part loading ON after seeking to ".concat(i.toFixed(2)," with buffer @").concat(e.toFixed(2))),this.loadingParts=t)}}this.hls.hasEnoughToStart||(this.log("Setting ".concat(o?"startPosition":"nextLoadPosition"," to ").concat(i," for seek without enough to start")),this.nextLoadPosition=i,o&&(this.startPosition=i)),o&&this.state===eM&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new IO(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new kO(e.config)}registerListeners(){const{hls:e}=this;e.on(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(HR.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(HR.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===$N)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=$N}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=DO.bufferedInfo(s,e.start,0));const i=e.nextStart;if(i&&i>r&&i<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const a=t.partList;if(null!=a&&a.length){const e=a[a.length-1];return DO.isBuffered(this.media,e.start+e.duration/2)}const o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;XN(n,"seeking",this.onMediaSeeking),XN(n,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===$N&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(null!==r){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ZN(r,"seeking",this.onMediaSeeking),ZN(r,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=$N,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){this._doFragLoad(e,t,n,e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn("".concat(t.type," sn: ").concat(t.sn).concat(e.part?" part: "+e.part.index:""," of ").concat(this.fragInfo(t,!1,e.part),") was dropped during download.")),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const t=this.state,n=e.frag;this.fragContextChanged(n)?(t===nM||!this.fragCurrent&&t===iM)&&(this.fragmentTracker.removeFragment(n),this.state=eM):("payload"in e&&(this.log("Loaded ".concat(n.type," sn: ").concat(n.sn," of ").concat(this.playlistLabel()," ").concat(n.level)),this.hls.trigger(HR.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(t=>{this.state!==$N&&this.state!==lM&&(this.warn("Frag error: ".concat((null==t?void 0:t.message)||t)),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===hO){const t=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,t),s=Math.max(e.duration,r?r.len:this.config.maxBufferLength),i=this.backtrackFragment;(1===(i?e.sn-i.sn:0)||this.reduceMaxBufferLength(s,e.duration))&&n.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===fO&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null};this.hls.trigger(HR.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:t}=this,{frag:n,payload:r}=e,s=n.decryptdata;if(r&&r.byteLength>0&&null!=s&&s.key&&s.iv&&YO(s.method)){const i=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,QO(s.method)).catch(e=>{throw t.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:n}),e}).then(r=>{const s=self.performance.now();return t.trigger(HR.FRAG_DECRYPTED,{frag:n,payload:r,stats:{tstart:i,tdecrypt:s}}),e.payload=r,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==$N&&this.state!==lM&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==$N&&(this.state=eM),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,r;const s=e.tracks;if(s&&!t.encrypted&&(null!=(n=s.audio)&&n.encrypted||null!=(r=s.video)&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const e=this.media,n=new Error("Encrypted track with no key in ".concat(this.fragInfo(t)," (media ").concat(e?"attached mediaKeys: "+e.mediaKeys:"detached",")"));return this.warn(n.message),!e||e.mediaKeys?!1:(this.hls.trigger(HR.ERROR,{type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_NO_KEYS,fatal:!1,error:n,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t)," > buffer:").concat(n?JN(DO.getBuffered(n)):"(detached)",")")),xP(e)){var r;if(e.type!==ZR){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=eM)}const t=null==(r=this.levels)?void 0:r[e.level];null!=t&&t.fragmentError&&(this.log("Resetting level fragment error count of ".concat(t.fragmentError," on frag buffered")),t.fragmentError=0)}this.state=eM}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:s}=e,i=!s||0===s.length||s.some(e=>!e),a=new RO(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!i);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;var s;this.fragCurrent=e;const i=t.details;if(!this.levels||!i)throw new Error("frag load aborted, missing level".concat(i?"":" detail","s"));let a=null;if(!e.encrypted||null!=(s=e.decryptdata)&&s.key)e.encrypted||(a=this.keyLoader.loadClear(e,i.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log("Loading key for ".concat(e.sn," of [").concat(i.startSN,"-").concat(i.endSN,"], ").concat(this.playlistLabel()," ").concat(e.level)),this.state=tM,this.fragCurrent=e,a=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(HR.KEY_LOADED,e),this.state===tM&&(this.state=eM),e}),this.hls.trigger(HR.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const o=this.fragPrevious;if(xP(e)&&(!o||e.sn!==o.sn)){const n=this.shouldLoadParts(t.details,e.end);n!==this.loadingParts&&(this.log("LL-Part loading ".concat(n?"ON":"OFF"," loading sn ").concat(null==o?void 0:o.sn,"->").concat(e.sn)),this.loadingParts=n)}if(n=Math.max(e.start,n||0),this.loadingParts&&xP(e)){const s=i.partList;if(s&&r){n>i.fragmentEnd&&i.fragmentHint&&(e=i.fragmentHint);const o=this.getNextPart(s,e,n);if(o>-1){const l=s[o];let c;return e=this.fragCurrent=l.fragment,this.log("Loading ".concat(e.type," sn: ").concat(e.sn," part: ").concat(l.index," (").concat(o,"/").concat(s.length-1,") of ").concat(this.fragInfo(e,!1,l),") cc: ").concat(e.cc," [").concat(i.startSN,"-").concat(i.endSN,"], target: ").concat(parseFloat(n.toFixed(3)))),this.nextLoadPosition=l.start+l.duration,this.state=nM,c=a?a.then(n=>!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(e,l,t,r)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,r).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(HR.FRAG_LOADING,{frag:e,part:l,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(s,n))return Promise.resolve(null)}}var l;if(xP(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @".concat(n.toFixed(2)," Check buffer at sn: ").concat(e.sn," loaded parts: ").concat(null==(l=i.partList)?void 0:l.filter(e=>e.loaded).map(e=>"[".concat(e.start,"-").concat(e.end,"]")))),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading ".concat(e.type," sn: ").concat(e.sn," of ").concat(this.fragInfo(e,!1),") cc: ").concat(e.cc," ").concat("["+i.startSN+"-"+i.endSN+"]",", target: ").concat(parseFloat(n.toFixed(3)))),jR(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=nM;const c=this.config.progressive&&e.type!==ZR;let u;return u=c&&a?a.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,r)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,c?r:void 0),a]).then(e=>{let[t]=e;return!c&&r&&r(t),t}).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(HR.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,n,r){return new Promise((s,i)=>{var a;const o=[],l=null==(a=n.details)?void 0:a.partList,c=t=>{this.fragmentLoader.loadPart(e,t,r).then(r=>{o[t.index]=r;const i=r.part;this.hls.trigger(HR.FRAG_LOADED,r);const a=BN(n.details,e.sn,t.index+1)||VN(l,e.sn,t.index+1);if(!a)return s({frag:e,part:i,partsLoaded:o});c(a)}).catch(i)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===GR.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===zR.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(HR.ERROR,t)}else this.hls.trigger(HR.ERROR,{type:zR.OTHER_ERROR,details:GR.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==iM)return void(this.fragCurrent||this.state===$N||this.state===lM||(this.state=eM));const{frag:n,part:r,level:s}=t,i=self.performance.now();n.stats.parsing.end=i,r&&(r.stats.parsing.end=i);const a=this.getLevelDetails(),o=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);o!==this.loadingParts&&(this.log("LL-Part loading ".concat(o?"ON":"OFF"," after parsing segment ending @").concat(n.end.toFixed(2))),this.loadingParts=o),this.updateLevelTiming(n,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const s=e.partList[0];if(s.fragment.type===ZR)return!1;if(t>=s.end+((null==(n=e.fragmentHint)?void 0:n.duration)||0)){var r;if((this.hls.hasEnoughToStart?(null==(r=this.media)?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:s,part:i}=e;if(null==t||!t[r])return this.warn("Levels object was unset while buffering fragment ".concat(s," of ").concat(this.playlistLabel()," ").concat(r,". The current chunk will not be buffered.")),null;const a=t[r],o=a.details,l=i>-1?BN(o,s,i):null,c=l?l.fragment:jN(o,s,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,n,r,s){if(this.state!==iM)return;const{data1:i,data2:a}=e;let o=i;if(a&&(o=qP(i,a)),!o.length)return;const l=this.initPTS[t.cc],c=l?-l.baseTime/l.timescale:void 0,u={type:e.type,frag:t,part:n,chunkMeta:r,offset:c,parent:t.type,data:o};if(this.hls.trigger(HR.BUFFER_APPENDING,u),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!DO.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const n=t.currentTime,r=DO.bufferInfo(t,n,0),s=e.duration,i=Math.min(2*this.config.maxFragLookUpTolerance,.25*s),a=Math.max(Math.min(e.start-i,r.end-i),n+i);e.start-a>i&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!jR(r))return null;const s=this.lastCurrentTime>r||null!=(n=this.media)&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,s)}getFwdBufferInfoAtPos(e,t,n,r){const s=DO.bufferInfo(e,t,r);if(0===s.len&&void 0!==s.nextStart){const i=this.fragmentTracker.getBufferedFrag(t,n);if(i&&(s.nextStart<=i.end||i.gap)){const n=Math.max(Math.min(s.nextStart,i.end)-t,r);return DO.bufferInfo(e,t,n)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return n=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-3*t,n.maxMaxBufferLength/2,r);return s>=r&&(n.maxMaxBufferLength=s,this.warn("Reduce max buffer length to ".concat(s,"s")),!0)}getAppendedFrag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:QR;const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:s}=this,i=n[0].start,a=s.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const n=s.initialLiveManifestSize;if(r<n)return this.warn("Not enough fragments to start playback (have: ".concat(r,", need: ").concat(n,")")),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<i){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);const n=this.hls.startPosition,r=this.hls.liveSyncPosition,s=o?(-1!==n&&n>=i?n:r)||o.start:e;this.log("Setting startPosition to ".concat(s," to match start frag at live edge. mainStart: ").concat(n," liveSyncPosition: ").concat(r," frag.start: ").concat(null==(l=o)?void 0:l.start)),this.startPosition=this.nextLoadPosition=s}}else e<=i&&(o=n[0]);if(!o){const n=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,n,t)}let c=this.filterReplacedPrimary(o,t);if(!c&&o){const e=o.sn-t.startSN;c=this.filterReplacedPrimary(n[e+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===pO||n===fO&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,s){let i=null;if(e.gap&&(i=this.getNextFragment(this.nextLoadPosition,t),i&&!i.gap&&n.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(null!==e&&n.len+e.len>=s){const e=i.sn;return this.loopSn!==e&&(this.log('buffer full after gaps in "'.concat(r,'" playlist starting at sn: ').concat(e)),this.loopSn=e),null}}return this.loopSn=void 0,i}get primaryPrefetch(){if(hM(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(hM(this.config)&&e.type!==ZR){const n=this.hls.interstitialsManager,r=null==n?void 0:n.bufferingItem;if(r){const n=r.event;if(n){if(n.appendInPlace||Math.abs(e.start-r.start)>1||0===r.start)return null}else{if(e.end<=r.start&&!1===(null==t?void 0:t.live))return null;if(e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}}const s=null==n?void 0:n.playerQueue;if(s)for(let t=s.length;t--;){const n=s[t].interstitial;if(n.appendInPlace&&e.start>=n.startTime&&e.end<=n.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,n){let r=-1,s=!1,i=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(i=i&&!o.independent,r>-1&&n<o.start)break;const l=o.loaded;l?r=-1:(s||(o.independent||i)&&o.fragment===t)&&(o.fragment!==t&&this.warn("Need buffer at ".concat(n," but next unloaded part starts at ").concat(o.start)),r=a),s=l}return r}loadedEndOfParts(e,t){let n;for(let r=e.length;r--;){if(n=e[r],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(n.programDateTime)),r=function(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!jR(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;for(let r=0;r<e.length;++r){const s=e[r];if(WD(t,n,s))return s}return null}(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const i=t[s-e.startSN];n.cc===i.cc&&(r=i,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(r.sn)))}r||(r=qD(e,n.cc,n.end),r&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(r.sn)))}}else{const t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:s}=this,{fragments:i,endSN:a}=n;const{fragmentHint:o}=n,{maxFragLookUpTolerance:l}=r,c=n.partList,u=!!(this.loadingParts&&null!=c&&c.length&&o);let d;if(u&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(i=i.concat(o),a=o.sn),e<t){var h;d=HD(s,i,e,e<this.lastCurrentTime||e>t-l||null!=(h=this.media)&&h.paused||!this.startFragRequested?0:l)}else d=i[i.length-1];if(d){const e=d.sn-n.startSN,t=this.fragmentTracker.getState(d);if((t===pO||t===fO&&d.gap)&&(s=d),s&&d.sn===s.sn&&(!u||c[0].fragment.sn>d.sn||!n.live)){if(d.level===s.level){const t=i[e+1];d=d.sn<a&&this.fragmentTracker.getState(t)!==pO?t:null}}}return d}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,i=!t,a=e.alignedSliding&&jR(s);if(i||!a&&!s){!function(e,t){e&&(YN(t,e),t.alignedSliding||QN(t,e),t.alignedSliding||t.skippedSegments||MN(e,t,!1))}(n,e);const s=e.fragmentStart;return this.log("Live playlist sliding: ".concat(s.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," fragments: ").concat(r)),s}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(-1===n){const s=null!==this.startTimeOffset,i=s?this.startTimeOffset:e.startTimeOffset;null!==i&&jR(i)?(n=t+i,i<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log("Setting startPosition to ".concat(n," for start time offset ").concat(i," found in ").concat(s?"multivariant":"media"," playlist")),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge ".concat(n)),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&xP(e)&&e.stats.aborted&&(this.log("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of ").concat(this.playlistLabel()," ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===rM)||(this.state=eM)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var s;if(this.fragContextChanged(r))return void this.warn("Frag load error must match current frag to retry ".concat(r.url," > ").concat(null==(s=this.fragCurrent)?void 0:s.url));const i=t.details===GR.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction;if(!a)return void(this.state=lM);const{action:o,flags:l,retryCount:c=0,retryConfig:u}=a,d=!!u,h=d&&o===iO,f=d&&!a.resolved&&l===oO,p=null==(n=this.hls.latestLevelDetails)?void 0:n.live;if(!h&&f&&xP(r)&&!r.endList&&p&&!XD(t))this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((h||f)&&c<u.maxNumRetry){var g;const n=tO(null==(g=t.response)?void 0:g.code),s=JD(u,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+s,this.state=rM,a.resolved=!0,n)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(t.reason="offline");this.warn("Fragment ".concat(r.sn," of ").concat(e," ").concat(r.level," errored with ").concat(t.details,", retrying loading ").concat(c+1,"/").concat(u.maxNumRetry," in ").concat(s,"ms"))}else if(u){if(this.resetFragmentErrors(e),!(c<u.maxNumRetry))return void this.warn("".concat(t.details," reached or exceeded max retry (").concat(c,")"));i||o===sO||(a.resolved=!0)}else this.state=o===rO?uM:lM;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!tO(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=eM)}reduceLengthAndFlushBuffer(e){if(this.state===iM||this.state===aM){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(null==t?void 0:t.duration)||10);const i=!s;return i&&this.warn("Buffer full error while media.currentTime (".concat(this.getLoadPosition(),") is not buffered, flush ").concat(n," buffer")),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),i}return!1}resetFragmentErrors(e){e===XR&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==$N&&(this.state=eM)}afterBufferFlushed(e,t,n){if(!e)return;const r=DO.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===oM&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==$N&&(this.state=eM)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log("Loading context changed while buffering sn ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(-1===e.level?"<removed>":e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const s=n.details;if(!s)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce((t,i)=>{const a=e.elementaryStreams[i];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn("Could not parse fragment ".concat(e.sn," ").concat(i," duration reliably (").concat(o,")")),t||!1;const l=r?0:DN(s,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS,this);return this.hls.trigger(HR.LEVEL_PTS_UPDATED,{details:s,level:n,drift:l,type:i,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t},!1)){var i;const t=null===(null==(i=this.transmuxer)?void 0:i.error);if((0===n.fragmentError||t&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),t){const t=new Error("Found no media in fragment ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(this.warn(t.message),this.hls.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:"Found no media in msn ".concat(e.sn," of ").concat(this.playlistLabel(),' "').concat(n.url,'"')}),!this.hls)return;this.resetTransmuxer()}}this.state=aM,this.log("Parsed ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t),")")),this.hls.trigger(HR.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===QR?"level":"track"}fragInfo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;var r,s;return"".concat(this.playlistLabel()," ").concat(e.level," (").concat(n?"part":"frag",":[").concat((null!=(r=t&&!n?e.startPTS:(n||e).start)?r:NaN).toFixed(3),"-").concat((null!=(s=t&&!n?e.endPTS:(n||e).end)?s:NaN).toFixed(3),"]").concat(n&&"main"===e.type?"INDEPENDENT="+(n.independent?"YES":"NO"):"")}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}get state(){return this._state}}function hM(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class fM{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;return e.length?(n=1===e.length?e[0]:function(e,t){const n=new Uint8Array(t);let r=0;for(let s=0;s<e.length;s++){const t=e[s];n.set(t,r),r+=t.length}return n}(e,t),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var pM,gM={exports:{}};var mM=(pM||(pM=1,function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,a){if("function"!==typeof r)throw new TypeError("The listener must be a function");var o=new s(r,i||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,s=[];if(0===this._eventsCount)return s;for(r in e=this._events)t.call(e,r)&&s.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,a=new Array(i);s<i;s++)a[s]=r[s].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,s,i,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,s),!0;case 5:return u.fn.call(u.context,t,r,s,i),!0;case 6:return u.fn.call(u.context,t,r,s,i,a),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,s);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,s){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||s&&!o.once||r&&o.context!==r||a(this,i);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=1===c.length?c[0]:c:a(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(gM)),gM.exports),vM=mP(mM);const yM="1.6.15",bM={};function EM(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function wM(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function SM(e,t){let n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3],n}function TM(e,t){const n=t;let r=0;for(;wM(e,t);){r+=10;r+=SM(e,t+6),EM(e,t+10)&&(r+=10),t+=r}if(r>0)return e.subarray(n,n+r)}function kM(e,t){return 255===e[t]&&240===(246&e[t+1])}function xM(e,t){return 1&e[t+1]?7:9}function IM(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function LM(e,t){return t+1<e.length&&kM(e,t)}function CM(e,t){if(LM(e,t)){const n=xM(e,t);if(t+n>=e.length)return!1;const r=IM(e,t);if(r<=n)return!1;const s=t+r;return s===e.length||LM(e,s)}return!1}function _M(e,t,n,r,s){if(!e.samplerate){const i=function(e,t,n,r){const s=t[n+2],i=s>>2&15;if(i>12){const t=new Error("invalid ADTS sampling index:".concat(i));return void e.emit(HR.ERROR,HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const a=1+(s>>6&3),o=t[n+3]>>6&3|(1&s)<<2,l="mp4a.40."+a,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][i];let u=i;5!==a&&29!==a||(u-=3);const d=[a<<3|(14&u)>>1,(1&u)<<7|o<<3];return uP.log("manifest codec:".concat(r,", parsed codec:").concat(l,", channels:").concat(o,", rate:").concat(c," (ADTS object type:").concat(a," sampling index:").concat(i,")")),{config:d,samplerate:c,channelCount:o,codec:l,parsedCodec:l,manifestCodec:r}}(t,n,r,s);if(!i)return;tP(e,i)}}function AM(e){return 9216e4/e}function RM(e,t,n,r,s){const i=r+s*AM(e.samplerate),a=function(e,t){const n=xM(e,t);if(t+n<=e.length){const r=IM(e,t)-n;if(r>0)return{headerLength:n,frameLength:r}}}(t,n);let o;if(a){const{frameLength:r,headerLength:s}=a,l=s+r,c=Math.max(0,n+l-t.length);c?(o=new Uint8Array(l-s),o.set(t.subarray(n+s,t.length),0)):o=t.subarray(n+s,n+l);const u={unit:o,pts:i};return c||e.samples.push(u),{sample:u,length:l,missing:c}}const l=t.length-n;o=new Uint8Array(l),o.set(t.subarray(n,t.length),0);return{sample:{unit:o,pts:i},length:l,missing:-1}}function PM(e,t){return wM(e,t)&&SM(e,t+6)+10<=e.length-t}function DM(e){return function(e,t,n,r){const s=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const a=(d=e,d&&d.buffer instanceof ArrayBuffer&&void 0!==d.byteLength&&void 0!==d.byteOffset?e.byteOffset:0),o=(a+e.byteLength)/i,l=(a+t)/i,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(n,0),o));var d;return new r(s,c,u-c)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,Uint8Array)}function OM(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");const n=e.data.subarray(1).indexOf(0);if(-1===n)return;const r=fP(DM(e.data,1,n)),s=e.data[2+n],i=e.data.subarray(3+n).indexOf(0);if(-1===i)return;const a=fP(DM(e.data,3+n,i));let o;return o="--\x3e"===r?fP(DM(e.data,4+n+i)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+n+i)),t.mimeType=r,t.pictureType=s,t.description=a,t.data=o,t}function NM(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=fP(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const n=fP(e.data.subarray(t),!0);t+=n.length+1;const r=fP(e.data.subarray(t));return{key:e.type,info:n,data:r}}const t=fP(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?OM(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const n=fP(e.data.subarray(t),!0);t+=n.length+1;const r=fP(e.data.subarray(t));return{key:e.type,info:n,data:r}}const t=fP(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function MM(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=SM(e,4);return{type:t,size:n,data:e.subarray(10,10+n)}}function FM(e){let t=0;const n=[];for(;wM(e,t);){const r=SM(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const s=t+r;for(;t+10<s;){const r=MM(e.subarray(t)),s=NM(r);s&&n.push(s),t+=r.size+10}EM(e,t)&&(t+=10)}return n}function UM(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function jM(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),n=1&t[3];let r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}}function BM(e){const t=FM(e);for(let n=0;n<t.length;n++){const e=t[n];if(UM(e))return jM(e)}}let VM=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function zM(){return{type:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",id:-1,pid:-1,inputTimeScale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,sequenceNumber:-1,samples:[],dropped:0}}class GM{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=qP(this.cachedData,e),this.cachedData=null);let n,r=TM(e,0),s=r?r.length:0;const i=this._audioTrack,a=this._id3Track,o=r?BM(r):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&jR(o))&&(this.basePTS=HM(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:VM.audioId3,duration:Number.POSITIVE_INFINITY});s<l;){if(this.canParse(e,s)){const t=this.appendFrame(i,e,s);t?(this.frameIndex++,this.lastPTS=t.sample.pts,s+=t.length,n=s):s=l}else PM(e,s)?(r=TM(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:VM.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,n=s):s++;if(s===l&&n!==l){const t=e.slice(n);this.cachedData?this.cachedData=qP(this.cachedData,t):this.cachedData=t}}return{audioTrack:i,videoTrack:zM(),id3Track:a,textTrack:zM()}}demuxSampleAes(e,t,n){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:zM(),id3Track:this._id3Track,textTrack:zM()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const HM=(e,t,n)=>{if(jR(e))return 90*e;return 9e4*t+(n?9e4*n.baseTime/n.timescale:0)};let KM=null;const WM=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],qM=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],YM=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],QM=[0,1,1,4];function XM(e,t,n,r,s){if(n+24>t.length)return;const i=ZM(t,n);if(i&&n+i.frameLength<=t.length){const a=r+s*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:t.subarray(n,n+i.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=i.channelCount,e.samplerate=i.sampleRate,e.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}function ZM(e,t){const n=e[t+1]>>3&3,r=e[t+1]>>1&3,s=e[t+2]>>4&15,i=e[t+2]>>2&3;if(1!==n&&0!==s&&15!==s&&3!==i){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*WM[14*(3===n?3-r:3===r?3:4)+s-1],c=qM[3*(3===n?0:2===n?1:2)+i],u=3===o?1:2,d=YM[n][r],h=QM[r],f=8*d*h,p=Math.floor(d*l/c+a)*h;if(null===KM){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);KM=e?parseInt(e[1]):0}return!!KM&&KM<=87&&2===r&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:u,frameLength:p,samplesPerFrame:f}}}function JM(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function $M(e,t){return t+1<e.length&&JM(e,t)}function eF(e,t){if(t+1<e.length&&JM(e,t)){const n=4,r=ZM(e,t);let s=n;null!=r&&r.frameLength&&(s=r.frameLength);const i=t+s;return i===e.length||$M(e,i)}return!1}const tF=(e,t)=>{let n=0,r=5;t+=r;const s=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=e[t];const o=Math.min(r,8),l=8-o;i[0]=4278190080>>>24+l<<l,s[0]=(a[0]&i[0])>>l,n=n?n<<o|s[0]:s[0],t+=1,r-=o}return n};class nF extends GM{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=rF(e,t,n,this.basePTS,this.frameIndex);if(-1!==r){return{sample:e.samples[e.samples.length-1],length:r,missing:0}}}static probe(e){if(!e)return!1;const t=TM(e,0);if(!t)return!1;const n=t.length;return 11===e[n]&&119===e[n+1]&&void 0!==BM(t)&&tF(e,n)<16}}function rF(e,t,n,r,s){if(n+8>t.length)return-1;if(11!==t[n]||119!==t[n+1])return-1;const i=t[n+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],o=63&t[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+i];if(n+l>t.length)return-1;const c=t[n+6]>>5;let u=0;2===c?u+=2:(1&c&&1!==c&&(u+=2),4&c&&(u+=2));const d=(t[n+6]<<8|t[n+7])>>12-u&1,h=[2,1,2,3,3,4,4,5][c]+d,f=t[n+5]>>3,p=7&t[n+5],g=new Uint8Array([i<<6|f<<1|p>>2,(3&p)<<6|c<<3|d<<2|o>>4,o<<4&224]),m=r+s*(1536/a*9e4),v=t.subarray(n,n+l);return e.config=g,e.channelCount=h,e.samplerate=a,e.samples.push({unit:v,pts:m}),l}const sF=/\/emsg[-/]ID3/i;function iF(e,t){return jR(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class aF{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new kO(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,bO)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),i=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(i).then(s=>{const i=new Uint8Array(s);r.set(i,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)n.set(e.subarray(s,s+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(n.subarray(r,r+16),s);return e}decryptAvcSample(e,t,n,r,s){const i=JP(s.data),a=this.getAvcEncryptedData(i);this.decryptBuffer(a.buffer).then(a=>{s.data=this.getAvcDecryptedUnit(i,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)}).catch(r)}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void r();const s=e[t].units;for(;!(n>=s.length);n++){const i=s[n];if(!(i.data.length<=48||1!==i.type&&5!==i.type)&&(this.decryptAvcSample(e,t,n,r,i),!this.decrypter.isSync()))return}}}}class oF{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n,r=this.VideoSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!=(t=r)&&t.units){const e=r.units;n=e[e.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const n=t.samples,r=n.length;if(!r)return void t.dropped++;{const t=n[r-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let s=e.naluState||0;const i=s,a=[];let o,l,c,u=0,d=-1,h=0;for(-1===s&&(d=0,h=this.getNALuType(t,0),s=0,u=1);u<r;)if(o=t[u++],s)if(1!==s)if(o)if(1===o){if(l=u-s-1,d>=0){const e={data:t.subarray(d,l),type:h};a.push(e)}else{const n=this.getLastNalUnit(e.samples);n&&(i&&u<=4-i&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-i)),l>0&&(n.data=qP(n.data,t.subarray(0,l)),n.state=0))}u<r?(c=this.getNALuType(t,u),d=u,h=c,s=0):s=-1}else s=0;else s=3;else s=o?0:2;else s=o?0:1;if(d>=0&&s>=0){const e={data:t.subarray(d,r),type:h,state:s};a.push(e)}if(0===a.length){const n=this.getLastNalUnit(e.samples);n&&(n.data=qP(n.data,t))}return e.naluState=s,a}}class lF{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");r.set(e.subarray(n,n+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&uP.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class cF extends oF{parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let i,a=this.VideoSample,o=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(r=>{var s,l;switch(r.type){case 1:{let t=!1;i=!0;const s=r.data;if(o&&s.length>4){const e=this.readSliceType(s);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var c;if(t)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=t;break}case 5:i=!0,null!=(s=a)&&s.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:i=!0,ZP(r.data,1,n.pts,t.samples);break;case 7:{var u,d;i=!0,o=!0;const t=r.data,n=this.readSPS(t);if(!e.sps||e.width!==n.width||e.height!==n.height||(null==(u=e.pixelRatio)?void 0:u[0])!==n.pixelRatio[0]||(null==(d=e.pixelRatio)?void 0:d[1])!==n.pixelRatio[1]){e.width=n.width,e.height=n.height,e.pixelRatio=n.pixelRatio,e.sps=[t];const r=t.subarray(1,4);let s="avc1.";for(let e=0;e<3;e++){let t=r[e].toString(16);t.length<2&&(t="0"+t),s+=t}e.codec=s}break}case 8:i=!0,e.pps=[r.data];break;case 9:i=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:i=!0;break;default:i=!1}if(a&&i){a.units.push(r)}}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new lF(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n,r=8,s=8;for(let i=0;i<e;i++)0!==s&&(n=t.readEG(),s=(r+n+256)%256),r=0===s?r:s}readSPS(e){const t=new lF(e);let n,r,s,i=0,a=0,o=0,l=0;const c=t.readUByte.bind(t),u=t.readBits.bind(t),d=t.readUEG.bind(t),h=t.readBoolean.bind(t),f=t.skipBits.bind(t),p=t.skipEG.bind(t),g=t.skipUEG.bind(t),m=this.skipScalingList.bind(this);c();const v=c();if(u(5),f(3),c(),g(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const e=d();if(3===e&&f(1),g(),g(),f(1),h())for(r=3!==e?8:12,s=0;s<r;s++)h()&&m(s<6?16:64,t)}g();const y=d();if(0===y)d();else if(1===y)for(f(1),p(),p(),n=d(),s=0;s<n;s++)p();g(),f(1);const b=d(),E=d(),w=u(1);0===w&&f(1),f(1),h()&&(i=d(),a=d(),o=d(),l=d());let S=[1,1];if(h()&&h()){switch(c()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(b+1)-2*i-2*a),height:(2-w)*(E+1)*16-(w?2:4)*(o+l),pixelRatio:S}}}class uF extends oF{constructor(){super(...arguments),this.initVPS=null}parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let i,a=this.VideoSample,o=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(r=>{var s,l;switch(r.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,i=!0;break;case 16:case 17:case 18:case 21:var c;if(i=!0,o)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:i=!0,null!=(s=a)&&s.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:i=!0,ZP(r.data,2,n.pts,t.samples);break;case 32:i=!0,e.vps||("object"!==typeof e.params&&(e.params={}),e.params=tP(e.params,this.readVPS(r.data)),this.initVPS=r.data),e.vps=[r.data];break;case 33:if(i=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],r.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(r.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!==typeof e.params&&(e.params={});for(const n in t.params)e.params[n]=t.params[n]}this.pushParameterSet(e.sps,r.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(i=!0,"object"===typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(r.data);for(const n in t)e.params[n]=t[n]}this.pushParameterSet(e.pps,r.data,e.vps)}break;case 35:i=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:i=!1}if(a&&i){a.units.push(r)}}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&3===e[r]&&0===e[r-1]&&0===e[r-2]||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new lF(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new lF(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),i=t.readBits(5),a=t.readUByte(),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),p=t.readUByte(),g=t.readUByte(),m=t.readUByte(),v=[],y=[];for(let W=0;W<n;W++)v.push(t.readBoolean()),y.push(t.readBoolean());if(n>0)for(let W=n;W<8;W++)t.readBits(2);for(let W=0;W<n;W++)v[W]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[W]&&t.readUByte();t.readUEG();const b=t.readUEG();3==b&&t.skipBits(1);const E=t.readUEG(),w=t.readUEG(),S=t.readBoolean();let T=0,k=0,x=0,I=0;S&&(T+=t.readUEG(),k+=t.readUEG(),x+=t.readUEG(),I+=t.readUEG());const L=t.readUEG(),C=t.readUEG(),_=t.readUEG();for(let W=t.readBoolean()?0:n;W<=n;W++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let n=0;n<(3===e?2:6);n++){if(t.readBoolean()){const n=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<n;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const A=t.readUEG();let R=0;for(let W=0;W<A;W++){let e=!1;if(0!==W&&(e=t.readBoolean()),e){W===A&&t.readUEG(),t.readBoolean(),t.readUEG();let e=0;for(let n=0;n<=R;n++){const n=t.readBoolean();let r=!1;n||(r=t.readBoolean()),(n||r)&&e++}R=e}else{const e=t.readUEG(),n=t.readUEG();R=e+n;for(let r=0;r<e;r++)t.readUEG(),t.readBoolean();for(let r=0;r<n;r++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let n=0;n<e;n++){for(let e=0;e<_+4;e++)t.readBits(1);t.readBits(1)}}let P=0,D=1,O=1,N=!0,M=1,F=0;t.readBoolean(),t.readBoolean();let U=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(D=t.readBits(16),O=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readBoolean(),U&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG());if(t.readBoolean()){M=t.readBits(32),F=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),r=t.readBoolean();let s=!1;(e||r)&&(s=t.readBoolean(),s&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),s&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let i=0;i<=n;i++){N=t.readBoolean();let n=!1;N||t.readBoolean()?t.readEG():n=t.readBoolean();const i=n?1:t.readUEG()+1;if(e)for(let e=0;e<i;e++)t.readUEG(),t.readUEG(),s&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(r)for(let e=0;e<i;e++)t.readUEG(),t.readUEG(),s&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let j=E,B=w;if(S){let e=1,t=1;1===b?e=t=2:2==b&&(e=2),j=E-e*k-e*T,B=w-t*I-t*x}const V=r?["A","B","C"][r]:"",z=a<<24|o<<16|l<<8|c;let G=0;for(let W=0;W<32;W++)G=(G|(z>>W&1)<<31-W)>>>0;let H=G.toString(16);1===i&&"2"===H&&(H="6");const K=s?"H":"L";return{codecString:"hvc1.".concat(V).concat(i,".").concat(H,".").concat(K).concat(m,".B0"),params:{general_tier_flag:s,general_profile_idc:i,general_profile_space:r,general_profile_compatibility_flags:[a,o,l,c],general_constraint_indicator_flags:[u,d,h,f,p,g],general_level_idc:m,bit_depth:L+8,bit_depth_luma_minus8:L,bit_depth_chroma_minus8:C,min_spatial_segmentation_idc:P,chroma_format_idc:b,frame_rate:{fixed:N,fps:F/M}},width:j,height:B,pixelRatio:[D,O]}}readPPS(e){const t=new lF(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let s=1;return r&&n?s=0:r?s=3:n&&(s=2),{parallelismType:s}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const dF=188;class hF{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=hF.syncOffset(e);return n>0&&t.warn("MPEG2-TS detected but first sync word found @ offset ".concat(n)),-1!==n}static syncOffset(e){const t=e.length;let n=Math.min(940,t-dF)+1,r=0;for(;r<n;){let s=!1,i=-1,a=0;for(let o=r;o<t;o+=dF){if(71!==e[o]||t-o!==dF&&71!==e[o+dF]){if(a)return-1;break}if(a++,-1===i&&(i=o,0!==i&&(n=Math.min(i+18612,e.length-dF)+1)),s||(s=0===fF(e,o)),s&&a>1&&(0===i&&a>2||o+dF>n))return i}r++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:RP[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=hF.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=hF.createTrack("audio",r),this._id3Track=hF.createTrack("id3"),this._txtTrack=hF.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t){let n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r||(this.sampleAes=null);const i=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=i.pid,u=i.pesData,d=a.pid,h=o.pid,f=a.pesData,p=o.pesData,g=null,m=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=qP(this.remainderData,e)).length,this.remainderData=null),y<dF&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:i,id3Track:o,textTrack:l};const b=Math.max(0,hF.syncOffset(e));y-=(y-b)%dF,y<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let E=0;for(let S=b;S<y;S+=dF)if(71===e[S]){const t=!!(64&e[S+1]),s=fF(e,S);let y;if((48&e[S+3])>>4>1){if(y=S+5+e[S+4],y===S+dF)continue}else y=S+4;switch(s){case c:t&&(u&&(n=yF(u,this.logger))&&(this.readyVideoParser(i.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(i,l,n,!1)),u={data:[],size:0}),u&&(u.data.push(e.subarray(y,S+dF)),u.size+=S+dF-y);break;case d:if(t){if(f&&(n=yF(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,n);break;case"mp3":this.parseMPEGPES(a,n);break;case"ac3":this.parseAC3PES(a,n)}f={data:[],size:0}}f&&(f.data.push(e.subarray(y,S+dF)),f.size+=S+dF-y);break;case h:t&&(p&&(n=yF(p,this.logger))&&this.parseID3PES(o,n),p={data:[],size:0}),p&&(p.data.push(e.subarray(y,S+dF)),p.size+=S+dF-y);break;case 0:t&&(y+=e[y]+1),v=this._pmtId=pF(e,y);break;case v:{t&&(y+=e[y]+1);const n=gF(e,y,this.typeSupported,r,this.observer,this.logger);c=n.videoPid,c>0&&(i.pid=c,i.segmentCodec=n.segmentVideoCodec),d=n.audioPid,d>0&&(a.pid=d,a.segmentCodec=n.segmentAudioCodec),h=n.id3Pid,h>0&&(o.pid=h),null===g||m||(this.logger.warn("MPEG-TS PMT found at ".concat(S," after unknown PID '").concat(g,"'. Backtracking to sync byte @").concat(b," to parse all TS packets.")),g=null,S=b-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=s}}else E++;E>0&&mF(this.observer,new Error("Found ".concat(E," TS packet/s that do not start with 0x47")),void 0,this.logger),i.pesData=u,a.pesData=f,o.pesData=p;const w={audioTrack:a,videoTrack:i,id3Track:o,textTrack:l};return s&&this.extractRemainingSamples(w),w}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:s}=e,i=n.pesData,a=t.pesData,o=r.pesData;let l;if(i&&(l=yF(i,this.logger))?(this.readyVideoParser(n.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(n,s,l,!0),n.pesData=null)):n.pesData=i,a&&(l=yF(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=yF(o,this.logger))?(this.parseID3PES(r,l),r.pesData=null):r.pesData=o}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new aF(this.observer,this.config,t);return this.decrypt(r,s)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new cF:"hevc"===e&&(this.videoParser=new uF))}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let s,i,a,o=t.data;if(r){this.aacOverFlow=null;const t=r.missing,s=r.sample.unit.byteLength;if(-1===t)o=qP(r.sample.unit,o);else{const i=s-t;r.sample.unit.set(o.subarray(0,t),i),e.samples.push(r.sample),n=r.missing}}for(s=n,i=o.length;s<i-1&&!LM(o,s);s++);if(s!==n){let e;const t=s<i-1;if(e=t?"AAC PES did not start with ADTS header,offset:".concat(s):"No ADTS header found in AAC PES",mF(this.observer,new Error(e),t,this.logger),!t)return}if(_M(e,this.observer,o,s,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!r)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=AM(e.samplerate);a=r.sample.pts+t}}let l,c=0;for(;s<i;){if(l=RM(e,o,s,a,c),s+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;s<i-1&&!LM(o,s);s++);}}parseMPEGPES(e,t){const n=t.data,r=n.length;let s=0,i=0;const a=t.pts;if(void 0!==a)for(;i<r;)if($M(n,i)){const t=XM(e,n,i,a,s);if(!t)break;i+=t.length,s++}else i++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(void 0===r)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const s=n.length;let i,a=0,o=0;for(;o<s&&(i=rF(e,n,o,r,a++))>0;)o+=i}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=tP({},t,{type:this._videoTrack?VM.emsg:VM.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function fF(e,t){return((31&e[t+1])<<8)+e[t+2]}function pF(e,t){return(31&e[t+10])<<8|e[t+11]}function gF(e,t,n,r,s,i){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=fF(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!r){vF("ADTS AAC",i);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!r){vF("H.264",i);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:n.mpeg||n.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):i.log("MPEG audio found, not supported in this browser");break;case 193:if(!r){vF("AC-3",i);break}case 129:n.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let r=t+5,s=l;for(;s>2;){if(106===e[r])!0!==n.ac3?i.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const t=e[r+1]+2;r+=t,s-=t}}break;case 194:case 135:return mF(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"))}t+=l+5}return a}function mF(e,t,n,r){r.warn("parsing error: ".concat(t.message)),e.emit(HR.ERROR,HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:t,reason:t.message})}function vF(e,t){t.log("".concat(e," with AES-128-CBC encryption found in unencrypted stream"))}function yF(e,t){let n,r,s,i,a,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=qP(l[0],l[1]),l.splice(1,1);n=l[0];if(1===(n[0]<<16)+(n[1]<<8)+n[2]){if(r=(n[4]<<8)+n[5],r&&r>e.size-6)return null;const c=n[7];192&c&&(i=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&c?(a=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2,i-a>54e5&&(t.warn("".concat(Math.round((i-a)/9e4),"s delta between PTS and DTS, align them")),i=a)):a=i),s=n[8];let u=s+9;if(e.size<=u)return null;e.size-=u;const d=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){n=l[e];let t=n.byteLength;if(u){if(u>t){u-=t;continue}n=n.subarray(u),t-=u,u=0}d.set(n,o),o+=t}return r&&(r-=s+3),{data:d,pts:i,dts:a,len:r}}return null}class bF{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const EF=Math.pow(2,32)-1;class wF{static init(){let e;for(e in wF.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},wF.types)wF.types.hasOwnProperty(e)&&(wF.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);wF.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);wF.STTS=wF.STSC=wF.STCO=s,wF.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),wF.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),wF.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),wF.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const i=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);wF.FTYP=wF.box(wF.types.ftyp,i,o,i,a),wF.DINF=wF.box(wF.types.dinf,wF.box(wF.types.dref,r))}static box(e){let t=8;for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];let i=r.length;const a=i;for(;i--;)t+=r[i].byteLength;const o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),i=0,t=8;i<a;i++)o.set(r[i],t),t+=r[i].byteLength;return o}static hdlr(e){return wF.box(wF.types.hdlr,wF.HDLR_TYPES[e])}static mdat(e){return wF.box(wF.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(EF+1)),r=Math.floor(t%(EF+1));return wF.box(wF.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(e){return wF.box(wF.types.mdia,wF.mdhd(e.timescale||0,e.duration||0),wF.hdlr(e.type),wF.minf(e))}static mfhd(e){return wF.box(wF.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?wF.box(wF.types.minf,wF.box(wF.types.smhd,wF.SMHD),wF.DINF,wF.stbl(e)):wF.box(wF.types.minf,wF.box(wF.types.vmhd,wF.VMHD),wF.DINF,wF.stbl(e))}static moof(e,t,n){return wF.box(wF.types.moof,wF.mfhd(e),wF.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=wF.trak(e[t]);return wF.box.apply(null,[wF.types.moov,wF.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(wF.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=wF.trex(e[t]);return wF.box.apply(null,[wF.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(EF+1)),r=Math.floor(t%(EF+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return wF.box(wF.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,n[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return wF.box(wF.types.sdtp,n)}static stbl(e){return wF.box(wF.types.stbl,wF.stsd(e),wF.box(wF.types.stts,wF.STTS),wF.box(wF.types.stsc,wF.STSC),wF.box(wF.types.stsz,wF.STSZ),wF.box(wF.types.stco,wF.STCO))}static avc1(e){let t,n,r,s=[],i=[];for(t=0;t<e.sps.length;t++)n=e.sps[t],r=n.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(n));for(t=0;t<e.pps.length;t++)n=e.pps[t],r=n.byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(n));const a=wF.box(wF.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(i))),o=e.width,l=e.height,c=e.pixelRatio[0],u=e.pixelRatio[1];return wF.box(wF.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,wF.box(wF.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),wF.box(wF.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return wF.box(wF.types.mp4a,wF.audioStsd(e),wF.box(wF.types.esds,wF.esds(e)))}static mp3(e){return wF.box(wF.types[".mp3"],wF.audioStsd(e))}static ac3(e){return wF.box(wF.types["ac-3"],wF.audioStsd(e),wF.box(wF.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return wF.box(wF.types.stsd,wF.STSD,wF.mp4a(e));if("ac3"===t&&e.config)return wF.box(wF.types.stsd,wF.STSD,wF.ac3(e));if("mp3"===t&&"mp3"===e.codec)return wF.box(wF.types.stsd,wF.STSD,wF.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return wF.box(wF.types.stsd,wF.STSD,wF.avc1(e));if("hevc"===t&&e.vps)return wF.box(wF.types.stsd,wF.STSD,wF.hvc1(e))}throw new Error("unsupported ".concat(e.type," segment codec (").concat(t,"/").concat(e.codec,")"))}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,i=Math.floor(n/(EF+1)),a=Math.floor(n%(EF+1));return wF.box(wF.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,s>>8&255,255&s,0,0]))}static traf(e,t){const n=wF.sdtp(e),r=e.id,s=Math.floor(t/(EF+1)),i=Math.floor(t%(EF+1));return wF.box(wF.types.traf,wF.box(wF.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),wF.box(wF.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i])),wF.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,wF.box(wF.types.trak,wF.tkhd(e),wF.mdia(e))}static trex(e){const t=e.id;return wF.box(wF.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,s=12+16*r,i=new Uint8Array(s);let a,o,l,c,u,d;for(t+=8+s,i.set(["video"===e.type?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<r;a++)o=n[a],l=o.duration,c=o.size,u=o.flags,d=o.cts,i.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*a);return wF.box(wF.types.trun,i)}static initSegment(e){wF.types||wF.init();const t=wF.moov(e);return qP(wF.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let s=r.length;for(let h=0;h<n.length;h+=1){s+=3;for(let e=0;e<n[h].length;e+=1)s+=2+n[h][e].length}const i=new Uint8Array(s);i.set(r,0),s=r.length;const a=n.length-1;for(let h=0;h<n.length;h+=1){i.set(new Uint8Array([32+h|(h===a?128:0),0,n[h].length]),s),s+=3;for(let e=0;e<n[h].length;e+=1)i.set(new Uint8Array([n[h][e].length>>8,255&n[h][e].length]),s),s+=2,i.set(n[h][e],s),s+=n[h][e].length}const o=wF.box(wF.types.hvcC,i),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return wF.box(wF.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,wF.box(wF.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),wF.box(wF.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))}}wF.types=void 0,wF.HDLR_TYPES=void 0,wF.STTS=void 0,wF.STSC=void 0,wF.STCO=void 0,wF.STSZ=void 0,wF.VMHD=void 0,wF.SMHD=void 0,wF.STSD=void 0,wF.FTYP=void 0,wF.DINF=void 0;function SF(e,t){const n=e*t*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?Math.round(n):n}function TF(e){return SF(e,1e3,1/9e4,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}function kF(e){const{baseTime:t,timescale:n,trackId:r}=e;return"".concat(t/n," (").concat(t,"/").concat(n,") trackId: ").concat(r)}let xF,IF=null,LF=null;function CF(e,t,n,r){return{duration:t,size:n,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class _F extends sP{constructor(e,t,n,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===IF){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);IF=e?parseInt(e[1]):0}if(null===LF){const e=navigator.userAgent.match(/Safari\/(\d+)/i);LF=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;t&&e&&e.trackId===t.trackId&&e.baseTime===t.baseTime&&e.timescale===t.timescale||this.log("Reset initPTS: ".concat(t?kF(t):t," > ").concat(e?kF(e):e)),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((e,r)=>{let s=r.pts,i=s-e;return i<-4294967296&&(t=!0,s=AF(s,n),i=s-e),i>0?e:s},n);return t&&this.debug("PTS rollover detected"),r}remux(e,t,n,r,s,i,a,o){let l,c,u,d,h,f,p=s,g=s;const m=e.pid>-1,v=t.pid>-1,y=t.samples.length,b=e.samples.length>0,E=a&&y>0||y>1;if((!m||b)&&(!v||E)||this.ISGenerated||a){if(this.ISGenerated){var w,S,T,k;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(w=t.pixelRatio)?void 0:w[0])!==(null==(S=e.pixelRatio)?void 0:S[0])||(null==(T=t.pixelRatio)?void 0:T[1])!==(null==(k=e.pixelRatio)?void 0:k[1]))||!e&&E||null===this.nextAudioTs&&b)&&this.resetInitSegment()}this.ISGenerated||(u=this.generateIS(e,t,s,i));const n=this.isVideoContiguous;let r,a=-1;if(E&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){this.warn("Dropped ".concat(a," out of ").concat(y," video samples due to a missing keyframe"));const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,g+=(t.samples[0].pts-e)/t.inputTimeScale,r=g}else-1===a&&(this.warn("No keyframe found out of ".concat(y," video samples")),f=!1);if(this.ISGenerated){if(b&&E){const n=this.getVideoStartPts(t.samples),r=(AF(e.samples[0].pts,n)-n)/t.inputTimeScale;p+=Math.max(0,r),g+=Math.max(0,-r)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),u=this.generateIS(e,t,s,i)),c=this.remuxAudio(e,p,this.isAudioContiguous,i,v||E||o===XR?g:void 0),E){const r=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),u=this.generateIS(e,t,s,i)),l=this.remuxVideo(t,g,n,r)}}else E&&(l=this.remuxVideo(t,g,n,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(h=RF(n,s,this._initPTS,this._initDTS)),r.samples.length&&(d=PF(r,s,this._initPTS))),{audio:c,video:l,initSegment:u,independent:f,text:d,id3:h}}computeInitPts(e,t,n,r){const s=Math.round(n*t);let i=AF(e,s);if(i<s+t)for(this.log("Adjusting PTS for rollover in timeline near ".concat((s-i)/t," ").concat(r));i<s+t;)i+=8589934592;return i-s}generateIS(e,t,n,r){const s=e.samples,i=t.samples,a=this.typeSupported,o={},l=this._initPTS;let c,u,d,h=!l||r,f="audio/mp4",p=-1;if(h&&(c=u=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):wF.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(p=e.id,d=e.inputTimeScale,l&&d===l.timescale?h=!1:c=u=this.computeInitPts(s[0].pts,d,n,"audio"))}if(t.sps&&t.pps&&i.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:wF.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(p=t.id,d=t.inputTimeScale,l&&d===l.timescale)h=!1;else{const e=this.getVideoStartPts(i),t=AF(i[0].dts,e),r=this.computeInitPts(t,d,n,"video"),s=this.computeInitPts(e,d,n,"video");u=Math.min(u,r),c=Math.min(c,s)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,h?(l&&this.warn("Timestamps at playlist time: ".concat(r?"":"~").concat(n," ").concat(c/d," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(n," offset: ").concat(c/d," (").concat(c,"/").concat(d,") trackId: ").concat(p)),this._initPTS={baseTime:c,timescale:d,trackId:p},this._initDTS={baseTime:u,timescale:d,trackId:p}):c=d=void 0,{tracks:o,initPTS:c,timescale:d,trackId:p}}remuxVideo(e,t,n,r){const s=e.inputTimeScale,i=e.samples,a=[],o=i.length,l=this._initPTS,c=l.baseTime*s/l.timescale;let u,d,h=this.nextVideoTs,f=8,p=this.videoSampleDuration,g=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=!1;if(!n||null===h){const e=c+t*s,r=i[0].pts-AF(i[0].dts,i[0].pts);IF&&null!==h&&Math.abs(e-r-(h+c))<15e3?n=!0:h=e-r-c}const y=h+c;for(let N=0;N<o;N++){const e=i[N];e.pts=AF(e.pts,y),e.dts=AF(e.dts,y),e.dts<i[N>0?N-1:N].dts&&(v=!0)}v&&i.sort(function(e,t){const n=e.dts-t.dts,r=e.pts-t.pts;return n||r}),u=i[0].dts,d=i[i.length-1].dts;const b=d-u,E=b?Math.round(b/(o-1)):p||e.inputTimeScale/30;if(n){const n=u-y,r=n>E,s=n<-1;if((r||s)&&(r?this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(TF(n,!0)," ms (").concat(n,"dts) hole between fragments detected at ").concat(t.toFixed(3))):this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(TF(-n,!0)," ms (").concat(n,"dts) overlapping between fragments detected at ").concat(t.toFixed(3))),!s||y>=i[0].pts||IF)){u=y;const e=i[0].pts-n;if(r)i[0].dts=u,i[0].pts=e;else{let t=!0;for(let r=0;r<i.length&&!(i[r].dts>e&&t);r++){const e=i[r].pts;if(i[r].dts-=n,i[r].pts-=n,r<i.length-1){const n=i[r+1].pts;t=n<=i[r].pts==n<=e}}}this.log("Video: Initial PTS/DTS adjusted: ".concat(TF(e,!0),"/").concat(TF(u,!0),", delta: ").concat(TF(n,!0)," ms"))}}u=Math.max(0,u);let w=0,S=0,T=u;for(let N=0;N<o;N++){const e=i[N],t=e.units,n=t.length;let r=0;for(let s=0;s<n;s++)r+=t[s].data.length;S+=r,w+=n,e.length=r,e.dts<T?(e.dts=T,T+=E/4|0||1):T=e.dts,g=Math.min(e.pts,g),m=Math.max(e.pts,m)}d=i[o-1].dts;const k=S+4*w+8;let x;try{x=new Uint8Array(k)}catch(O){return void this.observer.emit(HR.ERROR,HR.ERROR,{type:zR.MUX_ERROR,details:GR.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:k,reason:"fail allocating video mdat ".concat(k)})}const I=new DataView(x.buffer);I.setUint32(0,k),x.set(wF.types.mdat,4);let L=!1,C=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,R=Number.NEGATIVE_INFINITY;for(let N=0;N<o;N++){const e=i[N],t=e.units;let n,l=0;for(let r=0,s=t.length;r<s;r++){const e=t[r],n=e.data,s=e.data.byteLength;I.setUint32(f,s),f+=4,x.set(n,f),f+=s,l+=4+s}if(N<o-1)p=i[N+1].dts-e.dts,n=i[N+1].pts-e.pts;else{const t=this.config,a=N>0?e.dts-i[N-1].dts:E;if(n=N>0?e.pts-i[N-1].pts:E,t.stretchShortVideoTrack&&null!==this.nextAudioTs){const n=Math.floor(t.maxBufferHole*s),i=(r?g+r*s:this.nextAudioTs+c)-e.pts;i>n?(p=i-a,p<0?p=a:L=!0,this.log("It is approximately ".concat(i/90," ms to the next segment; using duration ").concat(p/90," ms for the last video frame."))):p=a}else p=a}const u=Math.round(e.pts-e.dts);C=Math.min(C,p),A=Math.max(A,p),_=Math.min(_,n),R=Math.max(R,n),a.push(CF(e.key,p,l,u))}if(a.length)if(IF){if(IF<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(LF&&R-_<A-C&&E/A<.025&&0===a[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,n=a.length;t<n;t++){const r=e+a[t].duration,s=e+a[t].cts;if(t<n-1){const e=r+a[t+1].cts;a[t].duration=e-s}else a[t].duration=t?a[t-1].duration:E;a[t].cts=0,e=r}}p=L||!p?E:p;const P=d+p;this.nextVideoTs=h=P-c,this.videoSampleDuration=p,this.isVideoContiguous=!0;const D={data1:wF.moof(e.sequenceNumber++,u,tP(e,{samples:a})),data2:x,startPTS:(g-c)/s,endPTS:(m+p-c)/s,startDTS:(u-c)/s,endDTS:h/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,D}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,n,r,s){const i=e.inputTimeScale,a=i/(e.samplerate?e.samplerate:i),o=this.getSamplesPerFrame(e),l=o*a,c=this._initPTS,u="mp3"===e.segmentCodec&&this.typeSupported.mpeg,d=[],h=void 0!==s;let f=e.samples,p=u?0:8,g=this.nextAudioTs||-1;const m=c.baseTime*i/c.timescale,v=m+t*i;if(this.isAudioContiguous=n=n||f.length&&g>0&&(r&&Math.abs(v-(g+m))<9e3||Math.abs(AF(f[0].pts,v)-(g+m))<20*l),f.forEach(function(e){e.pts=AF(e.pts,v)}),!n||g<0){const e=f.length;if(f=f.filter(e=>e.pts>=0),e!==f.length&&this.warn("Removed ".concat(f.length-e," of ").concat(e," samples (initPTS ").concat(m," / ").concat(i,")")),!f.length)return;g=0===s?0:r&&!h?Math.max(0,v-m):f[0].pts-m}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let n=0,r=g+m;n<f.length;n++){const s=f[n],a=s.pts,o=a-r,c=Math.abs(1e3*o/i);if(o<=-t*l&&h)0===n&&(this.warn("Audio frame @ ".concat((a/i).toFixed(3),"s overlaps marker by ").concat(Math.round(1e3*o/i)," ms.")),this.nextAudioTs=g=a-m,r=a);else if(o>=t*l&&c<1e4&&h){let t=Math.round(o/l);for(r=a-t*l;r<0&&t&&l;)t--,r+=l;0===n&&(this.nextAudioTs=g=r-m),this.warn("Injecting ".concat(t," audio frames @ ").concat(((r-m)/i).toFixed(3),"s due to ").concat(Math.round(1e3*o/i)," ms gap."));for(let i=0;i<t;i++){let t=bF.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=s.unit.subarray()),f.splice(n,0,{unit:t,pts:r}),r+=l,n++}}s.pts=r,r+=l}}let y,b=null,E=null,w=0,S=f.length;for(;S--;)w+=f[S].unit.byteLength;for(let A=0,R=f.length;A<R;A++){const t=f[A],r=t.unit;let s=t.pts;if(null!==E){d[A-1].duration=Math.round((s-E)/a)}else{if(n&&"aac"===e.segmentCodec&&(s=g+m),b=s,!(w>0))return;w+=p;try{y=new Uint8Array(w)}catch(_){return void this.observer.emit(HR.ERROR,HR.ERROR,{type:zR.MUX_ERROR,details:GR.REMUX_ALLOC_ERROR,fatal:!1,error:_,bytes:w,reason:"fail allocating audio mdat ".concat(w)})}if(!u){new DataView(y.buffer).setUint32(0,w),y.set(wF.types.mdat,4)}}y.set(r,p);const i=r.byteLength;p+=i,d.push(CF(!0,o,i,0)),E=s}const T=d.length;if(!T)return;const k=d[d.length-1];g=E-m,this.nextAudioTs=g+a*k.duration;const x=u?new Uint8Array(0):wF.moof(e.sequenceNumber++,b/a,tP({},e,{samples:d}));e.samples=[];const I=(b-m)/i,L=this.nextAudioTs/i,C={data1:x,data2:y,startPTS:I,endPTS:L,startDTS:I,endDTS:L,type:"audio",hasAudio:!0,hasVideo:!1,nb:T};return this.isAudioContiguous=!0,C}}function AF(e,t){let n;if(null===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}function RF(e,t,n,r){const s=e.samples.length;if(!s)return;const i=e.inputTimeScale;for(let o=0;o<s;o++){const s=e.samples[o];s.pts=AF(s.pts-n.baseTime*i/n.timescale,t*i)/i,s.dts=AF(s.dts-r.baseTime*i/r.timescale,t*i)/i}const a=e.samples;return e.samples=[],{samples:a}}function PF(e,t,n){const r=e.samples.length;if(!r)return;const s=e.inputTimeScale;for(let a=0;a<r;a++){const r=e.samples[a];r.pts=AF(r.pts-n.baseTime*s/n.timescale,t*s)/s}e.samples.sort((e,t)=>e.pts-t.pts);const i=e.samples;return e.samples=[],{samples:i}}function DF(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==(null==e?void 0:e.start)?(e.start+(n?e.duration:0))/e.timescale:t}function OF(e,t,n){const r=e.codec;if(r&&r.length>4)return r;if(t===wP){if("ec-3"===r||"ac-3"===r||"alac"===r)return r;if("fLaC"===r||"Opus"===r){return dD(r,!1)}return n.warn('Unhandled audio codec "'.concat(r,'" in mp4 MAP')),r||"mp4a"}return n.warn('Unhandled video codec "'.concat(r,'" in mp4 MAP')),r||"avc1"}try{xF=self.performance.now.bind(self.performance)}catch(lz){xF=Date.now}const NF=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const s=this.videoTrack=zM("video",1),i=this.audioTrack=zM("audio",1),a=this.txtTrack=zM("text",1);if(this.id3Track=zM("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=jP(e);if(o.video){const{id:e,timescale:t,codec:n,supplemental:r}=o.video;s.id=e,s.timescale=a.timescale=t,s.codec=n,s.supplemental=r}if(o.audio){const{id:e,timescale:t,codec:n}=o.audio;i.id=e,i.timescale=t,i.codec=n}a.id=RP.text,s.sampleDuration=0,s.duration=i.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let n=0;n<t;){const r=OP(e,n);if(r>8&&109===e[n+4]&&111===e[n+5]&&111===e[n+6]&&102===e[n+7])return!0;n=r>1?n+r:t}return!1}(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=qP(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},n=FP(e,["moof"]);if(n.length<2)return t.remainder=e,t;const r=n[n.length-1];return t.valid=e.slice(0,r.byteOffset-8),t.remainder=e.slice(r.byteOffset-8),t}(n);this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array}else r.samples=n;const i=this.extractID3Track(r,t);return s.samples=YP(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:i,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=YP(e,t),{videoTrack:t,audioTrack:zM(),id3Track:r,textTrack:zM()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=FP(e.samples,["emsg"]);r&&r.forEach(e=>{const r=function(e){const t=e[0];let n="",r="",s=0,i=0,a=0,o=0,l=0,c=0;if(0===t){for(;"\0"!==PP(e.subarray(c,c+1));)n+=PP(e.subarray(c,c+1)),c+=1;for(n+=PP(e.subarray(c,c+1)),c+=1;"\0"!==PP(e.subarray(c,c+1));)r+=PP(e.subarray(c,c+1)),c+=1;r+=PP(e.subarray(c,c+1)),c+=1,s=OP(e,12),i=OP(e,16),o=OP(e,20),l=OP(e,24),c=28}else if(1===t){c+=4,s=OP(e,c),c+=4;const t=OP(e,c);c+=4;const i=OP(e,c);for(c+=4,a=2**32*t+i,BR(a)||(a=Number.MAX_SAFE_INTEGER,uP.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=OP(e,c),c+=4,l=OP(e,c),c+=4;"\0"!==PP(e.subarray(c,c+1));)n+=PP(e.subarray(c,c+1)),c+=1;for(n+=PP(e.subarray(c,c+1)),c+=1;"\0"!==PP(e.subarray(c,c+1));)r+=PP(e.subarray(c,c+1)),c+=1;r+=PP(e.subarray(c,c+1)),c+=1}return{schemeIdUri:n,value:r,timeScale:s,presentationTime:a,presentationTimeDelta:i,eventDuration:o,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(sF.test(r.schemeIdUri)){const e=iF(r,t);let s=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;s<=.001&&(s=Number.POSITIVE_INFINITY);const i=r.payload;n.samples.push({data:i,len:i.byteLength,dts:e,pts:e,type:VM.emsg,duration:s})}else if(this.config.enableEmsgKLVMetadata&&r.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=iF(r,t);n.samples.push({data:r.payload,len:r.payload.byteLength,dts:e,pts:e,type:VM.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends sP{constructor(e,t,n,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:s,video:i}=this.initData=jP(e);if(t)!function(e,t){if(!e||!t)return;const n=t.keyId;n&&t.isCommonEncryption&&KP(e,(e,t)=>{const r=e.subarray(8,24);r.some(e=>0!==e)||(uP.log("[eme] Patching keyId in 'enc".concat(t?"a":"v",">sinf>>tenc' box: ").concat(pP(r)," -> ").concat(pP(n))),e.set(n,8))})}(e,t);else{const e=s||i;null!=e&&e.encrypted&&this.warn('Init segment with encrypted track with has no key ("'.concat(e.codec,'")!'))}s&&(n=OF(s,wP,this)),i&&(r=OF(i,SP,this));const a={};s&&i?a.audiovideo={container:"video/mp4",codec:n+","+r,supplemental:i.supplemental,encrypted:i.encrypted,initSegment:e,id:"main"}:s?a.audio={container:"audio/mp4",codec:n,encrypted:s.encrypted,initSegment:e,id:"audio"}:i?a.video={container:"video/mp4",codec:r,supplemental:i.supplemental,encrypted:i.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,r,s,i){var a,o;let{initPTS:l,lastEndTime:c}=this;const u={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};jR(c)||(c=this.lastEndTime=s||0);const d=t.samples;if(!d.length)return u;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(d),f=this.initData),null==(o=f)||!o.length)return this.warn("Failed to generate initSegment."),u;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(e,t,n){const r={},s=FP(e,["moof","traf"]);for(let i=0;i<s.length;i++){const e=s[i],a=FP(e,["tfhd"])[0],o=OP(a,4),l=t[o];if(!l)continue;r[o]||(r[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const c=r[o],u=FP(e,["tfdt"])[0];if(u){const e=u[0];let t=OP(u,4);1===e&&(t===_P?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=_P+1,t+=OP(u,8))),jR(t)&&(!jR(c.start)||t<c.start)&&(c.start=t)}const d=l.default,h=OP(a,0)|(null==d?void 0:d.flags);let f=(null==d?void 0:d.duration)||0;8&h&&(f=OP(a,2&h?12:8));const p=FP(e,["trun"]);let g=c.start||0,m=0,v=f;for(let t=0;t<p.length;t++){const e=p[t],n=OP(e,4),r=c.sampleCount;c.sampleCount+=n;const s=1&e[3],i=4&e[3],a=1&e[2],o=2&e[2],l=4&e[2],u=8&e[2];let d=8,h=n;for(s&&(d+=4),i&&n&&(1&e[d+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=r),d+=4,a?(v=OP(e,d),d+=4):v=f,o&&(d+=4),u&&(d+=4),g+=v,m+=v,h--);h--;)a?(v=OP(e,d),d+=4):v=f,o&&(d+=4),l&&(1&e[d+1]||void 0===c.keyFrameIndex&&(c.keyFrameIndex=c.sampleCount-(h+1),c.keyFrameStart=g),d+=4),u&&(d+=4),g+=v,m+=v;!m&&f&&(m+=f*n)}c.duration+=m}if(!Object.keys(r).some(e=>r[e].duration)){let t=1/0,n=0;const s=FP(e,["sidx"]);for(let e=0;e<s.length;e++){const r=UP(s[e]);if(null!=r&&r.references){t=Math.min(t,r.earliestPresentationTime/r.timescale);const e=r.references.reduce((e,t)=>e+t.info.duration||0,0);n=Math.max(n,e+r.earliestPresentationTime/r.timescale)}}n&&jR(n)&&Object.keys(r).forEach(e=>{r[e].duration||(r[e].duration=n*r[e].timescale-r[e].start)})}return r}(d,f,this),g=f.audio?p[f.audio.id]:null,m=f.video?p[f.video.id]:null,v=DF(m,1/0),y=DF(g,1/0),b=DF(m,0,!0),E=DF(g,0,!0);let w=s,S=0;const T=g&&(!m||!l&&y<v||l&&l.trackId===f.audio.id),k=T?g:m;if(k){const e=k.timescale,t=k.start-s*e,n=T?f.audio.id:f.video.id;w=k.start/e,S=T?E-y:b-v,!i&&l||!function(e,t,n,r){if(null===e)return!0;const s=Math.max(r,1),i=t-e.baseTime/e.timescale;return Math.abs(i-n)>s}(l,w,s,S)&&e===l.timescale||(l&&this.warn("Timestamps at playlist time: ".concat(i?"":"~").concat(s," ").concat(t/e," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(s," offset: ").concat(w-s," (").concat(t,"/").concat(e,") trackId: ").concat(n)),l=null,h.initPTS=t,h.timescale=e,h.trackId=n)}else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(s));l?(h.initPTS=l.baseTime,h.timescale=l.timescale,h.trackId=l.trackId):(h.timescale&&void 0!==h.trackId&&void 0!==h.initPTS||(this.warn("Could not set initPTS"),h.initPTS=w,h.timescale=1,h.trackId=-1),this.initPTS=l={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const x=w-l.baseTime/l.timescale,I=x+S;S>0?this.lastEndTime=I:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const L=!!f.audio,C=!!f.video;let _="";L&&(_+="audio"),C&&(_+="video");const A={data1:d,startPTS:x,startDTS:x,endPTS:I,endDTS:I,type:_,hasAudio:L,hasVideo:C,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};u.audio=L&&!C?A:void 0,u.video=C?A:void 0;const R=null==m?void 0:m.sampleCount;if(R){const e=m.keyFrameIndex,t=-1!==e;A.nb=R,A.dropped=0===e||this.isVideoContiguous?0:t?e:R,A.independent=t,A.firstKeyFrame=e,t&&m.keyFrameStart&&(A.firstKeyFramePTS=(m.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(u.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),A.dropped&&this.warn("fmp4 does not start with IDR: firstIDR ".concat(e,"/").concat(R," dropped: ").concat(A.dropped," start: ").concat(A.firstKeyFramePTS||"NA"))}return u.initSegment=h,u.id3=RF(n,s,l,l),r.samples.length&&(u.text=PF(r,s,l)),u}}},{demux:hF,remux:_F},{demux:class extends GM{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=TM(e,0);let r=(null==n?void 0:n.length)||0;if(eF(e,r))return!1;for(let s=e.length;r<s;r++)if(CM(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&kM(e,t)&&IM(e,t)<=e.length-t}(e,t)}appendFrame(e,t,n){_M(e,this.observer,t,n,e.manifestCodec);const r=RM(e,t,n,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:_F},{demux:class extends GM{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=TM(e,0);let n=(null==t?void 0:t.length)||0;if(t&&11===e[n]&&119===e[n+1]&&void 0!==BM(t)&&tF(e,n)<=16)return!1;for(let r=e.length;n<r;n++)if(eF(e,n))return uP.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return JM(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,n){if(null!==this.basePTS)return XM(e,t,n,this.basePTS,this.frameIndex)}},remux:_F}];NF.splice(2,0,{demux:nF,remux:_F});class MF{constructor(e,t,n,r,s,i){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=i}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const s=n.transmuxing;s.executeStart=xF();let i=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;r&&(this.currentTransmuxState=r);const{contiguous:l,discontinuity:c,trackSwitch:u,accurateTimeOffset:d,timeOffset:h,initSegmentChange:f}=r||a,{audioCodec:p,videoCodec:g,defaultInitPts:m,duration:v,initSegmentData:y}=o,b=function(e,t){let n=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(n=t);return n}(i,t);if(b&&YO(b.method)){const e=this.getDecrypter(),t=QO(b.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(i,b.key.buffer,b.iv.buffer,t).then(e=>{const t=this.push(e,null,n);return this.decryptionPromise=null,t}),this.decryptionPromise;{let r=e.softwareDecrypt(i,b.key.buffer,b.iv.buffer,t);if(n.part>-1){const t=e.flush();r=t?t.buffer:t}if(!r)return s.executeEnd=xF(),FF(n);i=new Uint8Array(r)}}const E=this.needsProbing(c,u);if(E){const e=this.configureTransmuxer(i);if(e)return this.logger.warn("[transmuxer] ".concat(e.message)),this.observer.emit(HR.ERROR,HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),s.executeEnd=xF(),FF(n)}(c||u||f||E)&&this.resetInitSegment(y,p,g,v,t),(c||f||E)&&this.resetInitialTimestamp(m),l||this.resetContiguity();const w=this.transmux(i,b,h,d,n);this.asyncResult=UF(w);const S=this.currentTransmuxState;return S.contiguous=!0,S.discontinuity=!1,S.trackSwitch=!1,s.executeEnd=xF(),w}flush(e){const t=e.transmuxing;t.executeStart=xF();const{decrypter:n,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const i=[],{timeOffset:a}=r;if(n){const t=n.flush();t&&i.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=xF();const n=[FF(e)];return this.asyncResult?Promise.resolve(n):n}const c=o.flush(a);return UF(c)?(this.asyncResult=!0,c.then(t=>(this.flushRemux(i,t,e),i))):(this.flushRemux(i,c,e),this.asyncResult?Promise.resolve(i):i)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:s,id3Track:i,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log("[transmuxer.ts]: Flushed ".concat(this.id," sn: ").concat(n.sn).concat(n.part>-1?" part: "+n.part:""," of ").concat(this.id===QR?"level":"track"," ").concat(n.level));const c=this.remuxer.remux(r,s,i,a,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=xF()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,s){const{demuxer:i,remuxer:a}=this;i&&a&&(i.resetInitSegment(e,t,n,r),a.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,s){let i;return i=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,r,s):this.transmuxUnencrypted(e,n,r,s),i}transmuxUnencrypted(e,t,n,r){const{audioTrack:s,videoTrack:i,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,i,a,o,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,s){return this.demuxer.demuxSampleAes(e,t,n).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let s;for(let u=0,d=NF.length;u<d;u++){var i;if(null!=(i=NF[u].demux)&&i.probe(e,this.logger)){s=NF[u];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=s.remux,c=s.demux;o&&o instanceof l||(this.remuxer=new l(n,t,r,this.logger)),a&&a instanceof c||(this.demuxer=new c(n,t,r,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new kO(this.config)),e}}const FF=e=>({remuxResult:{},chunkMeta:e});function UF(e){return"then"in e&&e.then instanceof Function}class jF{constructor(e,t,n,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=s||null}}class BF{constructor(e,t,n,r,s,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=i}}let VF=0;class zF{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=VF++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,n=this.hls;if(n&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var r;const e=null==(r=this.workerContext)?void 0:r.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":n.logger[t.data.logType]&&n.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,n.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));this.hls.config.enableWorker=!1,this.hls.logger.warn('Error in "'.concat(this.id,'" Web Worker, fallback to inline')),this.hls.trigger(HR.ERROR,{type:zR.OTHER_ERROR,details:GR.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const i=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===HR.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new vM,this.observer.on(HR.FRAG_DECRYPTED,i),this.observer.on(HR.ERROR,i);const a=gD(s.preferManagedMediaSource);if(this.useWorker&&"undefined"!==typeof Worker){const n=this.hls.logger;if(s.workerPath||"function"===typeof __HLS_WORKER_BUNDLE__){try{s.workerPath?(n.log("loading Web Worker ".concat(s.workerPath,' for "').concat(t,'"')),this.workerContext=function(e){const t=bM[e];if(t)return t.clientCount++,t;const n=new self.URL(e,self.location.href).href,r={worker:new self.Worker(n),scriptURL:n,clientCount:1};return bM[e]=r,r}(s.workerPath)):(n.log('injecting Web Worker for "'.concat(t,'"')),this.workerContext=function(){const e=bM[yM];if(e)return e.clientCount++,e;const t=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),n=self.URL.createObjectURL(t),r={worker:new self.Worker(n),objectURL:n,clientCount:1};return bM[yM]=r,r}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:OD(s)})}catch(lz){n.warn('Error setting up "'.concat(t,'" Web Worker, fallback to inline'),lz),this.terminateWorker(),this.error=null,this.transmuxer=new MF(this.observer,a,s,"",t,e.logger)}return}}this.transmuxer=new MF(this.observer,a,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=VF++;const t=this.hls.config,n=gD(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:OD(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=bM[e||yM];if(t&&1===t.clientCount--){const{worker:n,objectURL:r}=t;delete bM[e||yM],r&&self.URL.revokeObjectURL(r),n.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,s,i,a,o,l,c){var u,d;l.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:f}=this,p=i?i.start:s.start,g=s.decryptdata,m=this.frag,v=!(m&&s.cc===m.cc),y=!(m&&l.level===m.level),b=m?l.sn-m.sn:-1,E=this.part?l.part-this.part.index:-1,w=0===b&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),S=!y&&(1===b||0===b&&(1===E||w&&E<=0)),T=self.performance.now();(y||b||0===s.stats.parsing.start)&&(s.stats.parsing.start=T),!i||!E&&S||(i.stats.parsing.start=T);const k=!(m&&(null==(u=s.initSegment)?void 0:u.url)===(null==(d=m.initSegment)?void 0:d.url)),x=new BF(v,S,o,y,p,k);if(!S||v||k){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for ".concat(s.type," sn: ").concat(l.sn).concat(l.part>-1?" part: "+l.part:""," ").concat(this.id===QR?"level":"track",": ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(v,"\n        trackSwitch: ").concat(y,"\n        contiguous: ").concat(S,"\n        accurateTimeOffset: ").concat(o,"\n        timeOffset: ").concat(p,"\n        initSegmentChange: ").concat(k));const e=new jF(n,r,t,a,c);this.configureTransmuxer(e)}if(this.frag=s,this.part=i,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:x},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,g,l,x);UF(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const t=n.flush(e);UF(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class GF extends sP{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=null==t?void 0:t.renditionReports;if(r){let i=-1;for(let n=0;n<r.length;n++){const a=r[n];let o;try{o=new self.URL(a.URI,t.url).href}catch(s){this.warn("Could not construct new URL for Rendition Report: ".concat(s)),o=a.URI||""}if(o===e){i=n;break}o===e.substring(0,o.length)&&(i=n)}if(-1!==i){const e=r[i],s=parseInt(e["LAST-MSN"])||t.lastPartSn;let a=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=n&&_D(n);return new AD(s,a>=0?a:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(n))}return e}playlistLoaded(e,t,n){const{details:r,stats:s}=t,i=self.performance.now(),a=s.loading.first?Math.max(0,i-s.loading.first):0;r.advancedDateTime=Date.now()-a;const o=this.hls.config.timelineOffset;if(o!==r.appliedTimelineOffset){const e=Math.max(o||0,0);r.appliedTimelineOffset=e,r.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(r.live||null!=n&&n.live){const o="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){ON(n,r,this);const e=r.playlistParsingError;if(e){this.warn(e);const n=this.hls;if(!n.config.ignorePlaylistParsingErrors){var l;const{networkDetails:i}=t;return void n.trigger(HR.ERROR,{type:zR.NETWORK_ERROR,details:GR.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=r.fragments[0])?void 0:l.type,networkDetails:i,stats:s})}r.playlistParsingError=null}}-1===r.requestScheduled&&(r.requestScheduled=s.loading.start);const c=this.hls.mainForwardBufferInfo,u=c?c.end-c.len:0,d=UN(r,1e3*(r.edge-u));if(r.requestScheduled+d<i?r.requestScheduled=i:r.requestScheduled+=d,this.log("live playlist ".concat(e," ").concat(r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED")),!this.canLoad||!r.live)return;let h,f,p;if(r.canBlockReload&&r.endSN&&r.advanced){const e=this.hls.config.lowLatencyMode,s=r.lastPartSn,a=r.endSN,l=r.lastPartIndex,c=s===a;-1!==l?c?(f=a+1,p=e?0:l):(f=s,p=e?l+1:r.maxPartIndex):f=a+1;const u=r.age,d=u+r.ageHeader;let g=Math.min(d-r.partTarget,1.5*r.targetduration);if(g>0){if(d>3*r.targetduration)this.log("Playlist last advanced ".concat(u.toFixed(2),"s ago. Omitting segment and part directives.")),f=void 0,p=void 0;else if(null!=n&&n.tuneInGoal&&d-r.partTarget>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(n.tuneInGoal," to: ").concat(g," with playlist age: ").concat(r.age)),g=0;else{const e=Math.floor(g/r.targetduration);if(f+=e,void 0!==p){p+=Math.round(g%r.targetduration/r.partTarget)}this.log("CDN Tune-in age: ".concat(r.ageHeader,"s last advanced ").concat(u.toFixed(2),"s goal: ").concat(g," skip sn ").concat(e," to part ").concat(p))}r.tuneInGoal=g}if(h=this.getDeliveryDirectives(r,t.deliveryDirectives,f,p),e||!c)return r.requestScheduled=i,void this.loadingPlaylist(o,h)}else(r.canBlockReload||r.canSkipUntil)&&(h=this.getDeliveryDirectives(r,t.deliveryDirectives,f,p));h&&void 0!==f&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(d-2*a,d/2)),this.scheduleLoading(o,h,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r)return void this.loadingPlaylist(e,t);const s=self.performance.now(),i=r.requestScheduled;if(s>=i)return void this.loadingPlaylist(e,t);const a=i-s;this.log("reload live playlist ".concat(e.name||e.bitrate+"bps"," in ").concat(Math.round(a)," ms")),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,r){let s=_D(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,s=ID),new AD(n,r,s)}checkRetry(e){const t=e.details,n=YD(e),r=e.errorAction,{action:s,retryCount:i=0,retryConfig:a}=r||{},o=!!r&&!!a&&(s===iO||!r.resolved&&s===rO);if(o){var l;if(i>=a.maxNumRetry)return!1;if(n&&null!=(l=e.context)&&l.deliveryDirectives)this.warn("Retrying playlist loading ".concat(i+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" without delivery-directives')),this.loadPlaylist();else{const e=JD(a,i);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn("Retrying playlist loading ".concat(i+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" in ').concat(e,"ms"))}e.levelRetry=!0,r.resolved=!0}return o}}function HF(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!KF(e[n].attrs,t[n].attrs))return!1;return!0}function KF(e,t,n){const r=e["STABLE-RENDITION-ID"];return r&&!n?r===t["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>e[n]!==t[n])}function WF(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class qF{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(null===this.queues||null===this.tracks)return;const r=this.queues[t];r.push(e),1!==r.length||n||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=null==(t=e[0])?void 0:t.label;"async-blocker"!==n&&"async-blocker-prepend"!==n||(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(r){var n;if(s.onError(r),null===this.queues||null===this.tracks)return;const t=null==(n=this.tracks[e])?void 0:n.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":"\n".concat(this.list("video"),"\n").concat(this.list("audio"),"\n").concat(this.list("audiovideo"),"}")}list(e){var t,n;return null!=(t=this.queues)&&t[e]||null!=(n=this.tracks)&&n[e]?"".concat(e,": (").concat(this.listSbInfo(e),") ").concat(this.listOps(e)):""}listSbInfo(e){var t;const n=null==(t=this.tracks)?void 0:t[e],r=null==n?void 0:n.buffer;return r?"SourceBuffer".concat(r.updating?" updating":"").concat(n.ended?" ended":"").concat(n.ending?" ending":""):"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}const YF=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,QF="HlsJsTrackRemovedError";class XF extends Error{constructor(e){super(e),this.name=QF}}function ZF(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function JF(e){return"audio"===e?1:0}class $F{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(HR.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.on(HR.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(HR.BUFFER_CODECS,this.onBufferCodecs,this),e.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(HR.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.off(HR.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(HR.BUFFER_CODECS,this.onBufferCodecs,this),e.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&jR(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to ".concat(n,": ").concat(e[n].height,"p@").concat(e[n].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((t,n)=>this.isLevelAllowed(t)&&n<=e);return this.clientRect=null,$F.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(_w){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,n){if(null==e||!e.length)return-1;const r=(e,t)=>!t||(e.width!==t.width||e.height!==t.height);let s=e.length-1;const i=Math.max(t,n);for(let a=0;a<e.length;a+=1){const t=e[a];if((t.width>=i||t.height>=i)&&r(t,e[a+1])){s=a;break}}return s}}const eU={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},tU={HLS:"h"};class nU{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof nU?e:new nU(e))),this.value=e,this.params=t}}function rU(e,t,n,r){return new Error("failed to ".concat(e,' "').concat((s=t,Array.isArray(s)?JSON.stringify(s):s instanceof Map?"Map{}":s instanceof Set?"Set{}":"object"===typeof s?JSON.stringify(s):String(s)),'" as ').concat(n),{cause:r});var s}function sU(e,t,n){return rU("serialize",e,t,n)}class iU{constructor(e){this.description=e}}const aU="Bare Item";function oU(e){if(!1===ArrayBuffer.isView(e))throw sU(e,"Byte Sequence");return":".concat((t=e,btoa(String.fromCharCode(...t))),":");var t}function lU(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw sU(e,"Integer");return e.toString()}function cU(e,t){if(e<0)return-cU(-e,t);const n=Math.pow(10,t);if(Math.abs(e*n%1-.5)<Number.EPSILON){const t=Math.floor(e*n);return(t%2===0?t:t+1)/n}return Math.round(e*n)/n}function uU(e){const t=cU(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw sU(e,"Decimal");const n=t.toString();return n.includes(".")?n:"".concat(n,".0")}const dU=/[\x00-\x1f\x7f]+/;function hU(e){const t=(n=e).description||n.toString().slice(7,-1);var n;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw sU(t,"Token");return t}function fU(e){switch(typeof e){case"number":if(!jR(e))throw sU(e,aU);return Number.isInteger(e)?lU(e):uU(e);case"string":return function(e){if(dU.test(e))throw sU(e,"String");return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}(e);case"symbol":return hU(e);case"boolean":return function(e){if("boolean"!==typeof e)throw sU(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return"@".concat(lU(e.getTime()/1e3))}(e);if(e instanceof Uint8Array)return oU(e);if(e instanceof iU)return hU(e);default:throw sU(e,aU)}}function pU(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw sU(e,"Key");return e}function gU(e){return null==e?"":Object.entries(e).map(e=>{let[t,n]=e;return!0===n?";".concat(pU(t)):";".concat(pU(t),"=").concat(fU(n))}).join("")}function mU(e){return e instanceof nU?"".concat(fU(e.value)).concat(gU(e.params)):fU(e)}function vU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if("object"!==typeof e||null==e)throw sU(e,"Dict");const n=e instanceof Map?e.entries():Object.entries(e),r=(null===t||void 0===t?void 0:t.whitespace)?" ":"";return Array.from(n).map(e=>{let[t,n]=e;n instanceof nU===!1&&(n=new nU(n));let r=pU(t);var s;return!0===n.value?r+=gU(n.params):(r+="=",Array.isArray(n.value)?r+="(".concat((s=n).value.map(mU).join(" "),")").concat(gU(s.params)):r+=mU(n)),r}).join(",".concat(r))}function yU(e,t){return vU(e,t)}const bU="CMCD-Object",EU="CMCD-Request",wU="CMCD-Session",SU="CMCD-Status",TU={br:bU,ab:bU,d:bU,ot:bU,tb:bU,tpb:bU,lb:bU,tab:bU,lab:bU,url:bU,pb:EU,bl:EU,tbl:EU,dl:EU,ltc:EU,mtp:EU,nor:EU,nrr:EU,rc:EU,sn:EU,sta:EU,su:EU,ttfb:EU,ttfbb:EU,ttlb:EU,cmsdd:EU,cmsds:EU,smrt:EU,df:EU,cs:EU,ts:EU,cid:wU,pr:wU,sf:wU,sid:wU,st:wU,v:wU,msd:wU,bs:SU,bsd:SU,cdn:SU,rtp:SU,bg:SU,pt:SU,ec:SU,e:SU},kU=EU;function xU(e,t){const n={};if(!e)return n;const r=Object.keys(e),s=t?(i=t,Object.keys(i).reduce((e,t)=>{var n;return null===(n=i[t])||void 0===n||n.forEach(n=>e[n]=t),e},{})):{};var i;return r.reduce((t,n)=>{var r;const i=TU[n]||s[n]||kU;return(null!==(r=t[i])&&void 0!==r?r:t[i]={})[n]=e[n],t},n)}const IU="event";const LU=e=>Math.round(e),CU=(e,t)=>Array.isArray(e)?e.map(e=>CU(e,t)):e instanceof nU&&"string"===typeof e.value?new nU(CU(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){const n=new URL(e),r=new URL(t);if(n.origin!==r.origin)return e;const s=n.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+n.search+n.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),_U=e=>100*LU(e/100),AU={br:LU,d:LU,bl:_U,dl:_U,mtp:_U,nor:(e,t)=>{let n=e;return t.version>=2&&(e instanceof nU&&"string"===typeof e.value?n=new nU([e]):"string"===typeof e&&(n=[e])),CU(n,t)},rtp:_U,tb:LU},RU="request",PU="response",DU=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],OU=["e"],NU=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function MU(e){return NU.test(e)}const FU=["d","dl","nor","ot","rtp","su"];const UU=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const jU=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function BU(e){return jU.includes(e)||MU(e)}const VU={[PU]:function(e){return DU.includes(e)||FU.includes(e)||UU.includes(e)||MU(e)},[IU]:function(e){return DU.includes(e)||OU.includes(e)||MU(e)},[RU]:function(e){return DU.includes(e)||FU.includes(e)||MU(e)}};function zU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(null==e||"object"!==typeof e)return n;const r=t.version||e.v||1,s=t.reportingMode||RU,i=1===r?BU:VU[s];let a=Object.keys(e).filter(i);const o=t.filter;"function"===typeof o&&(a=a.filter(o));const l=s===PU||s===IU;l&&!a.includes("ts")&&a.push("ts"),r>1&&!a.includes("v")&&a.push("v");const c=tP({},AU,t.formatters),u={version:r,reportingMode:s,baseUrl:t.baseUrl};return a.sort().forEach(t=>{let s=e[t];const i=c[t];if("function"===typeof i&&(s=i(s,u)),"v"===t){if(1===r)return;s=r}"pr"==t&&1===s||(l&&"ts"===t&&!jR(s)&&(s=Date.now()),function(e){return"number"===typeof e?jR(e):null!=e&&""!==e&&!1!==e}(s)&&(function(e){return["ot","sf","st","e","sta"].includes(e)}(t)&&"string"===typeof s&&(s=new iU(s)),n[t]=s))}),n}function GU(e,t,n){return tP(e,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(!e)return n;const r=xU(zU(e,t),null===t||void 0===t?void 0:t.customHeaderMap);return Object.entries(r).reduce((e,t)=>{let[n,r]=t;const s=yU(r,{whitespace:!1});return s&&(e[n]=s),e},n)}(t,n))}function HU(e){if(!e)return"";const t=function(e){return e?yU(zU(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),{whitespace:!1}):""}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return encodeURIComponent(t)}const KU=/CMCD=[^&#]+/;function WU(e,t,n){const r=function(e){if(!e)return"";const t=HU(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return"".concat("CMCD","=").concat(t)}(t,n);if(!r)return e;if(KU.test(e))return e.replace(KU,r);const s=e.includes("?")?"&":"?";return"".concat(e).concat(s).concat(r)}function qU(e,t,n,r){e&&Object.keys(t).forEach(s=>{const i=e.filter(e=>e.groupId===s).map(e=>{const i=tP({},e);return i.details=void 0,i.attrs=new VO(i.attrs),i.url=i.attrs.URI=YU(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),i.groupId=i.attrs["GROUP-ID"]=t[s],i.attrs["PATHWAY-ID"]=r,i});e.push(...i)})}function YU(e,t,n,r){const{HOST:s,PARAMS:i,[n]:a}=r;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return s&&!o&&(l.host=s),i&&Object.keys(i).sort().forEach(e=>{e&&l.searchParams.set(e,i[e])}),l.href}class QU extends sP{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=QU.CDMCleanupPromise?[QU.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:t,initData:n}=e,r='"'.concat(e.type,'" event: init data type: "').concat(t,'"');if(this.debug(r),null!==n){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=lN(this.config));const t=e.map(oN).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(s=>{const i=aN(s);if("sinf"!==t||i!==tN.FAIRPLAY)return void this.log('Ignoring "'.concat(e.type,'" event with init data type: "').concat(t,'" for selected key-system ').concat(i));let a;try{const e=PP(new Uint8Array(n)),t=WP(XO(JSON.parse(e).sinf));if(!t)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(t.subarray(8,24))}catch(d){return void this.warn("".concat(r," Failed to parse sinf: ").concat(d))}const o=pP(a),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let u=l[o];for(let e=0;e<c.length;e++){const r=c[e],s=r.decryptdata;if(!s.keyId)continue;const i=pP(s.keyId);if(WO(a,s.keyId)||-1!==s.uri.replace(/-/g,"").indexOf(o)){if(u=l[i],!u)continue;if(s.pssh)break;delete l[i],s.pssh=new Uint8Array(n),s.keyId=a,u=l[o]=u.then(()=>this.generateRequestWithPreferredKeySession(r,t,n,"encrypted-event-key-match")),u.catch(e=>this.handleError(e));break}}u||this.handleError(new Error("Key ID ".concat(o," not encountered in playlist. Key-system sessions ").concat(c.length,".")))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log('"'.concat(e.type,'" event'))},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(HR.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(HR.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(HR.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(HR.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(HR.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(HR.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(HR.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(HR.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=null==t?void 0:t[e];return r?r.licenseUrl:e===tN.WIDEVINE&&n?n:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error('no license server URL configured for key-system "'.concat(e,'"'));return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=null==t?void 0:t[e];if(n)return n.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}attemptKeySystemAccess(e){const t=this.hls.levels,n=(e,t,n)=>!!e&&n.indexOf(e)===t,r=t.map(e=>e.audioCodec).filter(n),s=t.map(e=>e.videoCodec).filter(n);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((t,n)=>{const i=e=>{const a=e.shift();this.getMediaKeysPromise(a,r,s).then(e=>t({keySystem:a,mediaKeys:e})).catch(t=>{e.length?i(e):n(t instanceof JU?t:new JU({type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};i(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!==typeof n){let e="Configured requestMediaKeySystemAccess is not a function ".concat(n);return null===cN&&"http:"===self.location.protocol&&(e="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(e))}return n(e,t)}getMediaKeysPromise(e,t,n){var r;const s=function(e,t,n,r){let s;switch(e){case tN.FAIRPLAY:s=["cenc","sinf"];break;case tN.WIDEVINE:case tN.PLAYREADY:s=["cenc"];break;case tN.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(e))}return function(e,t,n,r){return[{initDataTypes:e,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:"audio/mp4; codecs=".concat(e),robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:n.map(e=>({contentType:"video/mp4; codecs=".concat(e),robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}(s,t,n,r)}(e,t,n,this.config.drmSystemOptions||{});let i=this.keySystemAccessPromises[e],a=null==(r=i)?void 0:r.keySystemAccess;if(!a){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(OD(s))),a=this.requestMediaKeySystemAccess(e,s);const t=i=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(t=>{this.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))}),a.then(n=>{this.log('Access for key-system "'.concat(n.keySystem,'" obtained'));const r=this.fetchServerCertificate(e);this.log('Create media-keys for "'.concat(e,'"'));const s=t.mediaKeys=n.createMediaKeys().then(n=>(this.log('Media-keys created for "'.concat(e,'"')),t.hasMediaKeys=!0,r.then(t=>t?this.setMediaKeysServerCertificate(n,e,t):n)));return s.catch(t=>{this.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))}),s})}return a.then(()=>i.mediaKeys)}createMediaKeySessionContext(e){let{decryptdata:t,keySystem:n,mediaKeys:r}=e;this.log('Creating key-system session "'.concat(n,'" keyId: ').concat(pP(t.keyId||[])," keyUri: ").concat(t.uri));const s=r.createSession(),i={decryptdata:t,keySystem:n,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=XU(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log('Updating key-session "'.concat(n.sessionId,'" for keyId ').concat(pP(e.decryptdata.keyId||[]),"\n      } (data length: ").concat(t.byteLength,")")),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(e=>{let{hasMediaKeys:t}=e;return!!t}).map(e=>{let{keySystem:t}=e;return oN(t)}).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:t,mediaKeys:n}=e;return this.attemptSetMediaKeys(t,n)})}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:r}=e;const s=oN(r);s?t(s):n(new Error('Unable to find format for key-system "'.concat(r,'"')))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=lN(this.config),n=e.map(aN).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const r=ZU(e,t[n]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,n=XU(t),r=this.bannedKeyIds[n];if(r||"internal-error"===this.getKeyStatus(t)){const n=$U(r||"internal-error",t);return this.handleError(n,e.frag),Promise.reject(n)}const s="(keyId: ".concat(n,' format: "').concat(t.keyFormat,'" method: ').concat(t.method," uri: ").concat(t.uri,")");this.log("Starting session for key ".concat(s));const i=this.keyIdToKeySessionPromise[n];if(!i){const r=this.getKeySystemForKeyPromise(t).then(n=>{let{keySystem:r,mediaKeys:i}=n;return this.throwIfDestroyed(),this.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(s)),this.attemptSetMediaKeys(r,i).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:r,mediaKeys:i,decryptdata:t})))}).then(e=>{const n=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",n,"playlist-key")});return r.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[n]=r,r}return i.catch(n=>{if(n instanceof JU){const r=rP({},n.data);"internal-error"===this.getKeyStatus(t)&&(r.decryptdata=t);const s=new JU(r,n.message);this.handleError(s,e.frag)}}),i}throwIfDestroyed(){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof JU){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error("".concat(e.message).concat(n?" (".concat(pP(n.keyId||[]),")"):"")),this.hls.trigger(HR.ERROR,e.data)}else this.error(e.message),this.hls.trigger(HR.ERROR,{type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=XU(e),n=this.keyIdToKeySessionPromise[t];if(!n){const t=aN(e.keyFormat),n=t?[t]:lN(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=lN(this.config)),0===e.length)throw new JU({type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(OD({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));const r=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((e,n)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return n(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(e).catch(n)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log('Media-keys set for "'.concat(e,'"')),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===n.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,n,r){var s;const i=null==(s=this.config.drmSystems)||null==(s=s[e.keySystem])?void 0:s.generateRequest;if(i)try{const r=i.call(this.hls,t,n,e);if(!r)throw new Error("Invalid response from configured generateRequest filter");t=r.initDataType,n=r.initData?r.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(f){if(this.warn(f.message),this.hls&&this.hls.config.debug)throw f}if(null===n)return this.log('Skipping key-session request for "'.concat(r,'" (no initData)')),Promise.resolve(e);const a=XU(e.decryptdata),o=e.decryptdata.uri;this.log('Generating key-session request for "'.concat(r,'" keyId: ').concat(a," URI: ").concat(o," (init data type: ").concat(t," length: ").concat(n.byteLength,")"));const l=new vM,c=e._onmessage=t=>{const n=e.mediaKeysSession;if(!n)return void l.emit("error",new Error("invalid state"));const{messageType:r,message:s}=t;this.log('"'.concat(r,'" message event for session "').concat(n.sessionId,'" message size: ').concat(s.byteLength)),"license-request"===r||"license-renewal"===r?this.renewLicense(e,s).catch(e=>{l.eventNames().length?l.emit("error",e):this.handleError(e)}):"license-release"===r?e.keySystem===tN.FAIRPLAY&&this.updateKeySession(e,ZO("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn('unhandled media key message type "'.concat(r,'"'))},u=(e,t)=>{let n;t.keyStatus=e,e.startsWith("usable")?l.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?n=$U(e,t.decryptdata):"expired"===e?n=new Error("key expired (keyId: ".concat(a,")")):"released"===e?n=new Error("key released"):"status-pending"===e||this.warn('unhandled key status change "'.concat(e,'" (keyId: ').concat(a,")")),n&&(l.eventNames().length?l.emit("error",n):this.handleError(n))},d=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void l.emit("error",new Error("invalid state"));const n=this.getKeyStatuses(e);if(!Object.keys(n).some(e=>"status-pending"!==n[e]))return;if("expired"===n[a])return this.log("Expired key ".concat(OD(n),' in key-session "').concat(e.mediaKeysSession.sessionId,'"')),void this.renewKeySession(e);let r=n[a];if(r)u(r,e);else{var s;const t=1e3;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(s=e.keyStatusTimeouts)[a]||(s[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const n=this.getKeyStatus(e.decryptdata);if(n&&"status-pending"!==n)return this.log("No status for keyId ".concat(a,' in key-session "').concat(e.mediaKeysSession.sessionId,'". Using session key-status ').concat(n," from other session.")),u(n,e);this.log("key status for ".concat(a,' in key-session "').concat(e.mediaKeysSession.sessionId,'" timed out after ').concat(t,"ms")),r="internal-error",u(r,e)},t)),this.log("No status for keyId ".concat(a," (").concat(OD(n),")."))}};XN(e.mediaKeysSession,"message",c),XN(e.mediaKeysSession,"keystatuseschange",d);const h=new Promise((e,t)=>{l.on("error",t),l.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log('Request generated for key-session "'.concat(e.mediaKeysSession.sessionId,'" keyId: ').concat(a," URI: ").concat(o))}).catch(t=>{throw new JU({type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},"Error generating key-session request: ".concat(t))}).then(()=>h).catch(t=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,r)=>{if("string"===typeof r&&"object"===typeof n){const e=r;r=n,n=e}const s="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===tN.PLAYREADY&&16===s.length){const e=pP(s);t[e]=n,JO(s)}const i=pP(s);"internal-error"===n&&(this.bannedKeyIds[i]=n),this.log('key status change "'.concat(n,'" for keyStatuses keyId: ').concat(i,' key-session "').concat(e.mediaKeysSession.sessionId,'"')),t[i]=n}),t}fetchServerCertificate(e){const t=this.config,n=new(0,t.loader)(t),r=this.getServerCertificateUrl(e);return r?(this.log('Fetching server certificate for "'.concat(e,'"')),new Promise((s,i)=>{const a={responseType:"arraybuffer",url:r},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{s(e.data)},onError:(t,n,s,o)=>{i(new JU({type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:rP({url:a.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(r,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:(t,n,s)=>{i(new JU({type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:{url:a.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(r,")")))},onAbort:(e,t,n)=>{i(new Error("aborted"))}};n.load(a,l,c)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,s)=>{e.setServerCertificate(n).then(s=>{this.log("setServerCertificate ".concat(s?"success":"not supported by CDM"," (").concat(n.byteLength,') on "').concat(t,'"')),r(e)}).catch(e=>{s(new JU({type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new JU({type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=(new DOMParser).parseFromString(n,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let t;for(let n=0,r=s.length;n<r;n++){var i,a;t=s[n];const r=null==(i=t.querySelector("name"))?void 0:i.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;r&&o&&e.setRequestHeader(r,o)}}const o=r.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return ZO(atob(l))}setupLicenseXHR(e,t,n,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,r)}).catch(i=>{if(!n.decryptdata)throw i;return e.open("POST",t,!0),s.call(this.hls,e,t,n,r)}).then(n=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:n||r}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const i=this.getLicenseServerUrlOrThrow(e.keySystem);this.log("Sending license request to URL: ".concat(i));const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log("License received ".concat(t instanceof ArrayBuffer?t.byteLength:t));const n=this.config.licenseResponseCallback;if(n)try{t=n.call(this.hls,a,i,e)}catch(o){this.error(o)}r(t)}else{const o=n.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)s(new JU({type:zR.KEY_SYSTEM_ERROR,details:GR.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:i,data:void 0,code:a.status,text:a.statusText}},"License Request XHR failed (".concat(i,"). Status: ").concat(a.status," (").concat(a.statusText,")")));else{const n=l-this._requestLicenseFailureCount+1;this.warn("Retrying license request, ".concat(n," attempts left")),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,i,e,t).then(t=>{let{xhr:n,licenseChallenge:r}=t;e.keySystem==tN.PLAYREADY&&(r=this.unpackPlayReadyKeyMessage(n,r)),n.send(r)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,XN(n,"encrypted",this.onMediaEncrypted),XN(n,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(ZN(e,"encrypted",this.onMediaEncrypted),ZN(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,fN.clearKeyUriToKeyIdMap();const s=r.length;QU.CDMCleanupPromise=Promise.all(r.map(e=>this.removeSession(e)).concat((null==n||null==(e=n.setMediaKeys(null))?void 0:e.catch(e=>{this.log("Could not clear media keys: ".concat(e)),this.hls&&this.hls.trigger(HR.ERROR,{type:zR.OTHER_ERROR,details:GR.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: ".concat(e))})}))||Promise.resolve())).catch(e=>{this.log("Could not close sessions and clear media keys: ".concat(e)),this.hls&&this.hls.trigger(HR.ERROR,{type:zR.OTHER_ERROR,details:GR.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: ".concat(e))})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,t){let{sessionKeys:n}=t;if(n&&this.config.emeEnabled&&!this.keyFormatPromise){const e=n.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log("Selecting key-system from session-keys ".concat(e.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:r}=e;if(t){this.log('Remove licenses and keys and close session "'.concat(t.sessionId,'" keyId: ').concat(pP((null==r?void 0:r.keyId)||[]))),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:i}=e;i&&Object.keys(i).forEach(e=>self.clearTimeout(i[e]));const{drmSystemOptions:a}=this.config,o=function(e){var t;return!!e&&("persistent-license"===e.sessionType||!(null==(t=e.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(a)?new Promise((e,n)=>{self.setTimeout(()=>n(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(n)}):Promise.resolve();return o.catch(e=>{this.log("Could not remove session: ".concat(e)),this.hls&&this.hls.trigger(HR.ERROR,{type:zR.OTHER_ERROR,details:GR.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: ".concat(e))})}).then(()=>t.close()).catch(e=>{this.log("Could not close session: ".concat(e)),this.hls&&this.hls.trigger(HR.ERROR,{type:zR.OTHER_ERROR,details:GR.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: ".concat(e))})})}return Promise.resolve()}}function XU(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return pP(e.keyId)}function ZU(e,t){return e.keyId&&t.mediaKeysSession.keyStatuses.has(e.keyId)?t.mediaKeysSession.keyStatuses.get(e.keyId):e.matches(t.decryptdata)?t.keyStatus:void 0}QU.CDMCleanupPromise=void 0;class JU extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function $U(e,t){const n="output-restricted"===e,r=n?GR.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:GR.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new JU({type:zR.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:t},n?"HDCP level output restricted":'key status changed to "'.concat(e,'"'))}function ej(e,t){let n;try{n=new Event("addtrack")}catch(lz){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function tj(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: ".concat(t))}catch(lz){uP.debug("[texttrack-utils]: ".concat(lz));try{const n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(r){uP.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(r))}}"disabled"===n&&(e.mode=n)}function nj(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues)for(let r=e.cues.length;r--;)t&&e.cues[r].removeEventListener("enter",t),e.removeCue(e.cues[r]);"disabled"===n&&(e.mode=n)}function rj(e,t,n,r){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&e.cues.length>0){const s=function(e,t,n){const r=[],s=function(e,t){if(t<=e[0].startTime)return 0;const n=e.length-1;if(t>e[n].endTime)return-1;let r,s=0,i=n;for(;s<=i;)if(r=Math.floor((i+s)/2),t<e[r].startTime)i=r-1;else{if(!(t>e[r].startTime&&s<n))return r;s=r+1}return e[s].startTime-t<t-e[i].startTime?s:i}(e,t);if(s>-1)for(let i=s,a=e.length;i<a;i++){const s=e[i];if(s.startTime>=t&&s.endTime<=n)r.push(s);else if(s.startTime>n)return r}return r}(e.cues,t,n);for(let t=0;t<s.length;t++)r&&!r(s[t])||e.removeCue(s[t])}"disabled"===s&&(e.mode=s)}function sj(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];"subtitles"!==r.kind&&"captions"!==r.kind||!r.label||t.push(e[n])}return t}function ij(e){let t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}const aj=.025;let oj=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function lj(e,t,n){return"".concat(e.identifier,"-").concat(n+1,"-").concat(ij(t))}class cj{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;if(e<=0||isNaN(n))return!1;if(0===n)return!0;return((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return uj(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-uj(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=jR(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return uj(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<aj))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?oj.Range:oj.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return'["'.concat((e=this).identifier,'" ').concat(e.cue.pre?"<pre>":e.cue.post?"<post>":"").concat(e.timelineStart.toFixed(2),"-").concat(e.resumeTime.toFixed(2),"]");var e}}function uj(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<aj)?t.start:t.start+t.duration}function dj(e,t,n){const r=new self.URL(e,n);return"data:"!==r.protocol&&r.searchParams.set("_HLS_primary_id",t),r}function hj(e,t){for(;null!=(n=e.assetList[++t])&&n.error;)var n;return t}function fj(e){const t=e.timelineStart,n=e.duration||0;return'["'.concat(e.identifier,'" ').concat(t.toFixed(2),"-").concat((t+n).toFixed(2),"]")}class pj{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(HR.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=r;const i=()=>{this.hasDetails=!0};s.once(HR.LEVEL_LOADED,i),s.once(HR.AUDIO_TRACK_LOADED,i),s.once(HR.SUBTITLE_TRACK_LOADED,i),s.on(HR.MEDIA_ATTACHING,(e,t)=>{let{media:n}=t;this.removeMediaListeners(),this.mediaAttached=n;this.interstitial.playoutLimit&&(n.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(HR.BUFFER_APPENDED,()=>{const e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,s.trigger(HR.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let n=this.assetItem.uri;try{n=dj(n,e.config.primarySessionId||"").href}catch(t){}e.loadSource(n)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=DO.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=n-.02}reachedPlayout(e){const t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=DO.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var r;null==(r=this.hls)||r.on(e,t)}once(e,t,n){var r;null==(r=this.hls)||r.once(e,t)}off(e,t,n){var r;null==(r=this.hls)||r.off(e,t)}toString(){var e;return"HlsAssetPlayer: ".concat(fj(this.assetItem)," ").concat(null==(e=this.hls)?void 0:e.sessionId," ").concat(this.appendInPlace?"append-in-place":"")}}class gj extends sP{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(void 0===t&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&null!=(s=r[n])&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let s=n[r];if(t&&"primary"!==t&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const e=n[r].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if((null==(n=t[r].event)?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let s=0;s<r;s++){const e=n[s];if(!e.error){const n=e.timelineStart;if(t===n||t>n&&(t<n+(e.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;const t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){const e=t.assetList,n=e[e.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,s=this.events,i=this.parseDateRanges(r,{url:n.url},t),a=Object.keys(r),o=s?s.filter(e=>!a.includes(e.identifier)):[];i.length&&i.sort((e,t)=>{const n=e.cue.pre,r=e.cue.post,s=t.cue.pre,i=t.cue.post;if(n&&!s)return-1;if(s&&!n)return 1;if(r&&!i)return 1;if(i&&!r)return-1;if(!n&&!s&&!r&&!i){const n=e.startTime,r=t.startTime;if(n!==r)return n-r}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=i,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.events||[];if(r.length||t.length||this.length<2){const s=this.items,i=this.parseSchedule(r,e),a=n||t.length||(null==s?void 0:s.length)!==i.length||i.some((e,t)=>Math.abs(e.playout.start-s[t].playout.start)>.005||Math.abs(e.playout.end-s[t].playout.end)>.005);a&&(this.items=i,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,n){const r=[],s=Object.keys(e);for(let i=0;i<s.length;i++){const a=s[i],o=e[a];if(o.isInterstitial){let e=this.eventMap[a];e?e.setDateRange(o):(e=new cj(o,t),this.eventMap[a]=e,!1===n&&(e.appendInPlace=n)),r.push(e)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,s=r.live?1/0:r.edge;let i=0;if((e=e.filter(e=>!e.error&&!(e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let r=0,o=0;if(e.forEach((t,a)=>{const l=t.cue.pre,c=t.cue.post,u=e[a-1]||null,d=t.appendInPlace,h=c?s:t.startOffset,f=t.duration,p=t.timelineOccupancy===oj.Range?f:0,g=t.resumptionOffset,m=(null==u?void 0:u.startTime)===h,v=h+t.cumulativeDuration;let y=d?v+f:h+g;if(l||!c&&h<=0){const e=o;o+=p,t.timelineStart=v;const r=i;i+=f,n.push({event:t,start:v,end:y,playout:{start:r,end:i},integrated:{start:e,end:o}})}else{if(!(h<=s))return;{if(!m){const s=h-r;if(s>.033){const l=r,c=o;o+=s;const u=i;i+=s;const d={previousEvent:e[a-1]||null,nextEvent:t,start:l,end:l+s,playout:{start:u,end:i},integrated:{start:c,end:o}};n.push(d)}else s>0&&u&&(u.cumulativeDuration+=s,n[n.length-1].end=h)}c&&(y=v),t.timelineStart=v;const s=o;o+=p;const l=i;i+=f,n.push({event:t,start:v,end:y,playout:{start:l,end:i},integrated:{start:s,end:o}})}}const b=t.resumeTime;r=c||b>s?s:b}),r<s){var a;const e=r,t=o,l=s-r;o+=l;const c=i;i+=l,n.push({previousEvent:(null==(a=n[n.length-1])?void 0:a.event)||null,nextEvent:null,start:r,end:e+l,playout:{start:c,end:i},integrated:{start:t,end:o}})}this.setDurations(s,i,o)}else{const e=0;n.push({previousEvent:null,nextEvent:null,start:e,end:s,playout:{start:e,end:s},integrated:{start:e,end:s}}),this.setDurations(s,s,s)}return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let s=0,i=-1;e.forEach((a,o)=>{const l=a.cue.pre,c=a.cue.post,u=l?0:c?r:a.startTime;this.updateAssetDurations(a);if(i===u?a.cumulativeDuration=s:(s=0,i=u),!c&&a.snapOptions.in&&(a.resumeAnchor=HD(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)}if(!a.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn("Could not change append strategy for abutting event ".concat(a)))}const d=jR(a.resumeOffset)?a.resumeOffset:a.duration;s+=d})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;if(Math.abs(n-r)>aj)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with estimated timeline end ").concat(r)),!1;return!Object.keys(t).some(r=>{const s=t[r].details,i=s.edge;if(n>=i)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," past ").concat(r," playlist end ").concat(i)),!1;const a=HD(null,s.fragments,n);if(!a)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," does not align with any fragments in ").concat(r," playlist (").concat(s.fragStart,"-").concat(s.fragmentEnd,")")),!0;const o="audio"===r?.175:0;return!(Math.abs(a.start-n)<aj+o||Math.abs(a.end-n)<aj+o)&&(this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with ").concat(r," fragment bounds (").concat(a.start,"-").concat(a.end," sn: ").concat(a.sn," cc: ").concat(a.cc,")")),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,s=!1;for(let i=0;i<e.assetList.length;i++){const a=e.assetList[i],o=t+n;a.startOffset=n,a.timelineStart=o,r||(r=null===a.duration),s||(s=!!a.error);n+=a.error?0:a.duration||0}e.duration=r&&!s?Math.max(n,e.duration):n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function mj(e){return"[".concat(e.event?'"'+e.event.identifier+'"':"primary",": ").concat(e.start.toFixed(2),"-").concat(e.end.toFixed(2),"]")}class vj{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=dj(n,this.hls.sessionId,e.baseUrl)}catch(u){const t=this.assignAssetListError(e,GR.ASSET_LIST_LOAD_ERROR,u,n);return void this.hls.trigger(HR.ERROR,t)}t&&"data:"!==r.protocol&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,i=new(0,s.loader)(s),a={responseType:"json",url:r.href},o=s.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,n,r,s)=>{const i=t.data,a=null==i?void 0:i.ASSETS;if(!Array.isArray(a)){const t=this.assignAssetListError(e,GR.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),r.url,n,s);return void this.hls.trigger(HR.ERROR,t)}e.assetListResponse=i,this.hls.trigger(HR.ASSET_LIST_LOADED,{event:e,assetListResponse:i,networkDetails:s})},onError:(t,n,r,s)=>{const i=this.assignAssetListError(e,GR.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status ".concat(t.code," ").concat(t.text," (").concat(n.url,")")),n.url,s,r);this.hls.trigger(HR.ERROR,i)},onTimeout:(t,n,r)=>{const s=this.assignAssetListError(e,GR.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST (".concat(n.url,")")),n.url,t,r);this.hls.trigger(HR.ERROR,s)}};return i.load(a,l,c),this.hls.trigger(HR.ASSET_LIST_LOADING,{event:e}),i}assignAssetListError(e,t,n,r,s,i){return e.error=n,{type:zR.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:i,stats:s}}}function yj(e){var t;null==e||null==(t=e.play())||t.catch(()=>{})}function bj(e,t){return"[".concat(e,"] Advancing timeline position to ").concat(t)}class Ej{constructor(e){this.buffered=void 0;const t=(t,n,r)=>{if((n>>>=0)>r-1)throw new DOMException("Failed to execute '".concat(t,"' on 'TimeRanges': The index provided (").concat(n,") is greater than the maximum bound (").concat(r,")"));return e[n][t]};this.buffered={get length(){return e.length},end:n=>t("end",n,e.length),start:n=>t("start",n,e.length)}}}const wj={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Sj=e=>String.fromCharCode(wj[e]||e),Tj=15,kj=100,xj={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ij={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Lj={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Cj={25:2,26:4,29:6,30:8,31:10,27:13,28:15},_j=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Aj{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n="function"===typeof t?t():t;uP.log("".concat(this.time," [").concat(e,"] ").concat(n))}}}const Rj=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class Pj{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Dj{constructor(){this.uchar=" ",this.penState=new Pj}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Oj{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Pj,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<kj;t++)this.chars.push(new Dj);this.logger=e}equals(e){for(let t=0;t<kj;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<kj;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<kj;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>kj&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=kj)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Sj(e);this.pos>=kj?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<kj;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<kj;n++){const r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class Nj{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Tj;t++)this.rows.push(new Oj(e));this.logger=e}reset(){for(let e=0;e<Tj;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let n=0;n<Tj;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Tj;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Tj;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+OD(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<Tj;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const r=n.rows[e].cueStartTime,s=this.logger.time;if(null!==r&&null!==s&&r<s)for(let i=0;i<this.nrRollUpRows;i++)this.rows[t-this.nrRollUpRows+i+1].copy(n.rows[e+i])}}this.currRow=t;const n=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,r=Math.max(t-1,0);n.setCursor(e.indent),e.color=n.chars[r].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+OD(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let s=0;s<Tj;s++){const n=this.rows[s].getTextString();n&&(r=s+1,e?t.push("Row "+r+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}getTextAndFormat(){return this.rows}}class Mj{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Nj(n),this.nonDisplayedMemory=new Nj(n),this.lastOutputScreen=new Nj(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+OD(t)),this.writeScreen.setPen(t)}outputDataUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Fj{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const r=this.logger=new Aj;this.channels=[null,new Mj(e,t,r),new Mj(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const e=127&t[n],r=127&t[n+1];let s=!1,i=null;if(0===e&&0===r)continue;this.logger.log(3,()=>"["+Rj([t[n],t[n+1]])+"] -> ("+Rj([e,r])+")");const a=this.cmdHistory;if(e>=16&&e<=31){if(jj(e,r,a)){Uj(null,null,a),this.logger.log(3,()=>"Repeated command ("+Rj([e,r])+") is dropped");continue}Uj(e,r,this.cmdHistory),s=this.parseCmd(e,r),s||(s=this.parseMidrow(e,r)),s||(s=this.parsePAC(e,r)),s||(s=this.parseBackgroundAttributes(e,r))}else Uj(null,null,a);if(!s&&(i=this.parseChars(e,r),i)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(i)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}s||i||this.logger.log(2,()=>"Couldn't parse cleaned data "+Rj([e,r])+" orig: "+Rj([t[n],t[n+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const n=20===e||21===e||23===e?1:2,r=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let n=0;if((17===e||25===e)&&t>=32&&t<=47){if(n=17===e?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return!!r&&(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Rj([e,t])+")"),!0)}return!1}parsePAC(e,t){let n;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const r=e<=23?1:2;n=t>=64&&t<=95?1===r?xj[e]:Lj[e]:1===r?Ij[e]:Cj[e];const s=this.channels[r];return!!s&&(s.setPAC(this.interpretPAC(n,t)),this.currentChannel=r,!0)}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1===(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}parseChars(e,t){let n,r=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let e;e=17===s?t+80:18===s?t+112:t+144,this.logger.log(2,()=>"Special char '"+Sj(e)+"' in channel "+n),r=[e]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+Rj(r).join(",")),r}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let n;const r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=_j[n],t%2===1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));const s=e<=23?1:2;return this.channels[s].setBkgData(r),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Uj(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Uj(e,t,n){n.a=e,n.b=t}function jj(e,t,n){return n.a===e&&n.b===t}var Bj=function(){if(null!=eN&&eN.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!==typeof t)return!1;if(!Array.isArray(e))return!1;const n=t.toLowerCase();return!!~e.indexOf(n)&&n}function r(e){return n(t,e)}function s(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let s=1;for(;s<arguments.length;s++){const t=arguments[s];for(const n in t)e[n]=t[n]}return e}function i(t,i,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",u=!1,d=t,h=i,f=a,p=null,g="",m=!0,v="auto",y="start",b=50,E="middle",w=50,S="middle";Object.defineProperty(o,"id",s({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",s({},l,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(o,"startTime",s({},l,{get:function(){return d},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",s({},l,{get:function(){return h},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",s({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",s({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",s({},l,{get:function(){return g},set:function(t){const r=function(t){return n(e,t)}(t);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");g=r,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",s({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",s({},l,{get:function(){return v},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",s({},l,{get:function(){return y},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",s({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",s({},l,{get:function(){return E},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",s({},l,{get:function(){return w},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");w=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",s({},l,{get:function(){return S},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),o.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i}();class Vj{decode(e,t){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function zj(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(r||0)}const n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}class Gj{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Hj(e,t,n,r){const s=r?e.split(r):[e];for(const i in s){if("string"!==typeof s[i])continue;const e=s[i].split(n);if(2!==e.length)continue;t(e[0],e[1])}}const Kj=new Bj(0,0,""),Wj="middle"===Kj.align?"middle":"center";function qj(e,t,n){const r=e;function s(){const t=zj(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function i(){e=e.replace(/^\s+/,"")}if(i(),t.startTime=s(),i(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.slice(3),i(),t.endTime=s(),i(),function(e,t){const r=new Gj;Hj(e,function(e,t){let s;switch(e){case"region":for(let s=n.length-1;s>=0;s--)if(n[s].id===t){r.set(e,n[s].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":s=t.split(","),r.integer(e,s[0]),r.percent(e,s[0])&&r.set("snapToLines",!1),r.alt(e,s[0],["auto"]),2===s.length&&r.alt("lineAlign",s[1],["start",Wj,"end"]);break;case"position":s=t.split(","),r.percent(e,s[0]),2===s.length&&r.alt("positionAlign",s[1],["start",Wj,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",Wj,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");let s=r.get("line","auto");"auto"===s&&-1===Kj.line&&(s=-1),t.line=s,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",Wj);let i=r.get("position","auto");"auto"===i&&50===Kj.position&&(i="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=i}(e,t)}function Yj(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class Qj{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Vj,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function n(){let e=t.buffer,n=0;for(e=Yj(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;const r=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),r}function r(e){Hj(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=n();const r=e.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==r||!r[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let s=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:e=n(),t.state){case"HEADER":/:/.test(e)?r(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new Bj(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{qj(e,t.cue,t.regionList)}catch(_w){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==e.indexOf("--\x3e");if(!e||n&&(s=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(_w){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(_w){e.onparsingerror&&e.onparsingerror(_w)}return e.onflush&&e.onflush(),this}}const Xj=/\r\n|\n\r|\n|\r/g,Zj=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(n,n+t.length)===t};function Jj(e,t,n){return ij(e.toString())+ij(t.toString())+ij(n)}function $j(e,t,n,r,s,i,a){const o=new Qj,l=fP(new Uint8Array(e)).trim().replace(Xj,"\n").split("\n"),c=[],u=t?function(e){return SF(e,9e4,1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}(t.baseTime,t.timescale):0;let d,h="00:00.000",f=0,p=0,g=!0;o.oncue=function(e){const i=n[r];let a=n.ccOffset;const o=(f-u)/9e4;if(null!=i&&i.new&&(void 0!==p?a=n.ccOffset=i.start:function(e,t,n){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;null!=(i=s)&&i.new;){var i;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=n}(n,r,o)),o){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));a=o-n.presentationOffset}const l=e.endTime-e.startTime,h=AF(9e4*(e.startTime+a-p),9e4*s)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const g=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(g)),e.id||(e.id=Jj(e.startTime,e.endTime,g)),e.endTime>0&&c.push(e)},o.onparsingerror=function(e){d=e},o.onflush=function(){d?a(d):i(c)},l.forEach(e=>{if(g){if(Zj(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach(e=>{Zj(e,"LOCAL:")?h=e.slice(6):Zj(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{p=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!jR(t)||!jR(n)||!jR(r)||!jR(s))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*n,t+=6e4*r,t+=36e5*s,t}(h)/1e3}catch(t){d=t}return}""===e&&(g=!1)}o.parse(e+"\n")}),o.flush()}const eB="stpp.ttml.im1t",tB=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,nB=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,rB={left:"start",center:"center",right:"end",start:"start",end:"end"};function sB(e,t,n,r){const s=FP(new Uint8Array(e),["mdat"]);if(0===s.length)return void r(new Error("Could not parse IMSC1 mdat"));const i=s.map(e=>fP(e)),a=function(e,t){return SF(e,t,1/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1),arguments.length>3&&void 0!==arguments[3]&&arguments[3])}(t.baseTime,1,t.timescale);try{i.forEach(e=>n(function(e,t){const n=(new DOMParser).parseFromString(e,"text/xml"),r=n.getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(s).reduce((e,t)=>(e[t]=r.getAttribute("ttp:".concat(t))||s[t],e),{}),a="preserve"!==r.getAttribute("xml:space"),o=aB(iB(r,"styling","style")),l=aB(iB(r,"layout","region")),c=iB(r,"body","[begin]");return[].map.call(c,e=>{const n=oB(e,a);if(!n||!e.hasAttribute("begin"))return null;const r=uB(e.getAttribute("begin"),i),s=uB(e.getAttribute("dur"),i);let c=uB(e.getAttribute("end"),i);if(null===r)throw cB(e);if(null===c){if(null===s)throw cB(e);c=r+s}const u=new Bj(r-t,c-t,n);u.id=Jj(u.startTime,u.endTime,u.text);const d=function(e,t,n){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&n.hasOwnProperty(a)&&(s=n[a]);return i.reduce((n,i)=>{const a=lB(t,r,i)||lB(e,r,i)||lB(s,r,i);return a&&(n[i]=a),n},{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:h}=d;if(h){const e=rB[h];e&&(u.lineAlign=e),u.align=h}return tP(u,d),u}).filter(e=>null!==e)}(e,a)))}catch(o){r(o)}}function iB(e,t,n){const r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function aB(e){return e.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function oB(e,t){return[].slice.call(e.childNodes).reduce((e,n,r)=>{var s;return"br"===n.nodeName&&r?e+"\n":null!=(s=n.childNodes)&&s.length?oB(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent},"")}function lB(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function cB(e){return new Error("Could not parse ttml timestamp ".concat(e))}function uB(e,t){if(!e)return null;let n=zj(e);return null===n&&(tB.test(e)?n=function(e,t){const n=tB.exec(e),r=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/t.frameRate}(e,t):nB.test(e)&&(n=function(e,t){const n=nB.exec(e),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),n}class dB{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function hB(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function fB(e,t){return!!e&&e.kind===hB(t)&&WF(t,e)}function pB(e,t,n,r){return Math.min(t,r)-Math.max(e,n)}const gB=/\s/,mB={newCue(e,t,n,r){const s=[];let i,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let h=0;h<r.rows.length;h++)if(i=r.rows[h],o=!0,l=0,c="",!i.isEmpty()){var d;for(let e=0;e<i.chars.length;e++)gB.test(i.chars[e].uchar)&&o?l++:(c+=i.chars[e].uchar,o=!1);i.cueStartTime=t,t===n&&(n+=1e-4),l>=16?l--:l++;const r=Yj(c.trim()),f=Jj(t,n,r);null!=e&&null!=(d=e.cues)&&d.getCueById(f)||(a=new u(t,n,r),a.id=f,a.line=h+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),s.push(a))}return e&&s.length&&(s.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),s.forEach(t=>tj(e,t))),s}};const vB=/(\d+)-(\d+)\/(\d+)/;class yB{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||bB,this.controller=new self.AbortController,this.stats=new EP}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=function(e,t){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(tP({},e.headers))};e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return n}(e,this.controller.signal),i="arraybuffer"===e.responseType,a=i?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=o&&jR(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout);(UF(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(n=>{var s;this.response=this.loader=n;const a=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},l-(a-r.loading.start)),!n.ok){const{status:e,statusText:t}=n;throw new EB(t||"fetch, bad network response",e,n)}r.loading.first=a,r.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=vB.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(jR(e))return e}const n=e.get("Content-Length");if(n)return parseInt(n)}(n.headers)||r.total;const o=null==(s=this.callbacks)?void 0:s.onProgress;return o&&jR(t.highWaterMark)?this.loadProgressively(n,r,e,t.highWaterMark,o):i?n.arrayBuffer():"json"===e.responseType?n.json():n.text()}).then(n=>{var s,i;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=n[a];l&&(r.loaded=r.total=l);const c={url:o.url,data:n,code:o.status},u=null==(s=this.callbacks)?void 0:s.onProgress;u&&!jR(t.highWaterMark)&&u(r,e,n,o),null==(i=this.callbacks)||i.onSuccess(c,r,e,o)}).catch(t=>{var n;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const s=t&&t.code||0,i=t?t.message:null;null==(n=this.callbacks)||n.onError({code:s,text:i},e,t?t.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;const i=new fM,a=e.body.getReader(),o=()=>a.read().then(a=>{if(a.done)return i.dataLength&&s(t,n,i.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return t.loaded+=c,c<r||i.dataLength?(i.push(l),i.dataLength>=r&&s(t,n,i.flush().buffer,e)):s(t,n,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function bB(e,t){return new self.Request(e.url,t)}class EB extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const wB=/^age:\s*[\d.]+\s*$/im;class SB{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new EP,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return s(n,t.url)}).catch(e=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(e=>{var s;null==(s=this.callbacks)||s.onError({code:n.status,text:e.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:i}=n.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&jR(s)?s:i,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!n.aborted&&r>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const r=t.status,l="text"===t.responseType?t.responseText:null;if(r>=200&&r<300){const s=null!=l?l:t.response;if(null!=s){var i,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const o="arraybuffer"===t.responseType?s.byteLength:s.length;n.loaded=n.total=o,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first);const l=null==(i=this.callbacks)?void 0:i.onProgress;l&&l(n,e,s,t);const c={url:t.responseURL,data:s,code:r};return void(null==(a=this.callbacks)||a.onSuccess(c,n,e,t))}}const c=s.loadPolicy.errorRetry;var o;if(eO(c,n.retry,!1,{url:e.url,data:void 0,code:r}))this.retry(c);else uP.error("".concat(r," while loading ").concat(e.url)),null==(o=this.callbacks)||o.onError({code:r,text:t.statusText},e,t,n)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(eO(e,this.stats.retry,!0))this.retry(e);else{var t;uP.warn("timeout while loading ".concat(null==(t=this.context)?void 0:t.url));const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=JD(e,n.retry),n.retry++,uP.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==t?void 0:t.url,", retrying ").concat(n.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&wB.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const TB=rP(rP({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:SB,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends sP{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:n,partCurrent:r,hls:s}=this,{autoLevelEnabled:i,media:a}=s;if(!n||!a)return;const o=performance.now(),l=r?r.stats:n.stats,c=r?r.duration:n.duration,u=o-l.loading.start,d=s.minAutoLevel,h=n.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||h<=d)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i)return;const p=f>-1&&f!==h,g=!!e||p;if(!g&&(a.paused||!a.playbackRate||!a.readyState))return;const m=s.mainForwardBufferInfo;if(!g&&null===m)return;const v=this.bwEstimator.getEstimateTTFB(),y=Math.abs(a.playbackRate);if(u<=Math.max(v,c/(2*y)*1e3))return;const b=m?m.len/y:0,E=l.loading.first?l.loading.first-l.loading.start:-1,w=l.loaded&&E>-1,S=this.getBwEstimate(),T=s.levels,k=T[h],x=Math.max(l.loaded,Math.round(c*(n.bitrate||k.averageBitrate)/8));let I=w?u-E:u;I<1&&w&&(I=Math.min(u,8*l.loaded/S));const L=w?1e3*l.loaded/I:0,C=v/1e3,_=L?(x-l.loaded)/L:8*x/S+C;if(_<=b)return;const A=L?8*L:S,R=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),P=this.hls.config.abrBandWidthUpFactor;let D,O=Number.POSITIVE_INFINITY;for(D=h-1;D>d;D--){const e=T[D].maxBitrate,t=!T[D].details||R;if(O=this.getTimeToLoadFrag(C,A,c*e,t),O<Math.min(b,c+C))break}if(O>=_)return;if(O>10*c)return;w?this.bwEstimator.sample(u-Math.min(v,E),l.loaded):this.bwEstimator.sampleTTFB(u);const N=T[D].maxBitrate;this.getBwEstimate()*P>N&&this.resetEstimator(N);const M=this.findBestLevel(N,d,D,0,b,1,1);M>-1&&(D=M),this.warn("Fragment ".concat(n.sn).concat(r?" part "+r.index:""," of level ").concat(h," is loading too slowly;\n      Fragment duration: ").concat(n.duration.toFixed(3),"\n      Time to underbuffer: ").concat(b.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(_.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(O.toFixed(3)," s\n      TTFB estimate: ").concat(0|E," ms\n      Current BW estimate: ").concat(jR(S)?0|S:"Unknown"," bps\n      New BW estimate: ").concat(0|this.getBwEstimate()," bps\n      Switching to level ").concat(D," @ ").concat(0|N," bps")),s.nextLoadLevel=s.nextAutoLevel=D,this.clearTimer();const F=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===D&&D>0){const e=this.getStarvationDelay();if(this.warn("Aborting inflight request ".concat(D>0?"and switching down":"","\n      Fragment duration: ").concat(n.duration.toFixed(3)," s\n      Time to underbuffer: ").concat(e.toFixed(3)," s")),n.abortRequests(),this.fragCurrent=this.partCurrent=null,D>d){let t=this.findBestLevel(this.hls.levels[d].bitrate,d,D,0,e,1,1);-1===t&&(t=d),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};p||_>2*O?F():this.timer=self.setInterval(F,1e3*O),s.trigger(HR.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log("setting initial bwe to ".concat(e)),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new $R(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.FRAG_LOADING,this.onFragLoading,this),e.on(HR.FRAG_LOADED,this.onFragLoaded,this),e.on(HR.FRAG_BUFFERED,this.onFragBuffered,this),e.on(HR.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.on(HR.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(HR.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(HR.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.FRAG_LOADING,this.onFragLoading,this),e.off(HR.FRAG_LOADED,this.onFragLoaded,this),e.off(HR.FRAG_BUFFERED,this.onFragBuffered,this),e.off(HR.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.off(HR.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(HR.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(HR.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){var r;if(!n.bitrateTest)this.fragCurrent=n,this.partCurrent=null!=(r=t.part)?r:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case GR.BUFFER_ADD_CODEC_ERROR:case GR.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case GR.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:n,partCurrent:r}=this;if(e&&n&&e.sn===n.sn&&e.level===n.level){const t=performance.now(),n=r?r.stats:e.stats,s=t-n.loading.start,i=n.loading.first?n.loading.first-n.loading.start:-1;if(n.loaded&&i>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(s-Math.min(e,i),n.loaded)}else this.bwEstimator.sampleTTFB(s)}break}}}getTimeToLoadFrag(e,t,n,r){return e+n/t+(r?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;jR(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,t){let{frag:n,part:r}=t;const s=r?r.stats:n.stats;if(n.type===QR&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=r?r.duration:n.duration,t=this.hls.levels[n.level],i=(t.loaded?t.loaded.bytes:0)+s.loaded,a=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:i,duration:a},t.realBitrate=Math.round(8*i/a)}if(n.bitrateTest){const e={stats:s,frag:n,part:r,id:n.type};this.onFragBuffered(HR.FRAG_BUFFERED,e),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,s=null!=r&&r.stats.loaded?r.stats:n.stats;if(s.aborted)return;if(this.ignoreFragment(n))return;const i=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(i,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==QR||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,r,1,1);if(s>-1)return s;const i=this.hls.firstLevel,a=Math.min(Math.max(i,t),e);return this.warn("Could not find best starting auto level. Defaulting to first in playlist ".concat(i," clamped to ").concat(a)),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(-1!==e&&(!t||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=t&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,r)&&t[e].loadError<=t[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:i}=n,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=s.abrBandWidthFactor,u=s.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,i,r,l,0,c,u);if(e>=0)return this.rebufferNotice=-1,e}let d=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){d=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-e,this.info("bitrate test took ".concat(Math.round(1e3*e),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*d)," ms")),c=u=1}}const h=this.findBestLevel(o,i,r,l,d,c,u);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info("".concat(l?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(h))),h>-1)return h;const f=n.levels[i],p=n.loadLevelObj;return p&&(null==f?void 0:f.bitrate)<p.bitrate?i:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,s,i,a){var o;const l=r+s,c=this.lastLoadedFragLevel,u=-1===c?this.hls.firstLevel:c,{fragCurrent:d,partCurrent:h}=this,{levels:f,allAudioTracks:p,loadLevel:g,config:m}=this.hls;if(1===f.length)return 0;const v=f[u],y=!(null==(o=this.hls.latestLevelDetails)||!o.live),b=-1===g||-1===c;let E,w="SDR",S=(null==v?void 0:v.frameRate)||0;const{audioPreference:T,videoPreference:k}=m,x=this.audioTracksByGroup||(this.audioTracksByGroup=MD(p));let I=-1;if(b){if(-1!==this.firstSelection)return this.firstSelection;const r=this.codecTiers||(this.codecTiers=function(e,t,n,r){return e.slice(n,r+1).reduce((e,n,r)=>{if(!n.codecSet)return e;const s=n.audioGroups;let i=e[n.codecSet];i||(e[n.codecSet]=i={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:r,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!s,fragmentError:0}),i.minBitrate=Math.min(i.minBitrate,n.bitrate);const a=Math.min(n.height,n.width);return i.minHeight=Math.min(i.minHeight,a),i.minFramerate=Math.min(i.minFramerate,n.frameRate),i.minIndex=Math.min(i.minIndex,r),i.maxScore=Math.max(i.maxScore,n.score),i.fragmentError+=n.fragmentError,i.videoRanges[n.videoRange]=(i.videoRanges[n.videoRange]||0)+1,s&&s.forEach(e=>{if(!e)return;const n=t.groups[e];n&&(i.hasDefaultAudio=i.hasDefaultAudio||t.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(n.channels).forEach(e=>{i.channels[e]=(i.channels[e]||0)+n.channels[e]}))}),e},{})}(f,x,t,n)),s=function(e,t,n,r,s){const i=Object.keys(e),a=null==r?void 0:r.channels,o=null==r?void 0:r.audioCodec,l=null==s?void 0:s.videoCodec,c=a&&2===parseInt(a);let u=!1,d=!1,h=1/0,f=1/0,p=1/0,g=1/0,m=0,v=[];const{preferHDR:y,allowedVideoRanges:b}=DD(t,s);for(let T=i.length;T--;){const t=e[i[T]];u||(u=t.channels[2]>0),h=Math.min(h,t.minHeight),f=Math.min(f,t.minFramerate),p=Math.min(p,t.minBitrate),b.filter(e=>t.videoRanges[e]>0).length>0&&(d=!0)}h=jR(h)?h:0,f=jR(f)?f:0;const E=Math.max(1080,h),w=Math.max(30,f);p=jR(p)?p:n,n=Math.max(p,n),d||(t=void 0);const S=i.length>1;return{codecSet:i.reduce((t,r)=>{const s=e[r];if(r===t)return t;if(v=d?b.filter(e=>s.videoRanges[e]>0):[],S){if(s.minBitrate>n)return ND(r,"min bitrate of ".concat(s.minBitrate," > current estimate of ").concat(n)),t;if(!s.hasDefaultAudio)return ND(r,"no renditions with default or auto-select sound found"),t;if(o&&r.indexOf(o.substring(0,4))%5!==0)return ND(r,'audio codec preference "'.concat(o,'" not found')),t;if(a&&!c){if(!s.channels[a])return ND(r,"no renditions with ".concat(a," channel sound found (channels options: ").concat(Object.keys(s.channels),")")),t}else if((!o||c)&&u&&0===s.channels[2])return ND(r,"no renditions with stereo sound found"),t;if(s.minHeight>E)return ND(r,"min resolution of ".concat(s.minHeight," > maximum of ").concat(E)),t;if(s.minFramerate>w)return ND(r,"min framerate of ".concat(s.minFramerate," > maximum of ").concat(w)),t;if(!v.some(e=>s.videoRanges[e]>0))return ND(r,"no variants with VIDEO-RANGE of ".concat(OD(v)," found")),t;if(l&&r.indexOf(l.substring(0,4))%5!==0)return ND(r,'video codec preference "'.concat(l,'" not found')),t;if(s.maxScore<m)return ND(r,"max score of ".concat(s.maxScore," < selected max of ").concat(m)),t}return t&&(lD(r)>=lD(t)||s.fragmentError>e[t].fragmentError)?t:(g=s.minIndex,m=s.maxScore,r)},void 0),videoRanges:v,preferHDR:y,minFramerate:f,minBitrate:p,minIndex:g}}(r,w,e,T,k),{codecSet:i,videoRanges:a,minFramerate:o,minBitrate:l,minIndex:c,preferHDR:u}=s;I=c,E=i,w=u?a[a.length-1]:a[0],S=o,e=Math.max(e,l),this.log("picked start tier ".concat(OD(s)))}else E=null==v?void 0:v.codecSet,w=null==v?void 0:v.videoRange;const L=h?h.duration:d?d.duration:0,C=this.bwEstimator.getEstimateTTFB()/1e3,_=[];for(let R=n;R>=t;R--){var A;const t=f[R],o=R>u;if(!t)continue;if(m.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const n=navigator.mediaCapabilities;"function"===typeof(null==n?void 0:n.decodingInfo)&&ED(t,x,w,S,e,T)?(t.supportedPromise=wD(t,x,n,this.supportedCache),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const n=this.hls.levels,r=n.indexOf(t);e.error?this.warn('MediaCapabilities decodingInfo error: "'.concat(e.error,'" for level ').concat(r," ").concat(OD(e))):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log("MediaCapabilities decodingInfo for level ".concat(r," not smooth or powerEfficient: ").concat(OD(e))):(this.warn("Unsupported MediaCapabilities decodingInfo result for level ".concat(r," ").concat(OD(e))),r>-1&&n.length>1&&(this.log("Removing unsupported level ".concat(r)),this.hls.removeLevel(r),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn("Error handling MediaCapabilities decodingInfo: ".concat(e))})):t.supportedResult=yD}if((E&&t.codecSet!==E||w&&t.videoRange!==w||o&&S>t.frameRate||!o&&S>0&&S<t.frameRate||null!=(A=t.supportedResult)&&null!=(A=A.decodingInfoResults)&&A.some(e=>!1===e.smooth))&&(!b||R!==I)){_.push(R);continue}const d=t.details,p=(h?null==d?void 0:d.partTarget:null==d?void 0:d.averagetargetduration)||L;let v;v=o?a*e:i*e;const k=L&&r>=2*L&&0===s?t.averageBitrate:t.maxBitrate,P=this.getTimeToLoadFrag(C,v,k*p,void 0===d);if(v>=k&&(R===c||0===t.loadError&&0===t.fragmentError)&&(P<=C||!jR(P)||y&&!this.bitrateTestDelay||P<l)){const e=this.forcedAutoLevel;return R===g||-1!==e&&e===g||(_.length&&this.trace("Skipped level(s) ".concat(_.join(",")," of ").concat(n,' max with CODECS and VIDEO-RANGE:"').concat(f[_[0]].codecs,'" ').concat(f[_[0]].videoRange,'; not compatible with "').concat(E,'" ').concat(w)),this.info("switch candidate:".concat(u,"->").concat(R," adjustedbw(").concat(Math.round(v),")-bitrate=").concat(Math.round(v-k)," ttfb:").concat(C.toFixed(1)," avgDuration:").concat(p.toFixed(1)," maxFetchDuration:").concat(l.toFixed(1)," fetchDuration:").concat(P.toFixed(1)," firstSelection:").concat(b," codecSet:").concat(t.codecSet," videoRange:").concat(t.videoRange," hls.loadLevel:").concat(g))),b&&(this.firstSelection=R),R}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}},bufferController:class extends sP{constructor(e,t){var n;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:n}=this;e&&this.log("Media source opened"),t&&n&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(HR.MEDIA_ATTACHED,{media:t,mediaSource:n}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e,")"))},this.hls=e,this.fragmentTracker=t,this.appendSource=(n=dP(e.config.preferManagedMediaSource),"undefined"!==typeof self&&n===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.on(HR.BUFFER_RESET,this.onBufferReset,this),e.on(HR.BUFFER_APPENDING,this.onBufferAppending,this),e.on(HR.BUFFER_CODECS,this.onBufferCodecs,this),e.on(HR.BUFFER_EOS,this.onBufferEos,this),e.on(HR.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(HR.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(HR.FRAG_PARSED,this.onFragParsed,this),e.on(HR.FRAG_CHANGED,this.onFragChanged,this),e.on(HR.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.off(HR.BUFFER_RESET,this.onBufferReset,this),e.off(HR.BUFFER_APPENDING,this.onBufferAppending,this),e.off(HR.BUFFER_CODECS,this.onBufferCodecs,this),e.off(HR.BUFFER_EOS,this.onBufferEos,this),e.off(HR.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(HR.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(HR.FRAG_PARSED,this.onFragParsed,this),e.off(HR.FRAG_CHANGED,this.onFragChanged,this),e.off(HR.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn("Transfering MediaSource with".concat(t?" operations in queue":"").concat(e?" updating SourceBuffer(s)":""," ").concat(this.operationQueue)),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?tP(n,r.tracks):this.sourceBuffers.forEach(e=>{const[t]=e;t&&(n[t]=tP({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log("".concat(r," bufferCodec event(s) expected.")),null!=(n=this.transferData)&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const r=dP(this.appendSource);if(r){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const i=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(i),e)this._objectUrl=n.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(i);if(this.appendSource)try{n.removeAttribute("src");const t=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||t&&i instanceof t,ZF(n),function(e,t){const n=self.document.createElement("source");n.type="video/mp4",n.src=t,e.appendChild(n)}(n,e),n.load()}catch(s){n.src=e}else n.src=e}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log("".concat((null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"," media source: ").concat(null==(n=e.constructor)?void 0:n.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,s=r?Object.keys(r):null,i=s?s.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&i){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log("attachTransferred: (bufferCodecEventsTotal ".concat(this.bufferCodecEventsTotal,")\nrequired tracks: ").concat(OD(n,(e,t)=>"initSegment"===e?void 0:t),";\ntransfer tracks: ").concat(OD(r,(e,t)=>"initSegment"===e?void 0:t),"}")),!hP(r,n)){t.mediaSource=null,t.tracks=void 0;const s=e.currentTime,i=this.details,a=Math.max(s,(null==i?void 0:i.fragments[0].start)||0);return a-s>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time ".concat(s," -> ").concat(a)):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'.concat(Object.keys(r),'"->"').concat(Object.keys(n),'") start time: ').concat(a," currentTime: ").concat(s)),this.onMediaDetaching(HR.MEDIA_DETACHING,{}),this.onMediaAttaching(HR.MEDIA_ATTACHING,t),void(e.currentTime=a))}this.transferData=void 0,s.forEach(e=>{const t=e,n=r[t];if(n){const e=n.buffer;if(e){const r=this.fragmentTracker,s=n.id;if(r.hasFragments(s)||r.hasParts(s)){const n=DO.getBuffered(e);r.detectEvictedFragments(t,n,s,null,!0)}const i=JF(t),a=[t,e];this.sourceBuffers[i]=a,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,n)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:i}=this;if(s){if(this.log("media source ".concat(n?"transferring":"detaching")),n)this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.removeBuffer(t)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===s.readyState;try{const t=s.sourceBuffers;for(let n=t.length;n--;)e&&t[n].abort(),s.removeSourceBuffer(t[n]);e&&s.endOfStream()}catch(lz){this.warn("onMediaDetaching: ".concat(lz.message," while calling endOfStream"))}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(i&&self.URL.revokeObjectURL(i),this.mediaSrc===i?(r.removeAttribute("src"),this.appendSource&&ZF(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(HR.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(e){var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;null!=(r=this.mediaSource)&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(lz){this.warn("onBufferReset ".concat(e),lz)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[JF(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new qF(this.tracks)}onBufferCodecs(e,t){var n;const r=this.tracks,s=Object.keys(t);this.log('BUFFER_CODECS: "'.concat(s,'" (current SB count ').concat(this.sourceBufferCount,")"));const i="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!i&&this.sourceBufferCount&&this.media&&s.some(e=>!r[e]);i||a?this.warn('Unsupported transition between "'.concat(Object.keys(r),'" and "').concat(s,'" SourceBuffers')):(s.forEach(e=>{var n,s;const i=t[e],{id:a,codec:o,levelCodec:l,container:c,metadata:u,supplemental:d}=i;let h=r[e];const f=null==(n=this.transferData)||null==(n=n.tracks)?void 0:n[e],p=null!=f&&f.buffer?f:h,g=(null==p?void 0:p.pendingCodec)||(null==p?void 0:p.codec),m=null==p?void 0:p.levelCodec;h||(h=r[e]={buffer:void 0,listeners:[],codec:o,supplemental:d,container:c,levelCodec:l,metadata:u,id:a});const v=hD(g,m),y=null==v?void 0:v.replace(YF,"$1");let b=hD(o,l);const E=null==(s=b)?void 0:s.replace(YF,"$1");b&&v&&y!==E&&("audio"===e.slice(0,5)&&(b=dD(b,this.appendSource)),this.log("switching codec ".concat(g," to ").concat(b)),b!==(h.pendingCodec||h.codec)&&(h.pendingCodec=b),h.container=c,this.appendChangeType(e,c,b))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&"main"===(null==(n=t.audio)?void 0:n.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r="".concat(t,";codecs=").concat(n),s={label:"change-type=".concat(r),execute:()=>{const s=this.tracks[e];if(s){const i=s.buffer;null!=i&&i.changeType&&(this.log("changing ".concat(e," sourceBuffer type to ").concat(r)),i.changeType(r),s.codec=n,s.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn("Failed to change ".concat(e," SourceBuffer type"),t)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(n,QR))?void 0:t.gap))return;const s={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>r||null!=t&&t.buffer&&DO.isBuffered(t.buffer,r)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(r,QR))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:s,frag:e},this.append(s,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:s,parent:i,frag:a,part:o,chunkMeta:l,offset:c}=t,u=l.buffering[s],{sn:d,cc:h}=a,f=self.performance.now();u.start=f;const p=a.stats.buffering,g=o?o.stats.buffering:null;0===p.start&&(p.start=f),g&&0===g.start&&(g.start=f);const m=n.audio;let v=!1;"audio"===s&&"audio/mpeg"===(null==m?void 0:m.container)&&(v=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const y=n.video,b=null==y?void 0:y.buffer;if(b&&"initSegment"!==d){const e=o||a,t=this.blockedAudioAppend;if("audio"!==s||"main"===i||this.blockedAudioAppend||y.ending||y.ended){if("video"===s){const n=e.end;if(t){const e=t.frag.start;(n>e||n<this.lastVideoAppendEnd||DO.isBuffered(b,e))&&this.unblockAudio()}this.lastVideoAppendEnd=n}}else{const t=e.start+.05*e.duration,n=b.buffered,r=this.currentOp("video");n.length||r?!r&&!DO.isBuffered(b,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const E=(o||a).start,w={label:"append-".concat(s),execute:()=>{var e;u.executeStart=self.performance.now();const t=null==(e=this.tracks[s])?void 0:e.buffer;t&&(v?this.updateTimestampOffset(t,E,.1,s,d,h):void 0!==c&&jR(c)&&this.updateTimestampOffset(t,c,1e-6,s,d,h)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();u.executeEnd=u.end=e,0===p.first&&(p.first=e),g&&0===g.first&&(g.first=e);const t={};this.sourceBuffers.forEach(e=>{let[n,r]=e;n&&(t[n]=DO.getBuffered(r))}),this.appendErrors[s]=0,"audio"===s||"video"===s?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(HR.BUFFER_APPENDED,{type:s,frag:a,part:o,chunkMeta:l,parent:a.type,timeRanges:t})},onError:e=>{var t;const n={type:zR.MEDIA_ERROR,parent:a.type,details:GR.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:o,chunkMeta:l,error:e,err:e,fatal:!1},r=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)n.details=GR.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!r)n.errorAction=uO(!0);else if(e.name===QF&&0===this.sourceBufferCount)n.errorAction=uO(!0);else{const e=++this.appendErrors[s];this.warn("Failed ".concat(e,"/").concat(this.hls.config.appendErrorMaxRetry,' times to append segment in "').concat(s,'" sourceBuffer (').concat(r||"no media error",")")),(e>=this.hls.config.appendErrorMaxRetry||r)&&(n.fatal=!0)}this.hls.trigger(HR.ERROR,n)}};this.log('queuing "'.concat(s,'" append sn: ').concat(d).concat(o?" p: "+o.index:""," of ").concat(a.type===QR?"level":"track"," ").concat(a.level," cc: ").concat(h)),this.append(w,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log('queuing "'.concat(e,'" remove ').concat(t,"-").concat(n)),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(HR.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn("Failed to remove ".concat(t,"-").concat(n,' from "').concat(e,'" SourceBuffer'),r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:s}=t;n?this.append(this.getFlushOp(n,r,s),n):this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.append(this.getFlushOp(t,r,s),t)})}onFragParsed(e,t){const{frag:n,part:r}=t,s=[],i=r?r.elementaryStreams:n.elementaryStreams;i[TP]?s.push("audiovideo"):(i[wP]&&s.push("audio"),i[SP]&&s.push("video"));0===s.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(n.type," level: ").concat(n.level," sn: ").concat(n.sn)),this.blockBuffers(()=>{const e=self.performance.now();n.stats.buffering.end=e,r&&(r.stats.buffering.end=e);const t=r?r.stats:n.stats;this.hls.trigger(HR.FRAG_BUFFERED,{frag:n,part:r,stats:t,id:n.type})},s).catch(e=>{this.warn("Fragment buffered callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(e=>{let[n]=e;if(n){const e=this.tracks[n];t.type&&t.type!==n||(e.ending=!0,e.ended||(e.ended=!0,this.log("".concat(n," buffer reached EOS"))))}});const r=!1!==(null==(n=this.overrides)?void 0:n.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;var n;return t&&!(null!=(n=this.tracks[t])&&n.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(HR.BUFFERED_TO_END,void 0)):e&&this.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState))})):(this.tracksEnded(),this.hls.trigger(HR.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(e=>{let[t]=e;if(null!==t){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(e,t){let{details:n}=t;n.fragments.length&&(this.details=n,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===GR.BUFFER_APPEND_ERROR&&t.frag){var n;const e=null==(n=t.errorAction)?void 0:n.nextAutoLevel;jR(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||null===t)return;if(!this.sourceBufferCount)return;const r=e.config,s=n.currentTime,i=t.levelTargetDuration,a=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(jR(a)&&a>=0){const e=Math.max(a,i),t=Math.floor(s/i)*i-e;this.flushBackBuffer(s,i,t)}const o=r.frontBufferFlushThreshold;if(jR(o)&&o>0){const e=Math.max(r.maxBufferLength,o),t=Math.max(e,i),n=Math.floor(s/i)*i+t;this.flushFrontBuffer(s,i,n)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(e=>{let[t,r]=e;if(r){const e=DO.getBuffered(r);if(e.length>0&&n>e.start(0)){var s;this.hls.trigger(HR.BACK_BUFFER_REACHED,{bufferEnd:n});const e=this.tracks[t];if(null!=(s=this.details)&&s.live)this.hls.trigger(HR.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(null!=e&&e.ended)return void this.log("Cannot flush ".concat(t," back buffer while SourceBuffer is in ended state"));this.hls.trigger(HR.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:t})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(t=>{let[r,s]=t;if(s){const t=DO.getBuffered(s),i=t.length;if(i<2)return;const a=t.start(i-1),o=t.end(i-1);if(n>a||e>=a&&e<=o)return;this.hls.trigger(HR.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||"open"!==(null==n?void 0:n.readyState))return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,r)}}return{duration:1/0}}const s=null==(e=this.overrides)?void 0:e.duration;if(s)return jR(s)?{duration:s}:null;const i=this.media.duration;return r>(jR(n.duration)?n.duration:0)&&r>i||!jR(i)?{duration:r}:null}updateMediaSource(e){let{duration:t,start:n,end:r}=e;const s=this.mediaSource;this.media&&s&&"open"===s.readyState&&(s.duration!==t&&(jR(t)&&this.log("Updating MediaSource duration to ".concat(t.toFixed(3))),s.duration=t),void 0!==n&&void 0!==r&&(this.log("MediaSource duration is set to ".concat(s.duration,". Setting seekable range to ").concat(n,"-").concat(r,".")),s.setLiveSeekableRange(n,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log("checkPendingTracks (pending: ".concat(t," codec events expected: ").concat(e,") ").concat(OD(n))),this.tracksReady){var r;const e=null==(r=this.transferData)?void 0:r.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(t=>{let[n,r]=t;if(n){const t=this.tracks[n];e[n]={buffer:r,container:t.container,codec:t.codec,supplemental:t.supplemental,levelCodec:t.levelCodec,id:t.id,metadata:t.metadata}}}),this.hls.trigger(HR.BUFFER_CREATED,{tracks:e}),this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),this.sourceBuffers.forEach(e=>{let[t]=e;this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const a=i,o=e[a];if(this.isPending(o)){const e=this.getTrackCodec(o,a),i="".concat(o.container,";codecs=").concat(e);o.codec=e,this.log("creating sourceBuffer(".concat(i,")").concat(this.currentOp(a)?" Queued":""," ").concat(OD(o)));try{const e=n.addSourceBuffer(i),r=JF(a),s=[a,e];t[r]=s,o.buffer=e}catch(s){var r;return this.error("error while trying to add sourceBuffer: ".concat(s.message)),this.shiftAndExecuteNext(a),null==(r=this.operationQueue)||r.removeBlockers(),delete this.tracks[a],void this.hls.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:s,sourceBufferName:a,mimeType:i,parent:o.id})}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&("video"===t||"audiovideo"===t)&&sD(n,"video")&&(r=function(e,t){const n=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)rD(t[e],"video")||n.push(t[e])}return t&&n.push(t),n.join(",")}(r,n));const s=hD(r,e.levelCodec);return s?"audio"===t.slice(0,5)?dD(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{const n=t.removedRanges;null!=n&&n.length&&this.hls.trigger(HR.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;const n=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==n?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error("".concat(e," SourceBuffer error. MediaSource readyState: ").concat(null==(n=this.mediaSource)?void 0:n.readyState));this.error("".concat(r),t),this.hls.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,n,r,s,i){const a=t-e.timestampOffset;Math.abs(a)>=n&&(this.log("Updating ".concat(r," SourceBuffer timestampOffset to ").concat(t," (sn: ").concat(s," cc: ").concat(i,")")),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:s}=this,i=this.tracks[e],a=null==i?void 0:i.buffer;if(!r||!s||!a)return this.warn("Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),void this.shiftAndExecuteNext(e);const o=jR(r.duration)?r.duration:1/0,l=jR(s.duration)?s.duration:1/0,c=Math.max(0,t),u=Math.min(n,o,l);u>c&&(!i.ending||i.ended)?(i.ended=!1,this.log("Removing [".concat(c,",").concat(u,"] from the ").concat(e," SourceBuffer")),a.remove(c,u)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=null==n?void 0:n.buffer;if(!r)throw new XF("Attempting to append to the ".concat(t," SourceBuffer, but it does not exist"));n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn("SourceBuffer blocked callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn("Callback run without blocking ".concat(this.operationQueue," ").concat(t))}}isUpdating(){return this.sourceBuffers.some(e=>{let[t,n]=e;return t&&n.updating})}isQueued(){return this.sourceBuffers.some(e=>{let[t]=e;return t&&!!this.currentOp(t)})}isPending(e){return!!e&&!e.buffer}blockBuffers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceBufferTypes;if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,r=t.map(e=>this.appendBlocker(e));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(t=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;n&&!n.updating&&this.shiftAndExecuteNext(e)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,t)=>{let[n]=t;return e+(n?1:0)},0)}get sourceBufferTypes(){return this.sourceBuffers.map(e=>{let[t]=e;return t}).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const i=n.bind(this,e);r.listeners.push({event:t,listener:i}),s.addEventListener(t,i)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(e=>{n.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}},capLevelController:$F,errorController:class extends sP{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(HR.ERROR,this.onError,this),e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(HR.ERROR,this.onError,this),e.off(HR.ERROR,this.onErrorOut,this),e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===QR?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===n?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if(null!=(n=e.details)&&n.hasKey(t))return!0;const r=e.audioGroups;if(r){return this.hls.allAudioTracks.filter(e=>r.indexOf(e.groupId)>=0).some(e=>{var n;return null==(n=e.details)?void 0:n.hasKey(t)})}}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case GR.FRAG_LOAD_ERROR:case GR.FRAG_LOAD_TIMEOUT:case GR.KEY_LOAD_ERROR:case GR.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case GR.FRAG_PARSING_ERROR:if(null!=(n=t.frag)&&n.gap)return void(t.errorAction=uO());case GR.FRAG_GAP:case GR.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=rO);case GR.LEVEL_EMPTY_ERROR:case GR.LEVEL_PARSING_ERROR:{var i;const e=t.parent===QR?t.level:r.loadLevel;t.details===GR.LEVEL_EMPTY_ERROR&&null!=(i=t.context)&&null!=(i=i.levelDetails)&&i.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case GR.LEVEL_LOAD_ERROR:case GR.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==s?void 0:s.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level)));case GR.AUDIO_TRACK_LOAD_ERROR:case GR.AUDIO_TRACK_LOAD_TIMEOUT:case GR.SUBTITLE_LOAD_ERROR:case GR.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const e=r.loadLevelObj;if(e&&(s.type===qR&&e.hasAudioGroup(s.groupId)||s.type===YR&&e.hasSubtitleGroup(s.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=rO,void(t.errorAction.flags=oO)}return;case GR.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(t.errorAction={action:rO,flags:lO});case GR.KEY_SYSTEM_SESSION_UPDATE_FAILED:case GR.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case GR.KEY_SYSTEM_NO_SESSION:return void(t.errorAction={action:rO,flags:cO});case GR.BUFFER_ADD_CODEC_ERROR:case GR.REMUX_ALLOC_ERROR:case GR.BUFFER_APPEND_ERROR:var a;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(a=t.level)?a:r.loadLevel);return;case GR.INTERNAL_EXCEPTION:case GR.BUFFER_APPENDING_ERROR:case GR.BUFFER_FULL_ERROR:case GR.LEVEL_SWITCH_ERROR:case GR.BUFFER_STALLED_ERROR:case GR.BUFFER_SEEK_OVER_HOLE:case GR.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=uO())}t.type===zR.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=uO())}getPlaylistRetryOrSwitchAction(e,t){const n=ZD(this.hls.config.playlistLoadPolicy,e),r=this.playlistError++;if(eO(n,r,YD(e),e.response))return{action:iO,flags:aO,retryConfig:n,retryCount:r};const s=this.getLevelSwitchAction(e,t);return n&&(s.retryConfig=n,s.retryCount=r),s}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:i}=t.config,a=ZD(QD(e)?i:s,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(r&&(e.details!==GR.FRAG_GAP&&r.fragmentError++,!XD(e))){if(eO(a,o,YD(e),e.response))return{action:iO,flags:aO,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(e,n);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(e,t){const n=this.hls;null!==t&&void 0!==t||(t=n.loadLevel);const r=this.hls.levels[t];if(r){var s,i;const t=e.details;r.loadError++,t===GR.BUFFER_APPEND_ERROR&&r.fragmentError++;let l=-1;const{levels:c,loadLevel:u,minAutoLevel:d,maxAutoLevel:h}=n;n.autoLevelEnabled||n.config.preserveManualLevelOnError||(n.loadLevel=-1);const f=null==(s=e.frag)?void 0:s.type,p=(f===XR&&t===GR.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===GR.BUFFER_ADD_CODEC_ERROR||t===GR.BUFFER_APPEND_ERROR))&&c.some(e=>{let{audioCodec:t}=e;return r.audioCodec!==t}),g="video"===e.sourceBufferName&&(t===GR.BUFFER_ADD_CODEC_ERROR||t===GR.BUFFER_APPEND_ERROR)&&c.some(e=>{let{codecSet:t,audioCodec:n}=e;return r.codecSet!==t&&r.audioCodec===n}),{type:m,groupId:v}=null!=(i=e.context)?i:{};for(let n=c.length;n--;){const s=(n+u)%c.length;if(s!==u&&s>=d&&s<=h&&0===c[s].loadError){var a,o;const n=c[s];if(t===GR.FRAG_GAP&&f===QR&&e.frag){const t=c[s].details;if(t){const n=HD(e.frag,t.fragments,e.frag.start);if(null!=n&&n.gap)continue}}else{if(m===qR&&n.hasAudioGroup(v)||m===YR&&n.hasSubtitleGroup(v))continue;if(f===XR&&null!=(a=r.audioGroups)&&a.some(e=>n.hasAudioGroup(e))||f===ZR&&null!=(o=r.subtitleGroups)&&o.some(e=>n.hasSubtitleGroup(e))||p&&r.audioCodec===n.audioCodec||g&&r.codecSet===n.codecSet||!p&&r.codecSet!==n.codecSet)continue}l=s;break}}if(l>-1&&n.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:rO,flags:aO,nextAutoLevel:l}}return{action:rO,flags:oO}}onErrorOut(e,t){var n;switch(null==(n=t.errorAction)?void 0:n.action){case nO:break;case rO:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===GR.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'.concat(t.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r}=n,s=n.nextAutoLevel;switch(r){case aO:this.switchLevel(e,s);break;case lO:{const r=this.getVariantLevelIndex(e.frag),s=t.levels[r],i=null==s?void 0:s.attrs["HDCP-LEVEL"];if(n.hdcpLevel=i,"NONE"===i)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(i){t.maxHdcpLevel=kD[kD.indexOf(i)-1],n.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'));break}}case cO:{const t=e.decryptdata;if(t){const r=this.hls.levels,s=r.length;for(let n=s;n--;){var i,a;if(this.variantHasKey(r[n],t))this.log("Banned key found in level ".concat(n," (").concat(r[n].bitrate,'bps) or audio group "').concat(null==(i=r[n].audioGroups)?void 0:i.join(","),'" (').concat(null==(a=e.frag)?void 0:a.type," fragment) ").concat(pP(t.keyId||[]))),r[n].fragmentError++,r[n].loadError++,this.log("Removing level ".concat(n," with key error (").concat(e.error,")")),this.hls.removeLevel(n)}const o=e.frag;if(this.hls.levels.length<s)n.resolved=!0;else if(o&&o.type!==QR){const e=o.decryptdata;e&&!t.matches(e)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===GR.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=mD(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r]["".concat(e.sourceBufferName,"Codec")]===t&&(this.log("Removing level ".concat(r," for ").concat(e.details,' ("').concat(t,'" not supported)')),this.hls.removeLevel(r))}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"===typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const e=r-this.lastTime,s=n-this.lastDroppedFrames,i=t-this.lastDecodedFrames,a=1e3*s/e,o=this.hls;if(o.trigger(HR.FPS_DROP,{currentDropped:s,currentDecoded:i,totalDroppedFrames:n}),a>0&&s>o.config.fpsDroppedMonitoringThreshold*i){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(HR.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:cN,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:mB,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends dM{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",ZR),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.on(HR.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(HR.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(HR.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(HR.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(HR.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.off(HR.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(HR.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(HR.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(HR.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(HR.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=eM,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(this.fragContextChanged(n)||(xP(n)&&(this.fragPrevious=n),this.state=eM),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let i;const a=n.start;for(let l=0;l<s.length;l++)if(a>=s[l].start&&a<=s[l].end){i=s[l];break}const o=n.start+n.duration;i?i.end=o:(i={start:a,end:o},s.push(i)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(0===n&&r!==Number.POSITIVE_INFINITY){const e=r-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let n=0;n<t.length;)if(t[n].end<=e)t.shift();else{if(!(t[n].start<e))break;t[n].start=e,n++}}),this.fragmentTracker.removeFragmentsInRange(n,e,ZR)}}onError(e,t){const n=t.frag;(null==n?void 0:n.type)===ZR&&(t.details===GR.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==$N&&(this.state=eM))}onSubtitleTracksUpdated(e,t){let{subtitleTracks:n}=t;this.levels&&HF(this.levels,n)?this.levels=n.map(e=>new RD(e)):(this.tracksBuffered=[],this.levels=n.map(e=>{const t=new RD(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ZR),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==$N&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:s}=this,{details:i,id:a}=t;if(!s)return void this.warn("Subtitle tracks were reset while loading level ".concat(a));const o=s[a];if(a>=s.length||!o)return;this.log("Subtitle track ".concat(a," loaded [").concat(i.startSN,",").concat(i.endSN,"]").concat(i.lastPartSn?"[part-".concat(i.lastPartSn,"-").concat(i.lastPartIndex,"]"):"",",duration:").concat(i.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(i.live||null!=(n=o.details)&&n.live){if(i.deltaUpdateFailed)return;const e=this.mainDetails;if(!e)return void(this.startFragRequested=!1);const t=e.fragments[0];var c;if(o.details)l=this.alignPlaylists(i,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&t&&(l=t.start,FN(i,l));else i.hasProgramDateTime&&e.hasProgramDateTime?(QN(i,e),l=i.fragmentStart):t&&(l=t.start,FN(i,l));e&&!this.startFragRequested&&this.setStartPosition(e,l)}if(o.details=i,this.levelLastLoaded=o,a===r&&(this.hls.trigger(HR.SUBTITLE_TRACK_UPDATED,{details:i,id:a,groupId:t.groupId}),this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===eM)){HD(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&null!=r&&r.key&&r.iv&&YO(r.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,QO(r.method)).catch(e=>{throw s.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(n=>{const r=performance.now();s.trigger(HR.FRAG_DECRYPTED,{frag:t,payload:n,stats:{tstart:e,tdecrypt:r}})}).catch(e=>{this.warn("".concat(e.name,": ").concat(e.message)),this.state=eM})}}doTick(){if(this.media){if(this.state===eM){const{currentTrackId:e,levels:t}=this,n=null==t?void 0:t[e];if(!n||!t.length||!n.details)return;if(this.waitForLive(n))return;const{config:r}=this,s=this.getLoadPosition(),i=DO.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:o}=i,l=n.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,u=c.length,d=l.edge;let h=null;const f=this.fragPrevious;if(a<d){const e=r.maxFragLookUpTolerance,t=a>d-e?0:e;h=HD(f,c,Math.max(c[0].start,a),t),!h&&f&&f.start<c[0].start&&(h=c[0])}else h=c[u-1];if(h=this.filterReplacedPrimary(h,n.details),!h)return;const p=c[h.sn-l.startSN-1];if(p&&p.cc===h.cc&&this.fragmentTracker.getState(p)===dO&&(h=p),this.fragmentTracker.getState(h)===dO){const e=this.mapToInitFragWhenRequired(h);e&&this.loadFragment(e,n,a)}}}else this.state=eM}loadFragment(e,t,n){xP(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Ej(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends GF{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=sj(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=t[r];else if("showing"===t[r].mode){e=t[r];break}const n=this.findTrackForTextTrack(e);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.on(HR.LEVEL_LOADING,this.onLevelLoading,this),e.on(HR.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(HR.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(HR.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.off(HR.LEVEL_LOADING,this.onLevelLoading,this),e.off(HR.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(HR.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(HR.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;sj(n.textTracks).forEach(e=>{nj(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,i=this.tracksInGroup[n];if(!i||i.groupId!==r)return void this.warn("Subtitle track with id:".concat(n," and group:").concat(r," not found in active group ").concat(null==i?void 0:i.groupId));const a=i.details;i.details=t.details,this.log("Subtitle track ".concat(n,' "').concat(i.name,'" lang:').concat(i.lang," group:").concat(r," loaded [").concat(s.startSN,"-").concat(s.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==r?void 0:r.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!s&&t){this.selectDefaultTrack=!1;const n=UD(t,e);if(n>-1)s=e[n];else{const e=UD(t,this.tracks);s=this.tracks[e]}}let r=this.findTrackId(s);-1===r&&s&&(r=this.findTrackId(null));const i={subtitleTracks:e};this.log("Updating subtitle tracks, ".concat(e.length,' track(s) found in "').concat(null==n?void 0:n.join(","),'" group-id')),this.hls.trigger(HR.SUBTITLE_TRACKS_UPDATED,i),-1!==r&&-1===this.trackId&&this.setSubtitleTrack(r)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if((!n||s.default)&&(n||e)&&(!e||jD(s,e)))return r}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(KF(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(KF(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){if(WF(t[n],e))return n}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==YR||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&jD(e,n))return n;const r=UD(e,this.tracksInGroup);if(r>-1){const e=this.tracksInGroup[r];return this.setSubtitleTrack(r),e}if(n)return null;{const n=UD(e,t);if(n>-1)return t[n]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),i=e.details,a=null==i?void 0:i.age;this.log("Loading subtitle ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&i.live?" age "+a.toFixed(1)+(i.type?" "+i.type||0:""):""," ").concat(s)),this.hls.trigger(HR.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=sj(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(e=>WF(n,e))[0],r||this.warn('Unable to find subtitle TextTrack with name "'.concat(n.name,'" and language "').concat(n.lang,'"'))),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==r&&(e.mode="disabled")}),r){const e=this.subtitleDisplay?"showing":"hidden";r.mode!==e&&(r.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!jR(e))return void this.warn("Invalid subtitle track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r)return void this.hls.trigger(HR.SUBTITLE_TRACK_SWITCH,{id:e});const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&s)return;this.log("Switching to subtitle-track ".concat(e)+(r?' "'.concat(r.name,'" lang:').concat(r.lang," group:").concat(r.groupId):""));const{id:i,groupId:a="",name:o,type:l,url:c}=r;this.hls.trigger(HR.SUBTITLE_TRACK_SWITCH,{id:i,groupId:a,name:o,type:l,url:c});const u=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(u)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(HR.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(HR.FRAG_LOADING,this.onFragLoading,this),e.on(HR.FRAG_LOADED,this.onFragLoaded,this),e.on(HR.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(HR.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(HR.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(HR.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(HR.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(HR.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(HR.FRAG_LOADING,this.onFragLoading,this),e.off(HR.FRAG_LOADED,this.onFragLoaded,this),e.off(HR.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(HR.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(HR.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(HR.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(HR.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new dB(this,"textTrack1"),t=new dB(this,"textTrack2"),n=new dB(this,"textTrack3"),r=new dB(this,"textTrack4");this.cea608Parser1=new Fj(1,e,t),this.cea608Parser2=new Fj(3,n,r)}addCues(e,t,n,r,s){let i=!1;for(let a=s.length;a--;){const e=s[a],r=pB(e[0],e[1],t,n);if(r>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],n),i=!0,r/(n-t)>.5))return}if(i||s.push([t,n]),this.config.renderTextTracksNatively){const s=this.captionsTracks[e];this.Cues.newCue(s,t,n,r)}else{const s=this.Cues.newCue(null,t,n,r);this.hls.trigger(HR.CUES_PARSED,{type:"captions",cues:s,track:e})}}onInitPtsFound(e,t){let{frag:n,id:r,initPTS:s,timescale:i,trackId:a}=t;const{unparsedVttFrags:o}=this;r===QR&&(this.initPTS[n.cc]={baseTime:s,timescale:i,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(HR.FRAG_LOADED,e):this.hls.trigger(HR.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const s=n.textTracks[r];if(fB(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:s,languageCode:i}=t[e],a=this.getExistingTrack(s,i);if(a)n[e]=a,nj(n[e]),ej(n[e],r);else{const t=this.createTextTrack("captions",s,i);t&&(t[e]=!0,n[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(HR.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(e=>{nj(r[e]),delete r[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)nj(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(e=>e.textCodec===eB);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(HF(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const e=this.media,t=e?sj(e.textTracks):null;if(this.tracks.forEach((e,n)=>{let r;if(t){let n=null;for(let r=0;r<t.length;r++)if(t[r]&&fB(t[r],e)){n=t[r],t[r]=null;break}n&&(r=n)}if(r)nj(r);else{const t=hB(e);r=this.createTextTrack(t,e.name,e.lang),r&&(r.mode="disabled")}r&&this.textTracks.push(r)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: ".concat(e.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){const e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(HR.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const n="textTrack".concat(t[1]),r=this.captionsProperties[n];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===QR){var n,r;const{cea608Parser1:e,cea608Parser2:s,lastSn:i}=this,{cc:a,sn:o}=t.frag,l=null!=(n=null==(r=t.part)?void 0:r.index)?n:-1;e&&s&&(o!==i+1||o===i&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),s.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===ZR)if(r.byteLength){const e=n.decryptdata,s="stats"in t;if(null==e||!e.encrypted||s){const e=this.tracks[n.level],s=this.vttCCs;s[n.cc]||(s[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),e&&e.textCodec===eB?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(HR.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;sB(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),n.trigger(HR.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{n.logger.log("Failed to parse IMSC1: ".concat(t)),n.trigger(HR.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:s,unparsedVttFrags:i}=this,a=s.length-1;if(!s[n.cc]&&-1===a)return void i.push(e);const o=this.hls;$j(null!=(t=n.initSegment)&&t.data?qP(n.initSegment.data,new Uint8Array(r)).buffer:r,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,e=>{this._appendCues(e,n.level),o.trigger(HR.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},t=>{const s="Missing initPTS for VTT MPEGTS"===t.message;s?i.push(e):this._fallbackToIMSC1(n,r),o.logger.log("Failed to parse VTT cue: ".concat(t)),s&&a>n.cc||o.trigger(HR.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||sB(t,this.initPTS[e.cc],()=>{n.textCodec=eB,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach(e=>tj(n,e))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;n.trigger(HR.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===ZR&&this.onFragLoaded(HR.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(n.type!==QR||"NONE"!==this.closedCaptionsForLevel(n))for(let s=0;s<r.length;s++){const e=r[s].bytes;if(e){this.cea608Parser1||this.initCea608Parsers();const t=this.extractCea608Data(e);this.cea608Parser1.addData(r[s].pts,t[0]),this.cea608Parser2.addData(r[s].pts,t[1])}}}onBufferFlushing(e,t){let{startOffset:n,endOffset:r,endOffsetSubtitles:s,type:i}=t;const{media:a}=this;if(a&&!(a.currentTime<r)){if(!i||"video"===i){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>rj(e[t],n,r))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==s){const{textTracks:e}=this;Object.keys(e).forEach(t=>rj(e[t],n,s))}}}extractCea608Data(e){const t=[[],[]],n=31&e[0];let r=2;for(let s=0;s<n;s++){const n=e[r++],s=127&e[r++],i=127&e[r++];if(0===s&&0===i)continue;if(0!==(4&n)){const e=3&n;0!==e&&1!==e||(t[e].push(s),t[e].push(i))}}return t}},audioStreamController:class extends dM{constructor(e,t,n){super(e,t,n,"audio-stream-controller",XR),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.on(HR.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(HR.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(HR.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(HR.BUFFER_RESET,this.onBufferReset,this),e.on(HR.BUFFER_CREATED,this.onBufferCreated,this),e.on(HR.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(HR.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(HR.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(HR.FRAG_LOADING,this.onFragLoading,this),e.on(HR.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.off(HR.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(HR.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(HR.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(HR.BUFFER_RESET,this.onBufferReset,this),e.off(HR.BUFFER_CREATED,this.onBufferCreated,this),e.off(HR.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(HR.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(HR.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(HR.FRAG_LOADING,this.onFragLoading,this),e.off(HR.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,t){let{frag:n,id:r,initPTS:s,timescale:i,trackId:a}=t;if(r===QR){const e=n.cc,t=this.fragCurrent;if(this.initPTS[e]={baseTime:s,timescale:i,trackId:a},this.log("InitPTS for cc: ".concat(e," found from main: ").concat(s/i," (").concat(s,"/").concat(i,") trackId: ").concat(a)),this.mainAnchor=n,this.state===cM){const t=this.waitingData;(!t&&!this.loadingParts||t&&t.frag.cc!==e)&&this.syncWithAnchor(n,null==t?void 0:t.frag)}else!this.hls.hasEnoughToStart&&t&&t.cc!==e?(t.abortRequests(),this.syncWithAnchor(n,t)):this.state===eM&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const r=(null==(n=this.mainFragLoading)?void 0:n.frag)||null;if(t&&(null==r?void 0:r.cc)===t.cc)return;const s=(r||e).cc,i=qD(this.getLevelDetails(),s,this.getLoadPosition());i&&(this.log("Syncing with main frag at ".concat(i.start," cc ").concat(i.cc)),this.startFragRequested=!1,this.nextLoadPosition=i.start,this.resetLoadingState(),this.state===eM&&this.doTickIdle())}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=$N);const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),n>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n,this.state=eM):this.state=sM,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case eM:this.doTickIdle();break;case sM:{const{levels:e,trackId:t}=this,n=null==e?void 0:e[t],r=null==n?void 0:n.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=cM}break}case rM:this.checkRetryDate();break;case cM:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:r,complete:s}=e,i=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=nM;const e={frag:t,part:n,payload:r.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),s&&super._handleFragmentLoadComplete(e)}else i&&i.cc!==e.frag.cc&&this.syncWithAnchor(i,e.frag)}else this.state=eM}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:s}=this,i=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!i.startFragPrefetch)||null==n||!n[s])return;const a=n[s],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=sM,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,wP,XR));const c=this.getFwdBufferInfo(l,XR);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o))return t.trigger(HR.BUFFER_EOS,{type:"audio"}),void(this.state=oM);const u=c.len,d=t.maxBufferLength,h=o.fragments,f=h[0].start,p=this.getLoadPosition(),g=this.flushing?p:c.end;if(this.switchingTrack&&r){const e=p;o.PTSKnown&&e<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=f+.05)}if(u>=d&&!this.switchingTrack&&g<h[h.length-1].start)return;let m=this.getNextFragment(g,o);if(m&&this.isLoopLoading(m,g)&&(m=this.getNextFragmentLoopLoading(m,o,c,QR,d)),!m)return void(this.bufferFlushed=!0);let v=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&xP(m)&&!m.endList&&(!o.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===pO&&(this.mainFragLoading=v=null),v&&xP(v))){if(m.start>v.end){const e=this.fragmentTracker.getFragAtPos(g,QR);e&&e.end>v.end&&(v=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(m.start>v.end)return}this.loadFragment(m,a,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,t){let{audioTracks:n}=t;this.resetTransmuxer(),this.levels=n.map(e=>new RD(e))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==$N&&(this.setInterval(100),this.state=eM,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(HR.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:s,id:i,groupId:a,track:o}=t;if(!r)return void this.warn("Audio tracks reset while loading track ".concat(i,' "').concat(o.name,'" of "').concat(a,'"'));const l=this.mainDetails;if(!l||s.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==$N&&(this.state=sM));this.cachedTrackLoadedData=null,this.log("Audio track ".concat(i,' "').concat(o.name,'" of "').concat(a,'" loaded [').concat(s.startSN,",").concat(s.endSN,"]").concat(s.lastPartSn?"[part-".concat(s.lastPartSn,"-").concat(s.lastPartIndex,"]"):"",",duration:").concat(s.totalduration));const c=r[i];let u=0;if(s.live||null!=(n=c.details)&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;var d;if(c.details)u=this.alignPlaylists(s,c.details,null==(d=this.levelLastLoaded)?void 0:d.details);s.alignedSliding||(YN(s,l),s.alignedSliding||QN(s,l),u=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,u),this.hls.trigger(HR.AUDIO_TRACK_UPDATED,{details:s,id:i,groupId:t.groupId}),this.state!==sM||this.waitForCdnTuneIn(s)||(this.state=eM),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{config:i,trackId:a,levels:o}=this;if(!o)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const u=i.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new zF(this.hls,XR,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[n.cc],f=null==(t=n.initSegment)?void 0:t.data;if(void 0!==h){const e=!1,t=r?r.index:-1,i=-1!==t,a=new RO(n.level,n.sn,n.stats.chunkCount,s.byteLength,t,i);d.push(s,f,u,"",n,r,c.totalduration,e,a,h)}else{this.log("Unknown video PTS for cc ".concat(n.cc,", waiting for video PTS before demuxing audio frag ").concat(n.sn," of [").concat(c.startSN," ,").concat(c.endSN,"],track ").concat(a));const{cache:e}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new fM,complete:!1};e.push(new Uint8Array(s)),this.state!==$N&&(this.state=cM)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===QR&&xP(t.frag)&&(this.mainFragLoading=t,this.state===eM&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type===XR)if(this.fragContextChanged(n))this.warn("Fragment ".concat(n.sn).concat(r?" p: "+r.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if(xP(n)){this.fragPrevious=n;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(HR.AUDIO_TRACK_SWITCHED,rP({},e)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}else this.audioOnly||n.type!==QR||n.elementaryStreams.video||n.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var n;if(t.fatal)this.state=lM;else switch(t.details){case GR.FRAG_GAP:case GR.FRAG_PARSING_ERROR:case GR.FRAG_DECRYPT_ERROR:case GR.FRAG_LOAD_ERROR:case GR.FRAG_LOAD_TIMEOUT:case GR.KEY_LOAD_ERROR:case GR.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(XR,t);break;case GR.AUDIO_TRACK_LOAD_ERROR:case GR.AUDIO_TRACK_LOAD_TIMEOUT:case GR.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==sM||(null==(n=t.context)?void 0:n.type)!==qR||(this.state=eM);break;case GR.BUFFER_ADD_CODEC_ERROR:case GR.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case GR.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case GR.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,t){let{type:n}=t;n!==SP&&(this.flushing=!0)}onBufferFlushed(e,t){let{type:n}=t;if(n!==SP){this.flushing=!1,this.bufferFlushed=!0,this.state===oM&&(this.state=eM);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,n,XR),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:s,chunkMeta:i}=e,a=this.getCurrentContext(i);if(!a)return void this.resetWhenMissingContext(i);const{frag:o,part:l,level:c}=a,{details:u}=c,{audio:d,text:h,id3:f,initSegment:p}=s;if(!this.fragContextChanged(o)&&u){if(this.state=iM,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const e=o.initSegment||o;if(this.unhandledEncryptionError(p,o))return;this._bufferInitSegment(c,p.tracks,e,i),r.trigger(HR.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:p.tracks})}if(d){const{startPTS:e,endPTS:t,startDTS:n,endDTS:r}=d;l&&(l.elementaryStreams[wP]={startPTS:e,endPTS:t,startDTS:n,endDTS:r}),o.setElementaryStreamInfo(wP,e,t,n,r),this.bufferFragmentData(d,o,l,i)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=tP({id:n,frag:o,details:u},f);r.trigger(HR.FRAG_PARSING_METADATA,e)}if(h){const e=tP({id:n,frag:o,details:u},h);r.trigger(HR.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,n,r){if(this.state!==iM)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const s=t.audio;s.id=XR;const i=e.audioCodec;this.log("Init audio buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(i,"/").concat(s.codec,"]")),i&&1===i.split(",").length&&(s.levelCodec=i),this.hls.trigger(HR.BUFFER_CODECS,t);const a=s.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:a};this.hls.trigger(HR.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);var s;if(this.switchingTrack||r===dO||r===fO)if(xP(e))if(null!=(s=t.details)&&s.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=cM;const n=this.mainDetails;n&&n.fragmentStart!==t.details.fragmentStart&&QN(t.details,n)}else super.loadFragment(e,t,n);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:s,audioCodec:i,channels:a}=this.bufferedTrack;jD({name:t,lang:n,assocLang:r,characteristics:s,audioCodec:i,channels:a},e,BD)||(zD(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(HR.AUDIO_TRACK_SWITCHED,rP({},e))}},audioTrackController:class extends GF{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.on(HR.LEVEL_LOADING,this.onLevelLoading,this),e.on(HR.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(HR.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(HR.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.off(HR.LEVEL_LOADING,this.onLevelLoading,this),e.off(HR.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(HR.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(HR.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,i=this.tracksInGroup[n];if(!i||i.groupId!==r)return void this.warn("Audio track with id:".concat(n," and group:").concat(r," not found in active group ").concat(null==i?void 0:i.groupId));const a=i.details;i.details=t.details,this.log("Audio track ".concat(n,' "').concat(i.name,'" lang:').concat(i.lang," group:").concat(r," loaded [").concat(s.startSN,"-").concat(s.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==r?void 0:r.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!s&&t){const n=UD(t,e,BD);if(n>-1)s=e[n];else{const e=UD(t,this.tracks);s=this.tracks[e]}}let r=this.findTrackId(s);-1===r&&s&&(r=this.findTrackId(null));const a={audioTracks:e};this.log("Updating audio tracks, ".concat(e.length," track(s) found in group(s): ").concat(null==n?void 0:n.join(","))),this.hls.trigger(HR.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==r&&-1===o)this.setAudioTrack(r);else if(e.length&&-1===o){var i;const t=new Error("No audio track selected for current audio group-ID(s): ".concat(null==(i=this.groupIds)?void 0:i.join(",")," track count: ").concat(e.length));this.warn(t.message),this.hls.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==qR||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&jD(e,r,BD))return r;const s=UD(e,this.tracksInGroup,BD);if(s>-1){const e=this.tracksInGroup[s];return this.setAudioTrack(s),e}if(r){let r=t.loadLevel;-1===r&&(r=t.firstAutoLevel);const s=function(e,t,n,r,s){const i=t[r],a=t.reduce((e,t,n)=>{const r=t.uri;return(e[r]||(e[r]=[])).push(n),e},{})[i.uri];a.length>1&&(r=Math.max.apply(Math,a));const o=i.videoRange,l=i.frameRate,c=i.codecSet.substring(0,4),u=VD(t,r,t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==c)return!1;const r=t.audioGroups,i=n.filter(e=>!r||-1!==r.indexOf(e.groupId));return UD(e,i,s)>-1});return u>-1?u:VD(t,r,t=>{const r=t.audioGroups,i=n.filter(e=>!r||-1!==r.indexOf(e.groupId));return UD(e,i,s)>-1})}(e,t.levels,n,r,BD);if(-1===s)return null;t.nextLoadLevel=s}if(e.channels||e.audioCodec){const t=UD(e,n);if(t>-1)return n[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid audio track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===n&&s)return;if(this.log("Switching to audio-track ".concat(e,' "').concat(r.name,'" lang:').concat(r.lang," group:").concat(r.groupId," channels:").concat(r.channels)),this.trackId=e,this.currentTrack=r,this.hls.trigger(HR.AUDIO_TRACK_SWITCHING,rP({},r)),s)return;const i=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(i)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if((!this.selectDefaultTrack||r.default)&&(!e||jD(e,r,BD)))return n}if(e){const{name:n,lang:r,assocLang:s,characteristics:i,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){if(jD({name:n,lang:r,assocLang:s,characteristics:i,audioCodec:a,channels:o},t[e],BD))return e}for(let l=0;l<t.length;l++){const n=t[l];if(KF(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const n=t[l];if(KF(e.attrs,n.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&zD(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),i=e.details,a=null==i?void 0:i.age;this.log("Loading audio-track ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&i.live?" age "+a.toFixed(1)+(i.type?" "+i.type||0:""):""," ").concat(s)),this.hls.trigger(HR.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}},emeController:QU,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:eU.MANIFEST,su:!this.initialized})}catch(t){this.hls.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const{frag:t,part:n}=e,r=this.hls.levels[t.level],s=this.getObjectType(t),i={d:1e3*(n||t).duration,ot:s};s!==eU.VIDEO&&s!==eU.AUDIO&&s!=eU.MUXED||(i.br=r.bitrate/1e3,i.tb=this.getTopBandwidth(s)/1e3,i.bl=this.getBufferLength(s));const a=n?this.getNextPart(n):this.getNextFrag(t);null!=a&&a.url&&a.url!==t.url&&(i.nor=a.url),this.apply(e,i)}catch(t){this.hls.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;null!=n&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(HR.MEDIA_DETACHED,this.onMediaDetached,this),e.on(HR.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(HR.MEDIA_DETACHED,this.onMediaDetached,this),e.off(HR.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:tU.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};tP(t,this.createData());const n=t.ot===eU.INIT||t.ot===eU.VIDEO||t.ot===eU.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((e,n)=>(r.includes(n)&&(e[n]=t[n]),e),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),GU(e.headers,t,s)):e.url=WU(e.url,t,s)}getNextFrag(e){var t;const n=null==(t=this.hls.levels[e.level])?void 0:t.details;if(n){const t=e.sn-n.startSN;return n.fragments[t+1]}}getNextPart(e){var t;const{index:n,fragment:r}=e,s=null==(t=this.hls.levels[r.level])||null==(t=t.details)?void 0:t.partList;if(s){const{sn:e}=r;for(let t=s.length-1;t>=0;t--){const r=s[t];if(r.index===n&&r.fragment.sn===e)return s[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?eU.TIMED_TEXT:"initSegment"===e.sn?eU.INIT:"audio"===t?eU.AUDIO:"main"===t?this.hls.audioTracks.length?eU.VIDEO:eU.MUXED:void 0}getTopBandwidth(e){let t,n=0;const r=this.hls;if(e===eU.AUDIO)t=r.audioTracks;else{const e=r.maxAutoLevel,n=e>-1?e+1:r.levels.length;t=r.levels.slice(0,n)}return t.forEach(e=>{e.bitrate>n&&(n=e.bitrate)}),n>0?n:NaN}getBufferLength(e){const t=this.media,n=e===eU.AUDIO?this.audioBuffer:this.videoBuffer;if(!n||!t)return NaN;return 1e3*DO.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,r){t(e),this.loader.load(e,n,r)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,r){t(e),this.loader.load(e,n,r)}}}},contentSteeringController:class extends sP{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.on(HR.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.off(HR.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((null==n?void 0:n.action)===rO&&n.flags===oO){const e=this.levels;let r=this._pathwayPriority,s=this.pathwayId;if(t.context){const{groupId:n,pathwayId:r,type:i}=t.context;n&&e?s=this.getPathwayForGroupId(n,i,s):r&&(s=r)}s in this.penalizedPathways||(this.penalizedPathways[s]=performance.now()),!r&&e&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==s),t.details!==GR.BUFFER_APPEND_ERROR||t.fatal?n.resolved||this.warn("Could not resolve ".concat(t.details,' ("').concat(t.error.message,'") with content-steering for Pathway: ').concat(s," levels: ").concat(e?e.length:e," priorities: ").concat(OD(r)," penalized: ").concat(OD(this.penalizedPathways))):n.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const n=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(n,'"')),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(e=>{r-n[e]>3e5&&delete n[e]});for(let s=0;s<e.length;s++){const r=e[s];if(r in n)continue;if(r===this.pathwayId)return;const i=this.hls.nextLoadLevel,a=this.hls.levels[i];if(t=this.getLevelsForPathway(r),t.length>0){this.log('Setting Pathway to "'.concat(r,'"')),this.pathwayId=r,zN(t),this.hls.trigger(HR.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[i];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(a.bitrate," to ").concat(e.bitrate)),this.hls.nextLoadLevel=i);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===qR&&r[s].hasAudioGroup(e)||t===YR&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(e=>{const{ID:s,"BASE-ID":i,"URI-REPLACEMENT":a}=e;if(t.some(e=>e.pathwayId===s))return;const o=this.getLevelsForPathway(i).map(e=>{const t=new VO(e.attrs);t["PATHWAY-ID"]=s;const i=t.AUDIO&&"".concat(t.AUDIO,"_clone_").concat(s),o=t.SUBTITLES&&"".concat(t.SUBTITLES,"_clone_").concat(s);i&&(n[t.AUDIO]=i,t.AUDIO=i),o&&(r[t.SUBTITLES]=o,t.SUBTITLES=o);const l=YU(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),c=new RD({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let n=1;n<e.audioGroups.length;n++)c.addGroupId("audio","".concat(e.audioGroups[n],"_clone_").concat(s));if(e.subtitleGroups)for(let n=1;n<e.subtitleGroups.length;n++)c.addGroupId("text","".concat(e.subtitleGroups[n],"_clone_").concat(s));return c});t.push(...o),qU(this.audioTracks,n,a,s),qU(this.subtitleTracks,r,a,s)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;let r;this.loader&&this.loader.destroy(),this.loader=new n(t);try{r=new self.URL(e)}catch(c){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(e))}if("data:"!==r.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+e)}const s={responseType:"json",url:r.href},i=t.steeringManifestLoadPolicy.default,a=i.errorRetry||i.timeoutRetry||{},o={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,n,s)=>{this.log('Loaded steering manifest: "'.concat(r,'"'));const i=e.data;if(1!==(null==i?void 0:i.VERSION))return void this.log("Steering VERSION ".concat(i.VERSION," not supported!"));this.updated=performance.now(),this.timeToLoad=i.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=i;if(a)try{this.uri=new self.URL(a,r).href}catch(c){return this.enabled=!1,void this.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(a))}this.scheduleRefresh(this.uri||n.url),o&&this.clonePathways(o);const u={steeringManifest:i,url:r.toString()};this.hls.trigger(HR.STEERING_MANIFEST_LOADED,u),l&&this.updatePathwayPriority(l)},onError:(e,t,n,r)=>{if(this.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log("Steering manifest ".concat(t.url," no longer available"));let s=1e3*this.timeToLoad;if(429===e.code){const e=this.loader;if("function"===typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(s=1e3*parseFloat(t))}return void this.log("Steering manifest ".concat(t.url," rate limited"))}this.scheduleRefresh(this.uri||t.url,s)},onTimeout:(e,t,n)=>{this.log("Timeout loading steering manifest (".concat(t.url,")")),this.scheduleRefresh(this.uri||t.url)}};this.log("Requesting steering manifest: ".concat(r)),this.loader.load(s,o,l)}scheduleRefresh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const n=null==(t=this.hls)?void 0:t.media;!n||n.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}},interstitialsController:class extends sP{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled||!this.schedule)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const n=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const r=this.playingItem;if(!r)return void this.checkBuffer();if(n){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(!0)}if(this.checkBuffer(),n&&e<r.start||e>=r.end){var s;const t=this.findItemIndex(r);let i=this.schedule.findItemIndexAtTime(e);if(-1===i&&(i=t+(n?-1:1),this.log("seeked ".concat(n?"back ":"","to position not covered by schedule ").concat(e," (resolving from ").concat(t," to ").concat(i,")"))),!this.isInterstitial(r)&&null!=(s=this.media)&&s.paused&&(this.shouldPlay=!1),!n&&i>t){const e=this.schedule.findJumpRestrictedIndex(t+1,i);if(e>t)return void this.setSchedulePosition(e)}return void this.setSchedulePosition(i)}const i=this.playingAsset;if(!i){if(this.playingLastItem&&this.isInterstitial(r)){const t=r.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const a=i.timelineStart,o=i.duration||0;var l;(n&&e<a||e>=a+o)&&(null!=(l=r.event)&&l.appendInPlace&&(this.clearAssetPlayers(r.event,r),this.flushFrontBuffer(e)),this.setScheduleToAssetAtTime(e,i))},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const n=this.playingAsset;if(!n)return;e>=n.timelineStart+(n.duration||0)&&this.setScheduleToAssetAtTime(e,n)},this.onScheduleUpdate=(e,t)=>{const n=this.schedule;if(!n)return;const r=this.playingItem,s=n.events||[],i=n.items||[],a=n.durations,o=e.map(e=>e.identifier),l=!(!s.length&&!o.length);(l||t)&&this.log("INTERSTITIALS_UPDATED (".concat(s.length,"): ").concat(s,"\nSchedule: ").concat(i.map(e=>mj(e))," pos: ").concat(this.timelinePos)),o.length&&this.log("Removed events ".concat(o));let c=null,u=null;r&&(c=this.updateItem(r,this.timelinePos),this.itemsMatch(r,c)?this.playingItem=c:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const d=this.bufferingItem;if(d&&(u=this.updateItem(d,this.bufferedPos),this.itemsMatch(d,u)?this.bufferingItem=u:d.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(d.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){const t=e.assetItem.timelineStart,n=e.timelineOffset-t;if(n)try{e.timelineOffset=t}catch(_w){Math.abs(n)>aj&&this.warn("".concat(_w,' ("').concat(e.assetId,'" ').concat(e.timelineOffset,"->").concat(t,")"))}}}),l||t){if(this.hls.trigger(HR.INTERSTITIALS_UPDATED,{events:s.slice(0),schedule:i.slice(0),durations:a,removedIds:o}),this.isInterstitial(r)&&o.includes(r.event.identifier))return this.warn('Interstitial "'.concat(r.event.identifier,'" removed while playing')),void this.primaryFallback(r.event);r&&this.trimInPlace(c,r),d&&u!==c&&this.trimInPlace(u,d),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new vj(e),this.schedule=new gj(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(HR.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(HR.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(HR.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(HR.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(HR.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(HR.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(HR.BUFFER_APPENDED,this.onBufferAppended,this),e.on(HR.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(HR.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(HR.MEDIA_ENDED,this.onMediaEnded,this),e.on(HR.ERROR,this.onError,this),e.on(HR.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(HR.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(HR.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(HR.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(HR.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(HR.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(HR.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(HR.BUFFER_CODECS,this.onBufferCodecs,this),e.off(HR.BUFFER_APPENDED,this.onBufferAppended,this),e.off(HR.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(HR.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(HR.MEDIA_ENDED,this.onMediaEnded,this),e.off(HR.ERROR,this.onError,this),e.off(HR.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ZN(e,"play",this.onPlay),ZN(e,"pause",this.onPause),ZN(e,"seeking",this.onSeeking),ZN(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;XN(n,"seeking",this.onSeeking),XN(n,"timeupdate",this.onTimeupdate),XN(n,"play",this.onPlay),XN(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,null===n)this.checkStart();else if(!r){this.clearScheduleState();const e=this.findItemIndex(n);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.log("Removing schedule state for detachedData and ".concat(e)),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=t=>t?e.getAssetPlayer(t.identifier):t,r=(t,r,i,a,o)=>{if(t){let l=t[r].start;const c=t.event;if(c){if("playout"===r||c.timelineOccupancy!==oj.Point){const e=n(i);(null==e?void 0:e.interstitial)===c&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===a?s():e[a])-t.start}return l}return 0},s=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?i("primary"):Math.max(t,0)},i=t=>{var n,r;return null!=(n=e.primaryDetails)&&n.live?e.primaryDetails.edge:(null==(r=e.schedule)?void 0:r.durations[t])||0},a=(t,s)=>{var i,a;const o=e.effectivePlayingItem;if(null!=o&&null!=(i=o.event)&&i.restrictions.skip||!e.schedule)return;e.log("seek to ".concat(t,' "').concat(s,'"'));const l=e.effectivePlayingItem,c=e.schedule.findItemIndexAtTime(t,s),u=null==(a=e.schedule.items)?void 0:a[c],d=e.getBufferingPlayer(),h=null==d?void 0:d.interstitial,f=null==h?void 0:h.appendInPlace,p=l&&e.itemsMatch(l,u);if(l&&(f||p)){const i=n(e.playingAsset),a=(null==i?void 0:i.media)||e.primaryMedia;if(a){const n="primary"===s?a.currentTime:r(l,s,e.playingAsset,"timelinePos","currentTime"),o=t-n,c=(f?n:a.currentTime)+o;if(c>=0&&(!i||f||c<=i.duration))return void(a.currentTime=c)}}if(u){let n=t;if("primary"!==s){const e=t-u[s].start;n=u.start+e}const r=!e.isInterstitial(u);if(e.isInterstitial(l)&&!l.event.appendInPlace||!r&&!u.event.appendInPlace){if(l){const i=e.findItemIndex(l);if(c>i){const t=e.schedule.findJumpRestrictedIndex(i+1,c);if(t>i)return void e.setSchedulePosition(t)}let a=0;if(r)e.timelinePos=n,e.checkBuffer();else{const e=u.event.assetList,n=t-(u[s]||u).start;for(let t=e.length;t--;){const r=e[t];if(r.duration&&n>=r.startOffset&&n<r.startOffset+r.duration){a=t;break}}}e.setSchedulePosition(c,a)}}else{const t=e.media||(f?null==d?void 0:d.media:null);t&&(t.currentTime=n)}}},o=()=>{const n=e.effectivePlayingItem;if(e.isInterstitial(n))return n;const r=t();return e.isInterstitial(r)?r:null},l={get bufferedEnd(){const n=t(),s=e.bufferingItem;var i;return s&&s===n&&(r(s,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-s.playout.start||(null==(i=e.bufferingAsset)?void 0:i.startOffset))||0},get currentTime(){const t=o(),n=e.effectivePlayingItem;return n&&n===t?r(n,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-n.playout.start:0},set currentTime(t){const n=o(),r=e.effectivePlayingItem;r&&r===n&&a(t+r.playout.start,"playout")},get duration(){const e=o();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const n=null==(t=o())?void 0:t.event.assetList;return n?n.map(t=>e.getAssetPlayer(t.identifier)):[]},get playingIndex(){var t;const n=null==(t=o())?void 0:t.event;return n&&e.effectivePlayingAsset?n.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var t;return(null==(t=e.schedule)||null==(t=t.events)?void 0:t.slice(0))||[]},get schedule(){var t;return(null==(t=e.schedule)||null==(t=t.items)?void 0:t.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const n=t();return e.findItemIndex(n)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return s()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){a(e,"primary")},get duration(){return i("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){a(e,"integrated")},get duration(){return i("integrated")},get seekableStart(){var t;return((t,n)=>{var r;if(0!==t&&"primary"!==n&&null!=(r=e.schedule)&&r.length){var s;const r=e.schedule.findItemIndexAtTime(t),i=null==(s=e.schedule.items)?void 0:s[r];if(i)return t+(i[n].start-i.start)}return t})((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,n=null==t?void 0:t.event;if(n&&!n.restrictions.skip){const r=e.findItemIndex(t);if(n.appendInPlace){const e=t.playout.start+t.event.duration;a(e+.001,"playout")}else e.advanceAfterAssetEnded(n,r,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&n)&&this.findItemIndex(t)===n.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(r=this.primaryMedia);const s=null==(t=r)?void 0:t.currentTime;return void 0!==s&&jR(s)?s:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r)return void(this.detachedData={media:r});const n=e.transferMedia();this.log("transfer MediaSource from ".concat(e," ").concat(OD(n))),this.detachedData=n}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let s=null;const i=this.hls,a=e!==i,o=a&&e.interstitial.appendInPlace,l=null==(n=this.detachedData)?void 0:n.mediaSource;let c;if(i.media)o&&(s=i.transferMedia(),this.detachedData=s),c="Primary";else if(l){const e=this.getBufferingPlayer();e?(s=e.transferMedia(),c="".concat(e)):c="detached MediaSource"}else c="detached media";if(!s)if(l)s=this.detachedData,this.log("using detachedData: MediaSource ".concat(OD(s)));else if(!this.detachedData||i.media===t){const e=this.playerQueue;e.length>1&&e.forEach(e=>{if(a&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn("Could not change append strategy for queued assets ".concat(t))}}),this.hls.detachMedia(),this.detachedData={media:t}}const u=s&&"mediaSource"in s&&"closed"!==(null==(r=s.mediaSource)?void 0:r.readyState),d=u&&s?s:t;this.log("".concat(u?"transfering MediaSource":"attaching media"," to ").concat(a?e:"Primary"," from ").concat(c," (media.currentTime: ").concat(t.currentTime,")"));const h=this.schedule;if(d===s&&h){const t=a&&e.assetId===h.assetIdAtEnd;d.overrides={duration:h.duration,endOfStream:!a||t,cueRemoval:!a}}e.attachMedia(d)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(-1===n){const n=this.hls.startPosition;if(this.log(bj("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const n=e.findEventIndex(t[0].identifier);this.setSchedulePosition(n)}else if(n>=0||!this.primaryLive){const t=this.timelinePos=n>0?n:0,r=e.findItemIndexAtTime(t);this.setSchedulePosition(r)}}else if(r&&!this.playingItem){const t=e.findItemIndex(r);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){const n=e.event,r=n.findAssetIndex(t),s=hj(n,r);if(n.isAssetPastPlayoutLimit(s)){if(this.schedule){var i;const t=null==(i=this.schedule.items)?void 0:i[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,s)}advanceAfterAssetEnded(e,t,n){const r=hj(e,n);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const n=this.schedule.items;if(n){const r=t+1;if(r>=n.length)return void this.setSchedulePosition(-1);const s=e.resumeTime;this.timelinePos<s&&(this.log(bj("advanceAfterAssetEnded",s)),this.timelinePos=s,e.appendInPlace&&this.advanceInPlace(s),this.checkBuffer(this.bufferedPos<s)),this.setSchedulePosition(r)}}}else{if(e.appendInPlace){const t=e.assetList[r];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const r=t.parentIdentifier,s=n.getEvent(r);if(s){const t=n.findEventIndex(r),i=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,t,i-1)}}setSchedulePosition(e,t){var n;const r=null==(n=this.schedule)?void 0:n.items;if(!r||this.playbackDisabled)return;const s=e>=0?r[e]:null;this.log("setSchedulePosition ".concat(e,", ").concat(t," (").concat(s?mj(s):s,") pos: ").concat(this.timelinePos));const i=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(i)){const n=i.event,c=this.playingAsset,u=null==c?void 0:c.identifier,d=u?this.getAssetPlayer(u):null;if(d&&u&&(!this.eventItemsMatch(i,s)||void 0!==t&&u!==n.assetList[t].identifier)){var o;const t=n.findAssetIndex(c);if(this.log("INTERSTITIAL_ASSET_ENDED ".concat(t+1,"/").concat(n.assetList.length," ").concat(fj(c))),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(HR.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:n,schedule:r.slice(0),scheduleIndex:e,player:d}),i!==this.playingItem)return void(this.itemsMatch(i,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(n,this.findItemIndex(this.playingItem),t));this.retreiveMediaSource(u,s),!d.media||null!=(o=this.detachedData)&&o.mediaSource||d.detachMedia()}if(!this.eventItemsMatch(i,s)&&(this.endedItem=i,this.playingItem=null,this.log("INTERSTITIAL_ENDED ".concat(n," ").concat(mj(i))),n.hasPlayed=!0,this.hls.trigger(HR.INTERSTITIAL_ENDED,{event:n,schedule:r.slice(0),scheduleIndex:e}),n.cue.once)){var l;this.updateSchedule();const e=null==(l=this.schedule)?void 0:l.items;if(s&&e){const n=this.findItemIndex(s);this.advanceSchedule(n,e,t,i,a)}return}}this.advanceSchedule(e,r,t,i,a)}advanceSchedule(e,t,n,r,s){const i=this.schedule;if(!i)return;const a=t[e]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{const n=t.interstitial,r=i.findEventIndex(n.identifier);(r<e||r>e+1)&&this.clearInterstitial(n,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const s=a.event;if(void 0===n){const t=hj(s,(n=i.findAssetIndex(s,this.timelinePos))-1);if(s.isAssetPastPlayoutLimit(t)||s.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(s,e,n);n=t}const l=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let c=this.preloadAssets(s,n);if(this.eventItemsMatch(a,l||r)||(this.waitingItem=a,this.log("INTERSTITIAL_STARTED ".concat(mj(a)," ").concat(s.appendInPlace?"append in place":"")),this.hls.trigger(HR.INTERSTITIAL_STARTED,{event:s,schedule:t.slice(0),scheduleIndex:e})),!s.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading ".concat(s));if(s.assetListLoader&&(s.assetListLoader.destroy(),s.assetListLoader=void 0),!o)return void this.log("Waiting for attachMedia to start Interstitial ".concat(s));this.waitingItem=this.endedItem=null,this.playingItem=a;const u=s.assetList[n];if(!u)return void this.advanceAfterAssetEnded(s,e,n||0);if(c||(c=this.getAssetPlayer(u.identifier)),null===c||c.destroyed){const e=s.assetList.length;this.warn("asset ".concat(n+1,"/").concat(e," player destroyed ").concat(s)),c=this.createAssetPlayer(s,u,n),c.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&s.appendInPlace&&this.isAssetBuffered(u))return;this.startAssetPlayer(c,n,t,e,o),this.shouldPlay&&yj(c.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&yj(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(i.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,n){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming ".concat(mj(e))),null==(r=this.detachedData)||!r.mediaSource){let n=this.timelinePos;(n<e.start||n>=e.end)&&(n=this.getPrimaryResumption(e,t),this.log(bj("resumePrimary",n)),this.timelinePos=n),this.attachPrimary(n,e)}if(!n)return;const i=null==(s=this.schedule)?void 0:s.items;i&&(this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(mj(e))),this.hls.trigger(HR.INTERSTITIALS_PRIMARY_RESUMED,{schedule:i.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(n<e.fragmentStart||n>e.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return DO.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(bj("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs(((null==(n=r.mainForwardBufferInfo)?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(HR.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(HR.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const r=rP(rP({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r)return void(this.altSelection=rP(rP({},this.altSelection),{},{audio:n}));const s=rP(rP({},r),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r)return void(this.altSelection=rP(rP({},this.altSelection),{},{subtitles:n}));const s=rP(rP({},r),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=FD(t);this.playerQueue.forEach(e=>{let{hls:r}=e;return r&&(r.setAudioOption(t)||r.setAudioOption(n))})}onSubtitleTrackSwitch(e,t){const n=FD(t);this.playerQueue.forEach(e=>{let{hls:r}=e;return r&&(r.setSubtitleOption(t)||-1!==t.id&&r.setSubtitleOption(n))})}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const r=t[e];if(r.cue.post){var n;const e=this.schedule.findEventIndex(r.identifier),t=null==(n=this.schedule.items)?void 0:n[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const r=null==(n=this.schedule)?void 0:n.items;if(e&&r){return r[this.findItemIndex(e,t)]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,n)=>{e.event.isAssetPastPlayoutLimit(n)&&this.clearAssetPlayer(t.identifier,null)});const n=e.end+.25,r=DO.bufferInfo(this.primaryMedia,n,0);if(r.end>n||(r.nextStart||0)>n){this.log("trim buffered interstitial ".concat(mj(e)," (was ").concat(mj(t),")"));const r=!0;this.attachPrimary(n,null,r),this.flushFrontBuffer(n)}}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===(null==(n=t.event)?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const n=this.mediaSelection;n&&(null==(t=this.schedule)||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=null==(t=this.schedule)?void 0:t.items;if(!n)return;const r=DO.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,n,e)}updateBufferedPos(e,t,n){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(1===t.length&&this.itemsMatch(t[0],s))return void(this.bufferedPos=e);const i=this.playingItem,a=this.findItemIndex(i);let o=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const n=this.findItemIndex(s),r=Math.min(n+1,t.length-1),i=t[r];if((-1===o&&s&&e>=s.end||null!=(l=i.event)&&l.appendInPlace&&e+.01>=i.start)&&(o=r),this.isInterstitial(s)){const e=s.event;if(r-a>1&&!1===e.appendInPlace)return;if(0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>n&&o>a)this.bufferedToItem(i);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&i.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(i)&&this.preloadAssets(i.event,0)}}else n&&i&&!this.itemsMatch(i,s)&&(o===a?this.bufferedToItem(i):o===a+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{const n=this.getAssetPlayer(e.identifier);return!(null!=n&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:r,events:s}=n;if(!r||!s)return t;const i=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const o=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(mj(e))+(t?" (".concat(o.toFixed(2)," remaining)"):"")),!this.playbackDisabled)if(i){const t=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,n)=>{const r=this.getAssetPlayer(e.identifier);r&&(n===t&&r.loadSource(),r.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(HR.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==n){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=0===n.assetList.length&&!n.assetListLoader,s=n.cue.once;if(r||!s){const e=this.preloadAssets(n,t);if(null!=e&&e.interstitial.appendInPlace){const t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,s=0===r&&!e.assetListLoader,i=e.cue.once;if(s){const s=e.timelineStart;if(e.appendInPlace){var a;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(a=t.nextEvent)?void 0:a.identifier)!==e.identifier||this.flushFrontBuffer(s+.25)}let i,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-s;e>0&&(i=Math.round(1e3*e)/1e3)}if(this.log("Load interstitial asset ".concat(t+1,"/").concat(n?1:r," ").concat(e).concat(i?" live-start: ".concat(o," start-offset: ").concat(i):"")),n)return this.createAsset(e,0,0,s,e.duration,n);const l=this.assetListLoader.loadAssetList(e,i);l&&(e.assetListLoader=l)}else if(!i&&r){for(let s=t;s<r;s++){const t=e.assetList[s],n=this.getAssetPlayerQueueIndex(t.identifier);-1!==n&&!this.playerQueue[n].destroyed||t.error||this.createAssetPlayer(e,t,s)}const n=e.assetList[t];if(n){const e=this.getAssetPlayer(n.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log("Removing front buffer starting at ".concat(e));Object.keys(t).forEach(t=>{this.hls.trigger(HR.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n];return null}createAsset(e,t,n,r,s,i){const a={parentIdentifier:e.identifier,identifier:lj(e,i,t),duration:s,startOffset:n,timelineStart:r,uri:i};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){const r=this.hls,s=r.userConfig;let i=s.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(i||a)&&(i=tP({},i),a.videoCodec&&(i.videoCodec=a.videoCodec),a.videoRange&&(i.allowedVideoRanges=[a.videoRange]));const o=r.audioTracks[r.audioTrack],l=r.subtitleTracks[r.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const n=t.duration;n&&e<n&&(c=e)}}const u=t.identifier,d=rP(rP({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:u,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:i,audioPreference:o||s.audioPreference,subtitlePreference:l||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(d.timelineOffset=t.timelineStart));const h=d.cmcd;null!=h&&h.sessionId&&h.contentId&&(d.cmcd=tP({},h,{contentId:ij(t.uri)})),this.getAssetPlayer(u)&&this.warn("Duplicate date range identifier ".concat(e," and asset ").concat(u));const f=new pj(this.HlsPlayerClass,d,e,t);this.playerQueue.push(f),e.assetList[n]=t;let p=!0;const g=r=>{if(r.live){var s;const t=new Error("Interstitials MUST be VOD assets ".concat(e)),r={fatal:!0,type:zR.OTHER_ERROR,details:GR.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=(null==(s=this.schedule)?void 0:s.findEventIndex(e.identifier))||-1;return void this.handleAssetItemError(r,e,i,n,t.message)}const i=r.edge-r.fragmentStart,a=t.duration;(p||null===a||i>a)&&(p=!1,this.log('Interstitial asset "'.concat(u,'" duration change ').concat(a," > ").concat(i)),t.duration=i,this.updateSchedule())};f.on(HR.LEVEL_UPDATED,(e,t)=>{let{details:n}=t;return g(n)}),f.on(HR.LEVEL_PTS_UPDATED,(e,t)=>{let{details:n}=t;return g(n)}),f.on(HR.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const m=(e,t)=>{const n=this.getAssetPlayer(u);if(n&&t.tracks){n.off(HR.BUFFER_CODECS,m),n.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===n.assetItem&&e&&!n.media&&this.bufferAssetPlayer(n,e)}};f.on(HR.BUFFER_CODECS,m);f.on(HR.BUFFERED_TO_END,()=>{var n;const r=this.getAssetPlayer(u);if(this.log("buffered to end of asset ".concat(r)),!r||!this.schedule)return;const s=this.schedule.findEventIndex(e.identifier),i=null==(n=this.schedule.items)?void 0:n[s];this.isInterstitial(i)&&this.advanceAssetBuffering(i,t)});const v=t=>()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;this.shouldPlay=!0;const n=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,t)};return f.once(HR.MEDIA_ENDED,v(n)),f.once(HR.PLAYOUT_LIMIT_REACHED,v(1/0)),f.on(HR.ERROR,(t,r)=>{if(!this.schedule)return;const s=this.getAssetPlayer(u);if(r.details===GR.BUFFER_STALLED_ERROR)return null!=s&&s.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),n,"Asset player error ".concat(r.error," ").concat(e))}),f.on(HR.DESTROYING,()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;const t=new Error("Asset player destroyed unexpectedly ".concat(u)),r={fatal:!0,type:zR.OTHER_ERROR,details:GR.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),n,t.message)}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(fj(t))),this.hls.trigger(HR.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:f}),f}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log('reset asset player "'.concat(e,'" after error'));const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(-1!==n){const e=this.playerQueue[n];this.log("clear ".concat(e," toSegment: ").concat(t?mj(t):t)),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(n,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,s){const{interstitial:i,assetItem:a,assetId:o}=e,l=i.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,n[r]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED ".concat(t+1,"/").concat(l," ").concat(fj(a))),this.hls.trigger(HR.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:i,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,r;if(!this.schedule)return;const{interstitial:s,assetItem:i}=e,a=this.schedule.findEventIndex(s.identifier),o=null==(n=this.schedule.items)?void 0:n[a];if(!o)return;e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=i;const l=this.getBufferingPlayer();if(l===e)return;const c=s.appendInPlace;if(c&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const u=(null==l?void 0:l.tracks)||(null==(r=this.detachedData)?void 0:r.tracks)||this.requiredTracks;if(c&&i!==this.playingAsset){if(!e.tracks)return void this.log("Waiting for track info before buffering ".concat(e));if(u&&!hP(u,e.tracks)){const t=new Error("Asset ".concat(fj(i)," SourceBuffer tracks ('").concat(Object.keys(e.tracks),"') are not compatible with primary content tracks ('").concat(Object.keys(u),"')")),n={fatal:!0,type:zR.OTHER_ERROR,details:GR.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},r=s.findAssetIndex(i);return void this.handleAssetItemError(n,s,a,r,t.message)}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const r=n.currentTime,s=t.findAssetIndex(e,r),i=e.assetList[s];if(i){const a=this.getAssetPlayer(i.identifier);if(a){const o=a.currentTime||r-i.timelineStart,l=a.duration-o;if(this.warn("Stalled at ".concat(o," of ").concat(o+l," in ").concat(a," ").concat(e," (media.currentTime: ").concat(r,")")),o&&(l/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const n=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,r,s){if(e.details===GR.BUFFER_STALLED_ERROR)return;const i=t.assetList[r]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR ".concat(i?fj(i):i," ").concat(e.error)),!this.schedule)return;const a=(null==i?void 0:i.identifier)||"",o=this.getAssetPlayerQueueIndex(a),l=this.playerQueue[o]||null,c=this.schedule.items,u=tP({},e,{fatal:!1,errorAction:uO(!0),asset:i,assetListIndex:r,event:t,schedule:c,scheduleIndex:n,player:l});if(this.hls.trigger(HR.INTERSTITIAL_ASSET_ERROR,u),!e.fatal)return;const d=this.playingAsset,h=this.bufferingAsset,f=new Error(s);if(i&&(this.clearAssetPlayer(a,null),i.error=f),t.assetList.some(e=>!e.error))for(let p=r;p<t.assetList.length;p++)this.resetAssetPlayer(t.assetList[p].identifier);else t.error=f;this.updateSchedule(!0),t.error?this.primaryFallback(t):d&&d.identifier===a?this.advanceAfterAssetEnded(t,n,r):h&&h.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let r=this.timelinePos;if(n){this.log('Fallback to primary from event "'.concat(e.identifier,'" start: ').concat(t," pos: ").concat(r," playing: ").concat(mj(n)," error: ").concat(e.error)),-1===r&&(r=this.hls.startPosition);const s=this.updateItem(n,r);this.itemsMatch(n,s)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(-1===r)return void this.checkStart();if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var n,r;const s=t.event,i=s.identifier,a=t.assetListResponse.ASSETS;if(null==(n=this.schedule)||!n.hasEvent(i))return;const o=s.timelineStart,l=s.duration;let c=0;a.forEach((e,t)=>{const n=parseFloat(e.DURATION);this.createAsset(s,t,c,o+c,n,e.URI),c+=n}),s.duration=c,this.log("Loaded asset-list with duration: ".concat(c," (was: ").concat(l,") ").concat(s));const u=this.waitingItem,d=(null==u?void 0:u.event.identifier)===i;this.updateSchedule();const h=null==(r=this.bufferingItem)?void 0:r.event;if(d){var f;const e=this.schedule.findEventIndex(i),t=null==(f=this.schedule.items)?void 0:f[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return s.error=new Error("Interstitial ".concat(a.length?"no longer within playback range":"asset-list is empty"," ").concat(this.timelinePos," ").concat(s)),this.log(s.error.message),this.updateSchedule(!0),void this.primaryFallback(s)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==h?void 0:h.identifier)===i){const e=s.assetList[0];if(e){const t=this.getAssetPlayer(e.identifier);if(h.appendInPlace){const e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case GR.ASSET_LIST_PARSING_ERROR:case GR.ASSET_LIST_LOAD_ERROR:case GR.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case GR.BUFFER_STALLED_ERROR:{const e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log("Primary player stall @".concat(this.timelinePos," bufferedPos: ").concat(this.bufferedPos)),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function kB(e){return e&&"object"===typeof e?Array.isArray(e)?e.map(kB):Object.keys(e).reduce((t,n)=>(t[n]=kB(e[n]),t),{}):e}function xB(e,t){const n=e.loader;if(n!==yB&&n!==SB)t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(_w){}return!1})()&&(e.loader=yB,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class IB extends AO{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(HR.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(HR.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(HR.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const n=this.media=t.media;XN(n,"playing",this.onMediaPlaying),XN(n,"waiting",this.onMediaWaiting),XN(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(ZN(n,"playing",this.onMediaPlaying),ZN(n,"waiting",this.onMediaWaiting),ZN(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const s=null==(n=this.hls)?void 0:n.config;if(!s)return;const i=this.media;if(!i)return;const{seeking:a}=i,o=this.seeking&&!a,l=!this.seeking&&a,c=i.paused&&!a||i.ended||0===i.playbackRate;if(this.seeking=a,e!==t)return t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(l||o)return void(o&&this.stallResolved(e));if(c)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&i.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(HR.MEDIA_ENDED,{stalled:!1})));if(!DO.getBuffered(i).length)return void(this.nudgeRetry=0);const u=DO.bufferInfo(i,e,0),d=u.nextStart||0,h=this.fragmentTracker;if(a&&h&&this.hls){const t=LB(this.hls.inFlightFragments,e),n=u.len>2,r=!d||t||d-e>2&&!h.getPartialFragment(e);if(n||r)return;this.moved=!1}const f=null==(r=this.hls)?void 0:r.latestLevelDetails;if(!this.moved&&null!==this.stalled&&h){if(!(u.len>0)&&!d)return;const t=Math.max(d,u.start||0)-e,n=!(null==f||!f.live)?2*f.targetduration:2,r=_B(e,h);if(t>0&&(t<=n||r))return void(i.paused||this._trySkipBufferHole(r))}const p=s.detectStallWithCurrentTimeMs,g=self.performance.now(),m=this.waiting;let v=this.stalled;if(null===v){if(!(m>0&&g-m<p))return void(this.stalled=g);v=this.stalled=m}const y=g-v;if(!a&&(y>=p||m)&&this.hls){var b;if("ended"===(null==(b=this.mediaSource)?void 0:b.readyState)&&(null==f||!f.live)&&Math.abs(e-((null==f?void 0:f.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(HR.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(u),!this.media||!this.hls)return}const E=DO.bufferInfo(i,e,s.maxBufferHole);this._tryFixBufferStall(E,y,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log("playback not stuck anymore @".concat(e,", after ").concat(Math.round(n),"ms")),this.stallReported=!1,this.waiting=0,this.hls.trigger(HR.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(n=this.buffered.audio)&&n.length&&r&&r.length>1&&e>r.end(0)){const n=DO.bufferedInfo(DO.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const n=DO.timeRangesToArray(r),s=DO.bufferedInfo(n,t,0).bufferedIndex;if(s>-1&&s<n.length-1){const t=DO.bufferedInfo(n,e,0).bufferedIndex,r=n[s].end,i=n[s+1].start;if((-1===t||t>s)&&i-r<1&&e-r<2){const n=new Error("nudging playhead to flush pipeline after video hole. currentTime: ".concat(e," hole: ").concat(r," -> ").concat(i," buffered index: ").concat(t));this.warn(n.message),this.media.currentTime+=1e-6;let s=_B(e,this.fragmentTracker);s&&"fragment"in s?s=s.fragment:s||(s=void 0);const a=DO.bufferInfo(this.media,e,0);this.hls.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,frag:s,buffer:a.len,bufferInfo:a})}}}}}_tryFixBufferStall(e,t,n){var r,s;const{fragmentTracker:i,media:a}=this,o=null==(r=this.hls)?void 0:r.config;if(!a||!i||!o)return;const l=null==(s=this.hls)?void 0:s.latestLevelDetails,c=_B(n,i);if(c||null!=l&&l.live&&n<l.fragmentStart){if(this._trySkipBufferHole(c)||!this.media)return}const u=e.buffered,d=this.adjacentTraversal(e,n);(u&&u.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-n<o.maxBufferHole||d))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,r=e.nextStart;if(n&&r){const e=n.getFragAtPos(t,QR),s=n.getFragAtPos(r,QR);if(e&&s)return s.sn-e.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:s}=this;if(!r&&null!==s&&n&&t){this.stallReported=!0;const r=new Error("Playback stalling at @".concat(n.currentTime," due to low buffer (").concat(OD(e),")"));this.warn(r.message),t.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,s=null==(t=this.hls)?void 0:t.config;if(!r||!n||!s)return 0;const i=r.currentTime,a=DO.bufferInfo(r,i,0),o=i<a.start?a.start:a.nextStart;if(o&&this.hls){const t=a.len<=s.maxBufferHole,c=a.len>0&&a.len<1&&r.readyState<3,u=o-i;if(u>0&&(t||c)){if(u>s.maxBufferHole){let t=!1;if(0===i){const e=n.getAppendedFrag(0,QR);e&&o<e.end&&(t=!0)}if(!t&&e){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(LB(this.hls.inFlightFragments,o))return 0;let t=!1,r=e.end;for(;r<o;){const e=_B(r,n);if(!e){t=!0;break}r+=e.duration}if(t)return 0}}const t=Math.max(o+.05,i+.1);if(this.warn("skipping hole, adjusting currentTime from ".concat(i," to ").concat(t)),this.moved=!0,r.currentTime=t,null==e||!e.gap){const n=new Error("fragment loaded with buffer holes, seeking from ".concat(i," to ").concat(t)),r={type:zR.MEDIA_ERROR,details:GR.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?r.part=e:r.frag=e),this.hls.trigger(HR.ERROR,r)}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,s=null==t?void 0:t.config;if(!n||!s)return 0;const i=n.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const a=i+(r+1)*s.nudgeOffset,o=new Error("Nudging 'currentTime' from ".concat(i," to ").concat(a));this.warn(o.message),n.currentTime=a,t.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const n=new Error("Playhead still not moving while enough data buffered @".concat(i," after ").concat(s.nudgeMaxRetry," nudges"));this.error(n.message),t.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.BUFFER_STALLED_ERROR,error:n,fatal:!0,buffer:e.len,bufferInfo:e})}}}function LB(e,t){const n=CB(e.main);if(n&&n.start<=t)return n;const r=CB(e.audio);return r&&r.start<=t?r:null}function CB(e){if(!e)return null;switch(e.state){case eM:case $N:case oM:case lM:return null}return e.frag}function _B(e,t){return t.getAppendedFrag(e,QR)||t.getPartialFragment(e)}function AB(){if("undefined"!==typeof self)return self.VTTCue||self.TextTrackCue}function RB(e,t,n,r,s){let i=new e(t,n,"");try{i.value=r,s&&(i.type=s)}catch(_w){i=new e(t,n,OD(s?rP({type:s},r):r))}return i}const PB=(()=>{const e=AB();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(_w){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class DB{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(HR.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(HR.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(HR.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(HR.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(HR.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(HR.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(HR.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(HR.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,!1===(null==(n=t.overrides)?void 0:n.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var e;const t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&nj(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if("metadata"===n.kind&&"id3"===n.label)return ej(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:r}=this.hls.config;if(!n&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const i=AB();if(i)for(let a=0;a<s.length;a++){const e=s[a].type;if(e===VM.emsg&&!n||!r)continue;const t=FM(s[a].data),o=s[a].pts;let l=o+s[a].duration;l>PB&&(l=PB);l-o<=0&&(l=o+.25);for(let n=0;n<t.length;n++){const r=t[n];if(!UM(r)){this.updateId3CueEnds(o,e);const t=RB(i,o,l,r,e);t&&this.id3Track.addCue(t)}}}}updateId3CueEnds(e,t){var n;const r=null==(n=this.id3Track)?void 0:n.cues;if(r)for(let s=r.length;s--;){const n=r[s];n.type===t&&n.startTime<e&&n.endTime===PB&&(n.endTime=e)}}onBufferFlushing(e,t){let{startOffset:n,endOffset:r,type:s}=t;const{id3Track:i,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(i&&(o||l)){let e;e="audio"===s?e=>e.type===VM.audioId3&&l:"video"===s?e=>e.type===VM.emsg&&o:e=>e.type===VM.audioId3&&l||e.type===VM.emsg&&o,rj(i,n,r,e)}}onLevelUpdated(e,t){let{details:n}=t;this.updateDateRangeCues(n,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:i}=this.hls.config;if(!s)return;const a=AB();if(n&&r&&!i){const{fragmentStart:t,fragmentEnd:r}=e;let s=this.assetCue;s?(s.startTime=t,s.endTime=r):a&&(s=this.assetCue=RB(a,t,r,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),s&&(s.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(s),s.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:l}=e,c=Object.keys(l);let u=this.dateRangeCuesAppended;var d;if(o&&t)if(null!=(d=o.cues)&&d.length){const e=Object.keys(u).filter(e=>!c.includes(e));for(let t=e.length;t--;){var h;const n=e[t],r=null==(h=u[n])?void 0:h.cues;delete u[n],r&&Object.keys(r).forEach(e=>{const t=r[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(t)}catch(_w){}}})}}else u=this.dateRangeCuesAppended={};const f=e.fragments[e.fragments.length-1];if(0!==c.length&&jR(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<c.length;e++){const t=c[e],n=l[t],r=n.startTime,s=u[t],o=(null==s?void 0:s.cues)||{};let d=(null==s?void 0:s.durationKnown)||!1,h=PB;const{duration:f,endDate:p}=n;if(p&&null!==f)h=r+f,d=!0;else if(n.endOnNext&&!d){const e=c.reduce((e,t)=>{if(t!==n.id){const r=l[t];if(r.class===n.class&&r.startDate>n.startDate&&(!e||n.startDate<e.startDate))return r}return e},null);e&&(h=e.startTime,d=!0)}const g=Object.keys(n.attr);for(let e=0;e<g.length;e++){const l=g[e];if(!zO(l))continue;const c=o[l];if(c)!d||null!=s&&s.durationKnown?Math.abs(c.startTime-r)>.01&&(c.startTime=r,c.endTime=h):c.endTime=h;else if(a){let e=n.attr[l];GO(l)&&(e=gP(e));const s=RB(a,r,h,{key:l,data:e},VM.dateRange);s&&(s.id=t,this.id3Track.addCue(s),o[l]=s,i&&("X-ASSET-LIST"!==l&&"X-ASSET-URL"!==l||s.addEventListener("enter",this.onEventCueEnter)))}}u[t]={cues:o,dateRange:n,durationKnown:d}}}}}class OB{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:s}=this.config;if(!r||1===s||!t.live)return;const i=this.targetLatency;if(null===i)return;const a=n-i;if(a<Math.min(this.maxLatency,i+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,s)),n=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,r=Math.min(t,Math.max(1,n));this.changeMediaPlaybackRate(e,r)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:i,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&n||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==s?s:i*r);const c=r;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const n=this.levelDetails;if(null===n)return null;const r=n.edge,s=e-t-this.edgeStalled,i=r-n.totalduration,a=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(i,s),a)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(HR.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(HR.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(HR.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(HR.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,t){let{details:n}=t;n.advanced&&this.onTimeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===GR.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(n=this.levelDetails)&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&(null==(n=this.hls)||n.logger.debug("[latency-controller]: latency=".concat(this.latency.toFixed(3),", targetLatency=").concat(null==(r=this.targetLatency)?void 0:r.toFixed(3),", forwardBufferLength=").concat(this.forwardBufferLength.toFixed(3),": adjusting playback rate from ").concat(e.playbackRate," to ").concat(t)),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class NB extends GF{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.on(HR.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(HR.FRAG_BUFFERED,this.onFragBuffered,this),e.on(HR.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.off(HR.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(HR.FRAG_BUFFERED,this.onFragBuffered,this),e.off(HR.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],s={},i={};let a=!1,o=!1,l=!1;t.levels.forEach(e=>{const t=e.attrs;let{audioCodec:c,videoCodec:u}=e;c&&(e.audioCodec=c=dD(c,n)||void 0),u&&(u=e.videoCodec=function(e){const t=e.split(",");for(let n=0;n<t.length;n++){const e=t[n].split(".");e.length>2&&"avc1"===e[0]&&(t[n]="avc1.".concat(parseInt(e[1]).toString(16)).concat(("000"+parseInt(e[2]).toString(16)).slice(-4)))}return t.join(",")}(u));const{width:d,height:h,unknownCodecs:f}=e,p=(null==f?void 0:f.length)||0;if(a||(a=!(!d||!h)),o||(o=!!u),l||(l=!!c),p||c&&!this.isAudioSupported(c)||u&&!this.isVideoSupported(u))return void this.log('Some or all CODECS not supported "'.concat(t.CODECS,'"'));const{CODECS:g,"FRAME-RATE":m,"HDCP-LEVEL":v,"PATHWAY-ID":y,RESOLUTION:b,"VIDEO-RANGE":E}=t,w="".concat(y||".","-"),S="".concat(w).concat(e.bitrate,"-").concat(b,"-").concat(m,"-").concat(g,"-").concat(E,"-").concat(v);if(s[S])if(s[S].uri===e.url||e.attrs["PATHWAY-ID"])s[S].addGroupId("audio",t.AUDIO),s[S].addGroupId("text",t.SUBTITLES);else{const t=i[S]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const n=this.createLevel(e);s[S]=n,r.push(n)}else{const t=this.createLevel(e);s[S]=t,i[S]=1,r.push(t)}}),this.filterAndSortMediaOptions(r,t,a,o,l)}createLevel(e){const t=new RD(e),n=e.supplemental;if(null!=n&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const e=new Error('SUPPLEMENTAL-CODECS not supported "'.concat(n.videoCodec,'"'));this.log(e.message),t.supportedResult=bD(e,[])}return t}isAudioSupported(e){return sD(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return sD(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,s){var i;let a=[],o=[],l=e;const c=(null==(i=t.stats)?void 0:i.parsing)||{};if((n||r)&&s&&(l=l.filter(e=>{let{videoCodec:t,videoRange:n,width:r,height:s}=e;return(!!t||!(!r||!s))&&(!!(i=n)&&xD.indexOf(i)>-1);var i})),0===l.length)return Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",n=e;t.levels.length&&(n="one or more CODECS in variant not supported: ".concat(OD(t.levels.map(e=>e.attrs.CODECS).filter((e,t,n)=>n.indexOf(e)===t))),this.warn(n),e+=" (".concat(n,")"));const r=new Error(e);this.hls.trigger(HR.ERROR,{type:zR.MEDIA_ERROR,details:GR.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:r,reason:n})}}),void(c.end=performance.now());t.audioTracks&&(a=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec)),MB(a)),t.subtitles&&(o=t.subtitles,MB(o));const u=l.slice(0);l.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return xD.indexOf(e.videoRange)-xD.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const n=oD(e.videoCodec),r=oD(t.videoCodec);if(n!==r)return r-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const n=lD(e.codecSet),r=lD(t.codecSet);if(n!==r)return r-n}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let d=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length))for(let v=0;v<u.length;v++)if(u[v].pathwayId===l[0].pathwayId){d=u[v];break}this._levels=l;for(let v=0;v<l.length;v++)if(l[v]===d){var h;this._firstLevel=v;const e=d.bitrate,t=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(l.length," level(s) found, first bitrate: ").concat(e)),void 0===(null==(h=this.hls.userConfig)?void 0:h.abrEwmaDefaultEstimate)){const n=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);n>t&&t===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=n)}break}const f=s&&!r,p=this.hls.config,g=!(!p.audioStreamController||!p.audioTrackController),m={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:g&&!f&&a.some(e=>!!e.url)};c.end=performance.now(),this.hls.trigger(HR.MANIFEST_PARSED,m)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const n=new Error("invalid level idx"),r=e<0;if(this.hls.trigger(HR.ERROR,{type:zR.OTHER_ERROR,details:GR.LEVEL_SWITCH_ERROR,level:e,fatal:r,error:n,reason:n.message}),r)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,i=t[e],a=i.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=i,n===e&&r&&s===a)return;this.log("Switching to level ".concat(e," (").concat(i.height?i.height+"p ":"").concat(i.videoRange?i.videoRange+" ":"").concat(i.codecSet?i.codecSet+" ":"","@").concat(i.bitrate,")").concat(a?" with Pathway "+a:""," from level ").concat(n).concat(s?" with Pathway "+s:""));const o={level:e,attrs:i.attrs,details:i.details,bitrate:i.bitrate,averageBitrate:i.averageBitrate,maxBitrate:i.maxBitrate,realBitrate:i.realBitrate,width:i.width,height:i.height,codecSet:i.codecSet,audioCodec:i.audioCodec,videoCodec:i.videoCodec,audioGroups:i.audioGroups,subtitleGroups:i.subtitleGroups,loaded:i.loaded,loadError:i.loadError,fragmentError:i.fragmentError,name:i.name,id:i.id,uri:i.uri,url:i.url,urlId:0,audioGroupIds:i.audioGroupIds,textGroupIds:i.textGroupIds};this.hls.trigger(HR.LEVEL_SWITCHING,o);const l=i.details;if(!l||l.live){const e=this.switchParams(i.uri,null==r?void 0:r.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn("pathwayPriority ".concat(e," should contain at least one pathway from list: ").concat(t));this.steering.pathwayPriority=n}}onError(e,t){!t.fatal&&t.context&&t.context.type===WR&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,t){let{frag:n}=t;if(void 0!==n&&n.type===QR){const e=n.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const t=this._levels[n.level];null!=t&&t.loadError&&(this.log("Resetting level error count of ".concat(t.loadError," on frag buffered")),t.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:s}=t,i=t.levelInfo;var a;if(!i)return this.warn("Invalid level index ".concat(r)),void(null!=(a=t.deliveryDirectives)&&a.skip&&(s.deltaUpdateFailed=!0));if(i===this.currentLevel||t.withoutMultiVariant){0===i.fragmentError&&(i.loadError=0);let e=i.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(r,t,e)}else null!=(n=t.deliveryDirectives)&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],i=e.details,a=null==i?void 0:i.age;this.log("Loading level index ".concat(r).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(s?" Pathway "+s:"").concat(a&&i.live?" age "+a.toFixed(1)+(i.type?" "+i.type||0:""):""," ").concat(n)),this.hls.trigger(HR.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const n=this._levels.filter((t,n)=>n!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));zN(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(HR.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,t){let{levels:n}=t;this._levels=n}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(HR.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function MB(e){const t={};e.forEach(e=>{const n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}function FB(){return self.SourceBuffer||self.WebKitSourceBuffer}function UB(){if(!dP())return!1;const e=FB();return!e||e.prototype&&"function"===typeof e.prototype.appendBuffer&&"function"===typeof e.prototype.remove}class jB extends dM{constructor(e,t,n){super(e,t,n,"stream-controller",QR),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!jR(t))return;if(this.log("Media seeked to ".concat(t.toFixed(3))),!this.getBufferedFrag(t))return;const n=this.getFwdBufferInfoAtPos(e,t,QR,0);null!==n&&0!==n.len?this.tick():this.warn("Main forward buffer length at ".concat(t,' on "seeked" event ').concat(n?n.len:"empty",")"))},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.on(HR.LEVEL_LOADING,this.onLevelLoading,this),e.on(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.on(HR.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(HR.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(HR.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(HR.BUFFER_CREATED,this.onBufferCreated,this),e.on(HR.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(HR.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(HR.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(HR.MANIFEST_PARSED,this.onManifestParsed,this),e.off(HR.LEVEL_LOADED,this.onLevelLoaded,this),e.off(HR.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(HR.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(HR.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(HR.BUFFER_CREATED,this.onBufferCreated,this),e.off(HR.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(HR.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(HR.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=r.startLevel;-1===e&&(r.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=r.firstAutoLevel),r.nextLoadLevel=e,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&-1===e&&!t&&(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n),this.state=eM,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=$N}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case uM:{const{levels:e,level:t}=this,n=null==e?void 0:e[t],r=null==n?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=eM;break}if(this.hls.nextLoadLevel!==this.level){this.state=eM;break}break}case rM:this.checkRetryDate()}this.state===eM&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(null===t||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==n||!n[s])return;const i=n[s],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(HR.BUFFER_EOS,e),void(this.state=oM)}if(!this.buffering)return;e.loadLevel!==s&&-1===e.manualLevel&&this.log("Adapting to level ".concat(s," from level ").concat(this.level)),this.level=e.nextLoadLevel=s;const l=i.details;if(!l||this.state===uM||this.waitForLive(i))return this.level=s,this.state=uM,void(this.startFragRequested=!1);const c=a.len,u=this.getMaxBufferLength(i.maxBitrate);if(c>=u)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(d,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&xP(h)&&this.fragmentTracker.getState(h)!==pO){var f;const e=(null!=(f=this.backtrackFragment)?f:h).sn-l.startSN,t=l.fragments[e-1];t&&h.cc===t.cc&&(h=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,d)){if(!h.gap){const e=this.audioOnly&&!this.altAudio?wP:SP,t=(e===SP?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,QR)}h=this.getNextFragmentLoopLoading(h,l,a,QR,u)}h&&(!h.initSegment||h.initSegment.data||this.bitrateTest||(h=h.initSegment),this.loadFragment(h,i,d))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===dO||r===fO?xP(e)?this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,QR)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(null!=s&&s.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*s.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],r=this.fragLastKbps;n=r&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*r)+1:0}else n=0;const i=this.getBufferedFrag(t.currentTime+n);if(i){const e=this.followingBufferedFrag(i);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,n=e.duration,r=Math.max(i.end,t+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case tM:case nM:case rM:case iM:case aM:this.state=eM}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;XN(n,"playing",this.onMediaPlaying),XN(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(ZN(n,"playing",this.onMediaPlaying),ZN(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(HR.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;for(let s=0;s<t.levels.length;s++){const e=t.levels[s].audioCodec;e&&(n=n||-1!==e.indexOf("mp4a.40.2"),r=r||-1!==e.indexOf("mp4a.40.5"))}this.audioCodecSwitch=n&&r&&!function(){var e;const t=FB();return"function"===typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==eM)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=uM)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:s}=this,i=t.level,a=t.details,o=a.totalduration;if(!r)return void this.warn("Levels were reset while loading level ".concat(i));this.log("Level ".concat(i," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",", cc [").concat(a.startCC,", ").concat(a.endCC,"] duration:").concat(o));const l=t.levelInfo,c=this.fragCurrent;!c||this.state!==nM&&this.state!==rM||c.level!==t.level&&c.loader&&this.abortCurrentFrag();let u=0;if(a.live||null!=(n=l.details)&&n.live){var d;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,l.details,null==(d=this.levelLastLoaded)?void 0:d.details)}if(l.details=a,this.levelLastLoaded=l,s||this.setStartPosition(a,u),this.hls.trigger(HR.LEVEL_UPDATED,{details:a,level:i}),this.state===uM){if(this.waitForCdnTuneIn(a))return;this.state=eM}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),i=e.fragmentStart,a=e.edge,o=s>=i-t.maxFragLookUpTolerance&&s<=a;if(null!==r&&n.duration>r&&(s<r||!o)){const i=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&n.readyState<4||s<a-i)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState))if(this.warn("Playback: ".concat(s.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(a,", reset currentTime to : ").concat(r.toFixed(3))),"buffered"===this.config.liveSyncMode){var l;const e=DO.bufferInfo(n,r,0);if(null==(l=e.buffered)||!l.length)return void(n.currentTime=r);if(e.start<=s)return void(n.currentTime=r);const{nextStart:t}=DO.bufferedInfo(e.buffered,s,0);t&&(n.currentTime=t)}else n.currentTime=r}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{levels:i}=this;if(!i)return void this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const a=i[n.level];if(!a)return void this.warn("Level ".concat(n.level," not found on progress"));const o=a.details;if(!o)return this.warn("Dropping fragment ".concat(n.sn," of level ").concat(n.level," after level details were reset")),void this.fragmentTracker.removeFragment(n);const l=a.videoCodec,c=o.PTSKnown||!o.live,u=null==(t=n.initSegment)?void 0:t.data,d=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new zF(this.hls,QR,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=r?r.index:-1,p=-1!==f,g=new RO(n.level,n.sn,n.stats.chunkCount,s.byteLength,f,p),m=this.initPTS[n.cc];h.push(s,u,d,l,n,r,o.totalduration,c,g,m)}onAudioTrackSwitching(e,t){const n=this.hls,r=0!==this.altAudio;if(zD(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r)return this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(HR.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(HR.AUDIO_TRACK_SWITCHED,t)}),void n.trigger(HR.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});n.trigger(HR.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=zD(t.url,this.hls);if(n){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,s,i=!1;for(const a in n){const e=n[a];if("main"===e.id){if(s=a,r=e,"video"===a){const e=n[a];e&&(this.videoBuffer=e.buffer)}}else i=!0}i&&r?(this.log("Alternate track found, use ".concat(s,".buffered to schedule main fragment loading")),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,s=n.type===QR;if(s){if(this.fragContextChanged(n))return this.warn("Fragment ".concat(n.sn).concat(r?" p: "+r.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===aM&&(this.state=eM));const e=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),xP(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const i=this.media;i&&(!this._hasEnoughToStart&&DO.getBuffered(i).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal)this.state=lM;else switch(t.details){case GR.FRAG_GAP:case GR.FRAG_PARSING_ERROR:case GR.FRAG_DECRYPT_ERROR:case GR.FRAG_LOAD_ERROR:case GR.FRAG_LOAD_TIMEOUT:case GR.KEY_LOAD_ERROR:case GR.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(QR,t);break;case GR.LEVEL_LOAD_ERROR:case GR.LEVEL_LOAD_TIMEOUT:case GR.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==uM||(null==(n=t.context)?void 0:n.type)!==WR||(this.state=eM);break;case GR.BUFFER_ADD_CODEC_ERROR:case GR.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case GR.BUFFER_FULL_ERROR:if("main"!==t.parent)return;if(this.reduceLengthAndFlushBuffer(t)){!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case GR.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=eM,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,t){let{type:n}=t;if(n!==wP||!this.altAudio){const e=(n===SP?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,n,QR),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log("could not seek to ".concat(n,", already seeking at ").concat(t));const r=this.timelineOffset;r&&n&&(n+=r);const s=this.getLevelDetails(),i=DO.getBuffered(e),a=i.length?i.start(0):0,o=a-n,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==s?void 0:s.partTarget)||0)))&&(this.log("adjusting start position by ".concat(o," to match buffer start")),n+=o,this.startPosition=n),t<n&&(this.log("seek to target start position ".concat(n," from current time ").concat(t," buffer start ").concat(a)),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{const{hls:n}=this,r=null==e?void 0:e.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=eM,this.startFragRequested=!1,this.bitrateTest=!1;const s=r.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),n.trigger(HR.FRAG_LOADED,e),r.bitrateTest=!1}).catch(t=>{this.state!==$N&&this.state!==lM&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:s}=e,i=this.getCurrentContext(s);if(!i)return void this.resetWhenMissingContext(s);const{frag:a,part:o,level:l}=i,{video:c,text:u,id3:d,initSegment:h}=r,{details:f}=l,p=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=iM,h){const e=h.tracks;if(e){const r=a.initSegment||a;if(this.unhandledEncryptionError(h,a))return;this._bufferInitSegment(l,e,r,s),n.trigger(HR.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:t,tracks:e})}const r=h.initPTS,i=h.timescale,o=this.initPTS[a.cc];if(jR(r)&&(!o||o.baseTime!==r||o.timescale!==i)){const e=h.trackId;this.initPTS[a.cc]={baseTime:r,timescale:i,trackId:e},n.trigger(HR.INIT_PTS_FOUND,{frag:a,id:t,initPTS:r,timescale:i,trackId:e})}}if(c&&f){p&&"audiovideo"===c.type&&this.logMuxedErr(a);const e=f.fragments[a.sn-1-f.startSN],t=a.sn===f.startSN,n=!e||a.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:r,startDTS:i,endDTS:l}=c;if(o)o.elementaryStreams[c.type]={startPTS:e,endPTS:r,startDTS:i,endDTS:l};else if(c.firstKeyFrame&&c.independent&&1===s.id&&!n&&(this.couldBacktrack=!0),c.dropped&&c.independent){const s=this.getMainFwdBufferInfo(),i=(s?s.end:this.getLoadPosition())+this.config.maxBufferHole,o=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&i<o-this.config.maxBufferHole&&!n)return void this.backtrack(a);n&&(a.gap=!0),a.setElementaryStreamInfo(c.type,a.start,r,a.start,l,!0)}else t&&e-(f.appliedTimelineOffset||0)>2&&(a.gap=!0);a.setElementaryStreamInfo(c.type,e,r,i,l),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,o,s,t||n)}else{if(!t&&!n)return void this.backtrack(a);a.gap=!0}}if(p){const{startPTS:e,endPTS:t,startDTS:n,endDTS:r}=p;o&&(o.elementaryStreams[wP]={startPTS:e,endPTS:t,startDTS:n,endDTS:r}),a.setElementaryStreamInfo(wP,e,t,n,r),this.bufferFragmentData(p,a,o,s)}if(f&&null!=d&&d.samples.length){const e={id:t,frag:a,details:f,samples:d.samples};n.trigger(HR.FRAG_PARSING_METADATA,e)}if(f&&u){const e={id:t,frag:a,details:f,samples:u.samples};n.trigger(HR.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn("".concat(xP(e)?"Media":"Init"," segment with muxed audiovideo where only video expected: ").concat(e.url))}_bufferInitSegment(e,t,n,r){if(this.state!==iM)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:i,audiovideo:a}=t;if(s){const n=e.audioCodec;let r=hD(s.codec,n);"mp4a"===r&&(r="mp4a.40.5");const i=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){r&&(r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=s.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===i.indexOf("firefox")&&(r="mp4a.40.5")}r&&-1!==r.indexOf("mp4a.40.5")&&-1!==i.indexOf("android")&&"audio/mpeg"!==s.container&&(r="mp4a.40.2",this.log("Android: force audio codec to ".concat(r))),n&&n!==r&&this.log('Swapping manifest audio codec "'.concat(n,'" for "').concat(r,'"')),s.levelCodec=r,s.id=QR,this.log("Init audio buffer, container:".concat(s.container,", codecs[selected/level/parsed]=[").concat(r||"","/").concat(n||"","/").concat(s.codec,"]")),delete t.audiovideo}if(i){i.levelCodec=e.videoCodec,i.id=QR;const n=i.codec;if(4===(null==n?void 0:n.length))switch(n){case"hvc1":case"hev1":i.codec="hvc1.1.6.L120.90";break;case"av01":i.codec="av01.0.04M.08";break;case"avc1":i.codec="avc1.42e01e"}this.log("Init video buffer, container:".concat(i.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(n,"]").concat(i.codec!==n?" parsed-corrected="+i.codec:"").concat(i.supplemental?" supplemental="+i.supplemental:"")),delete t.audiovideo}a&&(this.log("Init audiovideo buffer, container:".concat(a.container,", codecs[level/parsed]=[").concat(e.codecs,"/").concat(a.codec,"]")),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(HR.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{const s=t[e].initSegment;null!=s&&s.byteLength&&this.hls.trigger(HR.BUFFER_APPENDING,{type:e,data:s,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,QR)}get maxBufferLength(){const{levels:e,level:t}=this,n=null==e?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=eM}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const n=e.currentTime;if(DO.isBuffered(e,n)?t=this.getAppendedFrag(n):DO.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,n=t.level;e&&t.sn===e.sn&&e.level===n||(this.fragPlaying=t,this.hls.trigger(HR.FRAG_CHANGED,{frag:t}),e&&e.level===n||this.hls.trigger(HR.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return jR(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(jR(t)){const e=this.getLevelDetails(),n=this.currentFrag||(e?HD(null,e.fragments,t):null);if(n){const e=n.programDateTime;if(null!==e){const r=e+1e3*(t-n.start);return new Date(r)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class BB extends sP{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[n].loader;if(r){var t;if(e&&e!==(null==(t=r.context)?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:GR.KEY_LOAD_ERROR,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return new _O({type:zR.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:r})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){const i=t[r];if(e.cc<=i.cc&&(!xP(e)||!xP(i)||e.sn<i.sn)||!n&&r==s-1)return this.emeController.selectKeySystemFormat(i).then(e=>{if(!this.emeController)return;i.setKeyFormat(e);const t=aN(e);return t?this.emeController.getKeySystemAccess([t]):void 0})}if(this.config.requireKeySystemAccessOnStart){const e=lN(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const n=new Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(this.emeController&&this.config.emeEnabled,")"));return Promise.reject(this.createKeyLoadError(e,GR.KEY_LOAD_ERROR,n))}const i=s.uri;if(!i)return Promise.reject(this.createKeyLoadError(e,GR.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(i,'"'))));const a=VB(s);let o=this.keyIdToKeyInfo[a];if(null!=(n=o)&&n.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(this.emeController&&null!=(r=o)&&r.keyLoadPromise){switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>{const{keyInfo:n}=t;return s.key=n.decryptdata.key,{frag:e,keyInfo:n}})}}switch(this.log("".concat(this.keyIdToKeyInfo[a]?"Rel":"L","oading").concat(s.keyId?" keyId: "+pP(s.keyId):""," URI: ").concat(s.uri," from ").concat(e.type," ").concat(e.level)),o=this.keyIdToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===s.keyFormat?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,GR.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(s.method,'"'))))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&null!=(r=t.initSegment)&&r.data){const n=function(e){const t=[];return KP(e,e=>t.push(e.subarray(8,24))),t}(t.initSegment.data);if(n.length){let t=n[0];t.some(e=>0!==e)?(this.log("Using keyId found in init segment ".concat(pP(t))),fN.setKeyIdForUri(e.decryptdata.uri,t)):(t=fN.addKeyIdForUri(e.decryptdata.uri),this.log("Generating keyId to patch media ".concat(pP(t)))),e.decryptdata.keyId=t}}if(!e.decryptdata.keyId&&!xP(t))return Promise.resolve(n);const s=this.emeController.loadKey(n);return(e.keyLoadPromise=s.then(t=>(e.mediaKeySessionContext=t,n))).catch(n=>{throw e.keyLoadPromise=null,"data"in n&&(n.data.frag=t),n})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=new(0,n.loader)(n);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((s,i)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=n.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{const{frag:a,keyInfo:o}=n,l=VB(o.decryptdata);if(!a.decryptdata||o!==this.keyIdToKeyInfo[l])return i(this.createKeyLoadError(a,GR.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,s({frag:a,keyInfo:o})},onError:(e,n,r,s)=>{this.resetLoader(n),i(this.createKeyLoadError(t,GR.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),r,rP({url:a.url,data:void 0},e)))},onTimeout:(e,n,r)=>{this.resetLoader(n),i(this.createKeyLoadError(t,GR.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:(e,n,r)=>{this.resetLoader(n),i(this.createKeyLoadError(t,GR.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};r.load(a,l,c)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null);const i=VB(n.decryptdata)||r;delete this.keyIdToKeyInfo[i],s&&s.destroy()}}function VB(e){if(e.keyFormat!==rN){const t=e.keyId;if(t)return pP(t)}return e.uri}function zB(e){const{type:t}=e;switch(t){case qR:return XR;case YR:return ZR;default:return QR}}function GB(e,t){let n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}class HB{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.on(HR.LEVEL_LOADING,this.onLevelLoading,this),e.on(HR.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(HR.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(HR.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(HR.MANIFEST_LOADING,this.onManifestLoading,this),e.off(HR.LEVEL_LOADING,this.onLevelLoading,this),e.off(HR.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(HR.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(HR.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,s=new(n||r)(t);return this.loaders[e.type]=s,s}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:KR,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:s,url:i,deliveryDirectives:a,levelInfo:o}=t;this.load({id:n,level:r,pathwayId:s,responseType:"text",type:WR,url:i,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:i,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:qR,url:s,deliveryDirectives:i,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:i,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:YR,url:s,deliveryDirectives:i,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[WR];if(n){const e=n.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(n.abort(),delete this.loaders[WR])}}load(e){var t;const n=this.hls.config;let r,s=this.getInternalLoader(e);if(s){const t=this.hls.logger,n=s.context;if(n&&n.levelOrTrack===e.levelOrTrack&&(n.url===e.url||n.deliveryDirectives&&!e.deliveryDirectives))return void(n.url===e.url?t.log("[playlist-loader]: ignore ".concat(e.url," ongoing request")):t.log("[playlist-loader]: ignore ".concat(e.url," in favor of ").concat(n.url)));t.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),s.abort()}if(r=e.type===KR?n.manifestLoadPolicy.default:tP({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),jR(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===WR&&null!==e.level?t=this.hls.levels[e.level].details:e.type===qR&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===YR&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,n=t.targetduration;if(e&&n){const t=1e3*Math.max(3*e,.8*n);r=tP({},r,{maxTimeToFirstByteMs:Math.min(t,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,r.maxTimeToFirstByteMs)})}}}const i=r.errorRetry||r.timeoutRetry||{},a={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:i.maxNumRetry||0,retryDelay:i.retryDelayMs||0,maxRetryDelay:i.maxRetryDelayMs||0},o={onSuccess:(e,t,n,r)=>{const s=this.getInternalLoader(n);this.resetInternalLoader(n.type);const i=e.data;t.parsing.start=performance.now(),EN.isMediaPlaylist(i)||n.type!==KR?this.handleTrackOrLevelPlaylist(e,t,n,r||null,s):this.handleMasterPlaylist(e,t,n,r)},onError:(e,t,n,r)=>{this.handleNetworkError(t,n,!1,e,r)},onTimeout:(e,t,n)=>{this.handleNetworkError(t,n,!0,void 0,e)}};s.load(e,a,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log("".concat(e?"auto":"force"," startLoad with configured startPosition ").concat(t)),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const s=this.hls,i=e.data,a=GB(e,n),o=EN.parseMasterPlaylist(i,a);if(o.playlistParsingError)return t.parsing.end=performance.now(),void this.handleManifestParsingError(e,n,o.playlistParsingError,r,t);const{contentSteering:l,levels:c,sessionData:u,sessionKeys:d,startTimeOffset:h,variableList:f}=o;this.variableList=f,c.forEach(e=>{const{unknownCodecs:t}=e;if(t){const{preferManagedMediaSource:n}=this.hls.config;let{audioCodec:r,videoCodec:s}=e;for(let i=t.length;i--;){const a=t[i];sD(a,"audio",n)?(e.audioCodec=r=r?"".concat(r,",").concat(a):a,nD.audio[r.substring(0,4)]=2,t.splice(i,1)):sD(a,"video",n)&&(e.videoCodec=s=s?"".concat(s,",").concat(a):a,nD.video[s.substring(0,4)]=2,t.splice(i,1))}}});const{AUDIO:p=[],SUBTITLES:g,"CLOSED-CAPTIONS":m}=EN.parseMasterPlaylistMedia(i,a,o);if(p.length){p.some(e=>!e.url)||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new VO({}),bitrate:0,url:""}))}s.trigger(HR.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:g,captions:m,contentSteering:l,url:a,stats:t,networkDetails:r,sessionData:u,sessionKeys:d,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,n,r,s){const i=this.hls,{id:a,level:o,type:l}=n,c=GB(e,n),u=jR(o)?o:jR(a)?a:0,d=zB(n),h=EN.parseLevelPlaylist(e.data,c,u,d,0,this.variableList);if(l===KR){const e={attrs:new VO({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+UN(h,0),i.trigger(HR.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=h,this.handlePlaylistLoaded(h,e,t,n,r,s)}handleManifestParsingError(e,t,n,r,s){this.hls.trigger(HR.ERROR,{type:zR.NETWORK_ERROR,details:GR.MANIFEST_PARSING_ERROR,fatal:t.type===KR,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,i="A network ".concat(n?"timeout":"error"+(r?" (status "+r.code+")":"")," occurred while loading ").concat(e.type);e.type===WR?i+=": ".concat(e.level," id: ").concat(e.id):e.type!==qR&&e.type!==YR||(i+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));const a=new Error(i);this.hls.logger.warn("[playlist-loader]: ".concat(i));let o=GR.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case KR:o=n?GR.MANIFEST_LOAD_TIMEOUT:GR.MANIFEST_LOAD_ERROR,l=!0;break;case WR:o=n?GR.LEVEL_LOAD_TIMEOUT:GR.LEVEL_LOAD_ERROR,l=!1;break;case qR:o=n?GR.AUDIO_TRACK_LOAD_TIMEOUT:GR.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case YR:o=n?GR.SUBTITLE_TRACK_LOAD_TIMEOUT:GR.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const u={type:zR.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:s};if(r){const n=(null==t?void 0:t.url)||e.url;u.response=rP({url:n,data:void 0},r)}this.hls.trigger(HR.ERROR,u)}handlePlaylistLoaded(e,t,n,r,s,i){const a=this.hls,{type:o,level:l,levelOrTrack:c,id:u,groupId:d,deliveryDirectives:h}=r,f=GB(t,r),p=zB(r);let g="number"===typeof r.level&&p===QR?l:void 0;const m=e.playlistParsingError;if(m){if(this.hls.logger.warn("".concat(m," ").concat(e.url)),!a.config.ignorePlaylistParsingErrors)return void a.trigger(HR.ERROR,{type:zR.NETWORK_ERROR,details:GR.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:m,reason:m.message,response:t,context:r,level:g,parent:p,networkDetails:s,stats:n});e.playlistParsingError=null}if(!e.fragments.length){const i=e.playlistParsingError=new Error("No Segments found in Playlist");return void a.trigger(HR.ERROR,{type:zR.NETWORK_ERROR,details:GR.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:i,reason:i.message,response:t,context:r,level:g,parent:p,networkDetails:s,stats:n})}switch(e.live&&i&&(i.getCacheAge&&(e.ageHeader=i.getCacheAge()||0),i.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case KR:case WR:if(g)if(c){if(c!==a.levels[g]){const e=a.levels.indexOf(c);e>-1&&(g=e)}}else g=0;a.trigger(HR.LEVEL_LOADED,{details:e,levelInfo:c||a.levels[0],level:g||0,id:u||0,stats:n,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:o===KR});break;case qR:a.trigger(HR.AUDIO_TRACK_LOADED,{details:e,track:c,id:u||0,groupId:d||"",stats:n,networkDetails:s,deliveryDirectives:h});break;case YR:a.trigger(HR.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:u||0,groupId:d||"",stats:n,networkDetails:s,deliveryDirectives:h})}}}class KB{static get version(){return yM}static isMSESupported(){return UB()}static isSupported(){return function(){if(!UB())return!1;const e=dP();return"function"===typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(aD(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(aD(t,"audio"))))}()}static getMediaSource(){return dP()}static get Events(){return HR}static get MetadataSchema(){return VM}static get ErrorTypes(){return zR}static get ErrorDetails(){return GR}static get DefaultConfig(){return KB.defaultConfig?KB.defaultConfig:TB}static set DefaultConfig(e){KB.defaultConfig=e}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new vM,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,n){const r=oP();if("object"===typeof console&&!0===e||"object"===typeof e){const s=["debug","log","info","warn","error"];s.forEach(t=>{r[t]=lP(t,e,n)});try{r.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.6.15"))}catch(_w){return oP()}s.forEach(t=>{cP[t]=lP(t,e)})}else tP(cP,r);return r}(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=function(e,t,n){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=kB(e),s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{const i="".concat("level"===e?"playlist":e,"LoadPolicy"),a=void 0===t[i],o=[];s.forEach(n=>{const s="".concat(e,"Loading").concat(n),l=t[s];if(void 0!==l&&a){o.push(s);const e=r[i].default;switch(t[i]={default:e},n){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&n.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(i,'": ').concat(OD(t[i])))}),rP(rP({},r),t)}(KB.DefaultConfig,e,t);this.userConfig=e,n.progressive&&xB(n,t);const{abrController:r,bufferController:s,capLevelController:i,errorController:a,fpsController:o}=n,l=new a(this),c=this.abrController=new r(this),u=new gO(this),d=n.interstitialsController,h=d?this.interstitialsController=new d(this,KB):null,f=this.bufferController=new s(this,u),p=this.capLevelController=new i(this),g=new o(this),m=new HB(this),v=n.contentSteeringController,y=v?new v(this):null,b=this.levelController=new NB(this,y),E=new DB(this),w=new BB(this.config,this.logger),S=this.streamController=new jB(this,u,w),T=this.gapController=new IB(this,u);p.setStreamController(S),g.setStreamController(S);const k=[m,b,S];h&&k.splice(1,0,h),y&&k.splice(1,0,y),this.networkControllers=k;const x=[c,f,T,p,g,E,u];this.audioTrackController=this.createController(n.audioTrackController,k);const I=n.audioStreamController;I&&k.push(this.audioStreamController=new I(this,u,w)),this.subtitleTrackController=this.createController(n.subtitleTrackController,k);const L=n.subtitleStreamController;L&&k.push(this.subtititleStreamController=new L(this,u,w)),this.createController(n.timelineController,x),w.emeController=this.emeController=this.createController(n.emeController,x),this.cmcdController=this.createController(n.cmcdController,x),this.latencyController=this.createController(OB,x),this.coreComponents=x,k.push(l);const C=l.onErrorOut;"function"===typeof C&&this.on(HR.ERROR,C,l),this.on(HR.MANIFEST_LOADED,m.onManifestLoaded,m)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,n)}once(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,r=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const t=e===HR.ERROR;this.trigger(HR.ERROR,{type:zR.OTHER_ERROR,details:GR.INTERNAL_EXCEPTION,fatal:t,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(HR.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error("attachMedia failed: invalid argument (".concat(e,")"));return void this.trigger(HR.ERROR,{type:zR.OTHER_ERROR,details:GR.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(HR.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(HR.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(HR.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=bP.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:".concat(r)),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(HR.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;this.logger.log("startLoad(".concat(e+(t?", <skip seek to start>":""),")")),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),this.started&&this.networkControllers);n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[QR]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[XR]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ZR]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();const n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return n}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log("set currentLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return kD.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(r=-1===t&&null!=e&&e.length?e.length-1:t,n)for(let s=r;s--;){const t=e[s].attrs["HDCP-LEVEL"];if(t&&t<=n)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e){return wD(e,MD(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.allAudioTracks),navigator.mediaCapabilities)}}KB.defaultConfig=void 0;const WB="http://192.168.1.183:4450";function qB(){const e=(0,r.useRef)(null),t=(0,r.useRef)(null),[n,s]=(0,r.useState)(null),[i,a]=(0,r.useState)(null),[o,l]=(0,r.useState)(null),[c,u]=(0,r.useState)("idle"),[h,f]=(0,r.useState)(null),[p,g]=(0,r.useState)("video"),[m,v]=(0,r.useState)(""),[y,b]=(0,r.useState)([]),[E,w]=(0,r.useState)(null),[S,T]=(0,r.useState)(null),[k,x]=(0,r.useState)("video"),[I,L]=(0,r.useState)(3),[C,_]=(0,r.useState)(!1),[A,R]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const e=new URLSearchParams(window.location.search);s(e.get("cameraId"))},[]),(0,r.useEffect)(()=>{n&&fetch("".concat(WB,"/public/session?cameraId=").concat(encodeURIComponent(n)),{method:"POST"}).then(e=>e.json()).then(e=>{e.sessionId?l(e.sessionId):e.error&&v(e.error)}).catch(()=>v("Session init failed"))},[n]),(0,r.useEffect)(()=>{n&&async function(){const e=await Rv(Tm(lb,"cameras",n));e.exists()&&a(e.data().clientId)}()},[n]),(0,r.useEffect)(()=>{i&&async function(){const e=(await Pv(Sm(lb,"clients",i,"frames"))).docs.map(e=>d({id:e.id},e.data()));b(e)}()},[i]);const P=()=>{if(t.current){try{t.current.destroy()}catch(e){}t.current=null}},D=async()=>{if(v(""),f(null),n&&o)try{const r=await fetch("".concat(WB,"/public/start-stream?cameraId=").concat(encodeURIComponent(n),"&sessionId=").concat(encodeURIComponent(o))),s=await r.json();if(!s.ok)throw new Error(s.error);(n=>{const r=e.current;if(r)if(P(),r.muted=!0,r.autoplay=!0,r.playsInline=!0,r.controls=!1,KB.isSupported()){const e=new KB({lowLatencyMode:!0,liveSyncDuration:1,liveMaxLatencyDuration:3});t.current=e,e.loadSource(n),e.attachMedia(r),e.on(KB.Events.MANIFEST_PARSED,()=>{r.play().catch(()=>{})})}else r.src=n,r.play().catch(()=>{})})("".concat(WB).concat(s.hlsPath)),u("live")}catch(_w){v(_w.message)}else v("Missing cameraId or sessionId (session not ready yet)")},O=async e=>{L(e),R(!1),await D()};function N(e){"frame"===e.type&&w((null===E||void 0===E?void 0:E.id)===e.id?null:e),"logo"===e.type&&T((null===S||void 0===S?void 0:S.id)===e.id?null:e)}const M="photo"===k?"Capture Photo":"Capture Video (".concat(I,"s)");return(0,ub.jsx)("div",{className:"min-h-screen bg-gray-900 text-white flex justify-center",children:(0,ub.jsxs)("div",{className:"w-full max-w-3xl p-4 space-y-4",children:[(0,ub.jsx)("h1",{className:"text-2xl font-bold",children:"Town Capture"}),m&&(0,ub.jsx)("div",{className:"bg-red-700 px-3 py-2 rounded text-sm",children:m}),(0,ub.jsx)("div",{className:"relative bg-black rounded overflow-hidden",children:"preview"===c&&h&&"photo"===p?(0,ub.jsx)("img",{src:h,alt:"preview",className:"w-full h-64 object-contain bg-black"}):(0,ub.jsx)("video",{ref:e,className:"w-full h-64 bg-black",playsInline:!0,controls:"preview"===c&&"photo"!==p})}),y.length>0&&(0,ub.jsxs)("div",{className:"bg-gray-800 rounded p-3 space-y-3",children:[(0,ub.jsx)("div",{className:"text-sm font-semibold",children:"Choose Overlay"}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:"text-xs text-gray-300 mb-1",children:"Frames (max 1)"}),(0,ub.jsx)("div",{className:"flex gap-2 overflow-x-auto",children:y.filter(e=>"frame"===e.type).map(e=>(0,ub.jsx)(YB,{item:e,selected:(null===E||void 0===E?void 0:E.id)===e.id,onClick:()=>N(e)},e.id))})]}),(0,ub.jsxs)("div",{children:[(0,ub.jsx)("div",{className:"text-xs text-gray-300 mb-1",children:"Logos (max 1)"}),(0,ub.jsx)("div",{className:"flex gap-2 overflow-x-auto",children:y.filter(e=>"logo"===e.type).map(e=>(0,ub.jsx)(YB,{item:e,selected:(null===S||void 0===S?void 0:S.id)===e.id,onClick:()=>N(e)},e.id))})]})]}),(0,ub.jsxs)("div",{className:"flex gap-3",children:["idle"===c&&(0,ub.jsx)("button",{onClick:()=>{v(""),_(!0)},className:"px-4 py-2 bg-green-600 rounded",disabled:!o,title:o?"":"Waiting for session...",children:"Start"}),"live"===c&&(0,ub.jsx)("button",{onClick:async()=>{v(""),u("capturing");try{const e=await fetch("".concat(WB,"/public/capture"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:o,captureType:k,durationSec:"video"===k?I:0,frameId:(null===E||void 0===E?void 0:E.id)||null,logoId:(null===S||void 0===S?void 0:S.id)||null})}),t=await e.json();if(!t.ok)throw new Error(t.error);f(t.previewUrl),g(t.captureType||k),u("preview"),P()}catch(_w){v(_w.message),u("live")}},className:"px-4 py-2 bg-yellow-500 rounded",children:M}),"preview"===c&&(0,ub.jsxs)(ub.Fragment,{children:[(0,ub.jsx)("button",{onClick:async()=>{v("");try{const e=await fetch("".concat(WB,"/public/create-payment"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:o,email:null})}),t=await e.json();if(!t.url)throw new Error(t.error||"Payment session failed");window.location.href=t.url}catch(_w){v(_w.message)}},className:"px-4 py-2 bg-blue-600 rounded",children:"Pay & Download"}),(0,ub.jsx)("button",{onClick:()=>{u("idle"),f(null)},className:"px-3 py-2 bg-gray-700 rounded",children:"Back"})]})]}),C&&(0,ub.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:(0,ub.jsxs)("div",{className:"bg-gray-800 rounded p-4 w-72 space-y-3",children:[(0,ub.jsx)("div",{className:"text-sm font-semibold",children:"What do you want to capture?"}),(0,ub.jsx)("button",{className:"w-full py-2 rounded bg-gray-700 hover:bg-gray-600",onClick:async()=>{x("photo"),L(0),_(!1),await D()},children:"Photo (\xa5100)"}),(0,ub.jsx)("button",{className:"w-full py-2 rounded bg-gray-700 hover:bg-gray-600",onClick:()=>{x("video"),_(!1),R(!0)},children:"Video"}),(0,ub.jsx)("button",{className:"w-full py-2 rounded bg-red-600",onClick:()=>_(!1),children:"Close"})]})}),A&&(0,ub.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:(0,ub.jsxs)("div",{className:"bg-gray-800 rounded p-4 w-72 space-y-3",children:[(0,ub.jsx)("div",{className:"text-sm font-semibold",children:"Select Video Duration"}),(0,ub.jsxs)("div",{className:"flex gap-2",children:[(0,ub.jsx)("button",{className:"flex-1 py-2 rounded bg-gray-700 hover:bg-gray-600",onClick:()=>O(3),children:"3 sec (\xa5300)"}),(0,ub.jsx)("button",{className:"flex-1 py-2 rounded bg-gray-700 hover:bg-gray-600",onClick:()=>O(15),children:"15 sec (\xa5500)"})]}),(0,ub.jsx)("button",{className:"w-full py-2 rounded bg-red-600",onClick:()=>R(!1),children:"Close"})]})})]})})}function YB(e){let{item:t,selected:n,onClick:r}=e;return(0,ub.jsxs)("button",{onClick:r,className:"min-w-[120px] p-2 rounded border transition\n        ".concat(n?"border-blue-500 bg-blue-900/40":"border-gray-600 hover:bg-gray-700","\n      "),children:[(0,ub.jsx)("div",{className:"text-xs font-medium truncate",children:t.fileName}),(0,ub.jsx)("div",{className:"text-xs mt-1",children:t.isPaid?(0,ub.jsxs)("span",{className:"text-red-400",children:["\xa5",t.price]}):(0,ub.jsx)("span",{className:"text-green-400",children:"FREE"})}),n&&(0,ub.jsx)("div",{className:"text-[10px] text-blue-300 mt-1",children:"Selected"})]})}function QB(){const e=xe(),[t]=Mt(),n=t.get("sessionId"),s=(0,r.useMemo)(()=>{const e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"http://192.168.1.183:4450":"http://".concat(e,":4450")},[]),[i,a]=(0,r.useState)("checking"),[o,l]=(0,r.useState)("pending"),[c,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(null),[f,p]=(0,r.useState)(null),[g,m]=(0,r.useState)(null),[v,y]=(0,r.useState)(null),[b,E]=(0,r.useState)("\u5199\u771f"),[w,S]=(0,r.useState)("\u7121"),[T,k]=(0,r.useState)(null),[x,I]=(0,r.useState)(!1),L=(0,r.useMemo)(()=>{if(!c)return null;const e=c.includes("?")?"&":"?";return"".concat(c).concat(e,"t=").concat(Date.now())},[c]),C=(0,r.useMemo)(()=>L?function(e){if(!e)return!1;const t=e.split("?")[0].toLowerCase();return t.endsWith(".jpg")||t.endsWith(".jpeg")||t.endsWith(".png")||t.endsWith(".webp")||t.endsWith(".gif")||t.endsWith(".bmp")}(L)?"image":function(e){if(!e)return!1;const t=e.split("?")[0].toLowerCase();return t.endsWith(".mp4")||t.endsWith(".webm")||t.endsWith(".mov")||t.endsWith(".m4v")||t.endsWith(".ogg")}(L)?"video":"unknown":null,[L]);(0,r.useEffect)(()=>{if(!n)return k("Missing sessionId"),void a("failed");let e=!1,t=null;const r=async()=>{try{const r=await fetch("".concat(s,"/public/payment-status?sessionId=").concat(encodeURIComponent(n)),{cache:"no-store"}),i=await r.json();if(e)return;if(!r.ok||!1===(null===i||void 0===i?void 0:i.ok))throw new Error((null===i||void 0===i?void 0:i.error)||"HTTP ".concat(r.status));l(i.phase||"pending"),u(i.previewUrl||null),h(i.captureSessionId||null),p(i.downloadToken||null),m(i.fileName||null),y("number"===typeof i.sizeBytes?i.sizeBytes:null),E(i.modeLabel||("photo"===i.captureType?"\u5199\u771f":"\u52d5\u753b")||"\u5199\u771f"),S(i.overlayLabel||"\u7121"),null!==i&&void 0!==i&&i.paid?(a("paid"),t&&clearInterval(t)):a("checking")}catch(_w){if(e)return;k(String(_w.message||_w)),a("failed"),t&&clearInterval(t)}};return r(),t=setInterval(r,2e3),()=>{e=!0,t&&clearInterval(t)}},[s,n]);const _="failed"!==i&&!L,A=g||function(e){if(!e)return"\u2014";try{const t=e.split("?")[0].split("/").pop()||"";return decodeURIComponent(t)||"\u2014"}catch(t){return"\u2014"}}(L),R=function(e){if(null===e||void 0===e)return"\u2014";const t=["B","KB","MB","GB"];let n=e,r=0;for(;n>=1024&&r<t.length-1;)n/=1024,r++;return"".concat(n.toFixed(0===r?0:2)," ").concat(t[r])}(v);return(0,ub.jsx)("div",{className:"min-h-screen bg-slate-50 px-3 py-5 flex justify-center",children:(0,ub.jsxs)("div",{className:"w-full max-w-[520px]",children:[(0,ub.jsx)("h1",{className:"text-center text-xl font-extrabold text-slate-900 mt-1 mb-4",children:"\u4fdd\u5b58"}),(0,ub.jsxs)("div",{className:"flex gap-3 mb-3",children:[(0,ub.jsxs)("div",{className:"flex-1 rounded-full border border-slate-200 bg-white px-3 py-2 text-center text-[13px] font-bold text-slate-700 shadow-sm",children:["OVERLAY: ",w]}),(0,ub.jsxs)("div",{className:"flex-1 rounded-full border border-slate-200 bg-white px-3 py-2 text-center text-[13px] font-bold text-slate-700 shadow-sm",children:["\u9078\u629e\u30e2\u30fc\u30c9: ",b]})]}),(0,ub.jsxs)("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-[0_18px_50px_rgba(15,23,42,0.12)]",children:[(0,ub.jsxs)("div",{className:"relative aspect-video bg-black",children:[_&&(0,ub.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center gap-3 bg-gradient-to-br from-black/60 to-black/30",children:[(0,ub.jsx)("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white/30 border-t-white"}),(0,ub.jsxs)("div",{className:"text-sm font-extrabold text-white/90",children:["\u6c7a\u6e08\u78ba\u8a8d\u4e2d\u2026\uff08phase: ",o,"\uff09"]})]}),!_&&L&&"image"===C&&(0,ub.jsx)("img",{src:L,alt:"preview",className:"h-full w-full object-cover",onError:()=>k("\u30d7\u30ec\u30d3\u30e5\u30fc\u8868\u793a\u306b\u5931\u6557\u3057\u307e\u3057\u305f\uff08\u671f\u9650\u5207\u308c/\u30a2\u30af\u30bb\u30b9\u5236\u9650\uff09\u3002\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306f\u53ef\u80fd\u3067\u3059\u3002")}),!_&&L&&("video"===C||"unknown"===C)&&(0,ub.jsx)("video",{src:L,controls:!0,playsInline:!0,className:"h-full w-full object-cover",onError:()=>k("\u52d5\u753b\u30d7\u30ec\u30d3\u30e5\u30fc\u306b\u5931\u6557\u3057\u307e\u3057\u305f\uff08\u671f\u9650\u5207\u308c/\u30a2\u30af\u30bb\u30b9\u5236\u9650\uff09\u3002\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306f\u53ef\u80fd\u3067\u3059\u3002")}),(0,ub.jsx)("button",{type:"button",className:"absolute right-3 top-3 h-10 w-10 rounded-full bg-white/90 shadow-md grid place-items-center text-slate-900 disabled:opacity-50",title:"\u5225\u30bf\u30d6\u3067\u958b\u304f",disabled:!L,onClick:()=>{L&&window.open(L,"_blank","noopener,noreferrer")},children:"\ud83d\uddbc\ufe0f"})]}),(0,ub.jsxs)("div",{className:"flex gap-4 border-t border-slate-200 px-4 py-3",children:[(0,ub.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,ub.jsx)("div",{className:"text-[11px] font-extrabold tracking-wider text-slate-400",children:"SIZE"}),(0,ub.jsx)("div",{className:"mt-1 text-[13px] font-extrabold text-slate-900 truncate",title:String(R),children:R})]}),(0,ub.jsxs)("div",{className:"flex-1 min-w-0 text-right",children:[(0,ub.jsx)("div",{className:"text-[11px] font-extrabold tracking-wider text-slate-400",children:"FILENAME"}),(0,ub.jsx)("div",{className:"mt-1 text-[13px] font-extrabold text-slate-900 truncate",title:A,children:A})]})]})]}),T&&(0,ub.jsx)("div",{className:"mt-3 rounded-xl border border-red-300 bg-red-50 px-3 py-2 text-sm font-bold text-red-700 whitespace-pre-wrap",children:T}),(0,ub.jsx)("button",{type:"button",onClick:async function(){if(k(null),"paid"===i)if(f){I(!0);try{const t="".concat(s,"/stripe/dl/").concat(encodeURIComponent(f));window.open(t,"_blank","noopener,noreferrer"),e("/end?from=download",{replace:!0})}catch(_w){k(String(_w.message||_w))}finally{I(!1)}}else k("Paid, but missing downloadToken from server.");else k("Payment not confirmed yet.")},disabled:"paid"!==i||x||!f,className:"mt-4 w-full rounded-xl bg-emerald-500 py-4 text-[16px] font-black text-white shadow-[0_16px_40px_rgba(0,200,83,0.28)] disabled:opacity-50 disabled:cursor-not-allowed",children:x?"\u6e96\u5099\u4e2d\u2026":"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u6e96\u5099"}),(0,ub.jsxs)("div",{className:"mt-4 text-center text-xs leading-6 text-slate-500",children:["\u4e0a\u8a18\u30dc\u30bf\u30f3\u3067\u30c7\u30fc\u30bf\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u53ef\u80fd\u3067\u3059\u3002",(0,ub.jsx)("br",{}),"\u30e1\u30fc\u30eb\u3067\u3082\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9URL\u3092\u304a\u9001\u308a\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u305d\u3061\u3089\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002"]}),(0,ub.jsx)("div",{className:"mt-2 text-center text-xs font-extrabold text-red-500",children:"\u203b \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u306f1\u6642\u9593\u3067\u3001\u6700\u59273\u56de\u307e\u3067\u53ef\u80fd\u3067\u3059\u3002"})]})})}function XB(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ZB(e,t){return ZB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ZB(e,t)}function JB(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ZB(e,t)}function $B(e,t){if(t&&("object"==o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return XB(e)}function eV(e){return eV=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},eV(e)}function tV(e){return gb(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||vb(e)||yb()}function nV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nV(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var sV={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},iV=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Eb(this,e),this.init(t,n)}return Sb(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||sV,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,r){return r&&!this.debug?null:("string"===typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,rV(rV({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}},{key:"clone",value:function(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new e(this.logger,t)}}]),e}(),aV=new iV,oV=function(){function e(){Eb(this,e),this.observers={}}return Sb(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach(function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)}),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter(function(e){return e!==t}):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.observers[e]&&[].concat(this.observers[e]).forEach(function(e){e.apply(void 0,n)});this.observers["*"]&&[].concat(this.observers["*"]).forEach(function(t){t.apply(t,[e].concat(n))})}}]),e}();function lV(){var e,t,n=new Promise(function(n,r){e=n,t=r});return n.resolve=e,n.reject=t,n}function cV(e){return null==e?"":""+e}function uV(e,t,n){function r(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function s(){return!e||"string"===typeof e}for(var i="string"!==typeof t?[].concat(t):t.split(".");i.length>1;){if(s())return{};var a=r(i.shift());!e[a]&&n&&(e[a]=new n),e=Object.prototype.hasOwnProperty.call(e,a)?e[a]:{}}return s()?{}:{obj:e,k:r(i.shift())}}function dV(e,t,n){var r=uV(e,t,Object);r.obj[r.k]=n}function hV(e,t){var n=uV(e,t),r=n.obj,s=n.k;if(r)return r[s]}function fV(e,t,n){var r=hV(e,n);return void 0!==r?r:hV(t,n)}function pV(e,t,n){for(var r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?"string"===typeof e[r]||e[r]instanceof String||"string"===typeof t[r]||t[r]instanceof String?n&&(e[r]=t[r]):pV(e[r],t[r],n):e[r]=t[r]);return e}function gV(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var mV={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function vV(e){return"string"===typeof e?e.replace(/[&<>"'\/]/g,function(e){return mV[e]}):e}var yV="undefined"!==typeof window&&window.navigator&&"undefined"===typeof window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,bV=[" ",",","?","!",";"];function EV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function wV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?EV(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function SV(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(_w){return!1}}();return function(){var n,r=eV(e);if(t){var s=eV(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return $B(this,n)}}function TV(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var r=t.split(n),s=e,i=0;i<r.length;++i){if(!s)return;if("string"===typeof s[r[i]]&&i+1<r.length)return;if(void 0===s[r[i]]){for(var a=2,o=r.slice(i,i+a).join(n),l=s[o];void 0===l&&r.length>i+a;)a++,l=s[o=r.slice(i,i+a).join(n)];if(void 0===l)return;if(null===l)return null;if(t.endsWith(o)){if("string"===typeof l)return l;if(o&&"string"===typeof l[o])return l[o]}var c=r.slice(i+a).join(n);return c?TV(l,c,n):void 0}s=s[r[i]]}return s}}var kV=function(e){JB(n,e);var t=SV(n);function n(e){var r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return Eb(this,n),r=t.call(this),yV&&oV.call(XB(r)),r.data=e||{},r.options=s,void 0===r.options.keySeparator&&(r.options.keySeparator="."),void 0===r.options.ignoreJSONStructure&&(r.options.ignoreJSONStructure=!0),r}return Sb(n,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,i=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure,a=[e,t];n&&"string"!==typeof n&&(a=a.concat(n)),n&&"string"===typeof n&&(a=a.concat(s?n.split(s):n)),e.indexOf(".")>-1&&(a=e.split("."));var o=hV(this.data,a);return o||!i||"string"!==typeof n?o:TV(this.data&&this.data[e]&&this.data[e][t],n,s)}},{key:"addResource",value:function(e,t,n,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},i=this.options.keySeparator;void 0===i&&(i=".");var a=[e,t];n&&(a=a.concat(i?n.split(i):n)),e.indexOf(".")>-1&&(r=t,t=(a=e.split("."))[1]),this.addNamespaces(t),dV(this.data,a,r),s.silent||this.emit("added",e,t,n,r)}},{key:"addResources",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var s in n)"string"!==typeof n[s]&&"[object Array]"!==Object.prototype.toString.apply(n[s])||this.addResource(e,t,s,n[s],{silent:!0});r.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,r,s){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},a=[e,t];e.indexOf(".")>-1&&(r=n,n=t,t=(a=e.split("."))[1]),this.addNamespaces(t);var o=hV(this.data,a)||{};r?pV(o,n,s):o=wV(wV({},o),n),dV(this.data,a,o),i.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?wV(wV({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(function(e){return t[e]&&Object.keys(t[e]).length>0})}},{key:"toJSON",value:function(){return this.data}}]),n}(oV),xV={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,r,s){var i=this;return e.forEach(function(e){i.processors[e]&&(t=i.processors[e].process(t,n,r,s))}),t}};function IV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function LV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?IV(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function CV(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(_w){return!1}}();return function(){var n,r=eV(e);if(t){var s=eV(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return $B(this,n)}}var _V={},AV=function(e){JB(n,e);var t=CV(n);function n(e){var r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Eb(this,n),r=t.call(this),yV&&oV.call(XB(r)),function(e,t,n){e.forEach(function(e){t[e]&&(n[e]=t[e])})}(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,XB(r)),r.options=s,void 0===r.options.keySeparator&&(r.options.keySeparator="."),r.logger=aV.create("translator"),r}return Sb(n,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(void 0===e||null===e)return!1;var n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,s=t.ns||this.options.defaultNS||[],i=n&&e.indexOf(n)>-1,a=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!function(e,t,n){t=t||"",n=n||"";var r=bV.filter(function(e){return t.indexOf(e)<0&&n.indexOf(e)<0});if(0===r.length)return!0;var s=new RegExp("(".concat(r.map(function(e){return"?"===e?"\\?":e}).join("|"),")")),i=!s.test(e);if(!i){var a=e.indexOf(n);a>0&&!s.test(e.substring(0,a))&&(i=!0)}return i}(e,n,r);if(i&&!a){var o=e.match(this.interpolator.nestingRegexp);if(o&&o.length>0)return{key:e,namespaces:s};var l=e.split(n);(n!==r||n===r&&this.options.ns.indexOf(l[0])>-1)&&(s=l.shift()),e=l.join(r)}return"string"===typeof s&&(s=[s]),{key:e,namespaces:s}}},{key:"translate",value:function(e,t,r){var s=this;if("object"!==o(t)&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),t||(t={}),void 0===e||null===e)return"";Array.isArray(e)||(e=[String(e)]);var i=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,a=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,l=this.extractFromKey(e[e.length-1],t),c=l.key,u=l.namespaces,d=u[u.length-1],h=t.lng||this.language,f=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h&&"cimode"===h.toLowerCase()){if(f){var p=t.nsSeparator||this.options.nsSeparator;return i?(g.res="".concat(d).concat(p).concat(c),g):"".concat(d).concat(p).concat(c)}return i?(g.res=c,g):c}var g=this.resolve(e,t),m=g&&g.res,v=g&&g.usedKey||c,y=g&&g.exactUsedKey||c,b=Object.prototype.toString.apply(m),E=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,w=!this.i18nFormat||this.i18nFormat.handleAsObject;if(w&&m&&("string"!==typeof m&&"boolean"!==typeof m&&"number"!==typeof m)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(b)<0&&("string"!==typeof E||"[object Array]"!==b)){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var S=this.options.returnedObjectHandler?this.options.returnedObjectHandler(v,m,LV(LV({},t),{},{ns:u})):"key '".concat(c," (").concat(this.language,")' returned an object instead of string.");return i?(g.res=S,g):S}if(a){var T="[object Array]"===b,k=T?[]:{},x=T?y:v;for(var I in m)if(Object.prototype.hasOwnProperty.call(m,I)){var L="".concat(x).concat(a).concat(I);k[I]=this.translate(L,LV(LV({},t),{joinArrays:!1,ns:u})),k[I]===L&&(k[I]=m[I])}m=k}}else if(w&&"string"===typeof E&&"[object Array]"===b)(m=m.join(E))&&(m=this.extendTranslation(m,e,t,r));else{var C=!1,_=!1,A=void 0!==t.count&&"string"!==typeof t.count,R=n.hasDefaultValue(t),P=A?this.pluralResolver.getSuffix(h,t.count,t):"",D=t["defaultValue".concat(P)]||t.defaultValue;!this.isValidLookup(m)&&R&&(C=!0,m=D),this.isValidLookup(m)||(_=!0,m=c);var O=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&_?void 0:m,N=R&&D!==m&&this.options.updateMissing;if(_||C||N){if(this.logger.log(N?"updateKey":"missingKey",h,d,c,N?D:m),a){var M=this.resolve(c,LV(LV({},t),{},{keySeparator:!1}));M&&M.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var F=[],U=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&U&&U[0])for(var j=0;j<U.length;j++)F.push(U[j]);else"all"===this.options.saveMissingTo?F=this.languageUtils.toResolveHierarchy(t.lng||this.language):F.push(t.lng||this.language);var B=function(e,n,r){var i=R&&r!==m?r:O;s.options.missingKeyHandler?s.options.missingKeyHandler(e,d,n,i,N,t):s.backendConnector&&s.backendConnector.saveMissing&&s.backendConnector.saveMissing(e,d,n,i,N,t),s.emit("missingKey",e,d,n,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&A?F.forEach(function(e){s.pluralResolver.getSuffixes(e,t).forEach(function(n){B([e],c+n,t["defaultValue".concat(n)]||D)})}):B(F,c,D))}m=this.extendTranslation(m,e,t,g,r),_&&m===c&&this.options.appendNamespaceToMissingKey&&(m="".concat(d,":").concat(c)),(_||C)&&this.options.parseMissingKeyHandler&&(m="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(d,":").concat(c):c,C?m:void 0):this.options.parseMissingKeyHandler(m))}return i?(g.res=m,g):m}},{key:"extendTranslation",value:function(e,t,n,r,s){var i=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,LV(LV({},this.options.interpolation.defaultVariables),n),r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(LV(LV({},n),{interpolation:LV(LV({},this.options.interpolation),n.interpolation)}));var a,o="string"===typeof e&&(n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(o){var l=e.match(this.interpolator.nestingRegexp);a=l&&l.length}var c=n.replace&&"string"!==typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(c=LV(LV({},this.options.interpolation.defaultVariables),c)),e=this.interpolator.interpolate(e,c,n.lng||this.language,n),o){var u=e.match(this.interpolator.nestingRegexp);a<(u&&u.length)&&(n.nest=!1)}!1!==n.nest&&(e=this.interpolator.nest(e,function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return s&&s[0]===r[0]&&!n.context?(i.logger.warn("It seems you are nesting recursively key: ".concat(r[0]," in key: ").concat(t[0])),null):i.translate.apply(i,r.concat([t]))},n)),n.interpolation&&this.interpolator.reset()}var d=n.postProcess||this.options.postProcess,h="string"===typeof d?[d]:d;return void 0!==e&&null!==e&&h&&h.length&&!1!==n.applyPostProcessor&&(e=xV.handle(h,e,t,this.options&&this.options.postProcessPassResolved?LV({i18nResolved:r},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,r,s,i,a=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"===typeof e&&(e=[e]),e.forEach(function(e){if(!a.isValidLookup(t)){var l=a.extractFromKey(e,o),c=l.key;n=c;var u=l.namespaces;a.options.fallbackNS&&(u=u.concat(a.options.fallbackNS));var d=void 0!==o.count&&"string"!==typeof o.count,h=d&&!o.ordinal&&0===o.count&&a.pluralResolver.shouldUseIntlApi(),f=void 0!==o.context&&("string"===typeof o.context||"number"===typeof o.context)&&""!==o.context,p=o.lngs?o.lngs:a.languageUtils.toResolveHierarchy(o.lng||a.language,o.fallbackLng);u.forEach(function(e){a.isValidLookup(t)||(i=e,!_V["".concat(p[0],"-").concat(e)]&&a.utils&&a.utils.hasLoadedNamespace&&!a.utils.hasLoadedNamespace(i)&&(_V["".concat(p[0],"-").concat(e)]=!0,a.logger.warn('key "'.concat(n,'" for languages "').concat(p.join(", "),'" won\'t get resolved as namespace "').concat(i,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(function(n){if(!a.isValidLookup(t)){s=n;var i,l=[c];if(a.i18nFormat&&a.i18nFormat.addLookupKeys)a.i18nFormat.addLookupKeys(l,c,n,e,o);else{var u;d&&(u=a.pluralResolver.getSuffix(n,o.count,o));var p="".concat(a.options.pluralSeparator,"zero");if(d&&(l.push(c+u),h&&l.push(c+p)),f){var g="".concat(c).concat(a.options.contextSeparator).concat(o.context);l.push(g),d&&(l.push(g+u),h&&l.push(g+p))}}for(;i=l.pop();)a.isValidLookup(t)||(r=i,t=a.getResource(n,e,i,o))}}))})}}),{res:t,usedKey:n,exactUsedKey:r,usedLng:s,usedNS:i}}},{key:"isValidLookup",value:function(e){return void 0!==e&&!(!this.options.returnNull&&null===e)&&!(!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,r):this.resourceStore.getResource(e,t,n,r)}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}]),n}(oV);function RV(e){return e.charAt(0).toUpperCase()+e.slice(1)}var PV=function(){function e(t){Eb(this,e),this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=aV.create("languageUtils")}return Sb(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"===typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map(function(e){return e.toLowerCase()}):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=RV(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=RV(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=RV(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach(function(e){if(!t){var r=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(r)||(t=r)}}),!t&&this.options.supportedLngs&&e.forEach(function(e){if(!t){var r=n.getLanguagePartFromCode(e);if(n.isSupportedCode(r))return t=r;t=n.options.supportedLngs.find(function(e){if(0===e.indexOf(r))return e})}}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"===typeof e&&(e=e(t)),"string"===typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),s=[],i=function(e){e&&(n.isSupportedCode(e)?s.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"===typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(e))):"string"===typeof e&&i(this.formatLanguageCode(e)),r.forEach(function(e){s.indexOf(e)<0&&i(n.formatLanguageCode(e))}),s}}]),e}(),DV=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],OV={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},NV=["v1","v2","v3"],MV={zero:0,one:1,two:2,few:3,many:4,other:5};var FV=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Eb(this,e),this.languageUtils=t,this.options=n,this.logger=aV.create("pluralResolver"),this.options.compatibilityJSON&&"v4"!==this.options.compatibilityJSON||"undefined"!==typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=function(){var e={};return DV.forEach(function(t){t.lngs.forEach(function(n){e[n]={numbers:t.nr,plurals:OV[t.fc]}})}),e}()}return Sb(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(e,{type:t.ordinal?"ordinal":"cardinal"})}catch(n){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map(function(e){return"".concat(t).concat(e)})}},{key:"getSuffixes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getRule(e,n);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort(function(e,t){return MV[e]-MV[t]}).map(function(e){return"".concat(t.options.prepend).concat(e)}):r.numbers.map(function(r){return t.getSuffix(e,r,n)}):[]}},{key:"getSuffix",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.getRule(e,n);return r?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(r.select(t)):this.getSuffixRetroCompatible(r,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var n=this,r=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),s=e.numbers[r];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===s?s="plural":1===s&&(s=""));var i=function(){return n.options.prepend&&s.toString()?n.options.prepend+s.toString():s.toString()};return"v1"===this.options.compatibilityJSON?1===s?"":"number"===typeof s?"_plural_".concat(s.toString()):i():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?i():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}},{key:"shouldUseIntlApi",value:function(){return!NV.includes(this.options.compatibilityJSON)}}]),e}();function UV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function jV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UV(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var BV=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Eb(this,e),this.logger=aV.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return Sb(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:vV,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?gV(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?gV(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?gV(t.nestingPrefix):t.nestingPrefixEscaped||gV("$t("),this.nestingSuffix=t.nestingSuffix?gV(t.nestingSuffix):t.nestingSuffixEscaped||gV(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,r){var s,i,a,o=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function c(e){return e.replace(/\$/g,"$$$$")}var u=function(e){if(e.indexOf(o.formatSeparator)<0){var s=fV(t,l,e);return o.alwaysFormat?o.format(s,void 0,n,jV(jV(jV({},r),t),{},{interpolationkey:e})):s}var i=e.split(o.formatSeparator),a=i.shift().trim(),c=i.join(o.formatSeparator).trim();return o.format(fV(t,l,a),c,n,jV(jV(jV({},r),t),{},{interpolationkey:a}))};this.resetRegExp();var d=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,h=r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return c(e)}},{regex:this.regexp,safeValue:function(e){return o.escapeValue?c(o.escape(e)):c(e)}}].forEach(function(t){for(a=0;s=t.regex.exec(e);){var n=s[1].trim();if(void 0===(i=u(n)))if("function"===typeof d){var l=d(e,s,r);i="string"===typeof l?l:""}else if(r&&r.hasOwnProperty(n))i="";else{if(h){i=s[0];continue}o.logger.warn("missed to pass in variable ".concat(n," for interpolating ").concat(e)),i=""}else"string"===typeof i||o.useRawValueToEscape||(i=cV(i));var c=t.safeValue(i);if(e=e.replace(s[0],c),h?(t.regex.lastIndex+=i.length,t.regex.lastIndex-=s[0].length):t.regex.lastIndex=0,++a>=o.maxReplaces)break}}),e}},{key:"nest",value:function(e,t){var n,r,s=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=jV({},i);function o(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var r=e.split(new RegExp("".concat(n,"[ ]*{"))),s="{".concat(r[1]);e=r[0];var i=(s=this.interpolate(s,a)).match(/'/g),o=s.match(/"/g);(i&&i.length%2===0&&!o||o.length%2!==0)&&(s=s.replace(/'/g,'"'));try{a=JSON.parse(s),t&&(a=jV(jV({},t),a))}catch(_w){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),_w),"".concat(e).concat(n).concat(s)}return delete a.defaultValue,e}for(a.applyPostProcessor=!1,delete a.defaultValue;n=this.nestingRegexp.exec(e);){var l=[],c=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){var u=n[1].split(this.formatSeparator).map(function(e){return e.trim()});n[1]=u.shift(),l=u,c=!0}if((r=t(o.call(this,n[1].trim(),a),a))&&n[0]===e&&"string"!==typeof r)return r;"string"!==typeof r&&(r=cV(r)),r||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),r=""),c&&(r=l.reduce(function(e,t){return s.format(e,t,i.lng,jV(jV({},i),{},{interpolationkey:n[1].trim()}))},r.trim())),e=e.replace(n[0],r),this.regexp.lastIndex=0}return e}}]),e}();function VV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function zV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VV(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function GV(e){var t={};return function(n,r,s){var i=r+JSON.stringify(s),a=t[i];return a||(a=e(r,s),t[i]=a),a(n)}}var HV=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Eb(this,e),this.logger=aV.create("formatter"),this.options=t,this.formats={number:GV(function(e,t){var n=new Intl.NumberFormat(e,t);return function(e){return n.format(e)}}),currency:GV(function(e,t){var n=new Intl.NumberFormat(e,zV(zV({},t),{},{style:"currency"}));return function(e){return n.format(e)}}),datetime:GV(function(e,t){var n=new Intl.DateTimeFormat(e,zV({},t));return function(e){return n.format(e)}}),relativetime:GV(function(e,t){var n=new Intl.RelativeTimeFormat(e,zV({},t));return function(e){return n.format(e,t.range||"day")}}),list:GV(function(e,t){var n=new Intl.ListFormat(e,zV({},t));return function(e){return n.format(e)}})},this.init(t)}return Sb(e,[{key:"init",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"addCached",value:function(e,t){this.formats[e.toLowerCase().trim()]=GV(t)}},{key:"format",value:function(e,t,n,r){var s=this,i=t.split(this.formatSeparator).reduce(function(e,t){var i=function(e){var t=e.toLowerCase().trim(),n={};if(e.indexOf("(")>-1){var r=e.split("(");t=r[0].toLowerCase().trim();var s=r[1].substring(0,r[1].length-1);"currency"===t&&s.indexOf(":")<0?n.currency||(n.currency=s.trim()):"relativetime"===t&&s.indexOf(":")<0?n.range||(n.range=s.trim()):s.split(";").forEach(function(e){if(e){var t=tV(e.split(":")),r=t[0],s=t.slice(1).join(":").trim().replace(/^'+|'+$/g,"");n[r.trim()]||(n[r.trim()]=s),"false"===s&&(n[r.trim()]=!1),"true"===s&&(n[r.trim()]=!0),isNaN(s)||(n[r.trim()]=parseInt(s,10))}})}return{formatName:t,formatOptions:n}}(t),a=i.formatName,o=i.formatOptions;if(s.formats[a]){var l=e;try{var c=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},u=c.locale||c.lng||r.locale||r.lng||n;l=s.formats[a](e,u,zV(zV(zV({},o),r),c))}catch(d){s.logger.warn(d)}return l}return s.logger.warn("there was no format function for ".concat(a)),e},e);return i}}]),e}();function KV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function WV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KV(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function qV(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(_w){return!1}}();return function(){var n,r=eV(e);if(t){var s=eV(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return $B(this,n)}}var YV=function(e){JB(n,e);var t=qV(n);function n(e,r,s){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Eb(this,n),i=t.call(this),yV&&oV.call(XB(i)),i.backend=e,i.store=r,i.services=s,i.languageUtils=s.languageUtils,i.options=a,i.logger=aV.create("backendConnector"),i.waitingReads=[],i.maxParallelReads=a.maxParallelReads||10,i.readingCalls=0,i.maxRetries=a.maxRetries>=0?a.maxRetries:5,i.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,i.state={},i.queue=[],i.backend&&i.backend.init&&i.backend.init(s,a.backend,a),i}return Sb(n,[{key:"queueLoad",value:function(e,t,n,r){var s=this,i={},a={},o={},l={};return e.forEach(function(e){var r=!0;t.forEach(function(t){var o="".concat(e,"|").concat(t);!n.reload&&s.store.hasResourceBundle(e,t)?s.state[o]=2:s.state[o]<0||(1===s.state[o]?void 0===a[o]&&(a[o]=!0):(s.state[o]=1,r=!1,void 0===a[o]&&(a[o]=!0),void 0===i[o]&&(i[o]=!0),void 0===l[t]&&(l[t]=!0)))}),r||(o[e]=!0)}),(Object.keys(i).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}},{key:"loaded",value:function(e,t,n){var r=e.split("|"),s=r[0],i=r[1];t&&this.emit("failedLoading",s,i,t),n&&this.store.addResourceBundle(s,i,n),this.state[e]=t?-1:2;var a={};this.queue.forEach(function(n){!function(e,t,n,r){var s=uV(e,t,Object),i=s.obj,a=s.k;i[a]=i[a]||[],r&&(i[a]=i[a].concat(n)),r||i[a].push(n)}(n.loaded,[s],i),function(e,t){void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)}(n,e),t&&n.errors.push(t),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach(function(e){a[e]||(a[e]={});var t=n.loaded[e];t.length&&t.forEach(function(t){void 0===a[e][t]&&(a[e][t]=!0)})}),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(function(e){return!e.done})}},{key:"read",value:function(e,t,n){var r=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;return e.length?this.readingCalls>=this.maxParallelReads?void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:s,wait:i,callback:a}):(this.readingCalls++,this.backend[n](e,t,function(o,l){if(r.readingCalls--,r.waitingReads.length>0){var c=r.waitingReads.shift();r.read(c.lng,c.ns,c.fcName,c.tried,c.wait,c.callback)}o&&l&&s<r.maxRetries?setTimeout(function(){r.read.call(r,e,t,n,s+1,2*i,a)},i):a(o,l)})):a(null,{})}},{key:"prepareLoading",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();"string"===typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"===typeof t&&(t=[t]);var i=this.queueLoad(e,t,r,s);if(!i.toLoad.length)return i.pending.length||s(),null;i.toLoad.forEach(function(e){n.loadOne(e)})}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=e.split("|"),s=r[0],i=r[1];this.read(s,i,"read",void 0,void 0,function(r,a){r&&t.logger.warn("".concat(n,"loading namespace ").concat(i," for language ").concat(s," failed"),r),!r&&a&&t.logger.log("".concat(n,"loaded namespace ").concat(i," for language ").concat(s),a),t.loaded(e,r,a)})}},{key:"saveMissing",value:function(e,t,n,r,s){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):void 0!==n&&null!==n&&""!==n&&(this.backend&&this.backend.create&&this.backend.create(e,t,n,r,null,WV(WV({},i),{},{isUpdate:s})),e&&e[0]&&this.store.addResource(e[0],t,n,r))}}]),n}(oV);function QV(e){return"string"===typeof e.ns&&(e.ns=[e.ns]),"string"===typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"===typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function XV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ZV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?XV(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function JV(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(_w){return!1}}();return function(){var n,r=eV(e);if(t){var s=eV(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return $B(this,n)}}function $V(){}var ez=function(e){JB(n,e);var t=JV(n);function n(){var e,r,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(Eb(this,n),e=t.call(this),yV&&oV.call(XB(e)),e.options=QV(s),e.services={},e.logger=aV,e.modules={external:[]},r=XB(e),Object.getOwnPropertyNames(Object.getPrototypeOf(r)).forEach(function(e){"function"===typeof r[e]&&(r[e]=r[e].bind(r))}),i&&!e.isInitialized&&!s.isClone){if(!e.options.initImmediate)return e.init(s,i),$B(e,XB(e));setTimeout(function(){e.init(s,i)},0)}return e}return Sb(n,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;"function"===typeof t&&(n=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"===typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));var r={debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===o(e[1])&&(t=e[1]),"string"===typeof e[1]&&(t.defaultValue=e[1]),"string"===typeof e[2]&&(t.tDescription=e[2]),"object"===o(e[2])||"object"===o(e[3])){var n=e[3]||e[2];Object.keys(n).forEach(function(e){t[e]=n[e]})}return t},interpolation:{escapeValue:!0,format:function(e,t,n,r){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}};function s(e){return e?"function"===typeof e?new e:e:null}if(this.options=ZV(ZV(ZV({},r),this.options),QV(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=ZV(ZV({},r.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){var i;this.modules.logger?aV.init(s(this.modules.logger),this.options):aV.init(null,this.options),this.modules.formatter?i=this.modules.formatter:"undefined"!==typeof Intl&&(i=HV);var a=new PV(this.options);this.store=new kV(this.options.resources,this.options);var l=this.services;l.logger=aV,l.resourceStore=this.store,l.languageUtils=a,l.pluralResolver=new FV(a,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!i||this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format||(l.formatter=s(i),l.formatter.init(l,this.options),this.options.interpolation.format=l.formatter.format.bind(l.formatter)),l.interpolator=new BV(this.options),l.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},l.backendConnector=new YV(s(this.modules.backend),l.resourceStore,l,this.options),l.backendConnector.on("*",function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];e.emit.apply(e,[t].concat(r))}),this.modules.languageDetector&&(l.languageDetector=s(this.modules.languageDetector),l.languageDetector.init(l,this.options.detection,this.options)),this.modules.i18nFormat&&(l.i18nFormat=s(this.modules.i18nFormat),l.i18nFormat.init&&l.i18nFormat.init(this)),this.translator=new AV(this.services,this.options),this.translator.on("*",function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];e.emit.apply(e,[t].concat(r))}),this.modules.external.forEach(function(t){t.init&&t.init(e)})}if(this.format=this.options.interpolation.format,n||(n=$V),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.length>0&&"dev"!==c[0]&&(this.options.lng=c[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}});["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments),e}});var u=lV(),d=function(){var t=function(t,r){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),u.resolve(r),n(t,r)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?d():setTimeout(d,0),u}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$V,r="string"===typeof e?e:this.language;if("function"===typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase())return n();var s=[],i=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach(function(e){s.indexOf(e)<0&&s.push(e)})};if(r)i(r);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(function(e){return i(e)});this.options.preload&&this.options.preload.forEach(function(e){return i(e)}),this.services.backendConnector.load(s,this.options.ns,function(e){e||t.resolvedLanguage||!t.language||t.setResolvedLanguage(t.language),n(e)})}else n(null)}},{key:"reloadResources",value:function(e,t,n){var r=lV();return e||(e=this.languages),t||(t=this.options.ns),n||(n=$V),this.services.backendConnector.reload(e,t,function(e){r.resolve(),n(e)}),r}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&xV.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var n=this.languages[t];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}},{key:"changeLanguage",value:function(e,t){var n=this;this.isLanguageChangingTo=e;var r=lV();this.emit("languageChanging",e);var s=function(e){n.language=e,n.languages=n.services.languageUtils.toResolveHierarchy(e),n.resolvedLanguage=void 0,n.setResolvedLanguage(e)},i=function(i){e||i||!n.services.languageDetector||(i=[]);var a="string"===typeof i?i:n.services.languageUtils.getBestMatchFromCodes(i);a&&(n.language||s(a),n.translator.language||n.translator.changeLanguage(a),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage(a)),n.loadResources(a,function(e){!function(e,i){i?(s(i),n.translator.changeLanguage(i),n.isLanguageChangingTo=void 0,n.emit("languageChanged",i),n.logger.log("languageChanged",i)):n.isLanguageChangingTo=void 0,r.resolve(function(){return n.t.apply(n,arguments)}),t&&t(e,function(){return n.t.apply(n,arguments)})}(e,a)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),r}},{key:"getFixedT",value:function(e,t,n){var r=this,s=function e(t,s){var i;if("object"!==o(s)){for(var a=arguments.length,l=new Array(a>2?a-2:0),c=2;c<a;c++)l[c-2]=arguments[c];i=r.options.overloadTranslationOptionHandler([t,s].concat(l))}else i=ZV({},s);i.lng=i.lng||e.lng,i.lngs=i.lngs||e.lngs,i.ns=i.ns||e.ns,i.keyPrefix=i.keyPrefix||n||e.keyPrefix;var u=r.options.keySeparator||".",d=i.keyPrefix?"".concat(i.keyPrefix).concat(u).concat(t):t;return r.t(d,i)};return"string"===typeof e?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=n,s}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var r=this.resolvedLanguage||this.languages[0],s=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;var a=function(e,n){var r=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===r||2===r};if(n.precheck){var o=n.precheck(this,a);if(void 0!==o)return o}return!!this.hasResourceBundle(r,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!a(r,e)||s&&!a(i,e)))}},{key:"loadNamespaces",value:function(e,t){var n=this,r=lV();return this.options.ns?("string"===typeof e&&(e=[e]),e.forEach(function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)}),this.loadResources(function(e){r.resolve(),t&&t(e)}),r):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=lV();"string"===typeof e&&(e=[e]);var r=this.options.preload||[],s=e.filter(function(e){return r.indexOf(e)<0});return s.length?(this.options.preload=r.concat(s),this.loadResources(function(e){n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$V,s=ZV(ZV(ZV({},this.options),t),{isClone:!0}),i=new n(s);void 0===t.debug&&void 0===t.prefix||(i.logger=i.logger.clone(t));return["store","services","language"].forEach(function(t){i[t]=e[t]}),i.services=ZV({},this.services),i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i.translator=new AV(i.services,i.options),i.translator.on("*",function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit.apply(i,[e].concat(n))}),i.init(s,r),i.translator.options=i.options,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),n}(oV);c(ez,"createInstance",function(){return new ez(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)});var tz=ez.createInstance();tz.createInstance=ez.createInstance;tz.createInstance,tz.init,tz.loadResources,tz.reloadResources,tz.use,tz.changeLanguage,tz.getFixedT,tz.t,tz.exists,tz.setDefaultNamespace,tz.hasLoadedNamespace,tz.loadNamespaces,tz.loadLanguages;const nz=tz,rz=JSON.parse('{"title":"AutoCaster - View","email":"Email","password":"Password","placeholderEmail":"you@example.com","placeholderPassword":"Enter password","login":"Login","signingIn":"Signing in...","forgot":"Forgot password?","resetSent":"Password reset email sent","enterEmail":"Please enter your email first.","year":"AutoCaster-View {{year}}","resetTitle":"Reset Password","checking":"Checking...","newPassword":"New Password","confirmPassword":"Confirm Password","savePassword":"Save Password","passwordUpdated":"Password updated!","passwordNotMatch":"Passwords do not match","invalidLink":"Invalid or expired reset link","payment":{"cameraStatus":"Camera Payment & Status","camera":"Camera","status":"Status","nextBilling":"Next Billing","subId":"Subscription ID","invoices":"Invoices","activate":"Activate","cancel":"Cancel","details":"Details","noCameras":"No cameras. Use \u201c+ Add Camera\u201d.","goDashboard":"Back to Dashboard","cancelTitle":"Cancel subscription?","cancelDesc":"The subscription will be canceled on the next billing date. You can continue using the service until then.","cancelInfo":"After the next billing date, no further charges will be made and the subscription will be canceled automatically.","confirmCancel":"Schedule cancellation","cancelFailed":"Failed to cancel the subscription. Please try again.","billingOrCancelDate":"Next billing / Cancellation date","cancelEffectiveDate":"Cancellation date","canceling":"Canceling","cancelScheduled":"Cancel scheduled","cancelScheduledHint":"Cancellation is already scheduled","download":"PDF","noInvoices":"No invoices"},"common":{"back":"Back","processing":"Processing..."}}'),sz=JSON.parse('{"title":"AutoCaster - View","email":"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9","password":"\u30d1\u30b9\u30ef\u30fc\u30c9","placeholderEmail":"you@example.com","placeholderPassword":"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b","login":"\u30ed\u30b0\u30a4\u30f3","signingIn":"\u30b5\u30a4\u30f3\u30a4\u30f3\u4e2d...","forgot":"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5fd8\u308c\u307e\u3057\u305f\u304b\uff1f","resetSent":"\u30d1\u30b9\u30ef\u30fc\u30c9\u30ea\u30bb\u30c3\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f","enterEmail":"\u5148\u306b\u30e1\u30fc\u30eb\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002","year":"AutoCaster-View {{year}}","resetTitle":"\u30d1\u30b9\u30ef\u30fc\u30c9\u518d\u8a2d\u5b9a","checking":"\u78ba\u8a8d\u4e2d...","newPassword":"\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9","confirmPassword":"\u30d1\u30b9\u30ef\u30fc\u30c9\u78ba\u8a8d","savePassword":"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4fdd\u5b58","passwordUpdated":"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\uff01","passwordNotMatch":"\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093","invalidLink":"\u7121\u52b9\u306a\u30ea\u30f3\u30af\u307e\u305f\u306f\u671f\u9650\u5207\u308c\u3067\u3059","payment":{"cameraStatus":"\u30ab\u30e1\u30e9\u652f\u6255\u3044\u30fb\u30b9\u30c6\u30fc\u30bf\u30b9","camera":"\u30ab\u30e1\u30e9","status":"\u30b9\u30c6\u30fc\u30bf\u30b9","nextBilling":"\u6b21\u56de\u8acb\u6c42\u65e5","subId":"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID","invoices":"\u8acb\u6c42\u66f8","activate":"\u6709\u52b9\u5316","cancel":"\u89e3\u7d04","details":"\u8a73\u7d30","noCameras":"\u30ab\u30e1\u30e9\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u300c+ \u30ab\u30e1\u30e9\u8ffd\u52a0\u300d\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002","goDashboard":"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3078\u623b\u308b","cancelTitle":"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u89e3\u7d04\u3057\u307e\u3059\u304b\uff1f","cancelDesc":"\u89e3\u7d04\u306f\u6b21\u56de\u8acb\u6c42\u65e5\u3067\u6709\u52b9\u306b\u306a\u308a\u307e\u3059\u3002\u305d\u308c\u307e\u3067\u306f\u5f15\u304d\u7d9a\u304d\u3054\u5229\u7528\u3044\u305f\u3060\u3051\u307e\u3059\u3002","cancelInfo":"\u6b21\u56de\u8acb\u6c42\u65e5\u4ee5\u964d\u306f\u8acb\u6c42\u3055\u308c\u305a\u3001\u81ea\u52d5\u3067\u89e3\u7d04\u3068\u306a\u308a\u307e\u3059\u3002","confirmCancel":"\u89e3\u7d04\u3092\u4e88\u7d04\u3059\u308b","cancelFailed":"\u89e3\u7d04\u306e\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002","cancelEffectiveDate":"\u89e3\u7d04\u4e88\u5b9a\u65e5","billingOrCancelDate":"\u6b21\u56de\u8acb\u6c42\u65e5 / \u89e3\u7d04\u4e88\u5b9a\u65e5","canceling":"\u89e3\u7d04\u4e88\u5b9a","cancelScheduled":"\u89e3\u7d04\u4e88\u7d04\u6e08\u307f","cancelScheduledHint":"\u3059\u3067\u306b\u89e3\u7d04\u304c\u4e88\u7d04\u3055\u308c\u3066\u3044\u307e\u3059","download":"PDF","noInvoices":"\u8acb\u6c42\u66f8\u304c\u3042\u308a\u307e\u305b\u3093"},"common":{"back":"\u623b\u308b","processing":"\u51e6\u7406\u4e2d\u2026"}}');nz.use(Db).init({resources:{en:{translation:rz},ja:{translation:sz}},lng:(navigator.language||navigator.userLanguage||"en").startsWith("ja")?"ja":"en",fallbackLng:"en",interpolation:{escapeValue:!1}});function iz(){const e=xe(),[t]=Mt(),n=t.get("from")||"";return(0,r.useEffect)(()=>{window.history.pushState({end:!0},"",window.location.href);const t=()=>{e("/capture",{replace:!0})};return window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)},[e]),(0,ub.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center px-4",children:(0,ub.jsxs)("div",{className:"w-full max-w-[420px] text-center",children:[(0,ub.jsx)("div",{className:"mx-auto mb-5 h-24 w-24 rounded-full border-4 border-blue-200 bg-white flex items-center justify-center shadow-sm",children:(0,ub.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white text-xl font-black",children:"\u2713"})}),(0,ub.jsx)("div",{className:"text-2xl mb-2",children:"\u2728"}),(0,ub.jsx)("div",{className:"text-2xl font-black text-slate-900",children:"\u64ae\u5f71\u5b8c\u4e86"}),(0,ub.jsx)("div",{className:"mt-3 text-lg font-extrabold text-blue-600",children:"AutoCaster View"}),(0,ub.jsxs)("div",{className:"mt-2 text-sm text-slate-600 leading-6",children:["\u3054\u5229\u7528\u3044\u305f\u3060\u304d",(0,ub.jsx)("br",{}),(0,ub.jsx)("span",{className:"font-bold text-slate-800",children:"\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f"})]}),n&&(0,ub.jsxs)("div",{className:"mt-4 text-xs font-bold text-slate-400",children:["(",n,")"]})]})})}function az(){return(0,ub.jsx)(_t,{children:(0,ub.jsx)(fb,{children:(0,ub.jsxs)(Qe,{children:[(0,ub.jsx)(qe,{path:"/login",element:(0,ub.jsx)(JS,{})}),(0,ub.jsx)(qe,{path:"/:clientId/login",element:(0,ub.jsx)(JS,{})}),(0,ub.jsx)(qe,{path:"/__/auth/action",element:(0,ub.jsx)(UR,{})}),(0,ub.jsx)(qe,{path:"/reset-password",element:(0,ub.jsx)(FR,{})}),(0,ub.jsx)(qe,{path:"/capture",element:(0,ub.jsx)(qB,{})}),(0,ub.jsx)(qe,{path:"/success",element:(0,ub.jsx)(QB,{})}),(0,ub.jsx)(qe,{path:"/end",element:(0,ub.jsx)(iz,{})}),(0,ub.jsx)(qe,{path:"/reports",element:(0,ub.jsx)(PR,{})}),(0,ub.jsx)(qe,{path:"/:clientId/dashboard",element:(0,ub.jsx)(pb,{children:(0,ub.jsx)(MR,{})})}),(0,ub.jsx)(qe,{path:"/:clientId/camera-status",element:(0,ub.jsx)(pb,{children:(0,ub.jsx)(WA,{})})}),(0,ub.jsx)(qe,{path:"/:clientId/qr",element:(0,ub.jsx)(pb,{children:(0,ub.jsx)(LR,{})})}),(0,ub.jsx)(qe,{path:"/:clientId/report",element:(0,ub.jsx)(pb,{children:(0,ub.jsx)(PR,{})})})]})})})}const oz=document.getElementById("root");if(!oz)throw new Error("Root element #root not found. Check public/index.html has <div id='root'></div>.");i.createRoot(oz).render((0,ub.jsx)(az,{}))})();
//# sourceMappingURL=main.8066d2d0.js.map